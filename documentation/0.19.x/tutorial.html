<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Pustefix Tutorial</title><link rel="stylesheet" href="css/style.css" type="text/css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.73.2"><meta name="description" content="Pustefix Tutorial - Version 0.16.x"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div id="header"><h1><a href="http://pustefix-framework.org/">Pustefix-Framework</a></h1></div><div class="book" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="tutorial"></a>Pustefix Tutorial</h1></div><div><h2 class="subtitle">Version 0.16.x</h2></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Tobias</span> <span class="surname">Fehrenbach</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Martin</span> <span class="surname">Leidig</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Stephan</span> <span class="surname">Schmidt</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Felix</span> <span class="surname">Firgau</span></h3></div></div></div><div><p class="releaseinfo">This tutorial relates to the latest Pustefix release from the 0.16 branch.</p></div><div><p class="copyright">Copyright &copy; 2007, 2008, 2009, 2010, 2011 1&amp;1 Internet AG</p></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="preface"><a href="#introduction">Introduction</a></span></dt><dt><span class="chapter"><a href="#gettingstarted">1. Getting started</a></span></dt><dd><dl><dt><span class="section"><a href="#gettingstarted.requirements">1.1. Requirements</a></span></dt><dt><span class="section"><a href="#gettingstarted.mavensetup">1.2. Maven setup</a></span></dt><dt><span class="section"><a href="#gettingstarted.mavenarchetypes">1.3. Generating a new project from a Maven archetype</a></span></dt><dt><span class="section"><a href="#gettingstarted.ide">1.4. Configure your IDE</a></span></dt><dt><span class="section"><a href="#gettingstarted.getsources">1.5. Getting the source code</a></span></dt></dl></dd><dt><span class="chapter"><a href="#wrapper-handler">2. Basic tutorial</a></span></dt><dd><dl><dt><span class="section"><a href="#wrapper-handler.setup">2.1. Setting up a new project</a></span></dt><dt><span class="section"><a href="#wrapper-handler.structure">2.2. Generated files</a></span></dt><dt><span class="section"><a href="#wrapper-handler.pages">2.3. Creating the pages</a></span></dt><dt><span class="section"><a href="#wrapper-handler.entrypage">2.4. Setting the entry page</a></span></dt><dt><span class="section"><a href="#wrapper-handler.inputform">2.5. Create the input form</a></span></dt><dt><span class="section"><a href="#wrapper-handler.business-logic">2.6. Implementing the business logic</a></span></dt><dd><dl><dt><span class="section"><a href="#wrapper-handler.business-logic.wrapper">2.6.1. Implementing a wrapper</a></span></dt><dt><span class="section"><a href="#wrapper-handler.business-logic.bean">2.6.2. Interlude: Implementing a bean</a></span></dt><dt><span class="section"><a href="#wrapper-handler.business-logic.handler">2.6.3. Implementing a handler</a></span></dt><dt><span class="section"><a href="#wrapper-handler.business-logic.contextresource">2.6.4. Implementing a ContextResource</a></span></dt><dt><span class="section"><a href="#wrapper-handler.business-logic.contextresourcemanager">2.6.5. Accessing a ContextResource</a></span></dt></dl></dd><dt><span class="section"><a href="#wrapper-handler.pageflow">2.7. Implementing the workflow</a></span></dt><dt><span class="section"><a href="#wrapper-handler.errors">2.8. Displaying errors</a></span></dt><dt><span class="section"><a href="#wrapper-handler.domtree">2.9. Displaying the entered data</a></span></dt><dt><span class="section"><a href="#wrapper-handler.save">2.10. Saving the data</a></span></dt><dt><span class="section"><a href="#wrapper-handler.tweaks">2.11. The finishing touch</a></span></dt><dd><dl><dt><span class="section"><a href="#wrapper-handler.tweaks.retrieve">2.11.1. Changing data</a></span></dt><dt><span class="section"><a href="#wrapper-handler.tweaks.needsdata">2.11.2. Avoiding unwanted access</a></span></dt></dl></dd><dt><span class="section"><a href="#wrapper-handler.conclusion">2.12. Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="#user-manager">3. Usermanager tutorial</a></span></dt><dd><dl><dt><span class="section"><a href="#um.newproject">3.1. Setup</a></span></dt><dt><span class="section"><a href="#um.newbean">3.2. Create a new bean</a></span></dt><dt><span class="section"><a href="#um.userhandler">3.3. Create the handler</a></span></dt><dt><span class="section"><a href="#um.caster">3.4. Create a caster</a></span></dt><dd><dl><dt><span class="section"><a href="#um.caster.statuscode">3.4.1. Create a new statuscode for the caster</a></span></dt><dt><span class="section"><a href="#um.caster.tourl">3.4.2. Create the ToURL-caster</a></span></dt></dl></dd><dt><span class="section"><a href="#um.beanannotations">3.5. Annotate the User bean</a></span></dt><dd><dl><dt><span class="section"><a href="#um.beanannotations.class">3.5.1. Annotate the class declaration</a></span></dt><dt><span class="section"><a href="#um.beanannotations.getter">3.5.2. Annotate the getter</a></span></dt></dl></dd><dt><span class="section"><a href="#um.generation">3.6. Generate wrapper</a></span></dt><dt><span class="section"><a href="#um.userlist">3.7. Create a userlist class</a></span></dt><dt><span class="section"><a href="#um.contextresource">3.8. Adjust the servlet configuration</a></span></dt><dt><span class="section"><a href="#d0e1644">3.9. Add a new user</a></span></dt><dt><span class="section"><a href="#um.pages">3.10. Create the pages</a></span></dt><dd><dl><dt><span class="section"><a href="#um.pages.userform">3.10.1. Create a page for user data input</a></span></dt><dt><span class="section"><a href="#um.pages.overview">3.10.2. Create page for listing users</a></span></dt><dt><span class="section"><a href="#um.pages.configuration">3.10.3. Add pages to xml configuration files</a></span></dt></dl></dd><dt><span class="section"><a href="#um.pageflow">3.11. Add a pageflow</a></span></dt><dt><span class="section"><a href="#um.tryout">3.12. Try to add your own user</a></span></dt><dt><span class="section"><a href="#um.sampleusers">3.13. Add sample users</a></span></dt><dd><dl><dt><span class="section"><a href="#um.sampleusers.constructor">3.13.1. Add new constructors to your <code class="classname">UserList</code></a></span></dt><dt><span class="section"><a href="#um.sampleusers.initmethod">3.13.2. Add init method to UserList</a></span></dt></dl></dd><dt><span class="section"><a href="#um.deleteuser">3.14. New feature: Delete a user</a></span></dt><dd><dl><dt><span class="section"><a href="#um.deleteuser.bean">3.14.1. Create a new bean</a></span></dt><dt><span class="section"><a href="#um.deleteuser.handler">3.14.2. Create a new handler</a></span></dt><dt><span class="section"><a href="#um.deleteuser.annotations">3.14.3. Annotate the DeleteUser bean</a></span></dt><dt><span class="section"><a href="#um.deleteuser.generate">3.14.4. Generate the wrapper class</a></span></dt><dt><span class="section"><a href="#um.deleteuser.method">3.14.5. Add a delete user method</a></span></dt><dt><span class="section"><a href="#um.deleteuser.handlesubmitteddata">3.14.6. Delete a user</a></span></dt><dt><span class="section"><a href="#um.deleteuser.button">3.14.7. Add a delete button</a></span></dt><dt><span class="section"><a href="#um.deleteuser.configuration">3.14.8. Adjust the servlet configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#um.edituser">3.15. New feature: Edit a user</a></span></dt><dd><dl><dt><span class="section"><a href="#um.edituser.bean">3.15.1. Create a new bean</a></span></dt><dt><span class="section"><a href="#um.edituser.handler">3.15.2. Create a new handler</a></span></dt><dt><span class="section"><a href="#um.edituser.annotations">3.15.3. Annotate the EditUser bean</a></span></dt><dt><span class="section"><a href="#um.edituser.generate">3.15.4. Generate the wrapper class</a></span></dt><dt><span class="section"><a href="#um.edituser.method">3.15.5. Add a method to replace a user of our UserList class</a></span></dt><dt><span class="section"><a href="#um.edituser.handlesubmitteddata">3.15.6. Edit a user</a></span></dt><dt><span class="section"><a href="#um.edituser.button">3.15.7. Add an edit button</a></span></dt><dt><span class="section"><a href="#um.edituser.configuration">3.15.8. Adjust the servlet configuration</a></span></dt><dt><span class="section"><a href="#um.edituser.userhandler">3.15.9. Add user to form</a></span></dt><dt><span class="section"><a href="#d0e2114">3.15.10. Replace method handleSubmittedData of UserHandler</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2124">3.16. Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ajax-calculator">4. AJAX Calculator tutorial</a></span></dt><dd><dl><dt><span class="section"><a href="#ajax-calculator.setup">4.1. Setup</a></span></dt><dt><span class="section"><a href="#ajax-calculator.servlet">4.2. Using the webservice servlet</a></span></dt><dt><span class="section"><a href="#ajax-calculator.businesslogic">4.3. Implementing the business logic</a></span></dt><dt><span class="section"><a href="#ajax-calculator.expose">4.4. Exposing the service</a></span></dt><dt><span class="section"><a href="#ajax-calculator.consume">4.5. Consuming the service</a></span></dt><dt><span class="section"><a href="#ajax-calculator.conclusion">4.6. Conclusion</a></span></dt></dl></dd></dl></div><div class="list-of-figures"><p><b>List of Figures</b></p><dl><dt>2.1. <a href="#wrapper-handler.first-app">The new Pustefix project</a></dt></dl></div><div class="list-of-tables"><p><b>List of Tables</b></p><dl><dt>4.1. <a href="#ajax-calculator.servlet.config">Global webservice configuration </a></dt><dt>4.2. <a href="#ajax-calculator.expose.config">Local webservice configuration</a></dt></dl></div><div class="preface" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="introduction"></a>Introduction</h2></div></div></div><p>
    These tutorials are meant as a starting point for developers that have never worked with Pustefix.
    They introduce you to the different types of applications that can be implemented with Pustefix.
    Of course, they can only scratch at the surface of most of the features, if you are interested in 
    an in-depth look at Pustefix, refer to the reference documentation. 
  </p><p>
    You can either work through the tutorial by following the instructions and create the applications 
    from scratch (the preferred way for first-time Pustefix users) or you can just check out the complete
    source code (see  <a class="xref" href="#gettingstarted.getsources" title="1.5.&nbsp;Getting the source code">Section&nbsp;1.5, &#8220;Getting the source code&#8221;</a>).
  </p><p></p></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="gettingstarted"></a>Getting started</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#gettingstarted.requirements">1.1. Requirements</a></span></dt><dt><span class="section"><a href="#gettingstarted.mavensetup">1.2. Maven setup</a></span></dt><dt><span class="section"><a href="#gettingstarted.mavenarchetypes">1.3. Generating a new project from a Maven archetype</a></span></dt><dt><span class="section"><a href="#gettingstarted.ide">1.4. Configure your IDE</a></span></dt><dt><span class="section"><a href="#gettingstarted.getsources">1.5. Getting the source code</a></span></dt></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gettingstarted.requirements"></a>1.1.&nbsp;Requirements</h2></div></div></div><p>
     Before we can get started, you have to make sure that some requirements
     are met by your development environment. You will need:
    </p><div class="itemizedlist"><ul type="disc"><li><p>JDK 5.0 or newer</p></li><li><p>
          POSIX-like operating system (Pustefix has been tested with Linux
          and Mac OS X, but might also work with other systems like *BSD)
        </p></li><li><p>Apache Maven 2.0.10 or newer</p></li></ul></div><p>
      The installation of these tools is not covered by this
      tutorial. Please refer to the documentation provided with these tools
      for installation instructions.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gettingstarted.mavensetup"></a>1.2.&nbsp;Maven setup</h2></div></div></div><p>
      Pustefix provides some Maven archetypes for quickly creating new applications. Therefore you
      have to configure the repository where the according Pustefix artifacts reside (because
      they currently aren't hosted in the Maven central repository).  
    </p><p>
      You can either configure the repository globally for Maven or always specify the URL of the repository's
      archetype-catalog when generating a new project (and add the repository configuration to the project's POM,
      if not already there). If you don't want to configure it globally,
      you can skip the next paragraphs and continue with the archetype generation in the next section.
    </p><p>
      Adding the Pustefix repository can be easily done by adding the following profile to the
      Maven settings. The profile can be either added to the <code class="filename">settings.xml</code>
      file located in the <code class="filename">.m2</code> directory within your home directory (if it
      doesn't already exist you can just create it) or to the <code class="filename">settings.xml</code> file 
      located in the <code class="filename">conf</code> directory of your Maven installation.
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">settings</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">profiles</b>&gt;

    &lt;<b class="hl-tag" style="color: blue">profile</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">id</b>&gt;pustefix&lt;<b class="hl-tag" style="color: blue">/id</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">activation</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">activeByDefault</b>&gt;true&lt;<b class="hl-tag" style="color: blue">/activeByDefault</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">/activation</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">repositories</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">repository</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">id</b>&gt;pustefix&lt;<b class="hl-tag" style="color: blue">/id</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">name</b>&gt;Pustefix Maven Repository&lt;<b class="hl-tag" style="color: blue">/name</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">url</b>&gt;http://pustefix-framework.org/repository/maven&lt;<b class="hl-tag" style="color: blue">/url</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">/repository</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">/repositories</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">pluginRepositories</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">pluginRepository</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">id</b>&gt;pustefix&lt;<b class="hl-tag" style="color: blue">/id</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">url</b>&gt;http://pustefix-framework.org/repository/maven&lt;<b class="hl-tag" style="color: blue">/url</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">/pluginRepository</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">/pluginRepositories</b>&gt; 

    &lt;<b class="hl-tag" style="color: blue">/profile</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/profiles</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/settings</b>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gettingstarted.mavenarchetypes"></a>1.3.&nbsp;Generating a new project from a Maven archetype</h2></div></div></div><p>
      Pustefix provides an archetype for creating a basic application. Just call <code class="literal">mvn archetype:generate</code>
      and select the archetype <code class="literal">pustefix-archetype-basic</code>:
    </p><pre class="screen">
      $ mvn archetype:generate</pre><p>
      After choosing the <code class="literal">pustefix-archetype-basic</code> Maven will ask you for your project's <code class="literal">groupId</code>, 
      <code class="literal">artifactId</code>, <code class="literal">version</code> and <code class="literal">package</code>.
      Having finished these settings Maven will generate the new project within a new directory called like the <code class="literal">artifactId</code>
      and located within the current working directory.
    </p><pre class="screen">
      $ cd myproject
      $ mvn tomcat:run</pre><p>
      The generated project is a standard Maven project with <code class="literal">war</code> packaging type, i.e. you can immediately build and
      run your application, e.g. using Tomcat by calling <code class="literal">mvn tomcat:run</code> or <code class="literal">mvn tomcat:run-war</code> and
      opening <code class="literal">http://localhost:8080/myproject</code> in your browser.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gettingstarted.ide"></a>1.4.&nbsp;Configure your IDE</h2></div></div></div><p>
      You can use the IDE of your choice. As a Pustefix project is a standard Maven project, you can
      use an arbitrary IDE supporting projects with Maven layout.
    </p><p>
      Eclipse will be a good choice, e.g. you can just generate an according Eclipse configuration for your project
      using the Eclipse Maven plugin:
    </p><pre class="screen">
      $ mvn eclipse:eclipse</pre><p>
      Then you can import your project into Eclipse. Doing this the first time you will have to add 
      the <code class="literal">M2_REPO</code> classpath variable pointing to your local Maven repository
      (usually <code class="literal">.m2/repository</code> within your home directory). This can be done by 
      opening the <span class="guimenu">Window</span> &#8658; <span class="guimenuitem">Preferences</span> dialog
      and navigating to <span class="guimenu">Java</span> &#8658; <span class="guimenuitem">Build Path</span> &#8658;
      <span class="guimenuitem">Classpath Variables</span>
      (also see the <a class="link" href="http://maven.apache.org/guides/mini/guide-ide-eclipse.html">Maven Eclipse documentation</a>).
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gettingstarted.getsources"></a>1.5.&nbsp;Getting the source code</h2></div></div></div><p>
    The source code used in the tutorials is available for public checkout. To test the tutorials on
    your local development machine, execute the following commands:
  </p><pre class="screen">$ svn co https://pustefix.svn.sourceforge.net/svnroot/pustefix/tags/pustefixframework-0.18.x/pustefix-tutorial
$ cd pustefix-tutorial/ajax-calculator (or first-app, usermanagement)
$ mvn tomcat:run</pre></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="wrapper-handler"></a>Basic tutorial</h1></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Martin</span> <span class="surname">Leidig</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Stephan</span> <span class="surname">Schmidt</span></h3></div></div></div><div><p class="copyright">Copyright &copy; 2008 1&amp;1 Internet AG</p></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#wrapper-handler.setup">2.1. Setting up a new project</a></span></dt><dt><span class="section"><a href="#wrapper-handler.structure">2.2. Generated files</a></span></dt><dt><span class="section"><a href="#wrapper-handler.pages">2.3. Creating the pages</a></span></dt><dt><span class="section"><a href="#wrapper-handler.entrypage">2.4. Setting the entry page</a></span></dt><dt><span class="section"><a href="#wrapper-handler.inputform">2.5. Create the input form</a></span></dt><dt><span class="section"><a href="#wrapper-handler.business-logic">2.6. Implementing the business logic</a></span></dt><dd><dl><dt><span class="section"><a href="#wrapper-handler.business-logic.wrapper">2.6.1. Implementing a wrapper</a></span></dt><dt><span class="section"><a href="#wrapper-handler.business-logic.bean">2.6.2. Interlude: Implementing a bean</a></span></dt><dt><span class="section"><a href="#wrapper-handler.business-logic.handler">2.6.3. Implementing a handler</a></span></dt><dt><span class="section"><a href="#wrapper-handler.business-logic.contextresource">2.6.4. Implementing a ContextResource</a></span></dt><dt><span class="section"><a href="#wrapper-handler.business-logic.contextresourcemanager">2.6.5. Accessing a ContextResource</a></span></dt></dl></dd><dt><span class="section"><a href="#wrapper-handler.pageflow">2.7. Implementing the workflow</a></span></dt><dt><span class="section"><a href="#wrapper-handler.errors">2.8. Displaying errors</a></span></dt><dt><span class="section"><a href="#wrapper-handler.domtree">2.9. Displaying the entered data</a></span></dt><dt><span class="section"><a href="#wrapper-handler.save">2.10. Saving the data</a></span></dt><dt><span class="section"><a href="#wrapper-handler.tweaks">2.11. The finishing touch</a></span></dt><dd><dl><dt><span class="section"><a href="#wrapper-handler.tweaks.retrieve">2.11.1. Changing data</a></span></dt><dt><span class="section"><a href="#wrapper-handler.tweaks.needsdata">2.11.2. Avoiding unwanted access</a></span></dt></dl></dd><dt><span class="section"><a href="#wrapper-handler.conclusion">2.12. Conclusion</a></span></dt></dl></div><p>
    In this tutorial, you will learn how to work with the basic features provided by the Pustefix framework.
    You will accept user input, store it in the session and display it back to the user.
    Furthermore, you will create a very simple workflow containing three pages.  
  </p><p>
    The requirements for your application are:
  </p><div class="orderedlist"><ol type="1"><li><p>
        Provide an HTML form that can be used to register new users. The data for a new user must contain:
        gender, name, email-address, homepage, date of birth and a flag to mark the user as an administrator.
      </p></li><li><p>
        Validate the user data after the page has been submitted and display error information.
      </p></li><li><p>
        If the entered data is correct, move to a new page, which displays the user data and allows the
        user to choose whether he wants to go back and modify the data or accept the data.
      </p></li><li><p>
        After the data has been stored, display a confirmation page to the user.
      </p></li></ol></div><p>
    In this tutorial application, you will focus on how the requirements will be implemented in
    the Pustefix framework. There will be no real business logic like actually storing the
    user data in any data base. These tasks are left to your favorite ORM framework.
  </p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="wrapper-handler.setup"></a>2.1.&nbsp;Setting up a new project</h2></div></div></div><p>
      Before you can start developing the application, make sure that your system
      fulfills all requirements that are mentioned in <a class="xref" href="#gettingstarted.requirements" title="1.1.&nbsp;Requirements">Section&nbsp;1.1, &#8220;Requirements&#8221;</a>.
    </p><p>
      If your environment is set up correctly, you may create a new Pustefix project. For this
      tutorial, please name the project <span class="emphasis"><em>firstapp</em></span>. A new Pustefix project
      can be created using a Maven archetype as described in <a class="xref" href="#gettingstarted.mavensetup" title="1.2.&nbsp;Maven setup">Section&nbsp;1.2, &#8220;Maven setup&#8221;</a> 
      and <a class="xref" href="#gettingstarted.mavenarchetypes" title="1.3.&nbsp;Generating a new project from a Maven archetype">Section&nbsp;1.3, &#8220;Generating a new project from a Maven archetype&#8221;</a>.
      The project name corresponds to the artifactId, so you should enter <span class="emphasis"><em>firstapp</em></span> when
      you're asked by Maven. You should further choose <span class="emphasis"><em>org.pustefixframework.tutorial</em></span> as
      groupId and <span class="emphasis"><em>org.pustefixframework.tutorial.firstapp</em></span> as package name
      (you can choose other names, but you will have to replace the recommended names wherever used in this tutorial).
    </p><p>
      After Maven successfully created the new project, you can start it using <code class="literal">mvn tomcat:run</code>
      and open it in your browser under <code class="uri">http://localhost:8080/firstapp</code>.
      Figure <a class="xref" href="#wrapper-handler.first-app" title="Figure&nbsp;2.1.&nbsp;The new Pustefix project">Figure&nbsp;2.1, &#8220;The new Pustefix project&#8221;</a> shows the output of the new Pustefix project.
    </p><div class="figure"><a name="wrapper-handler.first-app"></a><p class="title"><b>Figure&nbsp;2.1.&nbsp;The new Pustefix project</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/tutorial/first-app.png" alt="The new Pustefix project"></div></div></div><br class="figure-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="wrapper-handler.structure"></a>2.2.&nbsp;Generated files</h2></div></div></div><p>
      Maven generated a working application for you. All relevant files have been put
      into the <code class="filename">firstapp</code> folder within your working directory. Please take a look at the most important folders:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          The <code class="filename">src/main/webapp/WEB-INF</code> folder contains all configuration files for your applications. These are:
        </p><div class="itemizedlist"><ul type="circle"><li><p>
              <code class="filename">project.xml</code> contains general project information, framework configuration, e.g. for the
              rendering system, exception processing, path mappings for static resources, etc.
            </p></li><li><p>
              <code class="filename">app.xml</code> contains the configuration concerning the Java part of the application, e.g. pagerequests and assigned Java
              framework classes
            </p></li><li><p>
              <code class="filename">depend.xml</code> contains the configuration concerning the XML/XSLT part of the application, e.g. pages and XSL stylesheets used in
              your project.
            </p></li><li><p>
              <code class="filename">web.xml</code> contains servlet configuration and mappings.
            </p></li><li><p>
              <code class="filename">spring.xml</code> is empty by default and can be used to configure your Spring beans.
            </p></li><li><p>
              <code class="filename">pfixlog.xml</code> contains the log4j configuration.
            </p></li></ul></div></li><li><p>
            The <code class="filename">src/main/webapp</code> folder also contains resource folders. These are:
          </p><div class="itemizedlist"><ul type="circle"><li><p>
          The <code class="filename">css</code> and <code class="filename">img</code> folders contain
          CSS files and images which should be delivered as static resources.
        </p></li><li><p>
          The <code class="filename">txt</code> folder contains the web pages, i.e. the according XML content and fragments.
        </p></li><li><p>
          The <code class="filename">xml</code> folder contains the different frames of your application. A frame is an
          XML document which will be used for every page that is generated. This way, you can easily share
          header, footer and navigation between all pages.
        </p></li><li><p>
          The <code class="filename">xsl</code> folder contains XSL stylesheets that are only used in your application
          (not including XSL stylesheets provided by Pustefix itself).
        </p></li></ul></div></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="wrapper-handler.pages"></a>2.3.&nbsp;Creating the pages</h2></div></div></div><p>
      Start implementing your application by adding the three needed pages to the application:
      <code class="literal">EnterData</code>, <code class="literal">ReviewData</code> and <code class="literal">Confirm</code>.
    </p><p>
      New pages are added by editing the <code class="filename">src/main/webapp/WEB-INF/depend.xml</code> file. For each page, you
      have to add two XML tags: 
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          The <code class="literal">&lt;page/&gt;</code> tag defines the servlet, that handles the request to this page.
          All three pages will be handled by the <code class="literal">app</code> servlet, which is available at
          <code class="literal">xml/app</code>.
        </p></li><li><p>
          The <code class="literal">&lt;standardpage/&gt;</code> tag defines the layout of the page by specifying the
          XML frame that should be used. Again, all three pages will be rendered using the standard
          frame that has been generated by the setup script.
        </p></li></ul></div><p>
      You can just remove or alter the according tags for the predefined pages. The new configuration should look like this:
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">make</b> <span class="hl-attribute" style="color: blue">lang</span>=<span class="hl-value" style="color: blue">"en_GB"</span> <span class="hl-attribute" style="color: blue">project</span>=<span class="hl-value" style="color: blue">"firstapp"</span>&gt;

  &lt;<i class="hl-comment" style="color: silver">!--
    Metatags have been left out.
  --</i>&gt;
  
  &lt;<b class="hl-tag" style="color: blue">standardpage</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"EnterData"</span> <span class="hl-attribute" style="color: blue">xml</span>=<span class="hl-value" style="color: blue">"xml/frame.xml"</span>/&gt;
  &lt;<b class="hl-tag" style="color: blue">standardpage</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"ReviewData"</span> <span class="hl-attribute" style="color: blue">xml</span>=<span class="hl-value" style="color: blue">"xml/frame.xml"</span>/&gt;
  &lt;<b class="hl-tag" style="color: blue">standardpage</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"Confirm"</span> <span class="hl-attribute" style="color: blue">xml</span>=<span class="hl-value" style="color: blue">"xml/frame.xml"</span>/&gt;
  
&lt;<b class="hl-tag" style="color: blue">/make</b>&gt;</pre><p>
      You can now open the <code class="literal">EnterData</code> page by browsing to <code class="uri">http://localhost:8080/firstapp/xml/app/EnterData</code>.
    </p><p>
      As you did not provide any content for this page, Pustefix will display an error icon. When hovering
      over this icon, you can see, that the content of the page in the file <code class="filename">txt/pages/EnterData.xml</code>
      is missing.
    </p><p>
      This problem can easily be solved by adding the file <code class="filename">src/main/webapp/txt/pages/EnterData.xml</code>:
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">include_parts</b> <span class="hl-attribute" style="color: blue">xmlns:ixsl</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/1999/XSL/Transform"</span> <span class="hl-attribute" style="color: blue">xmlns:pfx</span>=<span class="hl-value" style="color: blue">"http://www.schlund.de/pustefix/core"</span>&gt;
  &lt;<b class="hl-tag" style="color: blue">part</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"content"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">theme</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"default"</span>&gt;
      &lt;<b class="hl-tag" style="color: blue">h1</b>&gt;Register new user&lt;<b class="hl-tag" style="color: blue">/h1</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">/theme</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/part</b>&gt;
 &lt;<b class="hl-tag" style="color: blue">/include_parts</b>&gt;</pre><p>
      If you reload the page, you will see the <code class="literal">Register new user</code> headline. Now repeat this 
      step for all three pages (you can remove/alter the predefined pages which are no longer used).
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="wrapper-handler.entrypage"></a>2.4.&nbsp;Setting the entry page</h2></div></div></div><p>
      If you open the application in your browser without specifying the page directly, Pustefix will redirect
      you to <code class="filename">xml/app/Home</code>, which is the default page generated by the Maven archetype (you will get
      an error message, if you already removed the page in the previous step). Desired behaviour would
      be, that the <code class="literal">EnterData</code> page is displayed, when your application is started.
      This can be changed in the configuration in <code class="filename">src/main/webapp/WEB-INF/app.xml</code>:
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">context-xml-service-config</b>&gt;
  
  &lt;<b class="hl-tag" style="color: blue">global-config</b> /&gt;

  &lt;<b class="hl-tag" style="color: blue">context</b> <span class="hl-attribute" style="color: blue">defaultpage</span>=<span class="hl-value" style="color: blue">"EnterData"</span>&gt;
    ...
  &lt;<b class="hl-tag" style="color: blue">/context</b>&gt;

  ...

&lt;<b class="hl-tag" style="color: blue">/context-xml-service-config</b>&gt;</pre><p>
      The entry page is specified using the <code class="literal">defaultpage</code> attribute of the
      <code class="literal">&lt;context/&gt;</code> tag. After you set this attribute to <code class="literal">EnterData</code>
      open the URL <code class="uri">http://localhost:8080/firstapp</code> in your browser and you will be automatically
      redirected to the page to register new users.
    </p><p>
      After you changed the entry page, you can get completely rid of the generated/predefined pages by
      following these steps (if not already done before):
    </p><div class="orderedlist"><ol type="1"><li><p>
          Delete the XML files for the predefined pages from the <code class="filename">src/main/webapp/txt/pages</code> folder.
        </p></li><li><p>
          Remove the <code class="literal">&lt;pagerequest/&gt;</code> and <code class="literal">&lt;pageflow&gt;</code> tags
          for the predefined pages from the <code class="filename">src/main/webapp/WEB-INF/app.xml</code> file.
        </p></li><li><p>
          Remove the <code class="literal">&lt;page/&gt;</code> and <code class="literal">&lt;standardpage/&gt;</code> tags for the
          predefined pages from the <code class="filename">src/main/webapp/WEB-INF/depend.xml</code> file.
        </p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="wrapper-handler.inputform"></a>2.5.&nbsp;Create the input form</h2></div></div></div><p>
      Next, you have to create the HTML form to accept the data of a new user. To create the form, you should
      not use the standard HTML tags, but the replacements by Pustefix, which automatically write back the data
      from the business logic to the HTML page.
    </p><p>
      The form has to be added to <code class="filename">txt/pages/main_EnterData.xml</code>:
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">include_parts</b> <span class="hl-attribute" style="color: blue">xmlns:ixsl</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/1999/XSL/Transform"</span> <span class="hl-attribute" style="color: blue">xmlns:pfx</span>=<span class="hl-value" style="color: blue">"http://www.schlund.de/pustefix/core"</span>&gt;
  &lt;<b class="hl-tag" style="color: blue">part</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"content"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">theme</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"default"</span>&gt;
      &lt;<b class="hl-tag" style="color: blue">h1</b>&gt;Register new user&lt;<b class="hl-tag" style="color: blue">/h1</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">pfx:forminput</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">table</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">tr</b>&gt;
            &lt;<b class="hl-tag" style="color: blue">td</b>&gt;Gender:&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
            &lt;<b class="hl-tag" style="color: blue">td</b>&gt;
              &lt;<b class="hl-tag" style="color: blue">pfx:xinp</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"select"</span> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.sex"</span>&gt;
                &lt;<b class="hl-tag" style="color: blue">pfx:option</b> <span class="hl-attribute" style="color: blue">value</span>=<span class="hl-value" style="color: blue">"m"</span>&gt;male&lt;<b class="hl-tag" style="color: blue">/pfx:option</b>&gt;
                &lt;<b class="hl-tag" style="color: blue">pfx:option</b> <span class="hl-attribute" style="color: blue">value</span>=<span class="hl-value" style="color: blue">"f"</span>&gt;female&lt;<b class="hl-tag" style="color: blue">/pfx:option</b>&gt;
              &lt;<b class="hl-tag" style="color: blue">/pfx:xinp</b>&gt;
            &lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">/tr</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">tr</b>&gt;
            &lt;<b class="hl-tag" style="color: blue">td</b>&gt;Name:&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
            &lt;<b class="hl-tag" style="color: blue">td</b>&gt;&lt;<b class="hl-tag" style="color: blue">pfx:xinp</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"text"</span> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.name"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">/tr</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">tr</b>&gt;
            &lt;<b class="hl-tag" style="color: blue">td</b>&gt;Email:&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
            &lt;<b class="hl-tag" style="color: blue">td</b>&gt;&lt;<b class="hl-tag" style="color: blue">pfx:xinp</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"text"</span> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.email"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">/tr</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">tr</b>&gt;
            &lt;<b class="hl-tag" style="color: blue">td</b>&gt;Homepage:&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
            &lt;<b class="hl-tag" style="color: blue">td</b>&gt;&lt;<b class="hl-tag" style="color: blue">pfx:xinp</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"text"</span> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.homepage"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">/tr</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">tr</b>&gt;
            &lt;<b class="hl-tag" style="color: blue">td</b>&gt;Birthdate:&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
            &lt;<b class="hl-tag" style="color: blue">td</b>&gt;&lt;<b class="hl-tag" style="color: blue">pfx:xinp</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"text"</span> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.birthdate"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">/tr</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">tr</b>&gt;
            &lt;<b class="hl-tag" style="color: blue">td</b>&gt;Administrator:&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
            &lt;<b class="hl-tag" style="color: blue">td</b>&gt;&lt;<b class="hl-tag" style="color: blue">pfx:xinp</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"check"</span> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.admin"</span> <span class="hl-attribute" style="color: blue">value</span>=<span class="hl-value" style="color: blue">"true"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">/tr</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">/table</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">pfx:xinp</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"submit"</span> <span class="hl-attribute" style="color: blue">value</span>=<span class="hl-value" style="color: blue">"register"</span>/&gt;
      &lt;<b class="hl-tag" style="color: blue">/pfx:forminput</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">/theme</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/part</b>&gt;
 &lt;<b class="hl-tag" style="color: blue">/include_parts</b>&gt;</pre><p>
      See the Pustefix reference documentation for more information about the XML tags that have been used in
      this page.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="wrapper-handler.business-logic"></a>2.6.&nbsp;Implementing the business logic</h2></div></div></div><p>
      Now that you have finished most of the HTML frontend, you should start implementing the business logic.
      The business logic in Pustefix applications mostly consists of three parts:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          A <code class="literal">wrapper</code> is used to extract the user input from the HTTP-request, executes
          some checks and casts the data to the desired Java types. A <code class="literal">wrapper</code> is also used
          to write the values and/or error information back to the response. It connects your HTML frontend
          with your application logic. 
        </p></li><li><p>
          A <code class="literal">handler</code> processes the HTTP request. It extracts the user input from the <code class="literal">wrapper</code>,
          executes additional information and does whatever is necessary in the specific application. You have all the power
          provided by Java at your command when implementing a <code class="literal">handler</code>.
        </p><p>
          A handler does not have direct access to the HTTP request, HTTP session or HTTP response.
        </p></li><li><p>
          A <code class="literal">ContextResource</code> allows you to store any data in the Pustefix <code class="literal">Context</code> and thus
          in the HTTP-session.
        </p><p>
          A <code class="literal">ContextResource</code> furthermore allows you to add XML data to the <code class="literal">ResultDocument</code>
          which is the Pustefix way to pass information to the HTML frontend.
        </p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="wrapper-handler.business-logic.wrapper"></a>2.6.1.&nbsp;Implementing a wrapper</h3></div></div></div><p>
        When implementing the business logic you will always start by implementing a wrapper.
        Wrappers in Pustefix usually are implemented using XML, which will then be used to generate a Java class for the
        wrapper. Alternatively Wrappers can be defined using annotated Java beans (see the reference documentation). 
      </p><p>
        Before you can implement a new wrapper, you will have to create a new Java package <code class="literal">org.pustefixframework.tutorial.firstapp.wrapper</code>
        which will then contain the new wrapper (if you started with the Maven archetype, the package should already exist). After the package has been created, create a new <code class="filename">EnterUserDataWrapper.iwrp</code> file for the wrapper
        and paste the following content into this new file:
      </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">interface</b> <span class="hl-attribute" style="color: blue">xmlns</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/iwrapper"</span>
           <span class="hl-attribute" style="color: blue">xmlns:xsi</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/2001/XMLSchema-instance"</span>
           <span class="hl-attribute" style="color: blue">xsi:schemaLocation</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/iwrapper 
                               http://www.pustefix-framework.org/2008/namespace/iwrapper.xsd"</span>&gt;
  
  &lt;<i class="hl-comment" style="color: silver">!-- This handler will process the data --</i>&gt;
  &lt;<b class="hl-tag" style="color: blue">ihandler</b> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.firstapp.handler.EnterUserDataHandler"</span>/&gt;
  
  &lt;<i class="hl-comment" style="color: silver">!-- Parameters that have to be extracted from the request --</i>&gt;
  &lt;<b class="hl-tag" style="color: blue">param</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"sex"</span> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"java.lang.String"</span> <span class="hl-attribute" style="color: blue">occurrence</span>=<span class="hl-value" style="color: blue">"mandatory"</span>/&gt;
  &lt;<b class="hl-tag" style="color: blue">param</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"name"</span> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"java.lang.String"</span> <span class="hl-attribute" style="color: blue">occurrence</span>=<span class="hl-value" style="color: blue">"mandatory"</span>/&gt;
  &lt;<b class="hl-tag" style="color: blue">param</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"email"</span> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"java.lang.String"</span> <span class="hl-attribute" style="color: blue">occurrence</span>=<span class="hl-value" style="color: blue">"mandatory"</span>/&gt;
  &lt;<b class="hl-tag" style="color: blue">param</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"homepage"</span> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"java.lang.String"</span> <span class="hl-attribute" style="color: blue">occurrence</span>=<span class="hl-value" style="color: blue">"optional"</span>/&gt;
  &lt;<b class="hl-tag" style="color: blue">param</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"birthdate"</span> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"java.lang.String"</span> <span class="hl-attribute" style="color: blue">occurrence</span>=<span class="hl-value" style="color: blue">"optional"</span>/&gt;
  &lt;<b class="hl-tag" style="color: blue">param</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"admin"</span> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"java.lang.Boolean"</span> <span class="hl-attribute" style="color: blue">occurrence</span>=<span class="hl-value" style="color: blue">"optional"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">default</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">value</b>&gt;false&lt;<b class="hl-tag" style="color: blue">/value</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">/default</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">caster</b> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"de.schlund.pfixcore.generator.casters.ToBoolean"</span>/&gt;
  &lt;<b class="hl-tag" style="color: blue">/param</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/interface</b>&gt;</pre><p>
        The wrapper defines various options:
      </p><div class="orderedlist"><ol type="1"><li><p>
            Using the <code class="literal">&lt;ihandler/&gt;</code> tag, you define the name of the class that will do
            the request processing for this handler. This class will be implemented at a later point (see
            <a class="xref" href="#wrapper-handler.business-logic.handler" title="2.6.3.&nbsp;Implementing a handler">Section&nbsp;2.6.3, &#8220;Implementing a handler&#8221;</a> if you are too curious).
          </p></li><li><p>
            The different <code class="literal">&lt;param/&gt;</code> tags are used to define the different parameters that
            should be extracted from the HTTP request. For each parameter you define the name and the type of the data.
            All parameters except the admin-flag are String parameters, the admin-flag should be casted to a <code class="literal">boolean</code>
            value. This can be achieved by setting the <code class="literal">type</code> attribute to <code class="literal">java.lang.Boolean</code>
            and supplying a <code class="literal">&lt;caster/&gt;</code> tag that specifies a class to to the conversion for
            you. The class <code class="literal">de.schlund.pfixcore.generator.casters.ToBoolean</code> is provided by the 
            Pustefix framework.
          </p><p>
            For each parameter you may also specify a default value and define whether the parameter is mandatory or
            not. For more information on the differen <code class="literal">wrapper</code> features, please refer to the 
            reference documentation.
          </p></li></ol></div><p>
        After you created the <code class="literal">iwrp</code> definition, please run <span class="command"><strong>mvn generate-sources</strong></span> to
        generate the Java class for this wrapper:
      </p><pre class="screen">$ mvn generate-sources
[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------------
[INFO] Building Pustefix Basic Application
[INFO]    task-segment: [generate-sources]
[INFO] ------------------------------------------------------------------------
...
[INFO] [pustefix-iwrapper:generate {execution: default}]
[INFO] Generated 1 IWrapper class
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
...
</pre><p>
        After <code class="literal">Maven</code> has finished the build, you will find a new class
        <code class="literal">org.pustefixframework.tutorial.firstapp.wrapper.EnterUserDataWrapper</code> in the
        <code class="filename">target/generated-sources/iwrapper</code> folder of your installation.
        This file contains all information needed to extract the parameters from the request.
      </p><p>
        If you refresh your IDE or compile you will get an error because the generated class references an IHandler
        class which doesn't exist and will be created later in this tutorial.
      </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="wrapper-handler.business-logic.wrapper.conf"></a>Assigning the wrapper to the page</h4></div></div></div><p>
          Now that you have implemented the HTML page and the wrapper you have to connect the HTML form with
          the wrapper. This is done using the <code class="filename">app.xml</code> servlet configuration. If a page
          contains business logic that must be executed, you have to add a <code class="literal">&lt;pagerequest/&gt;</code>
          tag to the servlet configuration.
        </p><p>
         Place an <code class="literal">&lt;input/&gt;</code> tag inside the <code class="literal">&lt;pagerequest/&gt;</code> tag which
         will act as a container for all wrappers on this page.
         Each wrapper is registered using an <code class="literal">&lt;wrapper/&gt;</code> tag which requires two parameters
         to be set:
        </p><div class="orderedlist"><ol type="1"><li><p>
              <code class="literal">class</code> specifies the classname of the wrapper.
            </p></li><li><p>
              <code class="literal">prefix</code> specifies the prefix of all request parameters that this wrapper should
              pay attention to. If you take a look the the HTML page (<a class="xref" href="#wrapper-handler.inputform" title="2.5.&nbsp;Create the input form">Section&nbsp;2.5, &#8220;Create the input form&#8221;</a>)
              you will see, that all input fields are prefixed with <code class="literal">user</code> and a dot. This way,
              you can have two wrappers that share parameter names, but will not conflict, as the parameters reside
              in different namespaces. 
            </p></li></ol></div><p>
          To add your new wrapper to the <code class="literal">EnterData</code> page, add these lines to the configuration:
        </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">context-xml-service-config</b>&gt;
  
  &lt;<i class="hl-comment" style="color: silver">!-- ... --</i>&gt;

  &lt;<b class="hl-tag" style="color: blue">pagerequest</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"EnterData"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">input</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">wrapper</b> <span class="hl-attribute" style="color: blue">prefix</span>=<span class="hl-value" style="color: blue">"user"</span> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.firstapp.wrapper.EnterUserDataWrapper"</span> /&gt;
    &lt;<b class="hl-tag" style="color: blue">/input</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/pagerequest</b>&gt;

&lt;<b class="hl-tag" style="color: blue">/context-xml-service-config</b>&gt;</pre><p>
          The next step will be implementing a handler processing the wrapped data.
          But before you can go on and
          implement the handler, there is a small task left. Up to now, you do not have a Java type that is able to
          store the data for a user. This will be done in your next step.
        </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="wrapper-handler.business-logic.bean"></a>2.6.2.&nbsp;Interlude: Implementing a bean</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
          This step has absolutely nothing to do with the Pustefix framework. However, as it is needed to 
          understand the example, it still is part of the tutorial.
        </p></td></tr></table></div><p>
        As you need to store the data submitted by the user, you will need a bean, that is able to store
        all the information. The following class is a very simple implementation, in your applications 
        you might already have these beans or use a framework, that is generating them for you.
      </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.firstapp;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> User {
    <b class="hl-keyword">private</b> String name;
    <b class="hl-keyword">private</b> String email;
    <b class="hl-keyword">private</b> String birthday;
    <b class="hl-keyword">private</b> <b class="hl-keyword">boolean</b> admin;
    <b class="hl-keyword">private</b> String homepage;
    <b class="hl-keyword">private</b> String sex;

    <b class="hl-keyword">public</b> String getName() {
        <b class="hl-keyword">return</b> name;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setName(String name) {
        <b class="hl-keyword">this</b>.name = name;
    }

    <b class="hl-keyword">public</b> String getEmail() {
        <b class="hl-keyword">return</b> email;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setEmail(String email) {
        <b class="hl-keyword">this</b>.email = email;
    }

    <b class="hl-keyword">public</b> String getBirthday() {
        <b class="hl-keyword">return</b> birthday;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setBirthday(String birthday) {
        <b class="hl-keyword">this</b>.birthday = birthday;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> getAdmin() {
        <b class="hl-keyword">return</b> admin;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setAdmin(<b class="hl-keyword">boolean</b> admin) {
        <b class="hl-keyword">this</b>.admin = admin;
    }

    <b class="hl-keyword">public</b> String getHomepage() {
        <b class="hl-keyword">return</b> homepage;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setHomepage(String homepage) {
        <b class="hl-keyword">this</b>.homepage = homepage;
    }

    <b class="hl-keyword">public</b> String getSex() {
        <b class="hl-keyword">return</b> sex;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setSex(String sex) {
        <b class="hl-keyword">this</b>.sex = sex;
    }
}</pre><p>
        This bean contains exactly the same properties as the wrapper you defined earlier. You will later use this class
        to store the user information in the session.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="wrapper-handler.business-logic.handler"></a>2.6.3.&nbsp;Implementing a handler</h3></div></div></div><p>
        A handler is responsible to execute the actual business logic of your application. A handler can be any class
        but is has some requirements that have to be met:
      </p><div class="orderedlist"><ol type="1"><li><p>It has to implement the <code class="literal">de.schlund.pfixcore.generator.IHandler</code> interface.</p></li><li><p>As handlers are used as flyweights, they <span class="emphasis"><em>must not</em></span> have any static non-final properties.</p></li></ol></div><p>
        If you use Eclipse to generate a new <code class="literal">EnterUserDataHandler</code> class that implements the
        <code class="literal">IHandler</code> interface, you get the following code:
      </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.firstapp.handler;

<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IHandler;
<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IWrapper;
<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.Context;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> EnterUserDataHandler <b class="hl-keyword">implements</b> IHandler {

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> handleSubmittedData(Context context, IWrapper wrapper)
            <b class="hl-keyword">throws</b> Exception {
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> isActive(Context context) <b class="hl-keyword">throws</b> Exception {
        <b class="hl-keyword">return</b> false;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> needsData(Context context) <b class="hl-keyword">throws</b> Exception {
        <b class="hl-keyword">return</b> false;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> prerequisitesMet(Context context) <b class="hl-keyword">throws</b> Exception {
        <b class="hl-keyword">return</b> false;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> retrieveCurrentStatus(Context context, IWrapper wrapper)
            <b class="hl-keyword">throws</b> Exception {
    }
}</pre><p>
        If you now (re-)start your application and open the page again, you still get an error, that the page is still not accessible. This is because of the
        return values of the generated methods and how Pustefix processes a request.
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            When a page is requested, Pustefix calls the <code class="function">prerequisitesMet</code> method of all
            handlers that are configured for this page. If any of these methods return <code class="literal">false</code>,
            the page will not be displayed.
          </p></li><li><p>
            If all of these methods return <code class="literal">true</code>, Pustefix will call the <code class="function">isActive</code> method
            on all handlers of the page. If none of the methods return <code class="literal">true</code>, the page will not be displayed.
          </p></li></ul></div><p>
        When Eclipse generated the method bodies, both methods return <code class="literal">false</code> und thus the page
        cannot be displayed.
        Modify the return values of <code class="function">prerequisitesMet</code> and <code class="function">isActive</code> to
        make the page accessible
      </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.firstapp.handler;

<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IHandler;
<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IWrapper;
<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.Context;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> EnterUserDataHandler <b class="hl-keyword">implements</b> IHandler {

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> isActive(Context context) <b class="hl-keyword">throws</b> Exception {
        <b class="hl-keyword">return</b> true;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> prerequisitesMet(Context context) <b class="hl-keyword">throws</b> Exception {
        <b class="hl-keyword">return</b> true;
    }

}</pre><p>
        If you now restart the application and open the page again, all form fields will be displayed. To test your form, fill out at least the mandatory fields:
      </p><div class="itemizedlist"><ul type="disc"><li><p>gender</p><p>name</p><p>email</p></li></ul></div><p>
        If you submit the data, the wrapper will validate your data and then display the page again. At this point,
        the form elements will still contain the values that you entered. Pustefix saved their state automatically. 
      </p><p>
        If you click on the <code class="literal">XML</code> button in the upper right corner of the page, you will see the
        XML document that contains the data of the rendered page:
      </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">formresult</b> <span class="hl-attribute" style="color: blue">serial</span>=<span class="hl-value" style="color: blue">"1214247165246"</span>&gt;
      &lt;<b class="hl-tag" style="color: blue">formvalues</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">param</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.email"</span>&gt;schst@bar.de&lt;<b class="hl-tag" style="color: blue">/param</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">param</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.name"</span>&gt;Stephan&lt;<b class="hl-tag" style="color: blue">/param</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">param</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.sex"</span>&gt;m&lt;<b class="hl-tag" style="color: blue">/param</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">/formvalues</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">formerrors</b>/&gt;
      &lt;<b class="hl-tag" style="color: blue">formhiddenvals</b>/&gt;
      &lt;<b class="hl-tag" style="color: blue">wrapperstatus</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">wrapper</b> <span class="hl-attribute" style="color: blue">active</span>=<span class="hl-value" style="color: blue">"true"</span> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.firstapp.wrapper.EnterUserDataWrapper"</span> <span class="hl-attribute" style="color: blue">prefix</span>=<span class="hl-value" style="color: blue">"user"</span>/&gt;
      &lt;<b class="hl-tag" style="color: blue">/wrapperstatus</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/formresult</b>&gt;</pre><p>
        The <code class="literal">&lt;formvalues/&gt;</code> node contains a <code class="literal">&lt;param/&gt;</code> element for each
        of the form fields that you submitted. Inside the <code class="literal">&lt;wrapperstatus/&gt;</code> node, you can see a list
        of all wrappers that are registered for this page.
      </p><p>
        As the handler mostly consists of auto-generated code, it does not execute any business logic. If you want
        to execute Java code after the page is submitted, you only need to place it in the <code class="function">handleSubmittedData</code>
        method
      </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.firstapp.handler;

<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IHandler;
<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IWrapper;
<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.Context;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> EnterUserDataHandler <b class="hl-keyword">implements</b> IHandler {

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> handleSubmittedData(Context context, IWrapper wrapper)
            <b class="hl-keyword">throws</b> Exception {
        System.out.println(<b class="hl-string"><i style="color:red">"Place business logic here"</i></b>);
    }

}</pre><p>
        You will re-visit this class at a later point in the tutorial and add some real logic instead of
        just debugging code.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="wrapper-handler.business-logic.contextresource"></a>2.6.4.&nbsp;Implementing a ContextResource</h3></div></div></div><p>
        To be able to transport the user data from one page to the other, you have to store it in the session.
      </p><p>
        Pustefix does not allow you direct access to the applications HTTP session. Instead it provides you with
        an easy way to use objects that live inside the session scope. Those objects are called <span class="emphasis"><em>context resources</em></span>.
        A context resource can be any class, it just has to meet the following requirements: 
      </p><div class="orderedlist"><ol type="1"><li><p>There has to be an interface and an implementation for the context resource.</p></li><li><p>The interface has to extend the <code class="literal">ContextResource</code> interface provided by Pustefix.</p></li></ol></div><p>
        A context resource, that is able to store a user inside the HTTP session only requires two methods: one to set the user
        and one to retrieve it from the context resource.
      </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.firstapp.contextresources;

<b class="hl-keyword">import</b> org.pustefixframework.tutorial.firstapp.User;

<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.ContextResource;

<b class="hl-keyword">public</b> <b class="hl-keyword">interface</b> ContextUser <b class="hl-keyword">extends</b> ContextResource {
    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setUser(User user);
    <b class="hl-keyword">public</b> User getUser();
}</pre><p>
        The implementation for this interface also is very easy:
      </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.firstapp.contextresources;

<b class="hl-keyword">import</b> org.pustefixframework.tutorial.firstapp.User;
<b class="hl-keyword">import</b> org.w3c.dom.Element;

<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.Context;
<b class="hl-keyword">import</b> de.schlund.pfixxml.ResultDocument;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> ContextUserImpl <b class="hl-keyword">implements</b> ContextUser {

    <b class="hl-keyword">private</b> User user;
    
    <b class="hl-keyword">public</b> User getUser() {
        <b class="hl-keyword">return</b> user;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setUser(User user) {
        <b class="hl-keyword">this</b>.user = user;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> init(Context context) <b class="hl-keyword">throws</b> Exception {
        <i class="hl-comment" style="color: silver">// nothing to do here</i>

    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> insertStatus(ResultDocument document, Element element)
            <b class="hl-keyword">throws</b> Exception {
        <i class="hl-comment" style="color: silver">// will be implemented later</i>
    }
}</pre><p>
        The <code class="literal">ContextResource</code> interface forces you to implement the following methods:
      </p><div class="itemizedlist"><ul type="disc"><li><p><code class="function">init</code> will be called when the context resource is created.</p></li><li><p><code class="function">insertStatus</code> should insert its current state into the DOM tree.</p></li></ul></div><p>
        If a context resource is only used as a container to store information in the session, it is not needed
        to implement any of these methods.
      </p><p>
        To make this context resource available in your application, you have to register it in the servlet configuration
        file <code class="filename">app.xml</code>: 
      </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">context-xml-service-config</b> <span class="hl-attribute" style="color: blue">xmlns</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/context-xml-service-config"</span> 
      <span class="hl-attribute" style="color: blue">xmlns:xsi</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/2001/XMLSchema-instance"</span> 
      <span class="hl-attribute" style="color: blue">version</span>=<span class="hl-value" style="color: blue">"1.0"</span> <span class="hl-attribute" style="color: blue">xsi:schemaLocation</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/context-xml-service-config 
      ../../core/schema/context-xml-service-config.xsd"</span>&gt;

  &lt;<i class="hl-comment" style="color: silver">!-- Rest of configuration --</i>&gt;  

  &lt;<b class="hl-tag" style="color: blue">context</b> <span class="hl-attribute" style="color: blue">defaultpage</span>=<span class="hl-value" style="color: blue">"EnterData"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">resource</b> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.firstapp.contextresources.ContextUserImpl"</span>&gt;
      &lt;<b class="hl-tag" style="color: blue">implements</b> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.firstapp.contextresources.ContextUser"</span>/&gt;
    &lt;<b class="hl-tag" style="color: blue">/resource</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/context</b>&gt;

  &lt;<i class="hl-comment" style="color: silver">!-- Rest of configuration --</i>&gt;  

&lt;<b class="hl-tag" style="color: blue">/context-xml-service-config</b>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="wrapper-handler.business-logic.contextresourcemanager"></a>2.6.5.&nbsp;Accessing a ContextResource</h3></div></div></div><p>
        Now, that you have created a new context resource, you will learn, how you can access it from your application.
        All context resources can be accessed via the <code class="classname">ContextResourceManager</code>, which provides a
        <code class="function">getResource</code> method.
      </p><pre class="programlisting">ContextResourceManager manager = context.getContextResourceManager();
ContextUser cUser = manager.getResource(ContextUser.<b class="hl-keyword">class</b>);</pre><p>
        This method accepts the <code class="classname">Class</code> object of the interface. If the resource is accessed for the
        first time, a new instance of the implementation specified in the servlet configuration, is created and returned.
        On subsequent calls, the same instance is returned, so the resource is a singleton in the session scope.
      </p><p>
        You can now implement the business logic in the <code class="function">handleSubmittedData</code> method, that creates
        the <code class="classname">User</code> object and stores it in your context resource.
      </p><p>
        But first, you need to know, how you can extract the parameters from the request. Pustefix will pass two arguments
        to the <code class="function">handleSubmittedData</code> method: The <code class="literal">Context</code> and an instance of
        <code class="classname">IWrapper</code>. This <code class="classname">IWrapper</code> actually is an instance of the generated
        <code class="classname">EnterUserDataWrapper</code> class, that has been generated from your wrapper configuration. This
        class provides getter-methods for all parameters that you specified in the wrapper. Use these methods to extract
        the data from the request and create a new <code class="classname">User</code> instance based on the input data: 
      </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.firstapp.handler;

<b class="hl-keyword">import</b> org.pustefixframework.tutorial.firstapp.User;
<b class="hl-keyword">import</b> org.pustefixframework.tutorial.firstapp.contextresources.ContextUser;
<b class="hl-keyword">import</b> org.pustefixframework.tutorial.firstapp.wrapper.EnterUserDataWrapper;

<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IHandler;
<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IWrapper;
<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.Context;
<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.ContextResourceManager;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> EnterUserDataHandler <b class="hl-keyword">implements</b> IHandler {

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> handleSubmittedData(Context context, IWrapper wrapper)
            <b class="hl-keyword">throws</b> Exception {
        ContextResourceManager manager = context.getContextResourceManager();
        ContextUser cUser = manager.getResource(ContextUser.<b class="hl-keyword">class</b>);
        
        EnterUserDataWrapper euWrapper = (EnterUserDataWrapper)wrapper;
        User user = <b class="hl-keyword">new</b> User();
        user.setSex(euWrapper.getSex());
        user.setName(euWrapper.getName());
        <b class="hl-keyword">if</b> (euWrapper.getEmail() != null) {
            user.setEmail(euWrapper.getEmail());
        }
        <b class="hl-keyword">if</b> (euWrapper.getHomepage() != null) {
            user.setHomepage(euWrapper.getHomepage());
        }
        <b class="hl-keyword">if</b> (euWrapper.getBirthdate() != null) {
            user.setBirthday(euWrapper.getBirthdate());
        }
        user.setAdmin(euWrapper.getAdmin());
        cUser.setUser(user);
    }

}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="wrapper-handler.pageflow"></a>2.7.&nbsp;Implementing the workflow</h2></div></div></div><p>
      Now you have implemented the business logic, that creates your <code class="classname">User</code> object and stores it in the session,
      but still, the <code class="literal">EnterData</code> page is displayed, after you submitted the page. The desired behaviour is to display
      the <code class="literal">ReviewData</code> after the business logic has successfully been executed.
    </p><p>
      To achieve this, you have to create a new workflow and specify the steps in this workflow. This is done via the <code class="literal">&lt;pageflow/&gt;</code> tag
      in the servlet configuration file:
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">context-xml-service-config</b> <span class="hl-attribute" style="color: blue">xmlns</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/context-xml-service-config"</span> 
      <span class="hl-attribute" style="color: blue">xmlns:xsi</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/2001/XMLSchema-instance"</span> 
      <span class="hl-attribute" style="color: blue">version</span>=<span class="hl-value" style="color: blue">"1.0"</span> <span class="hl-attribute" style="color: blue">xsi:schemaLocation</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/context-xml-service-config 
      ../../core/schema/context-xml-service-config.xsd"</span>&gt;

  &lt;<i class="hl-comment" style="color: silver">!-- Rest of configuration --</i>&gt;  

  &lt;<b class="hl-tag" style="color: blue">pageflow</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"RegisterUser"</span> <span class="hl-attribute" style="color: blue">final</span>=<span class="hl-value" style="color: blue">"Confirm"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">flowstep</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"EnterData"</span>/&gt;
    &lt;<b class="hl-tag" style="color: blue">flowstep</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"ReviewData"</span> <span class="hl-attribute" style="color: blue">stophere</span>=<span class="hl-value" style="color: blue">"true"</span>/&gt;
  &lt;<b class="hl-tag" style="color: blue">/pageflow</b>&gt;

  &lt;<i class="hl-comment" style="color: silver">!-- Rest of configuration --</i>&gt;  

&lt;<b class="hl-tag" style="color: blue">/context-xml-service-config</b>&gt;</pre><p>
      The workflow starts with the <code class="literal">EnterData</code> page, which is followed by the <code class="literal">ReviewData</code> page. After the page flow
      is finished, the final page <code class="literal">Confirm</code> will be displayed. Open the <code class="literal">EnterData</code> page again, after you made the changes,
      fill out the mandatory fields and submit them: the page flow will lead you to the <code class="literal">ReviewData</code> page, as you specified in the configuration.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="wrapper-handler.errors"></a>2.8.&nbsp;Displaying errors</h2></div></div></div><p>
      Up to now, you expected, that the users of your application do not make any mistakes. We all know, that this is not the case for
      real-life users. To test, how the application reacts, if you do not fill out all required fields, open the <code class="literal">EnterData</code>
      page again, leave the <code class="literal">name</code> field empty and submit the page.
    </p><p>
      As you can see, Pustefix is clever enough not to continue the page flow. If you would debug the application, you would see, that Pustefix
      even does not execute the <code class="function">handleSubmittedData</code> method of your handler. This is because the generated wrapper class does
      some basic validation on the input data. As you specified the <code class="literal">name</code> parameter as <code class="literal">mandatory</code>, the data
      is not valid and the wrapper is not passed to the handler.
    </p><p>
      But how is the user supposed to know, why the page flow is not processed, there is no error message. But this is not completely true. Pustefix
      sends you an error message, but your page does not display it. If you open the DOM-tree view again, you will see a difference in the XML document
      that is used for the page rendering: 
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">formresult</b> <span class="hl-attribute" style="color: blue">serial</span>=<span class="hl-value" style="color: blue">"1214248690859"</span>&gt;
      &lt;<b class="hl-tag" style="color: blue">formvalues</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">param</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.email"</span>&gt;schst@bar.de&lt;<b class="hl-tag" style="color: blue">/param</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">param</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.sex"</span>&gt;m&lt;<b class="hl-tag" style="color: blue">/param</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">/formvalues</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">formerrors</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">error</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.name"</span>&gt;
              &lt;<b class="hl-tag" style="color: blue">pfx:include</b> <span class="hl-attribute" style="color: blue">href</span>=<span class="hl-value" style="color: blue">"core-override/dyntxt/statusmessages-core-merged.xml"</span> <span class="hl-attribute" style="color: blue">part</span>=<span class="hl-value" style="color: blue">"MISSING_PARAM"</span>/&gt;
          &lt;<b class="hl-tag" style="color: blue">/error</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">/formerrors</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">formhiddenvals</b>/&gt;
      &lt;<b class="hl-tag" style="color: blue">wrapperstatus</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">wrapper</b> <span class="hl-attribute" style="color: blue">active</span>=<span class="hl-value" style="color: blue">"true"</span> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.firstapp.wrapper.EnterUserDataWrapper"</span> <span class="hl-attribute" style="color: blue">prefix</span>=<span class="hl-value" style="color: blue">"user"</span>/&gt;
      &lt;<b class="hl-tag" style="color: blue">/wrapperstatus</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">pageflow</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"RegisterUser"</span>&gt;
          &lt;<b class="hl-tag" style="color: blue">step</b> <span class="hl-attribute" style="color: blue">current</span>=<span class="hl-value" style="color: blue">"true"</span> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"EnterData"</span>/&gt;
          &lt;<b class="hl-tag" style="color: blue">step</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"ReviewData"</span>/&gt;
      &lt;<b class="hl-tag" style="color: blue">/pageflow</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/formresult</b>&gt;</pre><p>
      Inside the <code class="literal">&lt;formerrors/&gt;</code> node, there is an <code class="literal">&lt;error/&gt;</code> element which signals an
      error for the field <code class="literal">user.name</code>. The content of the error is an include to the part <code class="literal">MISSING_PARAM</code>
      in the file <code class="filename">core-override/dyntxt/statusmessages-core-merged.xml</code>. This file contains all error messages
      provided by the core. If you open the file and search for this part, you will find something ike this XML:
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">part</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"MISSING_PARAM"</span>&gt;
  &lt;<b class="hl-tag" style="color: blue">theme</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"default"</span>&gt;This parameter is mandatory.&lt;<b class="hl-tag" style="color: blue">/theme</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/part</b>&gt;</pre><p>
      As you can see, Pustefix informs you, that an error happened, and even provides you with a human readable message for the error. All
      that is left for you to do, is display it to the user. This can be done using the <code class="literal">&lt;pfx:checkfield/&gt;</code>, <code class="literal">&lt;pfx:error/&gt;</code>
      and <code class="literal">&lt;pfx:scode/&gt;</code> tags provided by Pustefix.
    </p><p>
      To add the error message, open the page content file <code class="filename">txt/pages/main_EnterData.xml</code>. The <code class="literal">&lt;pfx:checkfield/&gt;</code> tag
      is used to check, whether an error happened for a specific field or not. Inside this tag, you can place a <code class="literal">&lt;pfx:error/&gt;</code> tag. The
      content of this tag will only be displayed, if an error occurred for this field. The <code class="literal">&lt;pfx:scode/&gt;</code> tag is an easy way
      to fetch the error message from the <code class="filename">core-override/dyntxt/statusmessages-core-merged.xml</code> file.
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">include_parts</b> <span class="hl-attribute" style="color: blue">xmlns:ixsl</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/1999/XSL/Transform"</span> <span class="hl-attribute" style="color: blue">xmlns:pfx</span>=<span class="hl-value" style="color: blue">"http://www.schlund.de/pustefix/core"</span>&gt;
  &lt;<b class="hl-tag" style="color: blue">part</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"content"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">theme</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"default"</span>&gt;
      &lt;<b class="hl-tag" style="color: blue">h1</b>&gt;Register new user&lt;<b class="hl-tag" style="color: blue">/h1</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">pfx:forminput</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">table</b>&gt;
          &lt;<i class="hl-comment" style="color: silver">!-- Other form fields --</i>&gt;
          &lt;<b class="hl-tag" style="color: blue">tr</b>&gt;
            &lt;<b class="hl-tag" style="color: blue">td</b>&gt;Name:&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
            &lt;<b class="hl-tag" style="color: blue">td</b>&gt;
              &lt;<b class="hl-tag" style="color: blue">pfx:xinp</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"text"</span> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.name"</span>/&gt;
              &lt;<b class="hl-tag" style="color: blue">pfx:checkfield</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.name"</span>&gt;
                &lt;<b class="hl-tag" style="color: blue">pfx:error</b>&gt;&lt;<b class="hl-tag" style="color: blue">div</b> <span class="hl-attribute" style="color: blue">style</span>=<span class="hl-value" style="color: blue">"color:#ff0000;"</span>&gt;&lt;<b class="hl-tag" style="color: blue">pfx:scode</b>/&gt;&lt;<b class="hl-tag" style="color: blue">/div</b>&gt;&lt;<b class="hl-tag" style="color: blue">/pfx:error</b>&gt;
              &lt;<b class="hl-tag" style="color: blue">/pfx:checkfield</b>&gt;
            &lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">/tr</b>&gt;
          &lt;<i class="hl-comment" style="color: silver">!-- Other form fields --</i>&gt;
        &lt;<b class="hl-tag" style="color: blue">/table</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">pfx:xinp</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"submit"</span> <span class="hl-attribute" style="color: blue">value</span>=<span class="hl-value" style="color: blue">"register"</span>/&gt;
      &lt;<b class="hl-tag" style="color: blue">/pfx:forminput</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">/theme</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/part</b>&gt;
 &lt;<b class="hl-tag" style="color: blue">/include_parts</b>&gt;</pre><p>
      If you now try to submit the page again without entering your name, Pustefix will display the correct error message.
      Of course, you have to repeat this step for all other input fields on your page.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="wrapper-handler.domtree"></a>2.9.&nbsp;Displaying the entered data</h2></div></div></div><p>
      Now that your application is displaying errors correctly, you should go back to implement the main requirements. The next feature
      that you will be implementing is the review page, where the user will be able to review has data. To achieve this, you will have
      to write the user data to the DOM tree, that is used to render the page. This can be done by implementing the <code class="function">insertStatus</code>
      method of the <code class="classname">ContextUserImpl</code> class.
    </p><p>
      This method receives the document and the element where it should append the user data. The <code class="classname">ResultDocument</code> class
      provides some wrapper methods, which make it easier to add data to the XML: 
    </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.firstapp.contextresources;

<b class="hl-keyword">import</b> org.pustefixframework.tutorial.firstapp.User;
<b class="hl-keyword">import</b> org.w3c.dom.Element;

<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.Context;
<b class="hl-keyword">import</b> de.schlund.pfixxml.ResultDocument;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> ContextUserImpl <b class="hl-keyword">implements</b> ContextUser {

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> insertStatus(ResultDocument document, Element element)
            <b class="hl-keyword">throws</b> Exception {
        <b class="hl-keyword">if</b> (<b class="hl-keyword">this</b>.user == null) {
            <b class="hl-keyword">return</b>;
        }
        ResultDocument.addTextChild(element, <b class="hl-string"><i style="color:red">"sex"</i></b>, <b class="hl-keyword">this</b>.user.getSex());
        ResultDocument.addTextChild(element, <b class="hl-string"><i style="color:red">"name"</i></b>, <b class="hl-keyword">this</b>.user.getName());
        ResultDocument.addTextChild(element, <b class="hl-string"><i style="color:red">"email"</i></b>, <b class="hl-keyword">this</b>.user.getEmail());
        ResultDocument.addTextChild(element, <b class="hl-string"><i style="color:red">"homepage"</i></b>, <b class="hl-keyword">this</b>.user.getHomepage());
        ResultDocument.addTextChild(element, <b class="hl-string"><i style="color:red">"birthday"</i></b>, <b class="hl-keyword">this</b>.user.getBirthday());
        ResultDocument.addTextChild(element, <b class="hl-string"><i style="color:red">"admin"</i></b>, String.valueOf(<b class="hl-keyword">this</b>.user.getAdmin()));
    }
}</pre><p>
      Now that the context resource is able to render its state to the XML document, you have to tell Pustefix, on which pages, the context
      resource should be rendered. Again, this is done in the servlet configuration file <code class="filename">app.xml</code>. This time, you will
      have to add an <code class="literal">&lt;output/&gt;</code> tag to the page and nest <code class="literal">&lt;resource/&gt;</code> tags for each
      context resource, that should be rendered on this page.
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">context-xml-service-config</b> <span class="hl-attribute" style="color: blue">xmlns</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/context-xml-service-config"</span> 
       <span class="hl-attribute" style="color: blue">xmlns:xsi</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="hl-attribute" style="color: blue">version</span>=<span class="hl-value" style="color: blue">"1.0"</span> 
       <span class="hl-attribute" style="color: blue">xsi:schemaLocation</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/context-xml-service-config 
       ../../core/schema/context-xml-service-config.xsd"</span>&gt;

  &lt;<i class="hl-comment" style="color: silver">!-- other configuration options --</i>&gt;
  
  &lt;<b class="hl-tag" style="color: blue">pagerequest</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"ReviewData"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">output</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">resource</b> <span class="hl-attribute" style="color: blue">node</span>=<span class="hl-value" style="color: blue">"user"</span> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.firstapp.contextresources.ContextUser"</span>/&gt;
    &lt;<b class="hl-tag" style="color: blue">/output</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/pagerequest</b>&gt;

&lt;<b class="hl-tag" style="color: blue">/context-xml-service-config</b>&gt;</pre><p>
      The <code class="literal">class</code> attribute references the interface implemented by the context resource and the <code class="literal">node</code>
      attribute defines the name of the element in which it will be rendered.
    </p><p>
      Open the XML view for the page, after you made the changes and reloaded the page and you will see, that the user data has been inserted
      into the XML:
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">formresult</b> <span class="hl-attribute" style="color: blue">serial</span>=<span class="hl-value" style="color: blue">"1214249956789"</span>&gt;
      &lt;<b class="hl-tag" style="color: blue">formvalues</b>/&gt;
      &lt;<b class="hl-tag" style="color: blue">formerrors</b>/&gt;
      &lt;<b class="hl-tag" style="color: blue">formhiddenvals</b>/&gt;
      &lt;<b class="hl-tag" style="color: blue">user</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">sex</b>&gt;m&lt;<b class="hl-tag" style="color: blue">/sex</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">name</b>&gt;Stephan&lt;<b class="hl-tag" style="color: blue">/name</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">email</b>&gt;schst@bar.de&lt;<b class="hl-tag" style="color: blue">/email</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">homepage</b>&gt;http://pustefix-framework.org&lt;<b class="hl-tag" style="color: blue">/homepage</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">birthday</b>&gt;null&lt;<b class="hl-tag" style="color: blue">/birthday</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">admin</b>&gt;false&lt;<b class="hl-tag" style="color: blue">/admin</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">/user</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">pageflow</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"RegisterUser"</span>&gt;
          &lt;<b class="hl-tag" style="color: blue">step</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"EnterData"</span>/&gt;
          &lt;<b class="hl-tag" style="color: blue">step</b> <span class="hl-attribute" style="color: blue">current</span>=<span class="hl-value" style="color: blue">"true"</span> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"ReviewData"</span>/&gt;
      &lt;<b class="hl-tag" style="color: blue">/pageflow</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/formresult</b>&gt;</pre><p>
      Pustefix allows you to use XSL and XPath in your page definitions to insert this information in the rendered page. Use the <code class="literal">ixsl</code>
      namespace to access nodes from the DOM tree:
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">include_parts</b> <span class="hl-attribute" style="color: blue">xmlns:ixsl</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/1999/XSL/Transform"</span> <span class="hl-attribute" style="color: blue">xmlns:pfx</span>=<span class="hl-value" style="color: blue">"http://www.schlund.de/pustefix/core"</span>&gt;
  &lt;<b class="hl-tag" style="color: blue">part</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"content"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">theme</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"default"</span>&gt;
      &lt;<b class="hl-tag" style="color: blue">h1</b>&gt;Review your data&lt;<b class="hl-tag" style="color: blue">/h1</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">table</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">tr</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">td</b>&gt;Gender:&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">td</b>&gt;
            &lt;<b class="hl-tag" style="color: blue">ixsl:choose</b>&gt;
              &lt;<b class="hl-tag" style="color: blue">ixsl:when</b> <span class="hl-attribute" style="color: blue">test</span>=<span class="hl-value" style="color: blue">"/formresult/user/gender/text() = 'f'"</span>&gt;female&lt;<b class="hl-tag" style="color: blue">/ixsl:when</b>&gt;
              &lt;<b class="hl-tag" style="color: blue">ixsl:otherwise</b>&gt;male&lt;<b class="hl-tag" style="color: blue">/ixsl:otherwise</b>&gt;
            &lt;<b class="hl-tag" style="color: blue">/ixsl:choose</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">/tr</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">tr</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">td</b>&gt;Name:&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">td</b>&gt;&lt;<b class="hl-tag" style="color: blue">ixsl:value-of</b> <span class="hl-attribute" style="color: blue">select</span>=<span class="hl-value" style="color: blue">"/formresult/user/name/text()"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">/tr</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">tr</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">td</b>&gt;Email:&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">td</b>&gt;&lt;<b class="hl-tag" style="color: blue">ixsl:value-of</b> <span class="hl-attribute" style="color: blue">select</span>=<span class="hl-value" style="color: blue">"/formresult/user/email/text()"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">/tr</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">tr</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">td</b>&gt;Homepage:&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">td</b>&gt;&lt;<b class="hl-tag" style="color: blue">ixsl:value-of</b> <span class="hl-attribute" style="color: blue">select</span>=<span class="hl-value" style="color: blue">"/formresult/user/homepage/text()"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">/tr</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">tr</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">td</b>&gt;Birthdate:&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">td</b>&gt;&lt;<b class="hl-tag" style="color: blue">ixsl:value-of</b> <span class="hl-attribute" style="color: blue">select</span>=<span class="hl-value" style="color: blue">"/formresult/user/birthdate/text()"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">/tr</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">tr</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">td</b>&gt;Administrator:&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">td</b>&gt;&lt;<b class="hl-tag" style="color: blue">ixsl:value-of</b> <span class="hl-attribute" style="color: blue">select</span>=<span class="hl-value" style="color: blue">"/formresult/user/admin/text()"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">/td</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">/tr</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">/table</b>&gt;      
    &lt;<b class="hl-tag" style="color: blue">/theme</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/part</b>&gt;
 &lt;<b class="hl-tag" style="color: blue">/include_parts</b>&gt;</pre><p>
     If you now open the page again, enter your data and submit the form, Pustefix will display a new page, which contains
     the information you entered.
   </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="wrapper-handler.save"></a>2.10.&nbsp;Saving the data</h2></div></div></div><p>
      Your application now handles the input of user data and displays it again to the user. To complete the last requirement, your application
      will have to provide another button on the <code class="literal">ReviewData</code> page, which lets the user confirm the data and then executes
      the business logic to store the data in your persistence layer. 
    </p><p>
      To achieve this, you will have to implement a new pair of wrapper and handler. As the <code class="literal">ReviewData</code> page does not
      contain any input fields, the new wrapper does not need any parameters:
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">interface</b> <span class="hl-attribute" style="color: blue">xmlns</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/iwrapper"</span>
      <span class="hl-attribute" style="color: blue">xmlns:xsi</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute" style="color: blue">xsi:schemaLocation</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/iwrapper 
                          http://www.pustefix-framework.org/2008/namespace/iwrapper.xsd"</span>&gt;
  
  &lt;<i class="hl-comment" style="color: silver">!-- This handler will process the data --</i>&gt;
  &lt;<b class="hl-tag" style="color: blue">ihandler</b> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.firstapp.handler.SaveUserDataHandler"</span>/&gt;
&lt;<b class="hl-tag" style="color: blue">/interface</b>&gt;</pre><p>
      After you implemented the wrapper, continue by creating a new <code class="classname">SaveUserData</code> class, which implements the
      <code class="classname">IHandler</code> interface. Make sure that the handler is active by returning <code class="literal">true</code> from the
      <code class="function">prerequisitesMet</code> and <code class="function">isActive</code> methods. Place the business logic that saves the new user
      in the <code class="function">handleSubmittedData</code> method. In this example, the business logic has been replaced by a simple
      <code class="function">System.out.println</code> call.
    </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.firstapp.handler;

<b class="hl-keyword">import</b> org.pustefixframework.tutorial.firstapp.contextresources.ContextUser;

<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IHandler;
<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IWrapper;
<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.Context;
<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.ContextResourceManager;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> SaveUserDataHandler <b class="hl-keyword">implements</b> IHandler {

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> handleSubmittedData(Context context, IWrapper wrapper)
            <b class="hl-keyword">throws</b> Exception {
        System.out.println(<b class="hl-string"><i style="color:red">"Business logic to save data"</i></b>);
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> isActive(Context context) <b class="hl-keyword">throws</b> Exception {
        <b class="hl-keyword">return</b> true;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> needsData(Context context) <b class="hl-keyword">throws</b> Exception {
        <b class="hl-keyword">return</b> false;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> prerequisitesMet(Context context) <b class="hl-keyword">throws</b> Exception {
        <b class="hl-keyword">return</b> true;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> retrieveCurrentStatus(Context context, IWrapper arg1)
            <b class="hl-keyword">throws</b> Exception {
        <i class="hl-comment" style="color: silver">// Nothing to be done here</i>
    }
}</pre><p>
      As the handler should be triggered from the <code class="literal">ReviewData</code> page, you have to add the handler to the
      <code class="literal">&lt;pagerequest/&gt;</code> tag in the servlet configuration:
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">context-xml-service-config</b> <span class="hl-attribute" style="color: blue">xmlns</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/context-xml-service-config"</span> 
      <span class="hl-attribute" style="color: blue">xmlns:xsi</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="hl-attribute" style="color: blue">version</span>=<span class="hl-value" style="color: blue">"1.0"</span> 
      <span class="hl-attribute" style="color: blue">xsi:schemaLocation</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/context-xml-service-config 
      ../../core/schema/context-xml-service-config.xsd"</span>&gt;
  
  &lt;<b class="hl-tag" style="color: blue">pagerequest</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"ReviewData"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">input</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">wrapper</b> <span class="hl-attribute" style="color: blue">prefix</span>=<span class="hl-value" style="color: blue">"user"</span> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.firstapp.wrapper.SaveUserDataWrapper"</span> /&gt;
    &lt;<b class="hl-tag" style="color: blue">/input</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">output</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">resource</b> <span class="hl-attribute" style="color: blue">node</span>=<span class="hl-value" style="color: blue">"user"</span> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.firstapp.contextresources.ContextUser"</span>/&gt;
    &lt;<b class="hl-tag" style="color: blue">/output</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/pagerequest</b>&gt;

&lt;<b class="hl-tag" style="color: blue">/context-xml-service-config</b>&gt;</pre><p>
      All that is left your you now, is to add a possibility to submit the <code class="literal">ReviewData</code> page. But as there is no
      input form needed, you will learn a new way, how data can be submitted using Pustefix. The <code class="literal">&lt;pfx:button/&gt;</code>
      tag is used, to create links between different Pustefix pages. But it can also be used to link to the same page again and
      pass any arguments using the <code class="literal">&lt;pfx:argument/&gt;</code>. If you use the <code class="literal">&lt;pfx:argument/&gt;</code>
      tag, Pustefix will treat the request as if the page had been submitted and call the <code class="function">handleSubmittedData</code> method
      on all handlers on the page.
    </p><p>
      As your handler does not accept any parameters, you can pass any argument as you like, for example setting the argument
      <code class="literal">user.save</code> to <code class="literal">true</code>.
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">include_parts</b> <span class="hl-attribute" style="color: blue">xmlns:ixsl</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/1999/XSL/Transform"</span> <span class="hl-attribute" style="color: blue">xmlns:pfx</span>=<span class="hl-value" style="color: blue">"http://www.schlund.de/pustefix/core"</span>&gt;
  &lt;<b class="hl-tag" style="color: blue">part</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"content"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">theme</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"default"</span>&gt;
      &lt;<b class="hl-tag" style="color: blue">h1</b>&gt;Review your data&lt;<b class="hl-tag" style="color: blue">/h1</b>&gt;
      &lt;<i class="hl-comment" style="color: silver">!-- Display user data --</i>&gt;
      &lt;<b class="hl-tag" style="color: blue">pfx:button</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">pfx:argument</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.save"</span>&gt;true&lt;<b class="hl-tag" style="color: blue">/pfx:argument</b>&gt;
        Go ahead and save the data
      &lt;<b class="hl-tag" style="color: blue">/pfx:button</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">/theme</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/part</b>&gt;
 &lt;<b class="hl-tag" style="color: blue">/include_parts</b>&gt;</pre><p>
      If you click on this link, the page will be submitted and if you placed the business logic inside the handler, it will
      be executed.
    </p><p>
      Open the <code class="filename">txt/pages/main_Confirm.xml</code> file and add some HTML, that will be displayed after the Pustefix
      workflow will continue to the last page.
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">include_parts</b> <span class="hl-attribute" style="color: blue">xmlns:ixsl</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/1999/XSL/Transform"</span> <span class="hl-attribute" style="color: blue">xmlns:pfx</span>=<span class="hl-value" style="color: blue">"http://www.schlund.de/pustefix/core"</span>&gt;
  &lt;<b class="hl-tag" style="color: blue">part</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"content"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">theme</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"default"</span>&gt;
      &lt;<b class="hl-tag" style="color: blue">h1</b>&gt;Congratulations&lt;<b class="hl-tag" style="color: blue">/h1</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">p</b>&gt;Your data has been saved&lt;<b class="hl-tag" style="color: blue">/p</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">/theme</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/part</b>&gt;
 &lt;<b class="hl-tag" style="color: blue">/include_parts</b>&gt;</pre><p>
      Now you have implemented all specified requirements and finished your first Pustefix application.
    </p><p>
      In the last part of the tutorial you will polish some of the rough edges of your applications, which you did not deal with
      while implementing the application.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="wrapper-handler.tweaks"></a>2.11.&nbsp;The finishing touch</h2></div></div></div><p>
      Although your application is already working, there are some minor problems that you should deal with.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="wrapper-handler.tweaks.retrieve"></a>2.11.1.&nbsp;Changing data</h3></div></div></div><p>
        In a typical application, the review page does not only display the entered data, but offer you a link to go back and modify
        the data you entered before. Your application currently lacks this feature, but you will now learn how this is implemented in
        Pustefix.
      </p><p>
        At first, you have to add a new link to the <code class="filename">main_ReviewData.xml</code> page, which sends the user back to the
        <code class="literal">EnterData</code> page. This can be done using the <code class="literal">&lt;pfx:button/&gt;</code> tag: 
      </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">pfx:button</b> <span class="hl-attribute" style="color: blue">page</span>=<span class="hl-value" style="color: blue">"EnterData"</span>&gt;Go back and edit data&lt;<b class="hl-tag" style="color: blue">/pfx:button</b>&gt;</pre><p>
        If you click on this link, the <code class="literal">EnterData</code> page will be loaded and the form will be displayed again.
        But the application does not behave exactly as you would like it to, as the form fields are empty and not filled with
        the data that the user entered before. This can be easily changed.
      </p><p>
        Every time a page is rendered, Pustefix will call the <code class="function">retrieveCurrentStatus</code> method of all handlers that
        are registered for the page and pass in the <code class="literal">context</code> and the matching wrapper for the handler. In this method
        you may use the generated setter methods of the wrapper class to assign values to the form fields.
      </p><p>
        To prefill the form fields with the values the user entered before, you need to fetch the <code class="classname">User</code> instance
        from the context resource, extract the properties and assign them to the form elements. This is almost the opposite of what you
        implemented in the <code class="function">handleSubmittedData</code> method:
      </p><div class="itemizedlist"><ul type="disc"><li><p>Fetch the <code class="classname">ContextUser</code> context resource using the <code class="classname">ContextResourceManager</code>.</p></li><li><p>Fetch the <code class="classname">User</code> instance from the context resource.</p></li><li><p>If the user equals <code class="literal">null</code> the page is accessed for the first time, no user data has been entered, and there is nothing left to do. You can leave the method using the <code class="literal">return</code> statement.</p></li><li><p>Cast the generic wrapper parameter to the concrete <code class="classname">EnterUserDataWrapper</code> implementation.</p></li><li><p>Get the properties from the <code class="classname">User</code> instance and set them to the corresponding properties in the wrapper.</p></li></ul></div><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.firstapp.handler;

<b class="hl-keyword">import</b> org.pustefixframework.tutorial.firstapp.User;
<b class="hl-keyword">import</b> org.pustefixframework.tutorial.firstapp.contextresources.ContextUser;
<b class="hl-keyword">import</b> org.pustefixframework.tutorial.firstapp.wrapper.EnterUserDataWrapper;

<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IHandler;
<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IWrapper;
<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.Context;
<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.ContextResourceManager;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> EnterUserDataHandler <b class="hl-keyword">implements</b> IHandler {

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> retrieveCurrentStatus(Context context, IWrapper wrapper)
            <b class="hl-keyword">throws</b> Exception {
        ContextResourceManager manager = context.getContextResourceManager();
        ContextUser cUser = manager.getResource(ContextUser.<b class="hl-keyword">class</b>);
        User user = cUser.getUser();
        <b class="hl-keyword">if</b> (user == null) {
            <b class="hl-keyword">return</b>;
        }
        EnterUserDataWrapper euWrapper = (EnterUserDataWrapper)wrapper;

        euWrapper.setSex(user.getSex());
        euWrapper.setName(user.getName());
        euWrapper.setEmail(user.getEmail());
        euWrapper.setHomepage(user.getHomepage());
        euWrapper.setBirthdate(user.getBirthday());
        euWrapper.setAdmin(user.getAdmin());
    }
}</pre><p>
        If you restart the application, enter some data and then go back to the form, you can see, that the form fields contain the
        values that you wanted them to contain and that you entered before.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="wrapper-handler.tweaks.needsdata"></a>2.11.2.&nbsp;Avoiding unwanted access</h3></div></div></div><p>
        Another problem ist, that your pages are not protected against unwanted access. If you open the URL
        <code class="uri">http://first-app.HOSTNAME.DOMAIN/xml/app/ReviewData</code>, Pustefix will display this page,
        although there is not data to review.
      </p><p>
        It is the responsibility of the application developer to make sure, that the page can only be
        displayed, if it makes sense in the application context. However, Pustefix provides an easy
        way to disable the availability of a page. The method <code class="function">prerequisitesMet</code> will be called on
        every handler, every time a page should be displayed. If this method returns <code class="literal">false</code>, the page
        will not be displayed.
      </p><p>
        To protect the <code class="literal">ReviewData</code> page, you have to modify the <code class="function">prerequisitesMet</code> method
        of the <code class="classname">SaveUserDataHandler</code> handler. As the page should only be accessible, if a user has
        been entered, you only need to fetch the <code class="classname">ContextUser</code> context resource and check, whether it contains
        user data. If no user has been set, the method must return <code class="literal">false</code>, otherwise it must return <code class="literal">true</code>.
      </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.firstapp.handler;

<b class="hl-keyword">import</b> org.pustefixframework.tutorial.firstapp.contextresources.ContextUser;

<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IHandler;
<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IWrapper;
<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.Context;
<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.ContextResourceManager;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> SaveUserDataHandler <b class="hl-keyword">implements</b> IHandler {

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> prerequisitesMet(Context context) <b class="hl-keyword">throws</b> Exception {
        ContextResourceManager manager = context.getContextResourceManager();
        ContextUser cUser = manager.getResource(ContextUser.<b class="hl-keyword">class</b>);
        <b class="hl-keyword">if</b> (cUser.getUser() != null) {
            <b class="hl-keyword">return</b> true;
        }
        <b class="hl-keyword">return</b> false;
    }
}</pre><p>
        If you now open the <code class="uri">http://first-app.HOSTNAME.DOMAIN/xml/app/ReviewData</code>, the page cannot be displayed.
        Now the workflow mechanism kicks in and selects the next page, that should be displayed. This is the <code class="literal">Confirm</code>
        page, which has been defined as the final page of the workflow.
      </p><p>
        It would have been better, if the <code class="literal">EnterData</code> page would have been displayed instead of the <code class="literal">Confirm</code>,
        page, as the user must enter data before any other page can be displayed. This can easily be achieved using Pustefix.
      </p><p>
        Each handler has a <code class="function">needsData</code> method, which will be called, when the workflow mechanism selects the next
        page to display. The workflow will start with the first page in the current workflow and if the <code class="function">needsData</code>
        method returns <code class="literal">true</code>, it will stop at this page until the handler is satisfied.
      </p><p>
        To make sure, that the user will stay on this page, you only need to implement the <code class="function">needsData</code> method of the
        <code class="classname">EnterUserDataHandler</code> handler: the method must return <code class="literal">true</code>, unless the context
        resource has a <code class="classname">User</code> instance.
      </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.firstapp.handler;

<b class="hl-keyword">import</b> org.pustefixframework.tutorial.firstapp.User;
<b class="hl-keyword">import</b> org.pustefixframework.tutorial.firstapp.contextresources.ContextUser;
<b class="hl-keyword">import</b> org.pustefixframework.tutorial.firstapp.wrapper.EnterUserDataWrapper;

<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IHandler;
<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IWrapper;
<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.Context;
<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.ContextResourceManager;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> EnterUserDataHandler <b class="hl-keyword">implements</b> IHandler {

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> needsData(Context context) <b class="hl-keyword">throws</b> Exception {
        ContextResourceManager manager = context.getContextResourceManager();
        ContextUser cUser = manager.getResource(ContextUser.<b class="hl-keyword">class</b>);
        <b class="hl-keyword">if</b> (cUser.getUser() == null) {
            <b class="hl-keyword">return</b> true;
        }
        <b class="hl-keyword">return</b> false;
    }
}
</pre><p>
        if you now try to access the <code class="literal">ReviewData</code> page directly, Pustefix will redirect you to the 
        <code class="literal">EnterData</code> page instead until you entered the data of a new user.
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="wrapper-handler.conclusion"></a>2.12.&nbsp;Conclusion</h2></div></div></div><p>
      In this tutorial you learned the basics about the core features of Pustefix and developed a very simple, but typical, web
      application. For details about the features that you got to know in this tutorial, take a look at the comprehensive reference
      documentation, which describes all the configuration options, XML tags and interfaces in detail.
    </p><p>
      Of course, Pustefix provides features to automate these tasks, there is no need to re-implement everything from
      scratch for your applications.
      See <a class="xref" href="#user-manager" title="Chapter&nbsp;3.&nbsp;Usermanager tutorial">Chapter&nbsp;3, <i>Usermanager tutorial</i></a> to learn how Pustefix will automatically generate wrapper definitions from your
      existing beans, how to add custom validations and how you can avoid working with DOM and adding any object structure to
      the generated XML tree automatically.
    </p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="user-manager"></a>Usermanager tutorial</h1></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Tobias</span> <span class="surname">Fehrenbach</span></h3></div></div></div><div><p class="copyright">Copyright &copy; 2008 1&amp;1 Internet AG</p></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#um.newproject">3.1. Setup</a></span></dt><dt><span class="section"><a href="#um.newbean">3.2. Create a new bean</a></span></dt><dt><span class="section"><a href="#um.userhandler">3.3. Create the handler</a></span></dt><dt><span class="section"><a href="#um.caster">3.4. Create a caster</a></span></dt><dd><dl><dt><span class="section"><a href="#um.caster.statuscode">3.4.1. Create a new statuscode for the caster</a></span></dt><dt><span class="section"><a href="#um.caster.tourl">3.4.2. Create the ToURL-caster</a></span></dt></dl></dd><dt><span class="section"><a href="#um.beanannotations">3.5. Annotate the User bean</a></span></dt><dd><dl><dt><span class="section"><a href="#um.beanannotations.class">3.5.1. Annotate the class declaration</a></span></dt><dt><span class="section"><a href="#um.beanannotations.getter">3.5.2. Annotate the getter</a></span></dt></dl></dd><dt><span class="section"><a href="#um.generation">3.6. Generate wrapper</a></span></dt><dt><span class="section"><a href="#um.userlist">3.7. Create a userlist class</a></span></dt><dt><span class="section"><a href="#um.contextresource">3.8. Adjust the servlet configuration</a></span></dt><dt><span class="section"><a href="#d0e1644">3.9. Add a new user</a></span></dt><dt><span class="section"><a href="#um.pages">3.10. Create the pages</a></span></dt><dd><dl><dt><span class="section"><a href="#um.pages.userform">3.10.1. Create a page for user data input</a></span></dt><dt><span class="section"><a href="#um.pages.overview">3.10.2. Create page for listing users</a></span></dt><dt><span class="section"><a href="#um.pages.configuration">3.10.3. Add pages to xml configuration files</a></span></dt></dl></dd><dt><span class="section"><a href="#um.pageflow">3.11. Add a pageflow</a></span></dt><dt><span class="section"><a href="#um.tryout">3.12. Try to add your own user</a></span></dt><dt><span class="section"><a href="#um.sampleusers">3.13. Add sample users</a></span></dt><dd><dl><dt><span class="section"><a href="#um.sampleusers.constructor">3.13.1. Add new constructors to your <code class="classname">UserList</code></a></span></dt><dt><span class="section"><a href="#um.sampleusers.initmethod">3.13.2. Add init method to UserList</a></span></dt></dl></dd><dt><span class="section"><a href="#um.deleteuser">3.14. New feature: Delete a user</a></span></dt><dd><dl><dt><span class="section"><a href="#um.deleteuser.bean">3.14.1. Create a new bean</a></span></dt><dt><span class="section"><a href="#um.deleteuser.handler">3.14.2. Create a new handler</a></span></dt><dt><span class="section"><a href="#um.deleteuser.annotations">3.14.3. Annotate the DeleteUser bean</a></span></dt><dt><span class="section"><a href="#um.deleteuser.generate">3.14.4. Generate the wrapper class</a></span></dt><dt><span class="section"><a href="#um.deleteuser.method">3.14.5. Add a delete user method</a></span></dt><dt><span class="section"><a href="#um.deleteuser.handlesubmitteddata">3.14.6. Delete a user</a></span></dt><dt><span class="section"><a href="#um.deleteuser.button">3.14.7. Add a delete button</a></span></dt><dt><span class="section"><a href="#um.deleteuser.configuration">3.14.8. Adjust the servlet configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#um.edituser">3.15. New feature: Edit a user</a></span></dt><dd><dl><dt><span class="section"><a href="#um.edituser.bean">3.15.1. Create a new bean</a></span></dt><dt><span class="section"><a href="#um.edituser.handler">3.15.2. Create a new handler</a></span></dt><dt><span class="section"><a href="#um.edituser.annotations">3.15.3. Annotate the EditUser bean</a></span></dt><dt><span class="section"><a href="#um.edituser.generate">3.15.4. Generate the wrapper class</a></span></dt><dt><span class="section"><a href="#um.edituser.method">3.15.5. Add a method to replace a user of our UserList class</a></span></dt><dt><span class="section"><a href="#um.edituser.handlesubmitteddata">3.15.6. Edit a user</a></span></dt><dt><span class="section"><a href="#um.edituser.button">3.15.7. Add an edit button</a></span></dt><dt><span class="section"><a href="#um.edituser.configuration">3.15.8. Adjust the servlet configuration</a></span></dt><dt><span class="section"><a href="#um.edituser.userhandler">3.15.9. Add user to form</a></span></dt><dt><span class="section"><a href="#d0e2114">3.15.10. Replace method handleSubmittedData of UserHandler</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2124">3.16. Conclusion</a></span></dt></dl></div><p>
    In this tutorial you will learn how to work with the advanced feature provided by the Pustefix Framework. Like in the basic tutorial 
    you will accept user input, store it in the session and display the data. Furthermore you will be able to delete and edit the data stored in the session.
  </p><p>
    The requirements for your application are:
  </p><div class="orderedlist"><ol type="1"><li><p>
        Provide an HTML form that can be used to register new users. The data for a new user must contain:
        gender, name, email-address, homepage, date of birth and a flag to mark the user as an administrator.
      </p></li><li><p>
        Validate the user data after the page has been submitted and display error information.
      </p></li><li><p>
        If the entered data is correct, move to an Overview page, which displays a list of user data and allows 
        the user to delete, edit or add new users. 
      </p></li><li><p>
        If you edit the user data, the page with the HTML form shows up with prefilled values. 
      </p></li><li><p>
        If you choose to delete the user data the data will be removed from session context. 
      </p></li></ol></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="um.newproject"></a>3.1.&nbsp;Setup</h2></div></div></div><p>
      To build this tutorial, create a new project <code class="literal">usermanagement</code> as described in 
      <a class="xref" href="#wrapper-handler.setup" title="2.1.&nbsp;Setting up a new project">Section&nbsp;2.1, &#8220;Setting up a new project&#8221;</a> with the following data:
    </p><table><thead xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><tr>
          <th>Property</th>
          <th>Value</th>
        </tr></thead><tbody xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><tr>
          <td>groupId</td>
          <td>org.pustefixframework.tutorial</td>
        </tr><tr>
          <td>artifactId</td>
          <td>usermanagement</td>
        </tr><tr>
          <td>version</td>
          <td>default</td>
        </tr><tr>
          <td>package</td>
          <td>org.pustefixframework.tutorial.usermanagement</td>
        </tr><tr>
          <td>pustefixVersion</td>
          <td>the latest 0.16.x version</td>
        </tr></tbody></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="um.newbean"></a>3.2.&nbsp;Create a new bean</h2></div></div></div><p>
      Create a simple Java-bean <code class="literal">User</code> in the package 
      <code class="literal">org.pustefixframework.tutorial.usermanagement</code> where you can store your user user data.
    </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.usermanagement;

<b class="hl-keyword">import</b> java.net.URL;
<b class="hl-keyword">import</b> java.util.Date;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> User {
    <b class="hl-keyword">private</b> <b class="hl-keyword">int</b> id;
    <b class="hl-keyword">private</b> String name;
    <b class="hl-keyword">private</b> String email;
    <b class="hl-keyword">private</b> Date birthday;
    <b class="hl-keyword">private</b> <b class="hl-keyword">boolean</b> admin;
    <b class="hl-keyword">private</b> URL homepage;
    <b class="hl-keyword">private</b> String gender;

    <b class="hl-keyword">public</b> <b class="hl-keyword">int</b> getId() {
        <b class="hl-keyword">return</b> id;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setId(<b class="hl-keyword">int</b> id) {
        <b class="hl-keyword">this</b>.id = id;
    }

    <b class="hl-keyword">public</b> String getName() {
        <b class="hl-keyword">return</b> name;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setName(String name) {
        <b class="hl-keyword">this</b>.name = name;
    }

    <b class="hl-keyword">public</b> String getEmail() {
        <b class="hl-keyword">return</b> email;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setEmail(String email) {
        <b class="hl-keyword">this</b>.email = email;
    }

    <b class="hl-keyword">public</b> Date getBirthday() {
        <b class="hl-keyword">return</b> birthday;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setBirthday(Date birthday) {
        <b class="hl-keyword">this</b>.birthday = birthday;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> getAdmin() {
        <b class="hl-keyword">return</b> admin;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setAdmin(<b class="hl-keyword">boolean</b> admin) {
        <b class="hl-keyword">this</b>.admin = admin;
    }

    <b class="hl-keyword">public</b> URL getHomepage() {
        <b class="hl-keyword">return</b> homepage;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setHomepage(URL homepage) {
        <b class="hl-keyword">this</b>.homepage = homepage;
    }

    <b class="hl-keyword">public</b> String getGender() {
        <b class="hl-keyword">return</b> gender;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setGender(String gender) {
        <b class="hl-keyword">this</b>.gender = gender;
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="um.userhandler"></a>3.3.&nbsp;Create the handler</h2></div></div></div><p>
      Create a new class <code class="literal">UserHandler</code> which implements 
      <code class="literal">de.schlund.pfixcore.generator.IHandler</code>
    </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.usermanagement;

<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IHandler;
<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IWrapper;
<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.Context;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> UserHandler <b class="hl-keyword">implements</b> IHandler {

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> handleSubmittedData(Context context, IWrapper wrapper) <b class="hl-keyword">throws</b> Exception {
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> isActive(Context context) <b class="hl-keyword">throws</b> Exception {
        <b class="hl-keyword">return</b> true;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> needsData(Context context) <b class="hl-keyword">throws</b> Exception {
        <b class="hl-keyword">return</b> false;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> prerequisitesMet(Context context) <b class="hl-keyword">throws</b> Exception {
        <b class="hl-keyword">return</b> true;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> retrieveCurrentStatus(Context context, IWrapper wrapper) <b class="hl-keyword">throws</b> Exception {
        
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="um.caster"></a>3.4.&nbsp;Create a caster</h2></div></div></div><p>
      In order to cast the String parameter from the HTML form to the <code class="literal">java.net.URL</code> object
      we defined in the bean above, you need to create a caster.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.caster.statuscode"></a>3.4.1.&nbsp;Create a new statuscode for the caster</h3></div></div></div><p>
        First of all you need a new statuscode to show an appropriate errormessage. Since this is your first
        statuscode you have to setup this first.
      </p><p>  
        Create the file <code class="filename">src/main/webapp/dyntxt/statuscodeinfo.xml</code> with the following content.
      </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="UTF-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">statuscodeinfo</b> <span class="hl-attribute" style="color: blue">xmlns</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/statuscodeinfo"</span> 
                <span class="hl-attribute" style="color: blue">xmlns:xsi</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/2001/XMLSchema-instance"</span>
                <span class="hl-attribute" style="color: blue">xsi:schemaLocation</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/statuscodeinfo 
                                    http://www.pustefix-framework.org/2008/namespace/statuscodeinfo.xsd"</span>&gt;

  &lt;<b class="hl-tag" style="color: blue">statuscodes</b> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.StatusCodeLib"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">file</b>&gt;statusmessages.xml&lt;<b class="hl-tag" style="color: blue">/file</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/statuscodes</b>&gt;
  
&lt;<b class="hl-tag" style="color: blue">/statuscodeinfo</b>&gt;</pre><p>
        This configuration file tells you application that the statuscodes can be found in the file 
        <code class="filename">statusmessages.xml</code> in the same directory
      </p><p>
        You need to create the file <code class="filename">src/main/webapp/dyntxt/statusmessages.xml</code> and add an statuscode
        for an invalid url.
      </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="UTF-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">include_parts</b> <span class="hl-attribute" style="color: blue">xmlns:ixsl</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/1999/XSL/Transform"</span> <span class="hl-attribute" style="color: blue">xmlns:pfx</span>=<span class="hl-value" style="color: blue">"http://www.schlund.de/pustefix/core"</span>&gt;
  &lt;<b class="hl-tag" style="color: blue">part</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"caster.url.INVALID"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">theme</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"default"</span>&gt;
      The URL you entered is not valid
    &lt;<b class="hl-tag" style="color: blue">/theme</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/part</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/include_parts</b>&gt;</pre><p>
	  In order to be able to use the Status Code in the following code, you have to create the associated sources using the <span class="command"><strong>mvn generate-sources</strong></span> command.
	</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.caster.tourl"></a>3.4.2.&nbsp;Create the ToURL-caster</h3></div></div></div><p>
        Create a new class <code class="literal">ToURL</code> in the package <code class="literal">org.pustefixframework.tutorial.caster</code>
        which extends <code class="literal">SimpleCheck</code>.
        The <code class="literal">ToURL</code> class casts the request param to an <code class="literal">java.net.URL</code> object and adds the new
        created statuscode if the url is malformed.
      </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.caster;

<b class="hl-keyword">import</b> java.net.MalformedURLException;
<b class="hl-keyword">import</b> java.net.URL;
<b class="hl-keyword">import</b> java.util.ArrayList;
<b class="hl-keyword">import</b> java.util.List;

<b class="hl-keyword">import</b> org.pustefixframework.tutorial.usermanagement.StatusCodes;

<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IWrapperParamCaster;
<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.SimpleCheck;
<b class="hl-keyword">import</b> de.schlund.pfixxml.RequestParam;
<b class="hl-keyword">import</b> de.schlund.util.statuscodes.StatusCode;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> ToURL <b class="hl-keyword">extends</b> SimpleCheck <b class="hl-keyword">implements</b> IWrapperParamCaster {

    <b class="hl-keyword">private</b> URL[] value = null;
    <b class="hl-keyword">private</b> StatusCode scode;
    
    <b class="hl-keyword">public</b> ToURL() {
        scode = StatusCodeLib.CASTER_URL_INVALID;
    }
    
    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> castValue(RequestParam[] requestParams) {
        List&lt;URL&gt; out = <b class="hl-keyword">new</b> ArrayList&lt;URL&gt;();
        URL url;
        <b class="hl-keyword">for</b> (RequestParam param : requestParams) {
            <b class="hl-keyword">try</b> {
                url = <b class="hl-keyword">new</b> URL(param.getValue());
                out.add(url);
            } <b class="hl-keyword">catch</b>(MalformedURLException ex) {
                addSCode(scode);
            }
        }
        <b class="hl-keyword">if</b> (!errorHappened()) {
            value = out.toArray(<b class="hl-keyword">new</b> URL[] {});
        }
    }

    <b class="hl-keyword">public</b> Object[] getValue() {
        <b class="hl-keyword">return</b> value;
    }
}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="um.beanannotations"></a>3.5.&nbsp;Annotate the User bean</h2></div></div></div><p>
      Instead of creating an <code class="literal">iwrp</code> file described in <a class="xref" href="#wrapper-handler.business-logic.wrapper" title="2.6.1.&nbsp;Implementing a wrapper">Section&nbsp;2.6.1, &#8220;Implementing a wrapper&#8221;</a>
      you can now use annotations to create the wrapper class. Therefor you need to annotate the class and the getters of 
      the user bean from above.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.beanannotations.class"></a>3.5.1.&nbsp;Annotate the class declaration</h3></div></div></div><p>
        To tell the pustefix build system to create an wrapper class from the bean you need to add the <code class="literal">@IWrapper</code> 
        annotation to the class declaration. You can specify the name of the generated wrapper class and the corresponding 
        handler class. 
      </p><pre class="programlisting"><b class="hl-keyword">import</b> de.schlund.pfixcore.generator.annotation.IWrapper;</pre><pre class="programlisting">@IWrapper(name=<b class="hl-string"><i style="color:red">"UserWrapper"</i></b>, ihandler=UserHandler.<b class="hl-keyword">class</b>)
<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> User {
    ...</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.beanannotations.getter"></a>3.5.2.&nbsp;Annotate the getter</h3></div></div></div><p>
         The @Param annotation is used to mark a bean property as parameter. You can select the name of the 
         parameter and choose if it is mandatory or optional. 
      </p><pre class="programlisting"><b class="hl-keyword">import</b> de.schlund.pfixcore.generator.annotation.Caster;
<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.annotation.Param;
<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.annotation.Transient;
<b class="hl-keyword">import</b> de.schlund.pfixcore.oxm.impl.annotation.DateSerializer;
<b class="hl-keyword">import</b> org.pustefixframework.tutorial.caster.ToURL;</pre><p>
        The <code class="literal">@Transient</code> annotation is used to avoid the generation of a wrapper parameter.  
      </p><pre class="programlisting">@Transient
<b class="hl-keyword">public</b> <b class="hl-keyword">int</b> getId() {
    ...</pre><pre class="programlisting">@Param(name=<b class="hl-string"><i style="color:red">"name"</i></b>)
<b class="hl-keyword">public</b> String getName() {
    ...</pre><pre class="programlisting">@Param(name=<b class="hl-string"><i style="color:red">"email"</i></b>)
<b class="hl-keyword">public</b> String getEmail() {
    ...</pre><p>
        The <code class="literal">@DateSerializer("format")</code> annotation tells the wrapper that it should use the given serializer
        class to serialize this property.
      </p><pre class="programlisting">@Param(name=<b class="hl-string"><i style="color:red">"birthday"</i></b>)
@DateSerializer(<b class="hl-string"><i style="color:red">"yyyy/MM/dd"</i></b>)
<b class="hl-keyword">public</b> Date getBirthday() {
    ...</pre><pre class="programlisting">@Param(name=<b class="hl-string"><i style="color:red">"admin"</i></b>, mandatory=false)
<b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> getAdmin() {
    ...</pre><p>
        The <code class="literal">@Caster</code> annotation notes the caster implementation class. Here you add your ToURL caster 
        implementation from <a class="xref" href="#um.caster" title="3.4.&nbsp;Create a caster">Section&nbsp;3.4, &#8220;Create a caster&#8221;</a>.  
      </p><pre class="programlisting">@Param(name=<b class="hl-string"><i style="color:red">"homepage"</i></b>, mandatory=false)
@Caster(type=ToURL.<b class="hl-keyword">class</b>)
<b class="hl-keyword">public</b> URL getHomepage() {
    ...</pre><pre class="programlisting">@Param(name=<b class="hl-string"><i style="color:red">"gender"</i></b>)
<b class="hl-keyword">public</b> String getGender() {
    ...</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="um.generation"></a>3.6.&nbsp;Generate wrapper</h2></div></div></div><p>
      Type <span class="command"><strong>mvn generate-sources</strong></span> to generate the wrapper.
    </p><p>
      You have to add all subfolders of <code class="filename">target/generated-sources</code> to your Java Buildpath of your project (in Eclipse, go to Project Properties - Java BuildPath - Tab "Source" - "Add Folder..." and check all subfolders of <code class="filename">target/generated-sources</code>).
      You can find the new class <code class="literal">org.pustefixframework.tutorial.usermanagement.UserWrapper</code>
      in the <code class="filename">target/generated-sources/apt</code> directory of your project.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="um.userlist"></a>3.7.&nbsp;Create a userlist class</h2></div></div></div><p>
      You need a class to hold your users. Therefor create a new class 
      <code class="literal">org.pustefixframework.tutorial.usermanagement.UserList</code> with the property users and methods to 
      get one specific users, get all users and add a new user. Further methods will be added later. 
    </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.usermanagement;

<b class="hl-keyword">import</b> java.util.ArrayList;
<b class="hl-keyword">import</b> java.util.List;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> UserList {
    
    <b class="hl-keyword">private</b> List&lt;User&gt; users = <b class="hl-keyword">new</b> ArrayList&lt;User&gt;();
    <b class="hl-keyword">private</b> <b class="hl-keyword">int</b> id = 0;
    
    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> addUser(User user) {
        user.setId(id);
        users.add(user);
        id++;
    }
    
    <b class="hl-keyword">public</b> List&lt;User&gt; getUsers() {
        <b class="hl-keyword">return</b> users;
    }
    
    <b class="hl-keyword">public</b> User getUser(<b class="hl-keyword">int</b> id) {
        <b class="hl-keyword">for</b> (User user : users) {
            <b class="hl-keyword">if</b> (user.getId() == id) {
                <b class="hl-keyword">return</b> user;
            }
        }
        <b class="hl-keyword">return</b> null;
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="um.contextresource"></a>3.8.&nbsp;Adjust the servlet configuration</h2></div></div></div><p>
      Get rid of the old sample stuff by removing the sample pageflow, 
      the pagerequest elements and the defaultflow attribute of the context element
    </p><p>
      Add this to the servlet configuration file <code class="filename">user.conf.xml</code>. 
      The context element should look like the following snippet:
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">context</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">resource</b> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.usermanagement.UserList"</span> /&gt;
&lt;<b class="hl-tag" style="color: blue">/context</b>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1644"></a>3.9.&nbsp;Add a new user</h2></div></div></div><p>
      Adding a new user is quite simple. Implement the handleSubmittedData method of the <code class="classname">UserHandler</code> 
      you created in <a class="xref" href="#um.userhandler" title="3.3.&nbsp;Create the handler">Section&nbsp;3.3, &#8220;Create the handler&#8221;</a>. You create a new <code class="classname">User</code> object by calling 
      <code class="methodname">IWrapperToBean.createBean(IWrapper iwrapper, Class&lt;T&gt; clazz)</code>, get the <code class="classname">
      UserList</code> from session context and add the user to the <code class="classname">userList</code> instance.
    </p><pre class="programlisting"><b class="hl-keyword">import</b> de.schlund.pfixcore.generator.iwrpgen.IWrapperToBean;</pre><pre class="programlisting">User user = IWrapperToBean.createBean(wrapper, User.<b class="hl-keyword">class</b>);
UserList userList = context.getContextResourceManager().getResource(UserList.<b class="hl-keyword">class</b>);
userList.addUser(user);</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="um.pages"></a>3.10.&nbsp;Create the pages</h2></div></div></div><p>
      Here you create two pages: One page for the user data input and one page to list the user data. To keep this
      application clean get rid of the sample pages by removing the sample pages
      in the directory <code class="filename">src/main/webapp/txt/pages</code>.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.pages.userform"></a>3.10.1.&nbsp;Create a page for user data input</h3></div></div></div><p>
        Create a new file <code class="filename">Userform.xml</code> in the directory 
        <code class="filename">src/main/webapp/txt/pages</code>. This page will contain the HTML form to submit the user data.
      </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">include_parts</b> <span class="hl-attribute" style="color: blue">xmlns:ixsl</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/1999/XSL/Transform"</span> <span class="hl-attribute" style="color: blue">xmlns:pfx</span>=<span class="hl-value" style="color: blue">"http://www.schlund.de/pustefix/core"</span>&gt;
  &lt;<b class="hl-tag" style="color: blue">part</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"content"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">theme</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"default"</span>&gt;
      &lt;<b class="hl-tag" style="color: blue">pfx:forminput</b>&gt;
        Name: &lt;<b class="hl-tag" style="color: blue">pfx:xinp</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"text"</span> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.name"</span> /&gt;
        &lt;<b class="hl-tag" style="color: blue">pfx:checkfield</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.name"</span>&gt;
          &lt;<b class="hl-tag" style="color: blue">pfx:error</b>&gt;&lt;<b class="hl-tag" style="color: blue">pfx:scode</b>/&gt;&lt;<b class="hl-tag" style="color: blue">/pfx:error</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">/pfx:checkfield</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">br</b>/&gt;

        E-Mail: &lt;<b class="hl-tag" style="color: blue">pfx:xinp</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"text"</span> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.email"</span> /&gt;
        &lt;<b class="hl-tag" style="color: blue">pfx:checkfield</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.email"</span>&gt;
          &lt;<b class="hl-tag" style="color: blue">pfx:error</b>&gt;&lt;<b class="hl-tag" style="color: blue">pfx:scode</b>/&gt;&lt;<b class="hl-tag" style="color: blue">/pfx:error</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">/pfx:checkfield</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">br</b>/&gt;

        Birthday: &lt;<b class="hl-tag" style="color: blue">pfx:xinp</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"text"</span> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.birthday"</span> /&gt;
        &lt;<b class="hl-tag" style="color: blue">pfx:checkfield</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.birthday"</span>&gt;
          &lt;<b class="hl-tag" style="color: blue">pfx:error</b>&gt;&lt;<b class="hl-tag" style="color: blue">pfx:scode</b>/&gt;&lt;<b class="hl-tag" style="color: blue">/pfx:error</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">/pfx:checkfield</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">br</b>/&gt;

        Gender: 
        &lt;<b class="hl-tag" style="color: blue">pfx:xinp</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"select"</span> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.gender"</span>&gt;
          &lt;<b class="hl-tag" style="color: blue">pfx:option</b> <span class="hl-attribute" style="color: blue">value</span>=<span class="hl-value" style="color: blue">"m"</span> &gt;male&lt;<b class="hl-tag" style="color: blue">/pfx:option</b>&gt;
          &lt;<b class="hl-tag" style="color: blue">pfx:option</b> <span class="hl-attribute" style="color: blue">value</span>=<span class="hl-value" style="color: blue">"f"</span> &gt;female&lt;<b class="hl-tag" style="color: blue">/pfx:option</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">/pfx:xinp</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">pfx:checkfield</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.gender"</span>&gt;
          &lt;<b class="hl-tag" style="color: blue">pfx:error</b>&gt;&lt;<b class="hl-tag" style="color: blue">pfx:scode</b>/&gt;&lt;<b class="hl-tag" style="color: blue">/pfx:error</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">/pfx:checkfield</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">br</b>/&gt;

        Homepage: &lt;<b class="hl-tag" style="color: blue">pfx:xinp</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"text"</span> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.homepage"</span> /&gt;
        &lt;<b class="hl-tag" style="color: blue">pfx:checkfield</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.homepage"</span>&gt;
          &lt;<b class="hl-tag" style="color: blue">pfx:error</b>&gt;&lt;<b class="hl-tag" style="color: blue">pfx:scode</b>/&gt;&lt;<b class="hl-tag" style="color: blue">/pfx:error</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">/pfx:checkfield</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">br</b>/&gt;
        
        Admin: &lt;<b class="hl-tag" style="color: blue">pfx:xinp</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"check"</span> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"user.admin"</span> <span class="hl-attribute" style="color: blue">value</span>=<span class="hl-value" style="color: blue">"true"</span> <span class="hl-attribute" style="color: blue">default</span>=<span class="hl-value" style="color: blue">"false"</span> /&gt;
        &lt;<b class="hl-tag" style="color: blue">br</b>/&gt;      
        &lt;<b class="hl-tag" style="color: blue">pfx:xinp</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"submit"</span> <span class="hl-attribute" style="color: blue">value</span>=<span class="hl-value" style="color: blue">"save"</span>/&gt;
      &lt;<b class="hl-tag" style="color: blue">/pfx:forminput</b>&gt;  
    &lt;<b class="hl-tag" style="color: blue">/theme</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/part</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/include_parts</b>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.pages.overview"></a>3.10.2.&nbsp;Create page for listing users</h3></div></div></div><p>
        Create a new file <code class="filename">Overview.xml</code> in the directory 
        <code class="filename">src/main/webapp/txt/pages</code>. This page shows all users which were stored in the
        session context. Later this page will provide links to <code class="literal">delete</code> and <code class="literal">edit</code> users.
      </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">include_parts</b> <span class="hl-attribute" style="color: blue">xmlns:ixsl</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/1999/XSL/Transform"</span> <span class="hl-attribute" style="color: blue">xmlns:pfx</span>=<span class="hl-value" style="color: blue">"http://www.schlund.de/pustefix/core"</span>&gt;
  &lt;<b class="hl-tag" style="color: blue">part</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"content"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">theme</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"default"</span>&gt;
      &lt;<b class="hl-tag" style="color: blue">h3</b>&gt;Users&lt;<b class="hl-tag" style="color: blue">/h3</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">ixsl:for-each</b> <span class="hl-attribute" style="color: blue">select</span>=<span class="hl-value" style="color: blue">"/formresult/users/users/user"</span>&gt;
        Name: &lt;<b class="hl-tag" style="color: blue">ixsl:value-of</b> <span class="hl-attribute" style="color: blue">select</span>=<span class="hl-value" style="color: blue">"./@name"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">br</b>/&gt;
        Email: &lt;<b class="hl-tag" style="color: blue">ixsl:value-of</b> <span class="hl-attribute" style="color: blue">select</span>=<span class="hl-value" style="color: blue">"./@email"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">br</b>/&gt;
        Birthday: &lt;<b class="hl-tag" style="color: blue">ixsl:value-of</b> <span class="hl-attribute" style="color: blue">select</span>=<span class="hl-value" style="color: blue">"./@birthday"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">br</b>/&gt;
        Gender: &lt;<b class="hl-tag" style="color: blue">ixsl:value-of</b> <span class="hl-attribute" style="color: blue">select</span>=<span class="hl-value" style="color: blue">"./@gender"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">br</b>/&gt;
        &lt;<b class="hl-tag" style="color: blue">ixsl:if</b> <span class="hl-attribute" style="color: blue">test</span>=<span class="hl-value" style="color: blue">"./@homepage"</span>&gt;
          Homepage: &lt;<b class="hl-tag" style="color: blue">ixsl:value-of</b> <span class="hl-attribute" style="color: blue">select</span>=<span class="hl-value" style="color: blue">"./@homepage"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">br</b>/&gt;
        &lt;<b class="hl-tag" style="color: blue">/ixsl:if</b>&gt;
        Admin: &lt;<b class="hl-tag" style="color: blue">ixsl:value-of</b> <span class="hl-attribute" style="color: blue">select</span>=<span class="hl-value" style="color: blue">"./@admin"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">br</b>/&gt;
        &lt;<b class="hl-tag" style="color: blue">br</b>/&gt;&lt;<b class="hl-tag" style="color: blue">br</b>/&gt;        
      &lt;<b class="hl-tag" style="color: blue">/ixsl:for-each</b>&gt;

      &lt;<b class="hl-tag" style="color: blue">pfx:button</b> <span class="hl-attribute" style="color: blue">page</span>=<span class="hl-value" style="color: blue">"Userform"</span>&gt;add&lt;<b class="hl-tag" style="color: blue">/pfx:button</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">/theme</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/part</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/include_parts</b>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.pages.configuration"></a>3.10.3.&nbsp;Add pages to xml configuration files</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="um.pages.configuration.servlet"></a>user.conf.xml</h4></div></div></div><p>
          Add two new <code class="literal">pagerequest</code> elements to the <code class="filename">app.xml</code> 
          configuration file below the <code class="literal">context</code> element.
        </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">pagerequest</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"Userform"</span>&gt;
  &lt;<b class="hl-tag" style="color: blue">input</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">wrapper</b> <span class="hl-attribute" style="color: blue">prefix</span>=<span class="hl-value" style="color: blue">"user"</span> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.usermanagement.UserWrapper"</span> /&gt;
  &lt;<b class="hl-tag" style="color: blue">/input</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/pagerequest</b>&gt;</pre><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">pagerequest</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"Overview"</span>&gt;
  &lt;<b class="hl-tag" style="color: blue">output</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">resource</b> <span class="hl-attribute" style="color: blue">node</span>=<span class="hl-value" style="color: blue">"users"</span> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.usermanagement.UserList"</span> /&gt;
  &lt;<b class="hl-tag" style="color: blue">/output</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/pagerequest</b>&gt;</pre><p>
          Set the <code class="literal">Overview</code> page as <code class="literal">defaultpage</code> by adding the 
          attribute to the context element as described in <a class="xref" href="#wrapper-handler.entrypage" title="2.4.&nbsp;Setting the entry page">Section&nbsp;2.4, &#8220;Setting the entry page&#8221;</a>.
        </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">context</b> <span class="hl-attribute" style="color: blue">defaultpage</span>=<span class="hl-value" style="color: blue">"Overview"</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="um.pages.configuration.depend"></a>depend.xml</h4></div></div></div><p>
          Remove the sample page element and the sample standardpage alement.
        </p><p>Add the standardmetatags element:</p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">standardpage</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"Userform"</span> <span class="hl-attribute" style="color: blue">xml</span>=<span class="hl-value" style="color: blue">"xml/frame.xml"</span>/&gt;
&lt;<b class="hl-tag" style="color: blue">standardpage</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"Overview"</span> <span class="hl-attribute" style="color: blue">xml</span>=<span class="hl-value" style="color: blue">"xml/frame.xml"</span>/&gt;</pre></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="um.pageflow"></a>3.11.&nbsp;Add a pageflow</h2></div></div></div><p>
      Place a new <code class="literal">pageflow</code> element between <code class="literal">context</code> and 
      <code class="filename">pagerequest</code> elements in the servlet configuration file <code class="filename">user.conf.xml</code>.
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">pageflow</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"userFlow"</span> <span class="hl-attribute" style="color: blue">final</span>=<span class="hl-value" style="color: blue">"Overview"</span>&gt;
  &lt;<b class="hl-tag" style="color: blue">flowstep</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"Userform"</span>/&gt;
  &lt;<b class="hl-tag" style="color: blue">flowstep</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"Overview"</span>/&gt;
&lt;<b class="hl-tag" style="color: blue">/pageflow</b>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="um.tryout"></a>3.12.&nbsp;Try to add your own user</h2></div></div></div><p>
      Type <span class="command"><strong>mvn tomcat:run</strong></span> to start the web-application.
    </p><p>
      Now you can point your browser to http://localhost:8080/usermanagement/
    </p><p>If everything works fine you should see this:</p><p></p><div class="mediaobject"><img src="images/tutorial/overview_empty.png"></div><p></p><div class="mediaobject"><img src="images/tutorial/userform.png"></div><p></p><div class="mediaobject"><img src="images/tutorial/overview_user.png"></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="um.sampleusers"></a>3.13.&nbsp;Add sample users</h2></div></div></div><p>
      If you tried out your application you've seen that the Overview page is empty unless you add new users.
      You can add some sample users by calling the <code class="methodname">addUser</code> method of 
      <code class="classname">UserList</code> directly.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.sampleusers.constructor"></a>3.13.1.&nbsp;Add new constructors to your <code class="classname">UserList</code></h3></div></div></div><p>
        To add sample users more easily add an constructor to set the mandatory data at once.
      </p><pre class="programlisting"><b class="hl-keyword">public</b> User(String name, String email, Date birthday, <b class="hl-keyword">boolean</b> admin, URL homepage, String gender) {
  <b class="hl-keyword">this</b>.name = name;
  <b class="hl-keyword">this</b>.email = email;
  <b class="hl-keyword">this</b>.birthday = birthday;
  <b class="hl-keyword">this</b>.admin = admin;
  <b class="hl-keyword">this</b>.homepage = homepage;
  <b class="hl-keyword">this</b>.gender = gender;
}</pre><p>
        Further you need a default constructor here.
      </p><pre class="programlisting"><b class="hl-keyword">public</b> User() {
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.sampleusers.initmethod"></a>3.13.2.&nbsp;Add init method to UserList</h3></div></div></div><p>
        To add the users when the <code class="literal">context resource</code> is initialized you need to add a method annotated with 
        <code class="literal">@InitResource</code>.
      </p><pre class="programlisting"><b class="hl-keyword">import</b> java.util.GregorianCalendar;
<b class="hl-keyword">import</b> java.net.URL;
<b class="hl-keyword">import</b> de.schlund.pfixcore.beans.InitResource;</pre><pre class="programlisting">@InitResource
<b class="hl-keyword">public</b> <b class="hl-keyword">void</b> createSampleUsers() <b class="hl-keyword">throws</b> Exception {
  addUser(<b class="hl-keyword">new</b> User(<b class="hl-string"><i style="color:red">"Neo"</i></b>, <b class="hl-string"><i style="color:red">"neo@pustefix-framework.org"</i></b>, <b class="hl-keyword">new</b> GregorianCalendar(1964, 8, 2).getTime(), true, 
      <b class="hl-keyword">new</b> URL(<b class="hl-string"><i style="color:red">"http://pustefix-framework.org"</i></b>), <b class="hl-string"><i style="color:red">"m"</i></b>));
  addUser(<b class="hl-keyword">new</b> User(<b class="hl-string"><i style="color:red">"Trinity"</i></b>, <b class="hl-string"><i style="color:red">"trinity@pustefix-framework.org"</i></b>, <b class="hl-keyword">new</b> GregorianCalendar(1967, 7, 21).getTime(), true, 
      <b class="hl-keyword">new</b> URL(<b class="hl-string"><i style="color:red">"http://pustefix-framework.org"</i></b>), <b class="hl-string"><i style="color:red">"f"</i></b>));
  addUser(<b class="hl-keyword">new</b> User(<b class="hl-string"><i style="color:red">"Morpheus"</i></b>, <b class="hl-string"><i style="color:red">"morpheus@pustefix-framework.org"</i></b>, <b class="hl-keyword">new</b> GregorianCalendar(1961, 6, 30).getTime(), true, 
      <b class="hl-keyword">new</b> URL(<b class="hl-string"><i style="color:red">"http://pustefix-framework.org"</i></b>), <b class="hl-string"><i style="color:red">"m"</i></b>));
}</pre><p>
        When you try this out again (see <a class="xref" href="#um.tryout" title="3.12.&nbsp;Try to add your own user">Section&nbsp;3.12, &#8220;Try to add your own user&#8221;</a>) you should see the following screen:
      </p><p></p><div class="mediaobject"><img src="images/tutorial/overview_sampleusers.png"></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="um.deleteuser"></a>3.14.&nbsp;New feature: Delete a user</h2></div></div></div><p>
      To remove an existing user from the <code class="classname">UserList</code> you need to create a new bean which stores
      the selected user id, a new handler and a delete method in the <code class="classname">UserList</code> class. 
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.deleteuser.bean"></a>3.14.1.&nbsp;Create a new bean</h3></div></div></div><p>
        Create another bean <code class="classname">org.pustefixframework.tutorial.usermanagement.DeleteUser</code>. This bean 
        stores the id of the selected user.
      </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.usermanagement;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> DeleteUser {
    <b class="hl-keyword">private</b> <b class="hl-keyword">int</b> id;

    <b class="hl-keyword">public</b> <b class="hl-keyword">int</b> getId() {
        <b class="hl-keyword">return</b> id;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setId(<b class="hl-keyword">int</b> id) {
        <b class="hl-keyword">this</b>.id = id;
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.deleteuser.handler"></a>3.14.2.&nbsp;Create a new handler</h3></div></div></div><p>
        Create a new handler <code class="classname">org.pustefixframework.tutorial.usermanagement.DeleteUserHandler</code>. This
        handler gets the selected user id from the wrapper and calls the remove method from <code class="classname">UserList</code>.
      </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.usermanagement;

<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IHandler;
<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IWrapper;
<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.Context;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> DeleteUserHandler <b class="hl-keyword">implements</b> IHandler {

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> handleSubmittedData(Context context, IWrapper wrapper) <b class="hl-keyword">throws</b> Exception {
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> isActive(Context context) <b class="hl-keyword">throws</b> Exception {
        <b class="hl-keyword">return</b> true;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> needsData(Context context) <b class="hl-keyword">throws</b> Exception {
        <b class="hl-keyword">return</b> false;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> prerequisitesMet(Context context) <b class="hl-keyword">throws</b> Exception {
        <b class="hl-keyword">return</b> true;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> retrieveCurrentStatus(Context context, IWrapper wrapper) <b class="hl-keyword">throws</b> Exception {
    }

}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.deleteuser.annotations"></a>3.14.3.&nbsp;Annotate the DeleteUser bean</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="um.deleteuser.annotations.class"></a>Annotate the class declaration</h4></div></div></div><pre class="programlisting"><b class="hl-keyword">import</b> de.schlund.pfixcore.generator.annotation.IWrapper;</pre><pre class="programlisting">@IWrapper(name=<b class="hl-string"><i style="color:red">"DeleteUserWrapper"</i></b>, ihandler=DeleteUserHandler.<b class="hl-keyword">class</b>)
<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> DeleteUser {</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="um.deleteuser.annotations.getter"></a>Annotate the getter</h4></div></div></div><pre class="programlisting"><b class="hl-keyword">import</b> de.schlund.pfixcore.generator.annotation.Param;</pre><pre class="programlisting">@Param(name=<b class="hl-string"><i style="color:red">"id"</i></b>)
<b class="hl-keyword">public</b> <b class="hl-keyword">int</b> getId() {</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.deleteuser.generate"></a>3.14.4.&nbsp;Generate the wrapper class</h3></div></div></div><p>
        Type <span class="command"><strong>mvn generate-sources</strong></span> to generate the wrapper class.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.deleteuser.method"></a>3.14.5.&nbsp;Add a delete user method</h3></div></div></div><p>
        Add a new method <code class="methodname">deleteUser(int id)</code> to remove an existing user from 
        <code class="classname">UserList</code>.
      </p><pre class="programlisting"><b class="hl-keyword">public</b> <b class="hl-keyword">void</b> deleteUser(<b class="hl-keyword">int</b> id) {
    User userToDelete = getUser(id);
    <b class="hl-keyword">if</b> (userToDelete != null) {
        users.remove(userToDelete);
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.deleteuser.handlesubmitteddata"></a>3.14.6.&nbsp;Delete a user</h3></div></div></div><p>
        To delete a user implement the method <code class="methodname">handleSubmittedData</code> of
        <code class="classname">DeleteUserHandler</code>. First create a new <code class="classname">DeleteUser</code> bean with
        <code class="literal">IWrapperToBean.createBean(Iwrapper wrapper, Class&lt;T&gt;</code> and get your
        <code class="classname">UserList</code> instance from <code class="literal">session context</code>. Then call the 
        <code class="methodname">deleteUser(Integer id)</code> method. 
      </p><pre class="programlisting"><b class="hl-keyword">import</b> de.schlund.pfixcore.generator.iwrpgen.IWrapperToBean;</pre><pre class="programlisting"><b class="hl-keyword">public</b> <b class="hl-keyword">void</b> handleSubmittedData(Context context, IWrapper wrapper) <b class="hl-keyword">throws</b> Exception {
    DeleteUser deleteUser = IWrapperToBean.createBean(wrapper, DeleteUser.<b class="hl-keyword">class</b>);
    UserList userList = context.getContextResourceManager().getResource(UserList.<b class="hl-keyword">class</b>);
    userList.deleteUser(deleteUser.getId());
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.deleteuser.button"></a>3.14.7.&nbsp;Add a delete button</h3></div></div></div><p>
        You need a button to trigger to deletion of a user. Simply add the following code inside the for-each 
        loop after the admin text in the <code class="filename">Overview.xml</code> file
      </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">pfx:button</b>&gt;delete
  &lt;<b class="hl-tag" style="color: blue">pfx:command</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"SELWRP"</span>&gt;delete&lt;<b class="hl-tag" style="color: blue">/pfx:command</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">pfx:argument</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"delete.id"</span>&gt;&lt;<b class="hl-tag" style="color: blue">ixsl:value-of</b> <span class="hl-attribute" style="color: blue">select</span>=<span class="hl-value" style="color: blue">"./@id"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">/pfx:argument</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/pfx:button</b>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.deleteuser.configuration"></a>3.14.8.&nbsp;Adjust the servlet configuration</h3></div></div></div><p>
        Add the input element to the existing <code class="literal">pagerequest</code> of the Overview page.
      </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">input</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">wrapper</b> <span class="hl-attribute" style="color: blue">prefix</span>=<span class="hl-value" style="color: blue">"delete"</span> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.usermanagement.DeleteUserWrapper"</span> /&gt;
&lt;<b class="hl-tag" style="color: blue">/input</b>&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="um.edituser"></a>3.15.&nbsp;New feature: Edit a user</h2></div></div></div><p>
      The last feature in this tutorial is to edit an existing user
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.edituser.bean"></a>3.15.1.&nbsp;Create a new bean</h3></div></div></div><p>
        Create another bean <code class="classname">org.pustefixframework.tutorial.usermanagement.EditUser</code>. This bean 
        stores the id of the selected user and if the user is currently being edited.
      </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.usermanagement;


<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> EditUser {
    <b class="hl-keyword">private</b> <b class="hl-keyword">int</b> id;
    <b class="hl-keyword">private</b> <b class="hl-keyword">boolean</b> editing = false;

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> isEditing() {
        <b class="hl-keyword">return</b> editing;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setEditing(<b class="hl-keyword">boolean</b> editing) {
        <b class="hl-keyword">this</b>.editing = editing;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">int</b> getId() {
        <b class="hl-keyword">return</b> id;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> setId(<b class="hl-keyword">int</b> id) {
        <b class="hl-keyword">this</b>.id = id;
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.edituser.handler"></a>3.15.2.&nbsp;Create a new handler</h3></div></div></div><p>
        Create a new handler <code class="classname">org.pustefixframework.tutorial.usermanagement.EditUserHandler</code>. 
        This handler gets the selected user id from the wrapper and loads the selected user. 
      </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.usermanagement;

<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IHandler;
<b class="hl-keyword">import</b> de.schlund.pfixcore.generator.IWrapper;
<b class="hl-keyword">import</b> de.schlund.pfixcore.workflow.Context;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> EditUserHandler <b class="hl-keyword">implements</b> IHandler {

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> handleSubmittedData(Context context, IWrapper wrapper) <b class="hl-keyword">throws</b> Exception {
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> isActive(Context context) <b class="hl-keyword">throws</b> Exception {
        <b class="hl-keyword">return</b> true;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> needsData(Context context) <b class="hl-keyword">throws</b> Exception {
        <b class="hl-keyword">return</b> false;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> prerequisitesMet(Context context) <b class="hl-keyword">throws</b> Exception {
        <b class="hl-keyword">return</b> true;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">void</b> retrieveCurrentStatus(Context context, IWrapper wrapper) <b class="hl-keyword">throws</b> Exception {
    }

}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.edituser.annotations"></a>3.15.3.&nbsp;Annotate the EditUser bean</h3></div></div></div><p>
        To generate a <code class="literal">wrapper</code> from this bean you have to annotate it.
      </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="um.edituser.annotations.class"></a>Annotate the class</h4></div></div></div><pre class="programlisting"><b class="hl-keyword">import</b> de.schlund.pfixcore.generator.annotation.IWrapper;</pre><pre class="programlisting">@IWrapper(name=<b class="hl-string"><i style="color:red">"EditUserWrapper"</i></b>, ihandler=EditUserHandler.<b class="hl-keyword">class</b>)
<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> EditUser {</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="um.edituser.annotations.getter.id"></a>Annotate the getter for id</h4></div></div></div><pre class="programlisting"><b class="hl-keyword">import</b> de.schlund.pfixcore.generator.annotation.Param;</pre><pre class="programlisting">@Param(name=<b class="hl-string"><i style="color:red">"id"</i></b>, mandatory=true)
<b class="hl-keyword">public</b> <b class="hl-keyword">int</b> getId() {</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="um.edituser.annotations.getter.editing"></a>Make the getter for editing transient</h4></div></div></div><pre class="programlisting"><b class="hl-keyword">import</b> de.schlund.pfixcore.generator.annotation.Transient;</pre><pre class="programlisting">@Transient
<b class="hl-keyword">public</b> <b class="hl-keyword">boolean</b> isEditing() {</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.edituser.generate"></a>3.15.4.&nbsp;Generate the wrapper class</h3></div></div></div><p>
        Type <span class="command"><strong>mvn generate-sources</strong></span> to generate the wrapper.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.edituser.method"></a>3.15.5.&nbsp;Add a method to replace a user of our UserList class</h3></div></div></div><p>
        To edit a user you need to implement the method to replace an existing user. 
        We add the following code to the <code class="classname">UserList</code> class.
      </p><pre class="programlisting"><b class="hl-keyword">public</b> <b class="hl-keyword">void</b> replaceUser(User user) {
    User userToReplace = getUser(user.getId());
    <b class="hl-keyword">if</b> (userToReplace != null) {
        users.remove(userToReplace);
        users.add(user);
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.edituser.handlesubmitteddata"></a>3.15.6.&nbsp;Edit a user</h3></div></div></div><p>
        To edit a user implement the method <code class="methodname">handleSubmittedData</code> of 
        <code class="classname">EditUserHandler</code>. First create a new <code class="classname">EditUser</code> bean with
        <code class="literal">IWrapperToBean.createBean(Iwrapper wrapper, Class&lt;T&gt;</code> and get your
        <code class="classname">EditUser</code> instance from <code class="literal">session context</code>. Then call the 
        <code class="methodname">setId(Integer id)</code> method. This stores the id of the user in the session context.
      </p><pre class="programlisting"><b class="hl-keyword">import</b> de.schlund.pfixcore.generator.iwrpgen.IWrapperToBean;</pre><pre class="programlisting"><b class="hl-keyword">public</b> <b class="hl-keyword">void</b> handleSubmittedData(Context context, IWrapper wrapper) <b class="hl-keyword">throws</b> Exception {
    EditUser editUser = IWrapperToBean.createBean(wrapper, EditUser.<b class="hl-keyword">class</b>);
    EditUser editUserContext = context.getContextResourceManager().getResource(EditUser.<b class="hl-keyword">class</b>);
    editUserContext.setId(editUser.getId());
    editUserContext.setEditing(true);
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.edituser.button"></a>3.15.7.&nbsp;Add an edit button</h3></div></div></div><p>
        We need a button to edit a user. We add the following code below the delete button in the 
        <code class="filename">Overview.xml</code> file.
      </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">pfx:button</b> <span class="hl-attribute" style="color: blue">jumptopage</span>=<span class="hl-value" style="color: blue">"Userform"</span>&gt;edit
  &lt;<b class="hl-tag" style="color: blue">pfx:command</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"SELWRP"</span>&gt;edit&lt;<b class="hl-tag" style="color: blue">/pfx:command</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">pfx:argument</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"edit.id"</span>&gt;&lt;<b class="hl-tag" style="color: blue">ixsl:value-of</b> <span class="hl-attribute" style="color: blue">select</span>=<span class="hl-value" style="color: blue">"./@id"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">/pfx:argument</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/pfx:button</b>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.edituser.configuration"></a>3.15.8.&nbsp;Adjust the servlet configuration</h3></div></div></div><p>
        Add the <code class="classname">EditUser</code> class as an resource to the context element
      </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">resource</b> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.usermanagement.EditUser"</span> /&gt;</pre><p>
        Add the following <code class="literal">interface</code> element into the <code class="literal">input</code> element of the 
        <code class="literal">pagerequest</code> of the Overview page.
      </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">wrapper</b> <span class="hl-attribute" style="color: blue">prefix</span>=<span class="hl-value" style="color: blue">"edit"</span> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.usermanagement.EditUserWrapper"</span> /&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="um.edituser.userhandler"></a>3.15.9.&nbsp;Add user to form</h3></div></div></div><p>
        To add the user data to the existing form of the <code class="literal">Userform</code> page you need to implement the 
        retrieveCurrentStatus method  of your <code class="classname">UserHandler</code> class.
      </p><pre class="programlisting"><b class="hl-keyword">import</b> de.schlund.pfixcore.generator.iwrpgen.BeanToIWrapper;</pre><pre class="programlisting"><b class="hl-keyword">public</b> <b class="hl-keyword">void</b> retrieveCurrentStatus(Context context, IWrapper wrapper) <b class="hl-keyword">throws</b> Exception {
    EditUser editUser = context.getContextResourceManager().getResource(EditUser.<b class="hl-keyword">class</b>);
    <b class="hl-keyword">if</b> (editUser.isEditing()) {
        UserList userList = context.getContextResourceManager().getResource(UserList.<b class="hl-keyword">class</b>);
        User user = userList.getUser(editUser.getId());
        BeanToIWrapper.populateIWrapper(user, wrapper);
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2114"></a>3.15.10.&nbsp;Replace method handleSubmittedData of UserHandler</h3></div></div></div><p>
        To add and replace an existing user you have to edit the method <code class="methodname">handleSubmittedData</code>:
      </p><pre class="programlisting"><b class="hl-keyword">public</b> <b class="hl-keyword">void</b> handleSubmittedData(Context context, IWrapper wrapper) <b class="hl-keyword">throws</b> Exception {
    UserList userList = context.getContextResourceManager().getResource(UserList.<b class="hl-keyword">class</b>);
    EditUser editUser = context.getContextResourceManager().getResource(EditUser.<b class="hl-keyword">class</b>);
    User user = IWrapperToBean.createBean(wrapper, User.<b class="hl-keyword">class</b>);
    <b class="hl-keyword">if</b> (editUser.isEditing()) {
        <i class="hl-comment" style="color: silver">// replace existing user</i>
        user.setId(editUser.getId());
        userList.replaceUser(user);
        editUser.setEditing(false);          
    } <b class="hl-keyword">else</b> {
        <i class="hl-comment" style="color: silver">// add new user</i>
        userList.addUser(user);    
    }
}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2124"></a>3.16.&nbsp;Conclusion</h2></div></div></div><p>
      In this tutorial you learned how to automatically create wrapper from annotated java beans, how to add custom 
      validations and how you can avoid working with DOM and adding any object structure to the generated XML tree automatically. 
      
      For details about the features that you got to know in this tutorial, take a look at the comprehensive reference documentation, 
      which describes all the annotations, configuration options, XML tags and interfaces in detail.
    </p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="ajax-calculator"></a>AJAX Calculator tutorial</h1></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Stephan</span> <span class="surname">Schmidt</span></h3></div></div></div><div><p class="copyright">Copyright &copy; 2008 1&amp;1 Internet AG</p></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#ajax-calculator.setup">4.1. Setup</a></span></dt><dt><span class="section"><a href="#ajax-calculator.servlet">4.2. Using the webservice servlet</a></span></dt><dt><span class="section"><a href="#ajax-calculator.businesslogic">4.3. Implementing the business logic</a></span></dt><dt><span class="section"><a href="#ajax-calculator.expose">4.4. Exposing the service</a></span></dt><dt><span class="section"><a href="#ajax-calculator.consume">4.5. Consuming the service</a></span></dt><dt><span class="section"><a href="#ajax-calculator.conclusion">4.6. Conclusion</a></span></dt></dl></div><p>
    In this tutorial you will learn how to create an AJAX application with Pustefix. As an example, you will build a very simple
    calculator, which does the real calculation in Java on the server. As in the other tutorials, the business logic has been kept
    extremely simple to focus on the tasks that are required to implement an AJAX application with the Pustefix framework.
  </p><p>
    No matter how complex your business logic is, the tasks required to set up an AJAX application will be almost the same as in
    this tutorial.
  </p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ajax-calculator.setup"></a>4.1.&nbsp;Setup</h2></div></div></div><p>
      To build this tutorial, create a new project <code class="literal">calculator</code> with one servlet as described in
      <a class="xref" href="#wrapper-handler.setup" title="2.1.&nbsp;Setting up a new project">Section&nbsp;2.1, &#8220;Setting up a new project&#8221;</a> with the following data:
    </p><table><thead xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><tr>
          <th>Property</th>
          <th>Value</th>
        </tr></thead><tbody xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><tr>
          <td>groupId</td>
          <td>org.pustefixframework.tutorial</td>
        </tr><tr>
          <td>artifactId</td>
          <td>calculator</td>
        </tr><tr>
          <td>version</td>
          <td>default</td>
        </tr><tr>
          <td>package</td>
          <td>org.pustefixframework.tutorial.calculator</td>
        </tr><tr>
          <td>pustefixVersion</td>
          <td>the latest 0.16.x version</td>
        </tr></tbody></table><p>
      You will also need additional dependencies in your <code class="filename">pom.xml</code> as described below. The version might differ from the version of pustefix-core, go to http://pustefix-framework.org/repository/maven/org/pustefixframework/webservices/ to see which versions are actually available.
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">dependency</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">groupId</b>&gt;org.pustefixframework.webservices&lt;<b class="hl-tag" style="color: blue">/groupId</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">artifactId</b>&gt;pustefix-webservices-core&lt;<b class="hl-tag" style="color: blue">/artifactId</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">version</b>&gt;0.16.2&lt;<b class="hl-tag" style="color: blue">/version</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/dependency</b>&gt;
&lt;<b class="hl-tag" style="color: blue">dependency</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">groupId</b>&gt;org.pustefixframework.webservices&lt;<b class="hl-tag" style="color: blue">/groupId</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">artifactId</b>&gt;pustefix-webservices-jsonws&lt;<b class="hl-tag" style="color: blue">/artifactId</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">version</b>&gt;0.16.2&lt;<b class="hl-tag" style="color: blue">/version</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/dependency</b>&gt;
&lt;<b class="hl-tag" style="color: blue">dependency</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">groupId</b>&gt;org.pustefixframework.webservices&lt;<b class="hl-tag" style="color: blue">/groupId</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">artifactId</b>&gt;pustefix-webservices-jaxws&lt;<b class="hl-tag" style="color: blue">/artifactId</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">version</b>&gt;0.16.2&lt;<b class="hl-tag" style="color: blue">/version</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/dependency</b>&gt;</pre><p>
      Although you are building an AJAX application and will not need any wrappers and handlers which process your submit requests, you
      still need at least one HTML page as a starting point for your application. Please create a page called <code class="literal">Calculator</code>
      by adding the necessary tags to the <code class="filename">depend.xml</code> as described in <a class="xref" href="#wrapper-handler.pages" title="2.3.&nbsp;Creating the pages">Section&nbsp;2.3, &#8220;Creating the pages&#8221;</a>. As the pages
      itself do not trigger any business logic, there is no need to make the page known in the servlet configuration file. 
    </p><p>
      Set the new <code class="literal">Calculator</code> page as the default page as described in <a class="xref" href="#wrapper-handler.entrypage" title="2.4.&nbsp;Setting the entry page">Section&nbsp;2.4, &#8220;Setting the entry page&#8221;</a>
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ajax-calculator.servlet"></a>4.2.&nbsp;Using the webservice servlet</h2></div></div></div><p>
      In AJAX applications, you will need a servlet, that is able to process the AJAX requests sent by the client.
      Pustefix provides a ready-to-use servlet, that is able to expose any Java class as a webservice and process
      requests made by the client. To use this servlet, open the <code class="filename">project.xml</code> configuration
      file and add the the webservice element at the end of the file.     
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">project-config</b> <span class="hl-attribute" style="color: blue">xmlns</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/project-config"</span>&gt;

&lt;<b class="hl-tag" style="color: blue">project</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">application</b>&gt;

    &lt;<i class="hl-comment" style="color: silver">!-- auto-generated content --</i>&gt;

    &lt;<i class="hl-comment" style="color: silver">!-- Add these lines manually above &lt;static&gt; and &lt;choose&gt; --</i>&gt;
    &lt;<b class="hl-tag" style="color: blue">webservice-service</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">path</b>&gt;/webservice&lt;<b class="hl-tag" style="color: blue">/path</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">config-file</b>&gt;docroot:/WEB-INF/webservice.conf.xml&lt;<b class="hl-tag" style="color: blue">/config-file</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">/webservice-service</b>&gt;
    
    &lt;<b class="hl-tag" style="color: blue">static</b>&gt;
      &lt;<i class="hl-comment" style="color: silver">!-- ... --</i>&gt;
    &lt;<b class="hl-tag" style="color: blue">/static</b>&gt;
    
    &lt;<b class="hl-tag" style="color: blue">choose</b>&gt;
      &lt;<i class="hl-comment" style="color: silver">!-- ... --</i>&gt;
    &lt;<b class="hl-tag" style="color: blue">/choose</b>&gt;

  &lt;<b class="hl-tag" style="color: blue">/application</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/project-config</b>&gt;</pre><p>
      Instead of using the <code class="classname">ContextXMLServlet</code> for the servlet, you need to use the
      <code class="classname">org.pustefixframework.webservices.WebServiceServlet</code> instead. To configure the webservice servlet
      you add the <code class="filename">docroot:/WEB-INF/webservice.conf.xml</code> file in the <code class="literal">&lt;propfile/&gt;</code> tag.
    </p><p>
      This <code class="filename">webservice.conf.xml</code> file makes use of the XML syntax like all the previous configuration files
      you encountered in Pustefix. Add the following content to the file:
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">webservice-config</b>
  <span class="hl-attribute" style="color: blue">xmlns</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/webservice-config"</span>
  <span class="hl-attribute" style="color: blue">xmlns:xsi</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hl-attribute" style="color: blue">xsi:schemaLocation</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/webservice-config ../../core/schema/webservice-config.xsd"</span>&gt;
  
  &lt;<b class="hl-tag" style="color: blue">webservice-global</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">requestpath</b>&gt;/webservice&lt;<b class="hl-tag" style="color: blue">/requestpath</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">wsdlsupport</b> <span class="hl-attribute" style="color: blue">enabled</span>=<span class="hl-value" style="color: blue">"false"</span>/&gt;
    &lt;<b class="hl-tag" style="color: blue">stubgeneration</b> <span class="hl-attribute" style="color: blue">enabled</span>=<span class="hl-value" style="color: blue">"false"</span>/&gt;
    &lt;<b class="hl-tag" style="color: blue">protocol</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"JSONWS"</span>/&gt;
    &lt;<b class="hl-tag" style="color: blue">session</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"servlet"</span>/&gt;
    &lt;<b class="hl-tag" style="color: blue">scope</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"application"</span>/&gt;
    &lt;<b class="hl-tag" style="color: blue">admin</b> <span class="hl-attribute" style="color: blue">enabled</span>=<span class="hl-value" style="color: blue">"true"</span>/&gt;
    &lt;<b class="hl-tag" style="color: blue">monitoring</b> <span class="hl-attribute" style="color: blue">enabled</span>=<span class="hl-value" style="color: blue">"true"</span> <span class="hl-attribute" style="color: blue">scope</span>=<span class="hl-value" style="color: blue">"session"</span> <span class="hl-attribute" style="color: blue">historysize</span>=<span class="hl-value" style="color: blue">"10"</span>/&gt;
    &lt;<b class="hl-tag" style="color: blue">logging</b> <span class="hl-attribute" style="color: blue">enabled</span>=<span class="hl-value" style="color: blue">"true"</span>/&gt;
    &lt;<b class="hl-tag" style="color: blue">faulthandler</b> <span class="hl-attribute" style="color: blue">class</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.webservices.fault.LoggingHandler"</span>/&gt;
  &lt;<b class="hl-tag" style="color: blue">/webservice-global</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/webservice-config</b>&gt;</pre><p>
      <a class="xref" href="#ajax-calculator.servlet.config" title="Table&nbsp;4.1.&nbsp;Global webservice configuration">Table&nbsp;4.1, &#8220;Global webservice configuration &#8221;</a> lists all used configuration options and describes
      their usage in this example. 
    </p><table xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" rules="all" frame="box" id="ajax-calculator.servlet.config"><caption>Table&nbsp;4.1.&nbsp;Global webservice configuration </caption><thead><tr>
          <th>Option</th>
          <th>Description</th>
        </tr></thead><tbody><tr>
          <td><code xmlns="" class="literal">requestpath</code></td>
          <td>
            The path where the webservice requests will be sent to.
          </td>
        </tr><tr>
          <td><code xmlns="" class="literal">wsdlsupport</code></td>
          <td>
            Whether WSDL for SOAP webservices should be generated. As you will be using a JSON protocol instead of SOAP, this is not needed.
          </td>
        </tr><tr>
          <td><code xmlns="" class="literal">stubgeneration</code></td>
          <td>
            Whether JavaScript stub classes should be generated in the build process. Again, this is not needed when using a JSON-based protocol.
          </td>
        </tr><tr>
          <td><code xmlns="" class="literal">protocol</code></td>
          <td>
            The protocol to use. In this example, you will be using the <code xmlns="" class="literal">JSONWS</code> protocol, which is very similar to JSON-RPC.
          </td>
        </tr><tr>
          <td><code xmlns="" class="literal">session</code></td>
          <td>
            Which session type to use. Using <code xmlns="" class="literal">servlet</code> means that there must be an HTTP-session that can be used in your services.
          </td>
        </tr><tr>
          <td><code xmlns="" class="literal">scope</code></td>
          <td>
            Specifies the scope in which your web services will be executed. When using <code xmlns="" class="literal">application</code>, the service object is created only once and reused for all requests.
          </td>
        </tr><tr>
          <td><code xmlns="" class="literal">admin</code></td>
          <td>
            Whether to enable the web service admin console.
          </td>
        </tr><tr>
          <td><code xmlns="" class="literal">monitoring</code></td>
          <td>
            Whether to enable the web service monitoring, which is useful for debgging.
          </td>
        </tr><tr>
          <td><code xmlns="" class="literal">logging</code></td>
          <td>
            Whether to enable the pustefix-webservice.log, which contains all requests and responses.
          </td>
        </tr><tr>
          <td><code xmlns="" class="literal">faulthandler</code></td>
          <td>
            Specifies a class that will receive all exceptions that are thrown in your web services.
          </td>
        </tr></tbody></table><p>
      You have now configured the <code class="classname">WebServiceServlet</code> and it is now available at
      <code class="uri">http://localhost:8080/calc/webservice/</code>. If you open this URL in your
      browser, you will get an HTTP Code <code class="literal">400 Bad Request</code> as you made a simple HTTP
      request instead of a webservice request.
    </p><p>
      To make web service requests, you will at first have to implement a service that you can send
      requests to.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ajax-calculator.businesslogic"></a>4.3.&nbsp;Implementing the business logic</h2></div></div></div><p>
      In Pustefix, a web service always has to consist of a service interface and an implementation.
      In this tutorial, you will implement a very simple webservice which provides three methods to
      execute mathematical operations.
    </p><div class="itemizedlist"><ul type="disc"><li><p>Add two integer numbers</p></li><li><p>Subtract two integer numbers</p></li><li><p>Multiply two integer numbers</p></li></ul></div><p>
      The interface for this business logic is very easy to implement:
    </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.calculator;

<b class="hl-keyword">public</b> <b class="hl-keyword">interface</b> CalculatorService {
    <b class="hl-keyword">public</b> <b class="hl-keyword">int</b> add(<b class="hl-keyword">int</b> a, <b class="hl-keyword">int</b> b);
    <b class="hl-keyword">public</b> <b class="hl-keyword">int</b> subtract(<b class="hl-keyword">int</b> a, <b class="hl-keyword">int</b> b);
    <b class="hl-keyword">public</b> <b class="hl-keyword">int</b> multiply(<b class="hl-keyword">int</b> a, <b class="hl-keyword">int</b> b);
}</pre><p>
      The implementation for this interface is not any harder to implement than the interface iteself:
    </p><pre class="programlisting"><b class="hl-keyword">package</b> org.pustefixframework.tutorial.calculator;

<b class="hl-keyword">import</b> org.pustefixframework.webservices.AbstractService;

<b class="hl-keyword">public</b> <b class="hl-keyword">class</b> CalculatorServiceImpl <b class="hl-keyword">extends</b> AbstractService <b class="hl-keyword">implements</b> CalculatorService {
    <b class="hl-keyword">public</b> <b class="hl-keyword">int</b> add(<b class="hl-keyword">int</b> a, <b class="hl-keyword">int</b> b) {
        <b class="hl-keyword">return</b> a+b;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">int</b> subtract(<b class="hl-keyword">int</b> a, <b class="hl-keyword">int</b> b) {
        <b class="hl-keyword">return</b> a-b;
    }

    <b class="hl-keyword">public</b> <b class="hl-keyword">int</b> multiply(<b class="hl-keyword">int</b> a, <b class="hl-keyword">int</b> b) {
        <b class="hl-keyword">return</b> a*b;
    }
}</pre><p>
      As you can see, the <code class="classname">CalculatorServiceImpl</code> implements the
      <code class="classname">CalculatorService</code> service interface <span class="emphasis"><em>and</em></span> extends
      the abstract class <code class="classname">AbstractService</code> provided by Pustefix.
      All of your web service implementations should extend this class to inherit some methods
      that are useful when working with web services. 
    </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Accessing the context"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/docbkx/tip.png"></td><th align="left">Accessing the context</th></tr><tr><td align="left" valign="top"><p>
        The <code class="classname">AbstractService</code> class provides a <code class="function">getContext</code> method
        which gives you access to the <code class="classname">Context</code> of the current user. This allows you to
        access any data that your application stored in the context.
      </p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ajax-calculator.expose"></a>4.4.&nbsp;Exposing the service</h2></div></div></div><p>
      Now that you have defined the interface for your service and also provided an implementation for it, the next
      step is to expose this service using the <code class="classname">WebServiceServlet</code> provided by Pustefix
    </p><p>
      This is done by adding some additional configuration options to the <code class="filename">webservice.conf.xml</code> file
      you created earler (in <a class="xref" href="#ajax-calculator.servlet" title="4.2.&nbsp;Using the webservice servlet">Section&nbsp;4.2, &#8220;Using the webservice servlet&#8221;</a>). For each webservice you want to expose, you
      have to add one <code class="literal">&lt;webservice/&gt;</code> tag in this configuration file:
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">webservice-config</b>
  <span class="hl-attribute" style="color: blue">xmlns</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/webservice-config"</span>
  <span class="hl-attribute" style="color: blue">xmlns:xsi</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hl-attribute" style="color: blue">xsi:schemaLocation</span>=<span class="hl-value" style="color: blue">"http://www.pustefix-framework.org/2008/namespace/webservice-config ../../core/schema/webservice-config.xsd"</span>&gt;
  
  &lt;<i class="hl-comment" style="color: silver">!-- global config --</i>&gt;
  
  &lt;<b class="hl-tag" style="color: blue">webservice</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"CalculatorService"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">interface</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.calculator.CalculatorService"</span>/&gt;
    &lt;<b class="hl-tag" style="color: blue">implementation</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"org.pustefixframework.tutorial.calculator.CalculatorServiceImpl"</span>/&gt;
  &lt;<b class="hl-tag" style="color: blue">/webservice</b>&gt;

&lt;<b class="hl-tag" style="color: blue">/webservice-config</b>&gt;</pre><p>
      Each of these webservice configurations requires at least the following options to be set:
    </p><table xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" rules="all" frame="box" id="ajax-calculator.expose.config"><caption>Table&nbsp;4.2.&nbsp;Local webservice configuration</caption><thead><tr>
          <th>Option</th>
          <th>Description</th>
        </tr></thead><tbody><tr>
          <td><code xmlns="" class="literal">name</code></td>
          <td>
            The <code xmlns="" class="literal">name</code> attribute specifies the name of the webservice. This name does not have to match
            the name of the Java class. It will be used to identify the service, when the web service servlet is
            requested by a client.
          </td>
        </tr><tr>
          <td><code xmlns="" class="literal">interface</code></td>
          <td>
            The <code xmlns="" class="literal">&lt;interface/&gt;</code> tag specifies the name of interface for the web service. Only methods
            defined in this interface will be exposed as web service methods.
          </td>
        </tr><tr>
          <td><code xmlns="" class="literal">implementation</code></td>
          <td>
            The <code xmlns="" class="literal">&lt;implementation/&gt;</code> tag references the actual implementation of the service.
          </td>
        </tr></tbody></table><p>
      Also, most of the global options (see <a class="xref" href="#ajax-calculator.servlet.config" title="Table&nbsp;4.1.&nbsp;Global webservice configuration">Table&nbsp;4.1, &#8220;Global webservice configuration &#8221;</a>) can be used in the local
      web service configuration to override them for the specified service.
    </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Accessing the context"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/docbkx/tip.png"></td><th align="left">Accessing the context</th></tr><tr><td align="left" valign="top"><p>
        If your web service extends the <code class="classname">AbstractService</code> class and you want to access the <code class="classname">Context</code>
        of your application, you can use the <code class="literal">&lt;context/&gt;</code> tag to reference the context you want to
        access in your service:
      </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">context</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"pfixtutorial:ajax-calculator::servlet:calc"</span>/&gt;</pre></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ajax-calculator.consume"></a>4.5.&nbsp;Consuming the service</h2></div></div></div><p>
      With these steps, you have finished all Java and configuration work packages and can continue implementing the client
      side of your application. Open the <code class="filename">Calculator.xml</code> file and add some HTML as a frontend for
      your calculator application:
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">include_parts</b> <span class="hl-attribute" style="color: blue">xmlns:ixsl</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/1999/XSL/Transform"</span>
  <span class="hl-attribute" style="color: blue">xmlns:pfx</span>=<span class="hl-value" style="color: blue">"http://www.schlund.de/pustefix/core"</span>&gt;
  &lt;<b class="hl-tag" style="color: blue">part</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"content"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">theme</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"default"</span>&gt;
      &lt;<i class="hl-comment" style="color: silver">!-- Include external JavaScript --</i>&gt;
      &lt;<b class="hl-tag" style="color: blue">pfx:include</b> <span class="hl-attribute" style="color: blue">part</span>=<span class="hl-value" style="color: blue">"javascript-includes"</span>/&gt;

      &lt;<b class="hl-tag" style="color: blue">h1</b>&gt;AJAX Calculator Tutorial&lt;<b class="hl-tag" style="color: blue">/h1</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">fieldset</b>&gt;
        &lt;<b class="hl-tag" style="color: blue">legend</b>&gt;Calculator&lt;<b class="hl-tag" style="color: blue">/legend</b>&gt;
        A: &lt;<b class="hl-tag" style="color: blue">input</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"text"</span> <span class="hl-attribute" style="color: blue">id</span>=<span class="hl-value" style="color: blue">"a"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">br</b>/&gt;
        B: &lt;<b class="hl-tag" style="color: blue">input</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"text"</span> <span class="hl-attribute" style="color: blue">id</span>=<span class="hl-value" style="color: blue">"b"</span>/&gt;&lt;<b class="hl-tag" style="color: blue">br</b>/&gt;
        &lt;<b class="hl-tag" style="color: blue">input</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"button"</span> <span class="hl-attribute" style="color: blue">value</span>=<span class="hl-value" style="color: blue">"add"</span> <span class="hl-attribute" style="color: blue">onClick</span>=<span class="hl-value" style="color: blue">"add();"</span>/&gt;
        &lt;<b class="hl-tag" style="color: blue">input</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"button"</span> <span class="hl-attribute" style="color: blue">value</span>=<span class="hl-value" style="color: blue">"subtract"</span> <span class="hl-attribute" style="color: blue">onClick</span>=<span class="hl-value" style="color: blue">"subtract();"</span>/&gt;
        &lt;<b class="hl-tag" style="color: blue">input</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"button"</span> <span class="hl-attribute" style="color: blue">value</span>=<span class="hl-value" style="color: blue">"multiply"</span> <span class="hl-attribute" style="color: blue">onClick</span>=<span class="hl-value" style="color: blue">"multiply();"</span>/&gt;
      &lt;<b class="hl-tag" style="color: blue">/fieldset</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">/theme</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/part</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/include_parts</b>&gt;</pre><p>
      The HTML page contains several controls:
    </p><div class="itemizedlist"><ul type="disc"><li><p>Two text input fields (with ids <code class="literal">a</code> and <code class="literal">b</code>), in which the user enters the two values, that are used for the calculation.</p></li><li><p>A button labeled <code class="literal">add</code> which will call the JavaScript function <code class="function">add()</code> when clicked.</p></li><li><p>A button labeled <code class="literal">subtract</code> which will call the JavaScript function <code class="function">subtract()</code> when clicked.</p></li><li><p>A button labeled <code class="literal">multiply</code> which will call the JavaScript function <code class="function">multiply()</code> when clicked.</p></li></ul></div><p>
      To implement an AJAX application, you will have to use JavaScript. This has been left out in the last example of your page,
      there is only a <code class="literal">&lt;pfx:include/&gt;</code> tag, which includes a second part <code class="literal">javascript-includes</code>
      defined in the same page. This part is used to separate the HTML from all your JavaScript includes and make the page
      more maintainable.
    </p><p>
      Pustefix does not only provide server side implementation helpers for your AJAX applications, but also some client side JavaScript
      classes which hide all transportation details from you. Pustefix will also generate JavaScript stub classes for the Java services
      you exposed via the <code class="classname">WebServiceServlet</code>. To use the <code class="literal">JSONWS</code> implementation, you have to
      include the following files:
    </p><div class="itemizedlist"><ul type="disc"><li><p><code class="filename">httpRequest.js</code> provides an abstraction over the different <code class="literal">XmlHttpRequest</code> implementations in the different browsers.</p></li><li><p><code class="filename">webservice_json.js</code> provides an abstraction of the <code class="literal">JSONWS</code> protocol used by Pustefix.</p></li><li><p>
          The JavaScript stub for your calculator service is not available as a file, but is generated on demand by the servlet.
          To include this generated JavaScript code, Pustefix provides the <code class="literal">&lt;pfxwsscript/&gt;</code> tag, which takes the name of the
          service (as specified in the <code class="literal">&lt;webservice/&gt;</code> tag in your web service configuration) in the <code class="literal">name</code>
          attribute. This tag will generate the <code class="literal">&lt;script/&gt;</code> tag that requests the generated JavaScript code from
          the web service servlet. 
        </p></li></ul></div><p>
      The following listing shows the <code class="literal">javascript-includes</code> part, which is referenced by the frontend of your application and has to be included in your <code class="filename">Calculator.xml</code> file:
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">include_parts</b> <span class="hl-attribute" style="color: blue">xmlns:ixsl</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/1999/XSL/Transform"</span>
  <span class="hl-attribute" style="color: blue">xmlns:pfx</span>=<span class="hl-value" style="color: blue">"http://www.schlund.de/pustefix/core"</span>&gt;
  
  &lt;<b class="hl-tag" style="color: blue">part</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"content"</span>&gt;
    &lt;<i class="hl-comment" style="color: silver">!-- content, including part "javascript-includes", see above --</i>&gt;
  &lt;<b class="hl-tag" style="color: blue">/part</b>&gt;
  
  &lt;<b class="hl-tag" style="color: blue">part</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"javascript-includes"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">theme</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"default"</span>&gt;
      &lt;<b class="hl-tag" style="color: blue">script</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"text/javascript"</span> <span class="hl-attribute" style="color: blue">src</span>=<span class="hl-value" style="color: blue">"{$__contextpath}/modules/pustefix-core/script/httpRequest.js"</span>&gt;&lt;<b class="hl-tag" style="color: blue">/script</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">script</b> <span class="hl-attribute" style="color: blue">type</span>=<span class="hl-value" style="color: blue">"text/javascript"</span> <span class="hl-attribute" style="color: blue">src</span>=<span class="hl-value" style="color: blue">"{$__contextpath}/modules/pustefix-webservices-jsonws/script/webservice_json.js"</span>&gt;&lt;<b class="hl-tag" style="color: blue">/script</b>&gt;
      &lt;<b class="hl-tag" style="color: blue">pfx:wsscript</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"CalculatorService"</span>/&gt;
    &lt;<b class="hl-tag" style="color: blue">/theme</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/part</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/include_parts</b>&gt;</pre><p>
      If you are taking a look at the generated JavaScript code, you will see, that this code defines a new class called
      <code class="classname">WS_CalculatorService</code>, which provides three methods:
    </p><div class="itemizedlist"><ul type="disc"><li><p><code class="function">add()</code></p></li><li><p><code class="function">subtract()</code></p></li><li><p><code class="function">divide()</code></p></li></ul></div><p>
      These are exactly the same methods that the <code class="classname">CalculatorService</code> interface declared in your Java code.
    </p><pre class="programlisting">//Autogenerated webservice stub (don't modify this code manually!)
function WS_CalculatorService(context) {
  pfx.ws.json.BaseStub.call(this,"CalculatorService",context);
}
WS_CalculatorService.prototype=new pfx.ws.json.BaseStub;
WS_CalculatorService.prototype.subtract=function() {
  return this.callMethod("subtract",arguments,2);
}
WS_CalculatorService.prototype.multiply=function() {
  return this.callMethod("multiply",arguments,2);
}
WS_CalculatorService.prototype.add=function() {
  return this.callMethod("add",arguments,2);
}
</pre><p>
      This class acts as a <span class="emphasis"><em>remote proxy</em></span> for the Java business logic you implemented earlier. If you call
      any of these methods, the calculation will not be done on the client, but the request will be sent to the server, where
      it will be processed by the Java implementation. The response will then be sent back to the client and is available
      in your JavaScript application.
    </p><p>
      So all that is left to do, is implement the client side logic, that will create the proxy object and delegate the
      calculation to it. This is done in a new part <code class="literal">javascript-logic</code>, which you need to include
      in the <code class="literal">content</code> part of your application:
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">include_parts</b> <span class="hl-attribute" style="color: blue">xmlns:ixsl</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/1999/XSL/Transform"</span> <span class="hl-attribute" style="color: blue">xmlns:pfx</span>=<span class="hl-value" style="color: blue">"http://www.schlund.de/pustefix/core"</span>&gt;
  &lt;<b class="hl-tag" style="color: blue">part</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"content"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">theme</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"default"</span>&gt;
      &lt;<i class="hl-comment" style="color: silver">!-- Include external JavaScript --</i>&gt;
      &lt;<b class="hl-tag" style="color: blue">pfx:include</b> <span class="hl-attribute" style="color: blue">part</span>=<span class="hl-value" style="color: blue">"javascript-includes"</span>/&gt;
      &lt;<b class="hl-tag" style="color: blue">pfx:include</b> <span class="hl-attribute" style="color: blue">part</span>=<span class="hl-value" style="color: blue">"javascript-logic"</span>/&gt;

      &lt;<i class="hl-comment" style="color: silver">!-- HTML has been left out --</i>&gt; 
    &lt;<b class="hl-tag" style="color: blue">/theme</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/part</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/include_parts</b>&gt;</pre><p>
      In this part, you are using the <code class="literal">&lt;pfx:script/&gt;</code> tag, which is used to insert inline JavaScript
      into your page. In this script, you create a new instance of <code class="classname">WS_Calculator</code> and assign it to
      a global JavaScript variable.
    </p><p>
      Furthermore, you implement the three missing functions <code class="function">add()</code>, <code class="function">subtract()</code> and
      <code class="function">multiply()</code>, which are called, if the corresponding buttons are clicked. All three methods are implemented
      the same way: The values of the two input fields are read and the corresponding method of the proxy object is called with
      these values. The return value of the proxy method is displayed to the user, using the <code class="function">alert()</code> function.
    </p><pre class="programlisting">&lt;<b class="hl-tag" style="color: blue">?xml version="1.0" encoding="utf-8"?</b>&gt;
&lt;<b class="hl-tag" style="color: blue">include_parts</b> <span class="hl-attribute" style="color: blue">xmlns:ixsl</span>=<span class="hl-value" style="color: blue">"http://www.w3.org/1999/XSL/Transform"</span> <span class="hl-attribute" style="color: blue">xmlns:pfx</span>=<span class="hl-value" style="color: blue">"http://www.schlund.de/pustefix/core"</span>&gt;

  &lt;<b class="hl-tag" style="color: blue">part</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"content"</span>&gt;
    &lt;<i class="hl-comment" style="color: silver">!-- content, see above --</i>&gt;
  &lt;<b class="hl-tag" style="color: blue">/part</b>&gt;
  
  &lt;<b class="hl-tag" style="color: blue">part</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"javascript-includes"</span>&gt;
    &lt;<i class="hl-comment" style="color: silver">!-- see above --</i>&gt;
  &lt;<b class="hl-tag" style="color: blue">/part</b>&gt;
  
  &lt;<b class="hl-tag" style="color: blue">part</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"javascript-logic"</span>&gt;
    &lt;<b class="hl-tag" style="color: blue">theme</b> <span class="hl-attribute" style="color: blue">name</span>=<span class="hl-value" style="color: blue">"default"</span>&gt;
      &lt;<b class="hl-tag" style="color: blue">pfx:script</b>&gt;
var calcProxy = new WS_CalculatorService();
function add() {
  var a = parseInt(document.getElementById('a').value);
  var b = parseInt(document.getElementById('b').value);
  alert(calcProxy.add(parseInt(a),parseInt(b)));
}
function subtract() {
  var a = parseInt(document.getElementById('a').value);
  var b = parseInt(document.getElementById('b').value);
  alert(calcProxy.subtract(parseInt(a),parseInt(b)));
}
function multiply() {
  var a = parseInt(document.getElementById('a').value);
  var b = parseInt(document.getElementById('b').value);
  alert(calcProxy.multiply(parseInt(a),parseInt(b)));
}
      &lt;<b class="hl-tag" style="color: blue">/pfx:script</b>&gt;
    &lt;<b class="hl-tag" style="color: blue">/theme</b>&gt;
  &lt;<b class="hl-tag" style="color: blue">/part</b>&gt;
&lt;<b class="hl-tag" style="color: blue">/include_parts</b>&gt;</pre><p>
      Now you can open the page, enter any two integer numbers and click on any button. Your application will send the request to
      your business logic on the server and display the result on the client without reloading the page.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ajax-calculator.conclusion"></a>4.6.&nbsp;Conclusion</h2></div></div></div><p>
      This tutorial showed you, how to implement an AJAX application based on Pustefix in several minutes. While this example only used
      a very simple business logic and transferred only primitive type, AJAX applications in Pustefix are not restricted to built-in
      Java types. Pustefix is able to send any Java-bean style objects from the client to the server and vice-versa. You only need to
      make sure, that there is an empty constructor in your beans.
    </p><p>
      Furthermore, the following features are also supported by Pustefix:
    </p><div class="itemizedlist"><ul type="disc"><li><p>Access any property of the context (including context resources) in your services.</p></li><li><p>Switch from JSONWS to SOAP without changing any of your services.</p></li><li><p>Implement custom protocols or custom serializers to fit your special needs.</p></li></ul></div><p>
      Of course, you can combine the AJAX features of Pustefix with any other feature in Pustefix with ease. For example, it
      is possible to force AJAX requests to be made secure or to restrict a service to users with sepcial roles attached.
    </p></div></div></div></body></html>
