<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Pustefix Framework Reference Documentation</title><link rel="stylesheet" type="text/css" href="css/style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><meta name="keywords" content="Java, web framework, XML, XSL, XSLT, MVC, Pustefix, Spring, Maven"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book"><div class="titlepage"><div><div><h1 class="title"><a name="reference"></a>Pustefix Framework Reference Documentation</h1></div><div><h2 class="subtitle">Version 0.20.x</h2></div><div><div class="authorgroup"></div></div><div><p class="releaseinfo">This documentation relates to the latest Pustefix release from the 0.20 line.</p></div><div><p class="copyright">Copyright &copy; 2007-2016 </p></div><div><div class="legalnotice"><a name="d0e12"></a><p>Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.</p></div></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="preface"><a href="#introduction">Introduction</a></span></dt><dt><span class="chapter"><a href="#news">1. What's new in Pustefix 0.20.x</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_20_0">1.1. What's new in Pustefix 0.20.0</a></span></dt><dt><span class="section"><a href="#news.0_20_1">1.2. What's new in Pustefix 0.20.1</a></span></dt><dt><span class="section"><a href="#news.0_20_14">1.3. What's new in Pustefix 0.20.14</a></span></dt><dt><span class="section"><a href="#news.0_20_19">1.4. What's new in Pustefix 0.20.19</a></span></dt><dt><span class="section"><a href="#news.0_20_20">1.5. What's new in Pustefix 0.20.20</a></span></dt></dl></dd><dt><span class="chapter"><a href="#installation">2. Installation</a></span></dt><dd><dl><dt><span class="section"><a href="#installation.requirements">2.1. Requirements</a></span></dt><dt><span class="section"><a href="#installation.mavenarchetypes">2.2. Generating a new project from a Maven archetype</a></span></dt><dt><span class="section"><a href="#installation.getsources">2.3. Getting the source code</a></span></dt></dl></dd><dt><span class="chapter"><a href="#architecture">3. Architecture</a></span></dt><dd><dl><dt><span class="section"><a href="#architecture.high-level">3.1. High Level View</a></span></dt><dt><span class="section"><a href="#architecture.backend">3.2. The Pustefix backend system</a></span></dt><dt><span class="section"><a href="#architecture.xsl">3.3. Recursive XSL Transformations</a></span></dt><dd><dl><dt><span class="section"><a href="#architecture.xsl.targets">3.3.1. XSL Targets</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#configuration">4. Configuring Pustefix</a></span></dt><dd><dl><dt><span class="section"><a href="#configuration.introduction">4.1. Overview</a></span></dt><dt><span class="section"><a href="#configuration.customization">4.2. Customization tools</a></span></dt><dt><span class="section"><a href="#configuration.project">4.3. Configuration files</a></span></dt><dd><dl><dt><span class="section"><a href="#configuration.format.props">4.3.1. XML property files syntax</a></span></dt><dt><span class="section"><a href="#configuration.project.projectxml">4.3.2. Project descriptor (project.xml)</a></span></dt><dt><span class="section"><a href="#configuration.depend">4.3.3. Page Configuration (depend.xml)</a></span></dt><dt><span class="section"><a href="#configuration.sitemap">4.3.4. Sitemap configuration</a></span></dt><dt><span class="section"><a href="#configuration.servlet.contextxml">4.3.5. ContextXMLService configuration file</a></span></dt><dt><span class="section"><a href="#configuration.servlet.directoutput">4.3.6. DirectOutputService configuration file</a></span></dt><dt><span class="section"><a href="#configuration.servlet.webservice">4.3.7. WebServices</a></span></dt><dt><span class="section"><a href="#configuration.format.fragments">4.3.8. Configuration Fragments</a></span></dt></dl></dd><dt><span class="section"><a href="#configuration.spring">4.4. Spring configuration and customization</a></span></dt><dd><dl><dt><span class="section"><a href="#configuration.spring.custom">4.4.1. Customizing the Spring configuration</a></span></dt><dt><span class="section"><a href="#configuration.spring.envprops">4.4.2. Environment-dependent Spring property files</a></span></dt><dt><span class="section"><a href="#configuration.spring.profiles">4.4.3. Environment-dependent Spring profiles</a></span></dt><dt><span class="section"><a href="#configuration.spring.beannames">4.4.4. Reserved Spring bean names</a></span></dt></dl></dd><dt><span class="section"><a href="#configuration.logging">4.5. Logging configuration </a></span></dt></dl></dd><dt><span class="chapter"><a href="#xslt">5. Core Pustefix tag library</a></span></dt><dd><dl><dt><span class="section"><a href="#xslt.structure">5.1. Defining the structure of a document</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2882">5.1.1. Structure of a Type 1 document</a></span></dt><dt><span class="section"><a href="#d0e2895">5.1.2. Structure of a Type 2 document</a></span></dt></dl></dd><dt><span class="section"><a href="#xslt.links">5.2. Creating links to internal and external pages</a></span></dt><dd><dl><dt><span class="section"><a href="#xslt.pfx.button">5.2.1. pfx:button</a></span></dt><dt><span class="section"><a href="#xslt.pfx.url">5.2.2. pfx:url</a></span></dt><dt><span class="section"><a href="#xslt.pfx.elink">5.2.3. pfx:elink</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e3114">5.3. Including text and images</a></span></dt><dd><dl><dt><span class="section"><a href="#xslt.pfx.include">5.3.1. Include parts (&lt;pfx:include&gt;)</a></span></dt><dt><span class="section"><a href="#xslt.pfx.maincontent">5.3.2. Generated include requests (&lt;pfx:maincontent&gt;)</a></span></dt><dt><span class="section"><a href="#xslt.pfx.image">5.3.3. Displaying images (&lt;pfx:image&gt;)</a></span></dt><dt><span class="section"><a href="#xslt.renderextensions">5.3.4. Dynamically including parts at rendering time</a></span></dt><dt><span class="section"><a href="#xslt.pfx.checkinclude">5.3.5. Checking include part existence (&lt;pfx:checkinclude&gt;)</a></span></dt><dt><span class="section"><a href="#xslt.pfx.includeparams">5.3.6. Include parameters (&lt;pfx:includeparam&gt;)</a></span></dt></dl></dd><dt><span class="section"><a href="#xslt.messages">5.4. Displaying messages</a></span></dt><dd><dl><dt><span class="section"><a href="#xslt.messages.tags">5.4.1. Message tags</a></span></dt><dt><span class="section"><a href="#xslt.messages.configuration">5.4.2. MessageSource configuration</a></span></dt><dt><span class="section"><a href="#d0e3884">5.4.3. Message format</a></span></dt></dl></dd><dt><span class="section"><a href="#xslt.forms">5.5. Handling HTML forms</a></span></dt><dd><dl><dt><span class="section"><a href="#xslt.pfx.forminput">5.5.1. Form creation</a></span></dt><dt><span class="section"><a href="#xslt.forms.submit">5.5.2. Submitting forms</a></span></dt><dt><span class="section"><a href="#xslt.controls.arguments">5.5.3. Arguments, comands and anchors</a></span></dt><dt><span class="section"><a href="#xslt.forms.elements">5.5.4. Form elements</a></span></dt><dt><span class="section"><a href="#xslt.forms.errors">5.5.5. Handling error conditions</a></span></dt><dt><span class="section"><a href="#xslt.forms.token">5.5.6. Avoiding duplicate form submission</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e4995">5.6. Miscellaneous utility tags</a></span></dt><dd><dl><dt><span class="section"><a href="#xslt.utility.active">5.6.1. Checking page status</a></span></dt><dt><span class="section"><a href="#xslt.pfx.langselect">5.6.2. Displaying content based on the language</a></span></dt><dt><span class="section"><a href="#xslt.pfx.themeselect">5.6.3. Displaying content based on the theme</a></span></dt><dt><span class="section"><a href="#xslt.consoles">5.6.4. Using the Pustefix console</a></span></dt></dl></dd><dt><span class="section"><a href="#xslt.extensions">5.7. XSLT extensions</a></span></dt><dd><dl><dt><span class="section"><a href="#xslt.extensions.xpathfunctions">5.7.1. XPath functions</a></span></dt><dt><span class="section"><a href="#xslt.extensions.extensionelements">5.7.2. XSL extension elements</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#concepts">6. Important Concepts</a></span></dt><dd><dl><dt><span class="section"><a href="#concepts.servlets">6.1. HTTP request handling</a></span></dt><dd><dl><dt><span class="section"><a href="#concepts.httprequesthandlers.core">6.1.1. HttpRequestHandlers provided by the core framework</a></span></dt></dl></dd><dt><span class="section"><a href="#concepts.request_processing">6.2. Processing of Requests</a></span></dt><dd><dl><dt><span class="section"><a href="#concepts.request_processing.context">6.2.1. The Context</a></span></dt><dt><span class="section"><a href="#concepts.request_processing_pageflow">6.2.2. PageFlow</a></span></dt><dt><span class="section"><a href="#concepts.request_processing_states">6.2.3. States</a></span></dt><dt><span class="section"><a href="#d0e6010">6.2.4. Influencing the page request cycle</a></span></dt><dt><span class="section"><a href="#d0e6389">6.2.5. The basic Pustefix Request Cycle</a></span></dt><dt><span class="section"><a href="#d0e6616">6.2.6. Pustefix <code class="code">State</code> implementations</a></span></dt><dt><span class="section"><a href="#d0e6774">6.2.7. Pustefix <code class="code">PageFlow</code> implementation: <code class="code">DataDrivenPageFlow</code></a></span></dt></dl></dd><dt><span class="section"><a href="#d0e6784">6.3. The data model: Context resources</a></span></dt><dt><span class="section"><a href="#d0e6811">6.4. Wrappers and Handlers</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6816">6.4.1. IWrappers</a></span></dt><dt><span class="section"><a href="#d0e7016">6.4.2. The <code class="literal">InputHandler</code> interface</a></span></dt><dt><span class="section"><a href="#d0e7035">6.4.3. The deprecated <code class="literal">IHandler</code> interface</a></span></dt></dl></dd><dt><span class="section"><a href="#concepts.statuscodes">6.5. StatusCodes</a></span></dt><dt><span class="section"><a href="#concepts.interceptors">6.6. ContextInterceptors</a></span></dt></dl></dd><dt><span class="chapter"><a href="#advanced">7. Advanced topics</a></span></dt><dd><dl><dt><span class="section"><a href="#advanced.variantsandthemes">7.1. Variants and Themes</a></span></dt><dd><dl><dt><span class="section"><a href="#advanced.variantsandthemes.themes">7.1.1. Themes</a></span></dt><dt><span class="section"><a href="#advanced.variantsandthemes.variants">7.1.2. Variants</a></span></dt></dl></dd><dt><span class="section"><a href="#advanced.pagealternatives">7.2. Page alternatives</a></span></dt><dt><span class="section"><a href="#advanced.i18n">7.3. Internationalization</a></span></dt><dt><span class="section"><a href="#advanced.multitenancy">7.4. Multitenancy</a></span></dt><dt><span class="section"><a href="#advanced.dyninclude">7.5. Dynamic resource inclusion</a></span></dt><dd><dl><dt><span class="section"><a href="#advanced.dyninclude.modinclude">7.5.1. Including resources from modules</a></span></dt><dt><span class="section"><a href="#advanced.dyninclude.dynamic">7.5.2. Dynamic search</a></span></dt><dt><span class="section"><a href="#advanced.dyninclude.override">7.5.3. Overriding module resources</a></span></dt></dl></dd><dt><span class="section"><a href="#advanced.rolebasedauth">7.6. Authentication and authorization</a></span></dt><dd><dl><dt><span class="section"><a href="#advanced.rolebasedauth.roles">7.6.1. Managing Roles</a></span></dt><dt><span class="section"><a href="#rolebasedauth_customconditions">7.6.2. Custom conditions</a></span></dt><dt><span class="section"><a href="#rolebasedauth_customroleprovider">7.6.3. Custom RoleProvider</a></span></dt></dl></dd><dt><span class="section"><a href="#advanced.ajax">7.7. AJAX services</a></span></dt><dd><dl><dt><span class="section"><a href="#advanced.ajax.config">7.7.1. Service configuration</a></span></dt><dt><span class="section"><a href="#advanced.ajax.exception">7.7.2. Exception handling</a></span></dt><dt><span class="section"><a href="#advanced.ajax.tools">7.7.3. Development tools</a></span></dt><dt><span class="section"><a href="#advanced.ajax.callback">7.7.4. Callback mechanisms</a></span></dt><dt><span class="section"><a href="#advanced.ajax.typemapping">7.7.5. Type mapping</a></span></dt></dl></dd><dt><span class="section"><a href="#advanced.object2xml">7.8. Object-to-XML mapping</a></span></dt><dd><dl><dt><span class="section"><a href="#advanced.object2xml.serializationprocess">7.8.1. Serialization process</a></span></dt><dt><span class="section"><a href="#advanced.object2xml.builtinserializers">7.8.2. Built-in serializers</a></span></dt><dt><span class="section"><a href="#advanced.object2xml.customserializers">7.8.3. Custom serializers</a></span></dt><dt><span class="section"><a href="#advanced.object2xml.jaxb">7.8.4. Using JAXB serialization</a></span></dt></dl></dd><dt><span class="section"><a href="#advanced.iwrapperannotations">7.9. Annotation-based IWrapper creation</a></span></dt><dd><dl><dt><span class="section"><a href="#advanced.iwrapperannotations.reference">7.9.1. IWrapper annotations</a></span></dt></dl></dd><dt><span class="section"><a href="#advanced.scriptedflows">7.10. Scripted workflows</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8977">7.10.1. Parameters and Variables</a></span></dt><dt><span class="section"><a href="#d0e8997">7.10.2. Statements</a></span></dt></dl></dd><dt><span class="section"><a href="#advanced.scripting">7.11. Scripting Langauge support</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e9123">7.11.1. IHandler</a></span></dt><dt><span class="section"><a href="#d0e9138">7.11.2. State</a></span></dt><dt><span class="section"><a href="#d0e9145">7.11.3. Implementation Details</a></span></dt></dl></dd><dt><span class="section"><a href="#advanced.eventbus">7.12. The Pustefix EventBus</a></span></dt><dt><span class="section"><a href="#advanced.requestid">7.13. Request IDs for log correlation</a></span></dt><dt><span class="section"><a href="#advanced.editor">7.14. The Pustefix Editor</a></span></dt></dl></dd><dt><span class="chapter"><a href="#springmvc">8. Using Spring MVC</a></span></dt><dd><dl><dt><span class="section"><a href="#springmvc.controllerstates">8.1. Pustefix states as Spring MVC controllers</a></span></dt><dt><span class="section"><a href="#springmvc.annotationmethodhandleradapter">8.2. AnnotationMethodHandlerAdapter customization</a></span></dt><dt><span class="section"><a href="#springmvc.paginationexample">8.3. Example: Pagination</a></span></dt></dl></dd><dt><span class="chapter"><a href="#modulessupport">9. Module Support</a></span></dt><dd><dl><dt><span class="section"><a href="#modulessupport.types.new">9.1. Resources within library JARs</a></span></dt><dt><span class="section"><a href="#modulessupport.maven">9.2. Creating new modules using the Maven archetype</a></span></dt></dl></dd><dt><span class="chapter"><a href="#testing">10. Testing</a></span></dt><dd><dl><dt><span class="section"><a href="#testing.unit">10.1. Unit testing</a></span></dt><dt><span class="section"><a href="#testing.integration">10.2. Integration testing</a></span></dt></dl></dd><dt><span class="chapter"><a href="#tooling">11. Tooling</a></span></dt><dd><dl><dt><span class="section"><a href="#tooling.pfxinternals">11.1. Pustefix internals page</a></span></dt><dt><span class="section"><a href="#tooling.specialparams">11.2. Special parameters for development</a></span></dt><dt><span class="section"><a href="#tooling.mavenplugins">11.3. Maven plugins</a></span></dt><dd><dl><dt><span class="section"><a href="#tooling.mavenplugins.generate.xsl">11.3.1. Pustefix XSL Generate Plugin</a></span></dt><dt><span class="section"><a href="#tooling.mavenplugins.pagelist">11.3.2. Pustefix Pagelist Plugin</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#upgrade">12. Upgrading to a newer Pustefix version</a></span></dt><dd><dl><dt><span class="section"><a href="#upgrade.0_18_to_0_19">12.1. Upgrading from Pustefix 0.18 to 0.19</a></span></dt><dd><dl><dt><span class="section"><a href="#upgrade.0_18_to_0_19.dependencies">12.1.1. Library dependencies</a></span></dt></dl></dd><dt><span class="section"><a href="#upgrade.0_17_to_0_18">12.2. Upgrading from Pustefix 0.17 to 0.18</a></span></dt><dd><dl><dt><span class="section"><a href="#upgrade.0_17_to_0_18.depend_xml">12.2.1. depend.xml</a></span></dt></dl></dd><dt><span class="section"><a href="#upgrade.0_16_to_0_17">12.3. Upgrading from Pustefix 0.16 to 0.17</a></span></dt><dt><span class="section"><a href="#upgrade.0_15_to_0_16">12.4. Upgrading from Pustefix 0.15 to 0.16</a></span></dt><dd><dl><dt><span class="section"><a href="#upgrade.0_15_to_0_16.web_xml">12.4.1. web.xml</a></span></dt><dt><span class="section"><a href="#upgrade.0_15_to_0_16.project_xml">12.4.2. project.xml</a></span></dt><dt><span class="section"><a href="#upgrade.0_15_to_0_16.depend_xml">12.4.3. depend.xml</a></span></dt><dt><span class="section"><a href="#upgrade.0_15_to_0_16.taglib">12.4.4. Tag library</a></span></dt><dt><span class="section"><a href="#upgrade.0_15_to_0_16.modules">12.4.5. Modules</a></span></dt><dt><span class="section"><a href="#upgrade.0_15_to_0_16.sessions">12.4.6. Session handling</a></span></dt><dt><span class="section"><a href="#upgrade.0_15_to_0_16.webservices">12.4.7. AJAX webservices</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#newsarchive">13. What's new (coming from the preceding release line)</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_15_6">13.1. What's new in Pustefix 0.15.6</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_15_6.modules">13.1.1. Module enhancements</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_15_7">13.2. What's new in Pustefix 0.15.7</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_15_7.modules">13.2.1. Module enhancements</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_15_11">13.3. What's new in Pustefix 0.15.11</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_15_11.config">13.3.1. Configuration system enhancements</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_15_13">13.4. What's new in Pustefix 0.15.13</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_15_13.config">13.4.1. Module/configuration enhancements</a></span></dt><dt><span class="section"><a href="#news.0_15_13.tooling">13.4.2. Tooling enhancements</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_15_14">13.5. What's new in Pustefix 0.15.14</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_15_14.iwrapper">13.5.1. IWrapper enhancements</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_15_17">13.6. What's new in Pustefix 0.15.17</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_15_17.modules">13.6.1. Module enhancements</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_16_0">13.7. What's new in Pustefix 0.16.0</a></span></dt><dt><span class="section"><a href="#news.0_16_5">13.8. What's new in Pustefix 0.16.5</a></span></dt><dt><span class="section"><a href="#news.0_17_0">13.9. What's new in Pustefix 0.17.0</a></span></dt><dt><span class="section"><a href="#news.0_18_0">13.10. What's new in Pustefix 0.18.0</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_0.multitenancy">13.10.1. Multi-tenancy</a></span></dt><dt><span class="section"><a href="#news.0_18_0.multilanguage">13.10.2. Multi-language</a></span></dt><dt><span class="section"><a href="#news.0_18_0.sitemap">13.10.3. Sitemap and i18n pagenames</a></span></dt><dt><span class="section"><a href="#news.0_18_0.pagealt">13.10.4. Page alternatives</a></span></dt><dt><span class="section"><a href="#news.0_18_0.modules">13.10.5. Pustefix modules</a></span></dt><dt><span class="section"><a href="#news.0_18_0.autoconfig">13.10.6. Automatic configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_2">13.11. What's new in Pustefix 0.18.2</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_2.xslterrors">13.11.1. Context information for XSLT errors</a></span></dt><dt><span class="section"><a href="#news.0_18_2.xslttooling">13.11.2. Switchable XSLT tooling extensions</a></span></dt><dt><span class="section"><a href="#news.0_18_2.sitemap">13.11.3. Search-engine sitemap generation</a></span></dt><dt><span class="section"><a href="#news.0_18_2.pagealts">13.11.4. Direct page alternative linking</a></span></dt><dt><span class="section"><a href="#news.0_18_2.oxm">13.11.5. OXM support for BigDecimal and BigInteger</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_5">13.12. What's new in Pustefix 0.18.5</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_5.cmis">13.12.1. CMIS support</a></span></dt><dt><span class="section"><a href="#news.0_18_5.pagealiases">13.12.2. Page aliases</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_6">13.13. What's new in Pustefix 0.18.6</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_6.xslt">13.13.1. Include part existence check</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_7">13.14. What's new in Pustefix 0.18.7</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_7.sitemap">13.14.1. Custom sitemap attributes</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_9">13.15. What's new in Pustefix 0.18.9</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_9.logging">13.15.1. Log directory configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_13">13.16. What's new in Pustefix 0.18.13</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_13.xslt">13.16.1. Getting environment properties from within XSLT</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_14">13.17. What's new in Pustefix 0.18.14</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_14.session">13.17.1. External session invalidation synchronization support</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_27">13.18. What's new in Pustefix 0.18.27</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_27.contextresources">13.18.1. Global output resources</a></span></dt><dt><span class="section"><a href="#news.0_18_27.sessiontracking">13.18.2. Cookie-only session tracking</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_29">13.19. What's new in Pustefix 0.18.29</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_29.renderextensions">13.19.1. Contextual render includes</a></span></dt><dt><span class="section"><a href="#news.0_18_29.xslt">13.19.2. XSL parameters within include parameter XPath expressions</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_30">13.20. What's new in Pustefix 0.18.30</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_30.oxm">13.20.1. Object-to-XML mapping with JAXB</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_31">13.21. What's new in Pustefix 0.18.31</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_31.pfxinternals">13.21.1. TargetGenerator tooling extensions toggle</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_34">13.22. What's new in Pustefix 0.18.34</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_34.includeparams">13.22.1. Extended include parameter support</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_35">13.23. What's new in Pustefix 0.18.35</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_35.logging">13.23.1. Early logging configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_38">13.24. What's new in Pustefix 0.18.38</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_38.pfxinternals">13.24.1. Full text search</a></span></dt><dt><span class="section"><a href="#news.0_18_38.sitemap">13.24.2. Default page alternatives</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_39">13.25. What's new in Pustefix 0.18.39</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_39.xslt">13.25.1. Setting pfx:button page at runtime</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_42">13.26. What's new in Pustefix 0.18.42</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_42.multitenancy">13.26.1. Multitenancy/-language support for static resources</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_59">13.27. What's new in Pustefix 0.18.59</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_59.tooling">13.27.1. Rendering pages with static DOM tree during development</a></span></dt><dt><span class="section"><a href="#news.0_18_59.xslt">13.27.2. Added XSL extension elements for logging and debugging</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_63">13.28. What's new in Pustefix 0.18.63</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_63.xslt">13.28.1. Instance level XSLT extension functions</a></span></dt><dt><span class="section"><a href="#news.0_18_63.urls">13.28.2. Preserving parameters on redirect</a></span></dt><dt><span class="section"><a href="#news.0_18_63.includes">13.28.3. Reflective include information</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_64">13.29. What's new in Pustefix 0.18.64</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_64.iwrapper">13.29.1. Support standard Java regular expressions in IWrapper checks</a></span></dt><dt><span class="section"><a href="#news.0_18_64.multitenancy">13.29.2. Support multitenant property configuration</a></span></dt><dt><span class="section"><a href="#news.0_18_64.tooling">13.29.3. Configurable result DOM viewing</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_70">13.30. What's new in Pustefix 0.18.70</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_70.aliases">13.30.1. Page alias names with slashes</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_71">13.31. What's new in Pustefix 0.18.71</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_71.spring">13.31.1. Environment-dependent Spring property files</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_87">13.32. What's new in Pustefix 0.18.87</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_87.xslt">13.32.1. New XPath string functions using pattern matching</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_19_0">13.33. What's new in Pustefix 0.19.0</a></span></dt><dt><span class="section"><a href="#news.0_19_4">13.34. What's new in Pustefix 0.19.4</a></span></dt><dt><span class="section"><a href="#news.0_19_8">13.35. What's new in Pustefix 0.19.8</a></span></dt><dt><span class="section"><a href="#news.0_19_9">13.36. What's new in Pustefix 0.19.9</a></span></dt><dt><span class="section"><a href="#news.0_19_11">13.37. What's new in Pustefix 0.19.11</a></span></dt><dt><span class="section"><a href="#news.0_19_14">13.38. What's new in Pustefix 0.19.14</a></span></dt><dt><span class="section"><a href="#news.0_19_15">13.39. What's new in Pustefix 0.19.15</a></span></dt><dt><span class="section"><a href="#news.0_19_17">13.40. What's new in Pustefix 0.19.17</a></span></dt><dt><span class="section"><a href="#news.0_19_21">13.41. What's new in Pustefix 0.19.21</a></span></dt><dt><span class="section"><a href="#news.0_19_23">13.42. What's new in Pustefix 0.19.23</a></span></dt><dt><span class="section"><a href="#news.0_19_24">13.43. What's new in Pustefix 0.19.24</a></span></dt><dt><span class="section"><a href="#news.0_19_25">13.44. What's new in Pustefix 0.19.25</a></span></dt><dt><span class="section"><a href="#news.0_19_27">13.45. What's new in Pustefix 0.19.27</a></span></dt><dt><span class="section"><a href="#news.0_19_28">13.46. What's new in Pustefix 0.19.28</a></span></dt><dt><span class="section"><a href="#news.0_19_29">13.47. What's new in Pustefix 0.19.29</a></span></dt><dt><span class="section"><a href="#news.0_19_30">13.48. What's new in Pustefix 0.19.30</a></span></dt></dl></dd></dl></div><div class="list-of-figures"><p><b>List of Figures</b></p><dl><dt>3.1. <a href="#architecture.high-level.figure">High Level View of the system</a></dt><dt>3.2. <a href="#architecture.backend.figure">The Pustefix backend system</a></dt><dt>3.3. <a href="#architecture.xsl.figure">Recursive XSL transformations</a></dt><dt>6.1. <a href="#concepts.servlets.core.figure">Pustefix HTTP request handlers</a></dt><dt>6.2. <a href="#concepts.interceptors.figure">ContextInterceptors</a></dt><dt>11.1. <a href="#tooling.pfxinternals.framework">Pustefix internals - Framework information</a></dt><dt>11.2. <a href="#tooling.pfxinternals.jvm">Pustefix internals - JVM information</a></dt><dt>11.3. <a href="#tooling.pfxinternals.targets">Pustefix internals - Target generator information</a></dt><dt>11.4. <a href="#tooling.pfxinternals.search">Pustefix internals - Full text search</a></dt></dl></div><div class="list-of-tables"><p><b>List of Tables</b></p><dl><dt>4.1. <a href="#d0e623">Attributes of the &lt;make&gt; tag</a></dt><dt>4.2. <a href="#d0e709">Attributes of the &lt;target&gt; tag</a></dt><dt>4.3. <a href="#d0e832">Attributes of the &lt;target&gt; tag</a></dt><dt>4.4. <a href="#d0e2580">Reserved Spring bean names</a></dt><dt>5.1. <a href="#d0e2700">The Core Pustefix XSLT Tags</a></dt><dt>5.2. <a href="#d0e2929">Attributes of the pfx:button tag</a></dt><dt>5.3. <a href="#d0e3147">Attributes of the pfx:include tag</a></dt><dt>5.4. <a href="#d0e3290">Attributes of the pfx:maincontent tag</a></dt><dt>5.5. <a href="#d0e3406">Attributes of the pfx:image tag</a></dt><dt>5.6. <a href="#d0e3630">Attributes of the pfx:render tag</a></dt><dt>5.7. <a href="#d0e3913">Attributes of the pfx:forminput tag</a></dt><dt>5.8. <a href="#d0e4044">Attributes of form submit controls</a></dt><dt>5.9. <a href="#d0e4202">Attributes of pfx:anchor</a></dt><dt>5.10. <a href="#d0e4249">Attributes of pfx:argument</a></dt><dt>5.11. <a href="#d0e4307">Attributes of pfx:command</a></dt><dt>5.12. <a href="#d0e4436">Attributes of pfx:xinp[@type="text"]</a></dt><dt>5.13. <a href="#d0e4591">Attributes of pfx:xinp[@type="radio|check"]</a></dt><dt>5.14. <a href="#d0e4693">Attributes of pfx:xinp[@type="select"]</a></dt><dt>5.15. <a href="#d0e4759">Attributes of pfx:option</a></dt><dt>5.16. <a href="#d0e5015">Attributes of the pfx:checkactive and pfx:checknotactive tags</a></dt><dt>6.1. <a href="#d0e6021">Variables of the context during processing</a></dt><dt>6.2. <a href="#d0e6835">Attributes of an iwrp parameter</a></dt><dt>11.1. <a href="#d0e9742">Special parameters for development</a></dt></dl></div><div class="list-of-examples"><p><b>List of Examples</b></p><dl><dt>5.1. <a href="#d0e4912">Using <code class="literal">&lt;pfx:checkfield&gt;</code></a></dt><dt>7.1. <a href="#rolebasedauth_example">Configuring roles</a></dt></dl></div><div class="preface"><div class="titlepage"><div><div><h1 class="title"><a name="introduction"></a>Introduction</h1></div></div></div><p>
    The Pustefix Framework is an open-source Java web application framework for developing request-based MVC-style web
    applications using Spring, XML and XSLT. 
  </p><p>
    A key feature of the framework is the clear separation of view and business logic, reflected by having
    two loosely coupled main parts:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
      A machinery to apply recursive XSLT transformations that produces the UI of the web application.
    </li><li class="listitem">
      A Java framework that takes input from the UI to change the application data and supplies changes of the application data back to the UI.
    </li></ul></div><p>
    Together, the framework acts similar to the Model-View-Controller pattern (as far as this is possible in
    the context of a web application).
  </p><p>
    This reference guide covers all important topics that you need to know when working with any aspects of the
    Pustefix framework. If you are new to Pustefix we recommend reading one of the tutorials.
  </p></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="news"></a>Chapter&nbsp;1.&nbsp;What's new in Pustefix 0.20.x</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#news.0_20_0">1.1. What's new in Pustefix 0.20.0</a></span></dt><dt><span class="section"><a href="#news.0_20_1">1.2. What's new in Pustefix 0.20.1</a></span></dt><dt><span class="section"><a href="#news.0_20_14">1.3. What's new in Pustefix 0.20.14</a></span></dt><dt><span class="section"><a href="#news.0_20_19">1.4. What's new in Pustefix 0.20.19</a></span></dt><dt><span class="section"><a href="#news.0_20_20">1.5. What's new in Pustefix 0.20.20</a></span></dt></dl></div><p>This section lists the new features and enhancements of the current Pustefix release line. 
        If you're interested in new features which already became available with the prior Pustefix release line,
        you can take a look at <a class="xref" href="#newsarchive" title="Chapter&nbsp;13.&nbsp;What's new (coming from the preceding release line)">Chapter&nbsp;13, <i>What's new (coming from the preceding release line)</i></a>.</p><p>If you're migrating an existing appliation to the new Pustefix version, you should have a look at <a class="xref" href="#upgrade" title="Chapter&nbsp;12.&nbsp;Upgrading to a newer Pustefix version">Chapter&nbsp;12, <i>Upgrading to a newer Pustefix version</i></a>.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_20_0"></a>1.1.&nbsp;What's new in Pustefix 0.20.0</h2></div></div></div><p>
      Added support for custom page URL paths: you can group pages using a common path prefix (so-called page <code class="literal">page groups</code>,
      see <a class="xref" href="#configuration.sitemap" title="4.3.4.&nbsp;Sitemap configuration">Section&nbsp;4.3.4, &#8220;Sitemap configuration&#8221;</a>) or map pageflow names to a URL path prefix.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_20_1"></a>1.2.&nbsp;What's new in Pustefix 0.20.1</h2></div></div></div><p>
      Added a DOM history in development mode, i.e. on the DOM view page, you can not only view last DOM but select an older version
      from a list of the previously used DOMs. 
    </p><p>
      Added support for headless rendering of Pustefix pages, i.e. you can programmatically do the rendering of a page or part
      and process the resulting content on the server side.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_20_14"></a>1.3.&nbsp;What's new in Pustefix 0.20.14</h2></div></div></div><p>
      Pustefix backported some useful XPath 2.0 functions to make them avaiable with XSLT 1: <code class="literal">pfx:encode-for-uri()</code>,
      <code class="literal">pfx:string-length()</code> and <code class="literal">pfx:substring()</code> (see <a class="xref" href="#xslt.extensions.xpathfunctions.string" title="String functions">the section called &#8220;String functions&#8221;</a>).
    </p><p>
      Extended the <code class="literal">pfx:button</code> template to support the creation of REST-style links using the new <code class="literal">@path</code> attribute,
      or the <code class="literal">pfx:path</code>/<code class="literal">pfx:segment</code> elements (see <a class="xref" href="#xslt.pfx.button" title="5.2.1.&nbsp;pfx:button">Section&nbsp;5.2.1, &#8220;pfx:button&#8221;</a>).
    </p><p>
      Added the new method <code class="literal">getModelAndView()</code> to the <code class="literal">ResultDocument</code> class. This enables you to retrieve
      the <code class="literal">ModelAndView</code> instance created by Spring MVC when using <code class="literal">RequestMappings</code>, e.g. when overriding the
      <code class="literal">getDocument()</code> method of a <code class="literal">State</code> and you need to check for model changes.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_20_19"></a>1.4.&nbsp;What's new in Pustefix 0.20.19</h2></div></div></div><p>
      Added <code class="literal">&lt;pfx:checkmessage&gt;</code> and <code class="literal">&lt;pfx:checknomessage&gt;</code> tags for checking if a <code class="literal">MessageSource</code>
      message is existing or not (see <a class="xref" href="#xslt.messages.tags" title="5.4.1.&nbsp;Message tags">Section&nbsp;5.4.1, &#8220;Message tags&#8221;</a>).
    </p><p>
      Added support for configuring the Spring <code class="literal">MessageSource</code> in <code class="literal">project.xml</code>, which makes it available
      during page pre-generation too (see <a class="xref" href="#xslt.messages.configuration" title="5.4.2.&nbsp;MessageSource configuration">Section&nbsp;5.4.2, &#8220;MessageSource configuration&#8221;</a>).
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_20_20"></a>1.5.&nbsp;What's new in Pustefix 0.20.20</h2></div></div></div><p>
      Added support for markup in message arguments and strings (unescaped rendering is enable by setting the new <code class="literal">&lt;pfx:message&gt;</code>
      attribute <code class="literal">disable-output-escaping</code> to <code class="literal">yes</code> (see <a class="xref" href="#xslt.messages.tags" title="5.4.1.&nbsp;Message tags">Section&nbsp;5.4.1, &#8220;Message tags&#8221;</a>).
   </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="installation"></a>Chapter&nbsp;2.&nbsp;Installation</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#installation.requirements">2.1. Requirements</a></span></dt><dt><span class="section"><a href="#installation.mavenarchetypes">2.2. Generating a new project from a Maven archetype</a></span></dt><dt><span class="section"><a href="#installation.getsources">2.3. Getting the source code</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="installation.requirements"></a>2.1.&nbsp;Requirements</h2></div></div></div><p>
     Before we can get started, you have to make sure that some requirements
     are met by your development environment. You will need:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
        JDK 8 or higher
      </li><li class="listitem">
        POSIX-like operating system (Pustefix has been tested with Linux
        and Mac OS X, but might also work with other systems like *BSD)
      </li><li class="listitem">
        Apache Maven 3 or higher
      </li></ul></div><p>
      The installation of these tools is not covered by this
      tutorial. Please refer to the documentation provided with these tools
      for installation instructions.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="installation.mavenarchetypes"></a>2.2.&nbsp;Generating a new project from a Maven archetype</h2></div></div></div><p>
      Pustefix provides some Maven archetypes for quickly creating new applications.
      A good starting point is the basic application archetype.
      Just call <code class="literal">mvn archetype:generate</code>
      and select the archetype <code class="literal">org.pustefixframework:pustefix-archetype-basic</code>:
    </p><pre class="screen">$ mvn archetype:generate -Dfilter=pustefix</pre><p>
      After choosing the <code class="literal">pustefix-archetype-basic</code> Maven will ask you for your project's <code class="literal">groupId</code>, 
      <code class="literal">artifactId</code>, <code class="literal">version</code> and <code class="literal">package</code>.
      Having finished these settings Maven will generate the new project within a new directory called like the <code class="literal">artifactId</code>
      and located within the current working directory (default is <code class="literal">myapp</code>).
    </p><pre class="screen">$ cd myapp
$ mvn tomcat7:run-war</pre><p>
      The generated project is a standard Maven project with <code class="literal">war</code> packaging type, i.e. you can immediately build and
      run your application, e.g. using Tomcat by calling <code class="literal">mvn tomcat7:run-war</code> and
      opening <code class="literal">http://localhost:8080</code> in your browser.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="installation.getsources"></a>2.3.&nbsp;Getting the source code</h2></div></div></div><p>
    The source code used in the tutorials is available for public checkout. To test the tutorials on
    your local development machine, execute the following commands:
  </p><pre class="screen">$ git clone https://github.com/pustefix-projects/pustefix-framework.git pustefix
$ cd pustefix
$ git checkout -b tutorial `git tag -l "pustefixframework-*" --sort v:refname | tail -1`
$ cd pustefix-tutorial/first-app
$ mvn tomcat7:run-war</pre><p></p><p>
    This will clone the Pustefix Git repository, checkout/branch the latest Pustefix release tag, and run the tutorial application. 
  </p><p></p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="architecture"></a>Chapter&nbsp;3.&nbsp;Architecture</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#architecture.high-level">3.1. High Level View</a></span></dt><dt><span class="section"><a href="#architecture.backend">3.2. The Pustefix backend system</a></span></dt><dt><span class="section"><a href="#architecture.xsl">3.3. Recursive XSL Transformations</a></span></dt><dd><dl><dt><span class="section"><a href="#architecture.xsl.targets">3.3.1. XSL Targets</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="architecture.high-level"></a>3.1.&nbsp;High Level View</h2></div></div></div><p>
        <a class="xref" href="#architecture.high-level.figure" title="Figure&nbsp;3.1.&nbsp;High Level View of the system">Figure&nbsp;3.1, &#8220;High Level View of the system&#8221;</a> shows the two main parts of the Pustefix system.
        On the left you can see the java framework. A request coming from the browser enters the business
        logic. After the processing has finished, the business logic delivers the result as a (in memory)
        DOM tree. To get a more detailed overview of the business logic, take a look at
        <a class="xref" href="#concepts" title="Chapter&nbsp;6.&nbsp;Important Concepts">Chapter&nbsp;6, <i>Important Concepts</i></a>.
      </p><p>
        The stylesheet that's responsible to render the UI to displays the result data is requested from
        the XML/XSLT generator. It uses the DOM tree as input to create the HTML output that is displayed
        on the browser.
      </p><div class="figure"><a name="architecture.high-level.figure"></a><p class="title"><b>Figure&nbsp;3.1.&nbsp;High Level View of the system</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/reference/architecture-high-level.png" alt="High Level View of the system"></div></div></div><br class="figure-break"><p>
        The stylesheet generator makes heavy use of caching to ensure that transformations are never made
        twice unless the result is out of date. Normally all generated stylesheets are cached in memory
        (and on disc). If you don't have enough memory to hold your site in RAM, you can specify other
        cache objects. E.g. we supply a LRU cache that can be configured to hold only the last N generated
        objects in memory.
      </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="architecture.backend"></a>3.2.&nbsp;The Pustefix backend system</h2></div></div></div><p>
        <a class="xref" href="#architecture.backend.figure" title="Figure&nbsp;3.2.&nbsp;The Pustefix backend system">Figure&nbsp;3.2, &#8220;The Pustefix backend system&#8221;</a> shows, how the different interfaces and classes
        in Pustefix are connected (not including web services and direct output support).
      </p><div class="figure"><a name="architecture.backend.figure"></a><p class="title"><b>Figure&nbsp;3.2.&nbsp;The Pustefix backend system</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/reference/architecture-backend.png" alt="The Pustefix backend system"></div><p>
          The Pustefix application runs within a Spring <code class="interfacename">ApplicationContext</code>
          that is created by the <code class="classname">DispatcherServlet</code>. The servlet dispatches
          all requests to <code class="interfacename">HttpRequestHandler</code>s that are managed as
          beans in the application context. <code class="classname">PustefixContextXMLHttpRequestHandler</code>
          handles the requests to Pustefix pages and takes care of session, cookie and SSL management.
          The actual request processing (workflow handling, dispatching to the right 
          <code class="interfacename">State</code>) is performed by <code class="interfacename">Context</code>
          (or more precisely <code class="classname">ContextImpl</code>). 
        </p></div></div><br class="figure-break"></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="architecture.xsl"></a>3.3.&nbsp;Recursive XSL Transformations</h2></div></div></div><p>
        The XML/XSLT System of Pustefix is responsible for generating the final stylesheet that
        represents the static content of a page. This stylesheet is then used together with the DOM
        tree that holds the result of the request (as given by the business logic) to produce the
        final HTML output.
      </p><p>
        <a class="xref" href="#architecture.xsl.figure" title="Figure&nbsp;3.3.&nbsp;Recursive XSL transformations">Figure&nbsp;3.3, &#8220;Recursive XSL transformations&#8221;</a> shows the typical transformations and files that are
        involved in producing the final stylesheet <code class="filename">BazPage.xsl</code>.
      </p><p>
        Note that we only discuss the common case here, arbitrary complex and deep transformation trees
        are in fact possible.
      </p><div class="figure"><a name="architecture.xsl.figure"></a><p class="title"><b>Figure&nbsp;3.3.&nbsp;Recursive XSL transformations</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/reference/architecture-xsl-transformations.png" alt="Recursive XSL transformations"></div></div></div><br class="figure-break"><p>
        The red boxes are supplied by the framework, you don't need to create them yourself and as an
        application programmer, you can't change them. Currently this is only the case for
        <code class="filename">core/xsl/master.xsl</code>, <code class="filename">core/xsl/metatags.xsl</code>,
        <code class="filename">core/xsl/customizemaster.xsl</code> and other stylesheets that make up the core
        environment (these are not shown as they are included into <code class="filename">master.xsl</code> and
        <code class="filename">metatags.xsl</code> via <code class="literal">xsl:include</code> transparently for the user).
      </p><p>
        The green boxes are the result of XSL transformations.
      </p><p>
        The blue boxes represent files that you need to create yourself. The <code class="literal">[PROJECT]</code>/xsl/skin.xsl and
        <code class="literal">[PROJECT]</code>/xsl/metatags.xsl files are special, as they are not a target (see below) but just another
        XSLT stylesheet that can be included via xsl:include into master.xsl and metatags.xsl resp.
        <code class="literal">[PROJECT]</code>/xsl/skin.xsl contains the project specific templates that should apply on the last
        transformation stage, while <code class="literal">[PROJECT]</code>/xsl/metatags.xsl contains the project specific templates that
        apply only on the first stage.
      </p><p>
        There are projects that don't use a <code class="literal">[PROJECT]</code>/xsl/skin.xsl stylesheet at all or include even more
        stylesheets. Making master.xsl aware of the presence of the <code class="literal">[PROJECT]</code>/xsl/skin.xsl stylesheet is
        part of the transformation from core/xsl/master.xsl + core/xsl/customizemaster.xsl --&gt; master.xsl
      </p><p>
        It'a also posible that a project doesn't use a <code class="literal">[PROJECT]</code>/xsl/metatags.xsl stylesheet or includes
        more stylesheets: Similar to master.xsl it's the responsibility of the transformation from
        core/xsl/metatags.xsl + core/xsl/customizemaster.xsl --&gt; metatags.xsl to customize the resulting 
        metatags.xsl to include the stylesheets.
      </p><p>
        The <code class="literal">[PROJECT]</code>/xml/FooBase.xml file defines the structure of the "BazPage" page (e.g. frames, the outer
        table structure if you do the layout with tables or divs and the like). You define one of these
        structural xml files for every layout you want to use in your project (the number of structural xml
        files is typically quite small, as many pages share the same layout).
      </p><p>
        The blue discs blue discs represent include parts. These are little snippets of XML code that make 
        up the actual content of the page. As can be seen from the diagram, they can include each other, as
        long as there is no cyclic inclusion (so no include part can include itself either directly or
        indirectly). Include parts have a name and are organized into so called include documents. These
        can hold an arbitrary number of parts.
      </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="architecture.xsl.targets"></a>3.3.1.&nbsp;XSL Targets</h3></div></div></div><p>
          A target is everything that is the result of a XSLT transformation as seen in <a class="xref" href="#architecture.xsl.figure" title="Figure&nbsp;3.3.&nbsp;Recursive XSL transformations">Figure&nbsp;3.3, &#8220;Recursive XSL transformations&#8221;</a>.
          It is also obvious that a target can be used to create new targets. For the sake of completeness,
          the initial XML or XSL files that are used in transformations are called targets, too.
        </p><p>
          The Pustefix system knows different types of targets:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Leaf targets are targets that are not the result of a XSL transformation, but are read
              directly from files. You only edit leaf targets, never virtual targets.
              The distinction between XML/XSL is made depending on the purpose the target serves.
              An XML target is read into the system without doing any special processing, while an XSL
              target is compiled into a templates object that is able to transform XML input.
            </p><p>
              Examples for leaf targets in <a class="xref" href="#architecture.xsl.figure" title="Figure&nbsp;3.3.&nbsp;Recursive XSL transformations">Figure&nbsp;3.3, &#8220;Recursive XSL transformations&#8221;</a> are <code class="filename">FooBase.xml</code>,
              <code class="filename">core/xsl/metatags.xsl</code> and <code class="filename">core/xsl/master.xsl</code>.
            </p></li><li class="listitem"><p>
              Virtual targets are the result of a XSL transformation. They don't exist as files
              (in fact they do, but only to cache the result on the harddisk. These cache files must never
              be edited by hand). The difference between the XML/XSL type is the same as with the leaf targets.
            </p><p>
              Examples for leaf targets in <a class="xref" href="#architecture.xsl.figure" title="Figure&nbsp;3.3.&nbsp;Recursive XSL transformations">Figure&nbsp;3.3, &#8220;Recursive XSL transformations&#8221;</a> are <code class="filename">BazPage.xml</code>,
              and <code class="filename">BazPage.xsl</code>.
            </p></li></ul></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="configuration"></a>Chapter&nbsp;4.&nbsp;Configuring Pustefix</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#configuration.introduction">4.1. Overview</a></span></dt><dt><span class="section"><a href="#configuration.customization">4.2. Customization tools</a></span></dt><dt><span class="section"><a href="#configuration.project">4.3. Configuration files</a></span></dt><dd><dl><dt><span class="section"><a href="#configuration.format.props">4.3.1. XML property files syntax</a></span></dt><dt><span class="section"><a href="#configuration.project.projectxml">4.3.2. Project descriptor (project.xml)</a></span></dt><dt><span class="section"><a href="#configuration.depend">4.3.3. Page Configuration (depend.xml)</a></span></dt><dt><span class="section"><a href="#configuration.sitemap">4.3.4. Sitemap configuration</a></span></dt><dt><span class="section"><a href="#configuration.servlet.contextxml">4.3.5. ContextXMLService configuration file</a></span></dt><dt><span class="section"><a href="#configuration.servlet.directoutput">4.3.6. DirectOutputService configuration file</a></span></dt><dt><span class="section"><a href="#configuration.servlet.webservice">4.3.7. WebServices</a></span></dt><dt><span class="section"><a href="#configuration.format.fragments">4.3.8. Configuration Fragments</a></span></dt></dl></dd><dt><span class="section"><a href="#configuration.spring">4.4. Spring configuration and customization</a></span></dt><dd><dl><dt><span class="section"><a href="#configuration.spring.custom">4.4.1. Customizing the Spring configuration</a></span></dt><dt><span class="section"><a href="#configuration.spring.envprops">4.4.2. Environment-dependent Spring property files</a></span></dt><dt><span class="section"><a href="#configuration.spring.profiles">4.4.3. Environment-dependent Spring profiles</a></span></dt><dt><span class="section"><a href="#configuration.spring.beannames">4.4.4. Reserved Spring bean names</a></span></dt></dl></dd><dt><span class="section"><a href="#configuration.logging">4.5. Logging configuration </a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuration.introduction"></a>4.1.&nbsp;Overview</h2></div></div></div><p>
      Developing a new Pustefix application requires (besides developing
      the business logic and the UI) that you edit a bunch of configuration files.
      In general those file are located under <code class="literal">src/main/webapp/WEB-INF</code>.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuration.customization"></a>4.2.&nbsp;Customization tools</h2></div></div></div><p>
      Virtually all configuration files used by Pustefix support a mechanism 
      called "customization". You may use this customization support to use 
      different portions of a configuration file depending on the environment
      within your application is running. For this task, the customization 
      tools provide a <code class="sgmltag-element">choose</code> tag which is similar to the 
      <code class="sgmltag-element">choose</code> tag provided by XSLT.
    </p><pre class="programlisting">

<span class="hl-tag">&lt;choose&gt;</span>
  <span class="hl-tag">&lt;when</span> <span class="hl-attribute">test</span>=<span class="hl-value">"XPathExpression"</span><span class="hl-tag">&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- Configuration code --&gt;</em>
  <span class="hl-tag">&lt;/when&gt;</span>
  <span class="hl-tag">&lt;when</span> <span class="hl-attribute">test</span>=<span class="hl-value">"XPathExpression"</span><span class="hl-tag">&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- Configuration code --&gt;</em>
  <span class="hl-tag">&lt;/when&gt;</span>
  <span class="hl-tag">&lt;otherwise&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- Configuration code --&gt;</em>
  <span class="hl-tag">&lt;/otherwise&gt;</span>
<span class="hl-tag">&lt;/choose&gt;</span>

    </pre><p>
      At least one <code class="sgmltag-element">when</code> tag has to be specified. Further 
      <code class="sgmltag-element">when</code> tags and the <code class="sgmltag-element">otherwise</code> are optional.
      However, if specified, the <code class="sgmltag-element">otherwise</code> tag has to be
      the last one.
    </p><p>
      The XPath expressions may contain references to the variables
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">mode</code>: The execution environment mode, e.g. 
            <code class="literal">test</code>, <code class="literal">stage</code> or
            <code class="literal">prod</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">uid</code>: The name of the OS user running 
            the application.
          </p></li><li class="listitem"><p>
            <code class="literal">fqdn</code>: The fully qualified domain name
            of the machine where the application is running.
          </p></li><li class="listitem"><p>
            <code class="literal">machine</code>: The host name of the machine
            where the application is running.
          </p></li><li class="listitem"><p>
            You not only have access to the predefined variables. You can also reference
            System properties and ServletContext init parameters. If you want to override
            the values of an automatically set predefined property, you can do this by adding an
            according context init parameter to your <code class="literal">web.xml</code>.
          </p></li></ul></div><p>
      It is an error to reference a variable that is not defined. Therefore you
      might use the special XPath function 
      <code class="literal">pfx:isSet('variableName')</code> to check if a variable with 
      a certain name is defined.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuration.project"></a>4.3.&nbsp;Configuration files</h2></div></div></div><p>
      For each Pustefix application you need to create a definition file
      that contains all the information about your application (including references to other
      application-specific configuration files). This file has to be named 
      <code class="literal">project.xml</code> and must be placed in the <code class="literal">WEB-INF</code>
      directory. It can be accompanied by a Spring bean definition file
      that must be called <code class="literal">spring.xml</code>. This file may contain arbitrary
      definitions for beans that will be created within the Spring ApplicationContext 
      automatically created for the web application.
    </p><p>
      All other configuration files can theoretically have arbitrary names, however 
      we strongly recommend using the naming convention used in this reference 
      documentation. 
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration.format.props"></a>4.3.1.&nbsp;XML property files syntax</h3></div></div></div><p>
        Some parts of the Pustefix framework are configured using Java 
        properties. To ease this configuration Pustefix provides you with 
        a special XML format which is read instead of the usual Java 
        property file format. This format provides some customization 
        mechanism to allow configuration options to depend on settings 
        like the makemode or the machine the application is being built on.
      </p><p>
        The structure of a standard .xml property file is very easy:
        </p><pre class="programlisting">
  
  <span class="hl-tag">&lt;properties</span>
    <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/properties-config"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/properties-config
                        http://www.pustefix-framework.org/2008/namespace/properties-config.xsd"</span><span class="hl-tag">&gt;</span>
    
    <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">name</span>=<span class="hl-value">"a.property.name"</span><span class="hl-tag">&gt;</span>a.property.value<span class="hl-tag">&lt;/prop&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- if you're using multitenancy, you can set or override properties depending on the tenant
    &lt;prop name="a.property.name" tenant="a.tenant"&gt;a.property.value&lt;/prop&gt; --&gt;</em>
  <span class="hl-tag">&lt;/properties&gt;</span>
  
        </pre><p>
        The prop tag is the most primitive way to enter a single property. 
        The example above would simply result in the java property
        <code class="literal">a.property.name=a.property.value</code>.
        Pustefix allows to customize the creation of the property files 
        using the mechanism described in <a class="xref" href="#configuration.customization" title="4.2.&nbsp;Customization tools">Section&nbsp;4.2, &#8220;Customization tools&#8221;</a>.
      </p><p>
        You may reference customization variables in property values using
        the syntax <code class="literal">${variableName}</code>. For example 
        <code class="literal">${fqdn}</code> will be replaced by the fully qualified 
        domain name of the machine.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration.project.projectxml"></a>4.3.2.&nbsp;Project descriptor (project.xml)</h3></div></div></div><p>
        The <code class="literal">project.xml</code> file contains references to all services
        and resources used by this project.
      </p><pre class="programlisting">

<span class="hl-tag">&lt;project-config</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/project-config"</span><span class="hl-tag">&gt;</span>
  
  <span class="hl-tag">&lt;project&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- Short project name, should equal the name 
         of the project directory                  --&gt;</em> 
    <span class="hl-tag">&lt;name&gt;</span>projectname<span class="hl-tag">&lt;/name&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- Description shown in Pustefix CMS --&gt;</em>
    <span class="hl-tag">&lt;description&gt;</span>Description for this project<span class="hl-tag">&lt;/description&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- 
      add
    &lt;enabled&gt;false&lt;/enabled&gt;
      to make disregard this project when building the
      server configuration 
    --&gt;</em>
    <em class="hl-comment" style="color: silver">&lt;!-- you can optionally specify which languages should be switchable at runtime --&gt;</em>
    <em class="hl-comment" style="color: silver">&lt;!--
    &lt;lang default="true"&gt;en_UK&lt;/lang&gt;
    &lt;lang&gt;de_DE&lt;/lang&gt;
    --&gt;</em>
  <span class="hl-tag">&lt;/project&gt;</span>
  
  <em class="hl-comment" style="color: silver">&lt;!-- You can optionally configure tenants bound to specific hosts supporting different languages.--&gt;</em>
  <em class="hl-comment" style="color: silver">&lt;!--
  &lt;tenant name="CA_market"&gt;
    &lt;choose&gt;
      &lt;when test="$mode='prod'"&gt;
        &lt;host&gt;.*\.ca$&lt;/host&gt;
      &lt;/when&gt;
      &lt;otherwise&gt;
        &lt;host&gt;^ca\..*&lt;/host&gt;
      &lt;/otherwise&gt;
    &lt;/choose&gt;
    &lt;lang default="true"&gt;en_CA&lt;/lang&gt;
    &lt;lang&gt;fr_CA&lt;/lang&gt;
  &lt;/tenant&gt;

  &lt;tenant name="US_market"&gt;
    ...
  &lt;/tenant&gt;
  --&gt;</em>

  <span class="hl-tag">&lt;editor&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- Set this to false to make the project disappear in the Pustefix CMS 
         (can be overridden using the ServletContext init parameter 'editor.enabled') --&gt;</em>
    <span class="hl-tag">&lt;enabled&gt;</span>true<span class="hl-tag">&lt;/enabled&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- Location of the Pustefix CMS, does not need to be changed usually 
         (can be overridden using the ServletContext init parameter 'editor.location') --&gt;</em>
    <span class="hl-tag">&lt;location&gt;</span>http://cms.${fqdn}/<span class="hl-tag">&lt;/location&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- Authentication secret for editor communication
         (can be overridden using the ServletContext init parameter 'editor.secret') --&gt;</em>
    <span class="hl-tag">&lt;secret&gt;</span>somevalue<span class="hl-tag">&lt;/secret&gt;</span>
  <span class="hl-tag">&lt;/editor&gt;</span>
  
  <span class="hl-tag">&lt;xml-generator&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- Path to the configuration file of 
         the TargetGenerator for this project --&gt;</em>
    <span class="hl-tag">&lt;config-file&gt;</span>docroot:/WEB-INF/depend.xml<span class="hl-tag">&lt;/config-file&gt;</span>
    <span class="hl-tag">&lt;choose&gt;</span>
      <span class="hl-tag">&lt;when</span> <span class="hl-attribute">test</span>=<span class="hl-value">"$mode='prod'"</span><span class="hl-tag">&gt;</span>
        <em class="hl-comment" style="color: silver">&lt;!-- Set this to false if you want to skip the check for changed stylesheets on every request.
             By default Pustefix will all dependant files for changes. --&gt;</em>
        <span class="hl-tag">&lt;check-modtime&gt;</span>false<span class="hl-tag">&lt;/check-modtime&gt;</span>
        <em class="hl-comment" style="color: silver">&lt;!-- Set capacity and implementation class of the in-memory caches for includes and targets.
             Defaults (if you leave out the elements):
             &lt;include-cache capacity="30" class="de.schlund.pfixxml.targets.LRUCache"/&gt;
        --&gt;</em>
        <span class="hl-tag">&lt;include-cache</span> <span class="hl-attribute">capacity</span>=<span class="hl-value">"50"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;target-cache</span> <span class="hl-attribute">capacity</span>=<span class="hl-value">"50"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;render-cache</span> <span class="hl-attribute">capacity</span>=<span class="hl-value">"50"</span><span class="hl-tag">/&gt;</span>
      <span class="hl-tag">&lt;/when&gt;</span>
      <span class="hl-tag">&lt;when</span> <span class="hl-attribute">test</span>=<span class="hl-value">"$mode='prelive'"</span><span class="hl-tag">&gt;</span>
        <em class="hl-comment" style="color: silver">&lt;!-- Enable/disable development tooling extensions (dynamic include info, console, etc.) 
             By default tooling is enabled if not in production mode. So this option is basically
             meant for non-production modes where you nevertheless want to disable tooling. 
        --&gt;</em>
        <span class="hl-tag">&lt;tooling-extensions&gt;</span>false<span class="hl-tag">&lt;/tooling-extensions&gt;</span>
      <span class="hl-tag">&lt;/when&gt;</span>
    <span class="hl-tag">&lt;/choose&gt;</span>
  <span class="hl-tag">&lt;/xml-generator&gt;</span>
  
  <em class="hl-comment" style="color: silver">&lt;!-- automatically generate searchengine sitemap file sitemaps.xml 
       (according to sitemaps protocol from http://www.sitemaps.org), 
       set the attribute "type" to "mobile" to generate a mobile sitemap--&gt;</em>
  <span class="hl-tag">&lt;searchengine-sitemap/&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!-- Sets the session tracking strategy. Default is 'COOKIE'.
       Alternatively you can set 'URL' to force session tracking
       within the URL, even if clients support cookies. You can completely
       disable URL based session tracking by setting 'COOKIEONLY'. You can
       completely leave out this element, if you go with the default. --&gt;</em>
  <span class="hl-tag">&lt;session-tracking-strategy&gt;</span>COOKIE<span class="hl-tag">&lt;/session-tracking-strategy&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!-- Set an initial session timeout 'value' (in seconds) used until 
       more than 'requestlimit' requests are made within a session.
       This element is optional. By default no separate timeout
       for the initial requests is used. --&gt;</em>
  <span class="hl-tag">&lt;initial-session-timeout</span> <span class="hl-attribute">value</span>=<span class="hl-value">"600"</span> <span class="hl-attribute">requestlimit</span>=<span class="hl-value">"3"</span><span class="hl-tag">/&gt;</span>

  <span class="hl-tag">&lt;application&gt;</span>
    
    <em class="hl-comment" style="color: silver">&lt;!-- Path that static resources will be delivered from (set i18n attribute to "true" for multitenancy/-language support)--&gt;</em>
    <span class="hl-tag">&lt;docroot-path&gt;</span>docroot:/htdocs<span class="hl-tag">&lt;/docroot-path&gt;</span>
    
    <em class="hl-comment" style="color: silver">&lt;!-- URI requests to / are redirected to (optional)--&gt;</em>
    <span class="hl-tag">&lt;default-path&gt;</span>/somepage<span class="hl-tag">&lt;/default-path&gt;</span>
    
    <em class="hl-comment" style="color: silver">&lt;!-- Only one context-xml-service may be specified per project --&gt;</em>
    <span class="hl-tag">&lt;context-xml-service&gt;</span>
      <em class="hl-comment" style="color: silver">&lt;!-- Path to the configuration file for the service --&gt;</em>
      <span class="hl-tag">&lt;config-file&gt;</span>docroot:/WEB-INF/config.conf.xml<span class="hl-tag">&lt;/config-file&gt;</span>
      <em class="hl-comment" style="color: silver">&lt;!-- Set this to true if you want to skip the last transformation and only get a
           xml document containing all needed information for an external renderer: --&gt;</em>
      <em class="hl-comment" style="color: silver">&lt;!-- &lt;render-external&gt;true&lt;/render-external&gt; --&gt;</em>
      <em class="hl-comment" style="color: silver">&lt;!-- Set the maximum number of DOMs stored for reusage (default 5): --&gt;</em>
      <em class="hl-comment" style="color: silver">&lt;!-- &lt;max-stored-doms&gt;5&lt;/max-stored-doms&gt; --&gt;</em>
      <em class="hl-comment" style="color: silver">&lt;!-- Set the timeout (in seconds) for removing old DOMs (default 300): --&gt;</em>
      <span class="hl-tag">&lt;choose&gt;</span>
        <span class="hl-tag">&lt;when</span> <span class="hl-attribute">test</span>=<span class="hl-value">"$mode='prod'"</span><span class="hl-tag">&gt;</span>
          <span class="hl-tag">&lt;session-cleaner-timeout&gt;</span>20<span class="hl-tag">&lt;/session-cleaner-timeout&gt;</span>
        <span class="hl-tag">&lt;/when&gt;</span>
        <span class="hl-tag">&lt;otherwise&gt;</span>
          <span class="hl-tag">&lt;session-cleaner-timeout&gt;</span>600<span class="hl-tag">&lt;/session-cleaner-timeout&gt;</span>
          <em class="hl-comment" style="color: silver">&lt;!-- Allow viewing of the DOM tree model, which is enabled 
               by default in all non-production modes --&gt;</em>
          <em class="hl-comment" style="color: silver">&lt;!--&lt;show-dom&gt;true&lt;/show-dom&gt;--&gt;</em>
          <em class="hl-comment" style="color: silver">&lt;!-- Maximum number of DOM trees to be displayed in DOM tree view --&gt;</em>
          <em class="hl-comment" style="color: silver">&lt;!-- &lt;dom-history-size&gt;5&lt;/dom-history-size&gt; --&gt;</em>
        <span class="hl-tag">&lt;/otherwise&gt;</span>
      <span class="hl-tag">&lt;/choose&gt;</span>
    <span class="hl-tag">&lt;/context-xml-service&gt;</span>
    
    <span class="hl-tag">&lt;direct-output-service&gt;</span>
      <em class="hl-comment" style="color: silver">&lt;!-- Path to the configuration file for the service --&gt;</em>
      <span class="hl-tag">&lt;config-file&gt;</span>docroot:/WEB-INF/direct.conf.xml<span class="hl-tag">&lt;/config-file&gt;</span>
    <span class="hl-tag">&lt;/direct-output-service&gt;</span>
    
    <em class="hl-comment" style="color: silver">&lt;!-- Extra paths for static resources (set i18n attribute to "true" for multitenancy/-language support)--&gt;</em>
    <span class="hl-tag">&lt;static&gt;</span>
      <span class="hl-tag">&lt;path&gt;</span>img<span class="hl-tag">&lt;/path&gt;</span>
      <span class="hl-tag">&lt;path</span> <span class="hl-attribute">i18n</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>errorpages<span class="hl-tag">&lt;/path&gt;</span>
    <span class="hl-tag">&lt;/static&gt;</span>
   
    <em class="hl-comment" style="color: silver">&lt;!-- Exceptions thrown by the business logic or Pustefix itself can be handled on the top layer by so-called
         ExceptionProcessors, e.g. an ExceptionProcessor implementation can forward certain types of exceptions to
         error pages, log them to a file or pass them to an external tool. If you don't configure an ExceptionProcessor
         or the ExceptionProcessor doesn't create an HTTP response by itself, the default exception handling of the 
         servlet container applies. Pustefix provides a default implementation for development, which renders the
         exception together with some contextual information as HTML. But this processor should only be used in test
         mode, because it would expose system internals to the world. In production mode you should leave it out or
         register an alternative implementation.
    --&gt;</em>
    <span class="hl-tag">&lt;choose&gt;</span>
      <span class="hl-tag">&lt;when</span> <span class="hl-attribute">test</span>=<span class="hl-value">"$mode='test'"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;exception-processing&gt;</span>
          <span class="hl-tag">&lt;process</span> <span class="hl-attribute">type</span>=<span class="hl-value">"java.lang.Throwable"</span> 
                   <span class="hl-attribute">processor</span>=<span class="hl-value">"de.schlund.pfixxml.exceptionprocessor.UniversalExceptionProcessor"</span><span class="hl-tag">/&gt;</span>
          <em class="hl-comment" style="color: silver">&lt;!-- &lt;process type="mypackage.MyException" forward="true" page="/error.html"/&gt; --&gt;</em>
        <span class="hl-tag">&lt;/exception-processing&gt;</span>
      <span class="hl-tag">&lt;/when&gt;</span>
    <span class="hl-tag">&lt;/choose&gt;</span>

    <em class="hl-comment" style="color: silver">&lt;!--  Custom Deplyment descriptor code
    &lt;web-xml&gt;
      &lt;jee:web-app xmlns:jee="http://java.sun.com/xml/ns/javaee"&gt;
        &lt;choose&gt;
          &lt;when test="$mode='test'"&gt;
            &lt;jee:display-name&gt;foo&lt;/jee:display-name&gt;
          &lt;/when&gt;
        &lt;/choose&gt;
      &lt;/jee:web-app&gt;
    &lt;/web-xml&gt;
    --&gt;</em>
    
  <span class="hl-tag">&lt;/application&gt;</span>
  
  <em class="hl-comment" style="color: silver">&lt;!-- Example configuration of Spring MessageSources --&gt;</em>
  <span class="hl-tag">&lt;messagesources&gt;</span>
    <span class="hl-tag">&lt;messagesource</span> <span class="hl-attribute">type</span>=<span class="hl-value">"po"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;basename&gt;</span>module://my-module/i18n/messages<span class="hl-tag">&lt;/basename&gt;</span>
      <span class="hl-tag">&lt;basename&gt;</span>module://my-module/i18n/errors<span class="hl-tag">&lt;/basename&gt;</span>
    <span class="hl-tag">&lt;/messagesource&gt;</span>
    <span class="hl-tag">&lt;messagesource</span> <span class="hl-attribute">type</span>=<span class="hl-value">"properties"</span> <span class="hl-attribute">basename</span>=<span class="hl-value">"/WEB-INF/messages"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/messagesources&gt;</span>

<span class="hl-tag">&lt;/project-config&gt;</span>


      </pre><p>
        As you can see, the configuration file consists of different sections: One for 
        information about the project, one for configuring the Pustefix CMS, one for 
        the server configuration and one for the application itself. The application 
        consists of services and static resources. Please note that only one 
        context-xml-service is allowed per project. 
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration.depend"></a>4.3.3.&nbsp;Page Configuration (depend.xml)</h3></div></div></div><p>
      The depend.xml is used to define the internal structure of the
      pages by defining, for every single page, the tree of transformations that need to be
      applied to certain files to get the final stylesheet (which is the representation of
      the page in Pustefix). For an overview over the transformation aspect of the whole
      framework, please go here.
    </p><p>
      To make life a little easier, you can use convenience tags that are automatically
      transformed by the runtime system when the file is loaded.
    </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e604"></a>Structure of the depend.xml</h4></div></div></div><p>
        The structure of the config file is show below:
        </p><pre class="programlisting"><span class="hl-tag">&lt;make</span> <span class="hl-attribute">project</span>=<span class="hl-value">"MyProject"</span> <span class="hl-attribute">lang</span>=<span class="hl-value">"en"</span> <span class="hl-attribute">themes</span>=<span class="hl-value">"ThemeA ThemeB ... default"</span><span class="hl-tag">&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!--
    The global section allows to set default values for ALL pages defined via the
    standardpage tag (see below). It's possible to set default params, and runtime
    stylesheets (see here). It's also possible to add more runtime stylesheets or
    overwrite params in the standardpage tag for a single page.
  --&gt;</em>
  <span class="hl-tag">&lt;global&gt;</span>
    <span class="hl-tag">&lt;include</span> <span class="hl-attribute">stylesheet</span>=<span class="hl-value">"path/to/AStyleSheet"</span><span class="hl-tag">/&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- Stylesheets from module jars can be directly included by setting the module attribute. --&gt;</em>
    <em class="hl-comment" style="color: silver">&lt;!-- &lt;include stylesheet="path/to/AStyleSheetFromModule" module="modulename"/&gt; --&gt;</em>
    <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"AValue"</span><span class="hl-tag">/&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- Enable compressing of inline Javascript (requires YUI compressor or Google Closure Compiler in classpath) --&gt;</em>
    <span class="hl-tag">&lt;cus:choose&gt;</span>
      <span class="hl-tag">&lt;cus:when</span> <span class="hl-attribute">test</span>=<span class="hl-value">"$mode = 'prod'"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"compress-inline-javascript"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
      <span class="hl-tag">&lt;/cus:when&gt;</span>
    <span class="hl-tag">&lt;/cus:choose&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- Show missing includes, i.e. display a warning image if an include doesn't exist or has no matching theme. --&gt;</em>
    <span class="hl-tag">&lt;cus:choose&gt;</span>
      <span class="hl-tag">&lt;cus:when</span> <span class="hl-attribute">test</span>=<span class="hl-value">"$mode = 'prod'"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"show-missing-include"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"false"</span><span class="hl-tag">/&gt;</span>
      <span class="hl-tag">&lt;/cus:when&gt;</span>
      <span class="hl-tag">&lt;cus:otherwise&gt;</span>
        <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"show-missing-include"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
      <span class="hl-tag">&lt;/cus:otherwise&gt;</span>
    <span class="hl-tag">&lt;/cus:choose&gt;</span>
  <span class="hl-tag">&lt;/global&gt;</span>

  <span class="hl-tag">&lt;config-include</span> <span class="hl-attribute">file</span>=<span class="hl-value">"conf/myfile.xml"</span> <span class="hl-attribute">section</span>=<span class="hl-value">"targets"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"mymodule"</span><span class="hl-tag">/&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!--
    The other allowed tags are target, global, standardmaster, standardmetatags and 
    standardpage. The latter three are only convenience tags that can be expressed 
    fully in terms of target tags (Expanding those tags is one of the duties of the 
    runtime transformation of the depend.xml file mentioned above).
  --&gt;</em>
  <span class="hl-tag">&lt;target</span> <span class="hl-attribute">name</span>=<span class="hl-value">"a_target_name.xsl"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"[xsl|xml]"</span><span class="hl-tag">&gt;</span>...<span class="hl-tag">&lt;/target&gt;</span>
  <span class="hl-tag">&lt;target</span> <span class="hl-attribute">name</span>=<span class="hl-value">"another_target_name.xml"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"[xsl|xml]"</span><span class="hl-tag">&gt;</span>...<span class="hl-tag">&lt;/target&gt;</span>...
  <span class="hl-tag">&lt;standardmaster</span> <span class="hl-attribute">name</span>=<span class="hl-value">"..."</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;standardmetatags</span> <span class="hl-attribute">name</span>=<span class="hl-value">"..."</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;standardpage</span> <span class="hl-attribute">name</span>=<span class="hl-value">"a_name"</span> <span class="hl-attribute">master</span>=<span class="hl-value">"..."</span>
                <span class="hl-attribute">metatags</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">themes</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">variant</span>=<span class="hl-value">"..."</span>
                <span class="hl-attribute">xml</span>=<span class="hl-value">"a_base_xml_file.xml"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;auto-standardpage</span> <span class="hl-attribute">lookup-path</span>=<span class="hl-value">"txt/pages"</span> <span class="hl-attribute">lookup-module</span>=<span class="hl-value">"..."</span> 
                     <span class="hl-attribute">master</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">metatags</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">themes</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">variant</span>=<span class="hl-value">"..."</span>
                     <span class="hl-attribute">xml</span>=<span class="hl-value">"a_base_xml_file.xml"</span><span class="hl-tag">&gt;</span>
    ...
  <span class="hl-tag">&lt;/standardpage&gt;</span>
<span class="hl-tag">&lt;/make&gt;</span></pre><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e612"></a>The &lt;make/&gt; tag</h4></div></div></div><p>
       The <code class="literal">&lt;make&gt;</code> tag is the root element of the
       <code class="filename">depend.xml</code>
      </p><div class="table"><a name="d0e623"></a><p class="title"><b>Table&nbsp;4.1.&nbsp;Attributes of the &lt;make&gt; tag</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
            <th>Attribute</th>
            <th>Mandatory?</th>
            <th>Description</th>
          </tr></thead><tbody><tr>
            <td>project</td>
            <td>mandatory</td>
            <td>The name of the project. This is the same as the corresponding entry in the project.xml file.</td>
          </tr><tr>
            <td>lang</td>
            <td>mandatory</td>
            <td>The default language of the project. This is the same as the value of the lang node's name attribute used in include parts.</td>
          </tr><tr>
            <td>themes</td>
            <td>optional</td>
            <td>
              <p>
                The attribute is a space separated list of theme names. It acts as a fallback
                queue of product branch names that should be checked in include parts to decide
                which branch to use. The least specific theme is always the "default" theme
                and therefore "default" should be the last theme in the list. The last theme in the list is used when a non-existing include part is created in the Pustefix CMS, so you can omit the "default" theme from the end of the list if you want to use another theme for newly created include parts. However the "default" theme will still be used as a fallback for existing include parts when no other matching theme variant of the include part exists. You should have at least a product branch named "default" in every include part to make sure to always have a valid fallback.
              </p>
              <p>
                If it's not given, it defaults (in our example where the project name is
                "MyProject") to "MyProject default".
              </p>
              <p>
                Note that this attribute only defines a global value, each target can define
                it's own themes list (see below for targets and their attributes).
              </p>
              <p>
                The allowed characters for themes are: a-zA-Z0-9_+-
              </p>
            </td>
          </tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="configuration.depend.target"></a>Target definition</h4></div></div></div><p>
        The <code class="literal">&lt;target&gt;</code> tag is used to specify the XSL transformations in Pustefix. In most cases, you will not have
        to use the rather complex <code class="literal">&lt;target&gt;</code>, but use the convinience tags described in
        <a class="xref" href="#configuration.depend.standardpage" title="Standard page definition">the section called &#8220;Standard page definition&#8221;</a>, <a class="xref" href="#configuration.depend.standardmaster" title="Standard master target definition">the section called &#8220;Standard master target definition&#8221;</a> and
        <a class="xref" href="#configuration.depend.standardmetatags" title="Standard metatags target definition">the section called &#8220;Standard metatags target definition&#8221;</a>.
      </p><p>
        <a class="xref" href="#architecture.xsl.targets" title="3.3.1.&nbsp;XSL Targets">Section&nbsp;3.3.1, &#8220;XSL Targets&#8221;</a> provides more information on the concept of targets in Pustefix.
      </p><pre class="programlisting"><span class="hl-tag">&lt;target</span> <span class="hl-attribute">name</span>=<span class="hl-value">"baz.xsl"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"xsl"</span> <span class="hl-attribute">page</span>=<span class="hl-value">"foo"</span> <span class="hl-attribute">variant</span>=<span class="hl-value">"bar"</span> <span class="hl-attribute">themes</span>=<span class="hl-value">"Theme_A Theme_B ... default"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!--
    depxml and depxsl reference other targets by their name attribute
    that serve as the XML resp. XSL input used to create this target
    via a XSL transformation. If for a given name attribute of either
    depxml or depxsl no other target definition is found, the transformation
    parent is supposed to be a leaf target and the name attribute is 
    interpreted as a path relative to the docroot.
  --&gt;</em>
  <span class="hl-tag">&lt;depxml</span> <span class="hl-attribute">name</span>=<span class="hl-value">"foo/xsl/bar.xsl"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;depxsl</span> <span class="hl-attribute">name</span>=<span class="hl-value">"foo/xsl/baz.xsl"</span><span class="hl-tag">/&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!--
    Additional dependencies
  --&gt;</em>
  <span class="hl-tag">&lt;depaux</span> <span class="hl-attribute">name</span>=<span class="hl-value">"foo/xsl/snarf.xsl"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;depaux</span> <span class="hl-attribute">name</span>=<span class="hl-value">"foo/xsl/fubar.xsl"</span><span class="hl-tag">/&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!--
    param tags supply XSL transformation parameters that are used when the target is generated.
  --&gt;</em>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"AValue"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/target&gt;</span></pre><p>
        The &lt;target&gt; tag supports the following attributes:
      </p><div class="table"><a name="d0e709"></a><p class="title"><b>Table&nbsp;4.2.&nbsp;Attributes of the &lt;target&gt; tag</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
            <th>Attribute</th>
            <th>Mandatory?</th>
            <th>Description</th>
          </tr></thead><tbody><tr>
            <td>name</td>
            <td>mandatory</td>
            <td>The name of the target. This name must be unique for the whole project (not the whole environment!)</td>
          </tr><tr>
            <td>type</td>
            <td>mandatory</td>
            <td>Must be xsl for a target that should be "compiled" into a templates object. Must be xml for every target that is used as input for a transformation.</td>
          </tr><tr>
            <td>themes</td>
            <td>optional</td>
            <td>This is just a local overwrite to the global themes attribute as explained on this page</td>
          </tr><tr>
            <td>page</td>
            <td>optional</td>
            <td>It must be set for any top level target (that means a target that is not itself used to generate other targets) that should be accessible via the page name. Note: having a non-toplevel target with a page attribute is considered an error.</td>
          </tr><tr>
            <td>variant</td>
            <td>optional</td>
            <td>It makes only sense when also a page attribute is set. This attribute will discriminate between targets that should be associated with the same page, but represent a differnt variant of this page.</td>
          </tr></tbody></table></div></div><br class="table-break"><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="d0e780"></a>Adding dependencies</h5></div></div></div><p>
          <code class="literal">&lt;depaux&gt;</code> tags create user defined dependencies on the files they reference in
          their name attribute. Whenever the target generation system is asked for a target, all its dependencies
          are checked whether their modification time is older than the creation time of the target. Dependencies include
          by design the <code class="literal">depxml</code> and <code class="literal">depxsl</code> targets (which may be files in the case 
          of a leaf target or another virtual target that returns its own creation time as the modification time) and all
          include files from which include parts are taken during the transformation of the target.
        </p><p>
          If any of these files or targets has been changed after the target was built, it is taken care of that the target is rebuild.
        </p><p>
          <code class="literal">&lt;depaux&gt;</code> just adds more dependencies "by hand" that are not automatically detected. In the example
          above, the file referenced is a XSLT stylesheets that's included via <code class="literal">xsl:include</code> into the <code class="filename">foo.xsl</code>
          stylesheet. Such external dependencies are not currently recognized automatically.
        </p><p>
          E.g. if you use a <code class="filename">foo/xsl/fubar.xsl</code> stylesheet that serves as a library of templates you want to include into
          <code class="filename">foo.xsl</code>, you need to add the following line to the target definition of <code class="filename">foo.xsl</code> to make
          the system recognize changes to <code class="filename">foo/xsl/fubar.xsl</code>.
        </p><pre class="programlisting"><span class="hl-tag">&lt;depaux</span> <span class="hl-attribute">name</span>=<span class="hl-value">"foo/xsl/fubar.xsl"</span><span class="hl-tag">/&gt;</span></pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="configuration.depend.standardpage"></a>Standard page definition</h4></div></div></div><p>
        The standardpage tag is a convenience tag that encapsulates the typical definition of a complete page in the Pustefix system.
      </p><pre class="programlisting"><span class="hl-tag">&lt;standardpage</span> <span class="hl-attribute">name</span>=<span class="hl-value">"BazPage"</span> <span class="hl-attribute">master</span>=<span class="hl-value">"AName"</span> <span class="hl-attribute">metatags</span>=<span class="hl-value">"AName"</span> <span class="hl-attribute">xml</span>=<span class="hl-value">"xml/FooBase.xml"</span>
              <span class="hl-attribute">themes</span>=<span class="hl-value">"Theme_A Theme_B ... default"</span> <span class="hl-attribute">variant</span>=<span class="hl-value">"foo"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!--
    Note: All the child nodes are optional (and in fact usually not needed)
  --&gt;</em>
  <span class="hl-tag">&lt;include</span> <span class="hl-attribute">stylesheet</span>=<span class="hl-value">"xsl/runtime.xsl"</span><span class="hl-tag">/&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- Stylesheets from module jars can be directly included by setting the module attribute. --&gt;</em>
  <em class="hl-comment" style="color: silver">&lt;!-- &lt;include stylesheet="xsl/runtimeFromModule.xsl" module="modulename"/&gt; --&gt;</em>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"fubar"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"bar"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/standardpage&gt;</span></pre><p>
        The &lt;standardpage&gt; tag supports the following attributes:
      </p><div class="table"><a name="d0e832"></a><p class="title"><b>Table&nbsp;4.3.&nbsp;Attributes of the &lt;target&gt; tag</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
            <th>Attribute</th>
            <th>Mandatory?</th>
            <th>Description</th>
          </tr></thead><tbody><tr>
            <td>name</td>
            <td>mandatory</td>
            <td>The name of the page. This must be a name already defined in a page tag in the navigation tree.</td>
          </tr><tr>
            <td>xml</td>
            <td>mandatory</td>
            <td>The name of a xml target to use as input for the "metatags transformation". Often this is a leaf target and one of the projects structural xml files.</td>
          </tr><tr>
            <td>module</td>
            <td>optional</td>
            <td>The name of the module from which the xml file should be loaded.</td>
          </tr><tr>
            <td>themes</td>
            <td>optional</td>
            <td>This attribute is a local overwrite of the global themes attribute explained here.</td>
          </tr><tr>
            <td>variant</td>
            <td>optional</td>
            <td>This attribute allows you to define variants of the same page. It's only possible to define variants of pages when there's already a "root" page, in other words a standardpage definition without the variant attribute. Variants also influence the local themes (in fact the visible aspect of variants is implemented in terms of themes).</td>
          </tr><tr>
            <td>master</td>
            <td>optional</td>
            <td>Default is to use the default definition of the master stylesheet (standardmaster without a name attribute).</td>
          </tr><tr>
            <td>metatags</td>
            <td>optional</td>
            <td>Default is to use the default definition of the metatags stylesheet (standardmetatags without a name attribute).</td>
          </tr></tbody></table></div></div><br class="table-break"><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Page auto-configuration"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left"><a name="configuration.depend.autostandardpage"></a>Page auto-configuration</th></tr><tr><td align="left" valign="top">
         If you're configuration contains a lot of repeating standardpage definitions only differing in the page name, you can
         alternatively use <code class="literal">&lt;auto-standardpage&gt;</code>, which will automatically create standardpage definitions
         for all found pages. Pages are searched looking for XML files in the directory specified by the <code class="literal">lookup-path</code>  
         attribute (and <code class="literal">lookup-module</code> if the pages are located in modules). The page name will be derived from the XML file 
         name. Apart from the <code class="literal">name</code> attribute all <code class="literal">standardpage</code> attributes can be used.
 <pre class="programlisting"><span class="hl-tag">&lt;auto-standardpage</span> <span class="hl-attribute">lookup-path</span>=<span class="hl-value">"txt/pages"</span> <span class="hl-attribute">lookup-module</span>=<span class="hl-value">"*"</span> <span class="hl-attribute">master</span>=<span class="hl-value">"AName"</span> <span class="hl-attribute">metatags</span>=<span class="hl-value">"AName"</span><span class="hl-tag">&gt;</span>
  ...
<span class="hl-tag">&lt;/auto-standardpage&gt;</span></pre></td></tr></table></div><p>
        After performing the transformation of the depend.xml on loading (automatically done by the runtime system system) this becomes
      </p><pre class="programlisting"><span class="hl-tag">&lt;target</span> <span class="hl-attribute">name</span>=<span class="hl-value">"BazPage::foo.xsl"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"xsl"</span> <span class="hl-attribute">themes</span>=<span class="hl-value">"foo Target_A Target_B ... default"</span> <span class="hl-attribute">page</span>=<span class="hl-value">"BazPage"</span> <span class="hl-attribute">variant</span>=<span class="hl-value">"foo"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!--
    For every target that is only used in the generation of one single page
    (if you look at the example given here, this is true for the generated
    targets BazPage.xml and BazPage.xsl) you must give a parameter called page
    with the name of the resulting page as the value for the standard XSLT tags
    to be able to work correctly. They need this information e.g. to create links
    to other pages and many other things. While the standardpage tag does this
    automatically for you make sure that you don't forget it for target structures
    you define yourself.

    If the master attribute is not given, the depxsl will be master.xsl
  --&gt;</em>
  <span class="hl-tag">&lt;depxml</span> <span class="hl-attribute">name</span>=<span class="hl-value">"BazPage::foo.xml"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;depxsl</span> <span class="hl-attribute">name</span>=<span class="hl-value">"master-AName.xsl"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"page"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"BazPage"</span><span class="hl-tag">/&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!--
    parameters given to the standardpage tag are supplied to the first of the two
    transformations. The outputencoding parameter is inserted by the build system.
    Refrain from supplying this parameter on your own, unless you really know what
    you do. Changing the encoding should be done in the project.xml file.
  --&gt;</em>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"fubar"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"bar"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"outputencoding"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"UTF-8"</span><span class="hl-tag">/&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!--
    All include tags given are runtime stylesheets, given to the transformation via
    the parameter stylesheets_to_include (as a space separated list if multiple
    include tags are given). Note that the needed depaux nodes are inserted automatically.
  --&gt;</em>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"stylesheets_to_include"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"xsl/runtime.xsl"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/target&gt;</span>

<span class="hl-tag">&lt;target</span> <span class="hl-attribute">name</span>=<span class="hl-value">"BazPage::foo.xml"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"xml"</span> <span class="hl-attribute">themes</span>=<span class="hl-value">"foo Themes_A Themes_B ... default"</span><span class="hl-tag">&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!--
    If the metatags attribute has not been given, the depxsl value is metatags.xsl  
  --&gt;</em>  
  <span class="hl-tag">&lt;depxml</span> <span class="hl-attribute">name</span>=<span class="hl-value">"xml/FooBase.xml"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;depxsl</span> <span class="hl-attribute">name</span>=<span class="hl-value">"metatags-AName.xsl"</span><span class="hl-tag">/&gt;</span>

  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"fubar"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"bar"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"page"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"BazPage"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/target&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="configuration.depend.standardmaster"></a>Standard master target definition</h4></div></div></div><p>
        The <code class="literal">standardmaster</code> tag is a convenience tag that encapsulates the typical target
        definition of the master.xsl stylesheet.
      </p><pre class="programlisting"><span class="hl-tag">&lt;standardmaster</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AName"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- The name attribute is optional --&gt;</em>
  <span class="hl-tag">&lt;include</span> <span class="hl-attribute">stylesheet</span>=<span class="hl-value">"xsl/skin.xsl"</span><span class="hl-tag">/&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- Stylesheets from module jars can be directly included by setting the module attribute. --&gt;</em>
  <em class="hl-comment" style="color: silver">&lt;!-- &lt;include stylesheet="xsl/skinFromModule.xsl" module="modulename"/&gt; --&gt;</em>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"AValue"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/standardmaster&gt;</span></pre><p>
        After performing the transformation of <code class="filename">depend.xml</code> when the runtime system loads
        the file this becomes:
      </p><pre class="programlisting"><span class="hl-tag">&lt;target</span> <span class="hl-attribute">name</span>=<span class="hl-value">"master-AName.xsl"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"xsl"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!--
    If the name attribute of the standardmaster tag has not been given,
    the value for the target's name attribute will be master.xsl.
  --&gt;</em>
  <span class="hl-tag">&lt;depxml</span> <span class="hl-attribute">name</span>=<span class="hl-value">"xsl/master.xsl"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"pustefix-core"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;depxsl</span> <span class="hl-attribute">name</span>=<span class="hl-value">"xsl/customizemaster.xsl"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"pustefix-core"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"AValue"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"product"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"MyProject"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"lang"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"en"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/target&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="configuration.depend.standardmetatags"></a>Standard metatags target definition</h4></div></div></div><p>
        The standardmetatags tag is a convenience tag that encapsulates the typical target definition
        of the <code class="literal">metatags.xsl</code> stylesheet.
      </p><pre class="programlisting"><span class="hl-tag">&lt;standardmetatags</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AName"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- The name attribute is optional --&gt;</em>
  <span class="hl-tag">&lt;include</span> <span class="hl-attribute">stylesheet</span>=<span class="hl-value">"xsl/metatags.xsl"</span><span class="hl-tag">/&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- Stylesheets from module jars can be directly included by setting the module attribute. --&gt;</em>
  <em class="hl-comment" style="color: silver">&lt;!-- &lt;include stylesheet="xsl/metatagsFromModule.xsl" module="modulename"/&gt; --&gt;</em>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"AValue"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/standardmetatags&gt;</span></pre><p>
        After performing the transformation of <code class="filename">depend.xml</code> when the runtime system loads
        the file this becomes:
      </p><pre class="programlisting"><span class="hl-tag">&lt;target</span> <span class="hl-attribute">name</span>=<span class="hl-value">"metatags-AName.xsl"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"xsl"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!--
    If the name attribute of the standardmetatags tag has not been given,
    the value of the name attribute here becomes metatags.xsl.
  --&gt;</em>

  <span class="hl-tag">&lt;depxml</span> <span class="hl-attribute">name</span>=<span class="hl-value">"xsl/metatags.xsl"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"pustefix-core"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;depxsl</span> <span class="hl-attribute">name</span>=<span class="hl-value">"xsl/customizemaster.xsl"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"pustefix-core"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"stylesheets_to_include"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"xsl/metatags.xsl "</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"AValue"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"product"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"MyProject"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"lang"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"en"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/target&gt;</span></pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration.sitemap"></a>4.3.4.&nbsp;Sitemap configuration</h3></div></div></div><p>
        The optional sitemap configuration file <code class="literal">sitemap.xml</code> can be used to define a logical page structure, e.g.
        for grouping pages according to a navigation or menu structure. This sitemap can be accessed during the XSL transformations
        using the XSL parameter <code class="literal">$sitemap</code>.
      </p><p>
        The sitemap can be also used to provide page name aliases. Pustefix differentiates between logcial page names and display 
        page names. Within the sitemap you can set a display page name by setting a so-called page alias. Thus you can rename a page
        without having to change existing page references, i.e. internally the logical name is still used, but when Pustefix renders
        the page, page names in links, etc., are replaced by the display names.
      </p><p>
        In addition the sitemap allows the definition of page alternatives. Page alternatives can be used to create different 
        representations of a page. They base on the same logical page, but can produce different content and display names,
        e.g. for landing pages.
      </p><p>
        Finally you can define so-called <code class="literal">page groups</code>, which let you group pages and add a common path prefix
        to their URL. Page groups can be nested arbitrarily, which will create compound path prefixes.
      </p><pre class="programlisting"><span class="hl-tag">&lt;sitemap&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- page elements can be arbitrarily listed/nested, the name attribute relates to the logical page name --&gt;</em>
  <span class="hl-tag">&lt;page</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Home"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;page</span> <span class="hl-attribute">name</span>=<span class="hl-value">"..."</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;page</span> <span class="hl-attribute">name</span>=<span class="hl-value">"..."</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/page&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- the 'alias' attribute can be used to provide a page alias which should be displayed instead of the logical name,
       you can optionally add the 'internal' attribute to exclude a page from the generated search engine sitemap,
       you're also allowed to use arbitrary custom attributes --&gt;</em>
  <span class="hl-tag">&lt;page</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Overview"</span> <span class="hl-attribute">alias</span>=<span class="hl-value">"Summary"</span> <span class="hl-attribute">internal</span>=<span class="hl-value">"true"</span> <span class="hl-attribute">foo</span>=<span class="hl-value">"bar"</span><span class="hl-tag">/&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- using the alt element you can add page alternatives, matching is done using the mandatory key attribute --&gt;</em>
  <span class="hl-tag">&lt;page</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Info"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;alt</span> <span class="hl-attribute">key</span>=<span class="hl-value">"cities"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Cities"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;alt</span> <span class="hl-attribute">key</span>=<span class="hl-value">"nationalparks"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"NationalParks"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;alt</span> <span class="hl-attribute">key</span>=<span class="hl-value">"mountains"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Mountains"</span><span class="hl-tag">/&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- Optionally you can set one page alternative to be the default one used when no page alternative is
         explicitly requested --&gt;</em>
    <em class="hl-comment" style="color: silver">&lt;!-- &lt;alt key="mountains" name="Mountains" default="true"/&gt; --&gt;</em>
  <span class="hl-tag">&lt;/page&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- the page-group name will appear as path prefix in the URL, setting the default attribute on a page will make it
       accessible under the group name, e.g. /mainpath/mainpage, /mainpath/subpath/ and /mainpath/subpath/subpage2 --&gt;</em> 
  <span class="hl-tag">&lt;page-group</span> <span class="hl-attribute">key</span>=<span class="hl-value">"main"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mainpath"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;page</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mainpage"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;page-group</span> <span class="hl-attribute">key</span>=<span class="hl-value">"sub"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"subpath"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;page</span> <span class="hl-attribute">name</span>=<span class="hl-value">"subpage1"</span> <span class="hl-attribute">default</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
      <span class="hl-tag">&lt;page</span> <span class="hl-attribute">name</span>=<span class="hl-value">"subpage2"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/page-group&gt;</span>
  <span class="hl-tag">&lt;/page-group&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- additional parts of a sitemap can be included, e.g. from modules --&gt;</em>
  <span class="hl-tag">&lt;config-include</span> <span class="hl-attribute">file</span>=<span class="hl-value">"conf/sitemap-fragment.xml"</span> <span class="hl-attribute">section</span>=<span class="hl-value">"sitemap"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"*"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/sitemap&gt;</span></pre><p>
        Internationalizing page names can be done by creating additional language specific alias mappings. These mappings are
        defined in the <code class="literal">sitemap-alias.xml</code> configuration files.
      </p><pre class="programlisting"><span class="hl-tag">&lt;sitemap-aliases</span> <span class="hl-attribute">lang</span>=<span class="hl-value">"de"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- the alias elements map page names to language specific display names --&gt;</em>
  <span class="hl-tag">&lt;alias</span> <span class="hl-attribute">page</span>=<span class="hl-value">"Home"</span><span class="hl-tag">&gt;</span>Start<span class="hl-tag">&lt;/alias&gt;</span>
  <span class="hl-tag">&lt;alias</span> <span class="hl-attribute">page</span>=<span class="hl-value">"Overview"</span><span class="hl-tag">&gt;</span>Uebersicht<span class="hl-tag">&lt;/alias&gt;</span>
  <span class="hl-tag">&lt;alias</span> <span class="hl-attribute">page</span>=<span class="hl-value">"Info"</span><span class="hl-tag">&gt;</span>Information<span class="hl-tag">&lt;/alias&gt;</span>
  <span class="hl-tag">&lt;alias</span> <span class="hl-attribute">page</span>=<span class="hl-value">"Cities"</span><span class="hl-tag">&gt;</span>Staedte<span class="hl-tag">&lt;/alias&gt;</span>
  <span class="hl-tag">&lt;alias</span> <span class="hl-attribute">page</span>=<span class="hl-value">"NationalParks"</span><span class="hl-tag">&gt;</span>Nationalparks<span class="hl-tag">&lt;/alias&gt;</span>
  <span class="hl-tag">&lt;alias</span> <span class="hl-attribute">page</span>=<span class="hl-value">"Mountains"</span><span class="hl-tag">&gt;</span>Berge<span class="hl-tag">&lt;/alias&gt;</span>
<span class="hl-tag">&lt;/sitemap-aliases&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration.servlet.contextxml"></a>4.3.5.&nbsp;ContextXMLService configuration file</h3></div></div></div><p>
        The ContextXMLService handles requests for all pages (where page means
        some content generated by an XSL transformation). The name of the
        configuration file can be arbitrarily chosen and is configured in the
        project configuration file.
       </p><p>
        This service uses a configuration file that has a special 
        syntax. However properties and customization in this file 
        work nearly the same way as explained for the standard 
        property definitions.
      </p><p>
        </p><pre class="programlisting">
  <span class="hl-tag">&lt;context-xml-service-config</span>
    <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/context-xml-service-config"</span><span class="hl-tag">
  &gt;</span>
    <span class="hl-tag">&lt;global-config&gt;</span>
      <span class="hl-tag">&lt;force-ssl&gt;</span>false<span class="hl-tag">&lt;/force-ssl&gt;</span>
        </pre><p>
        <code class="sgmltag-element">force-ssl</code> can be set to <code class="literal">true</code> in order 
        to enforce a secure connection for all pages of this service. The 
        whole node is optional and defaults to <code class="literal">false</code>.
        </p><pre class="programlisting">
      <span class="hl-tag">&lt;defaultstate</span> <span class="hl-attribute">class</span>=<span class="hl-value">"a.state.Class"</span><span class="hl-tag">/&gt;</span>
      <span class="hl-tag">&lt;defaultihandlerstate</span> <span class="hl-attribute">class</span>=<span class="hl-value">"another.state.Class"</span><span class="hl-tag">/&gt;</span>
      <em class="hl-comment" style="color: silver">&lt;!-- optional attribute for both elements: parent-bean-ref="..." --&gt;</em>
        </pre><p>
        <code class="sgmltag-element">defaultstate</code> and 
        <code class="sgmltag-element">defaultihandlerstate</code> are both optional. 
        The <code class="sgmltag-attribute">class</code> attribute must 
        be given. <code class="classname">a.state.Class</code> should 
        de a descendant of 
        <code class="classname">de.schlund.pfixcore.workflow.app.StaticState</code> 
        and <code class="classname">another.state.Class</code> should 
        be a descendant of 
        <code class="classname">de.schlund.pfixcore.workflow.app.DefaultIWrapperState</code> 
        (unless you really know what you are doing). They are 
        used to set the defaults for the state tag used when 
        processing the <code class="sgmltag-element">pagerequest</code> tag 
        (see there for more info).
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
          As Pustefix creates a singleton-scoped Spring bean of the specified class
          for each page, which uses a default state, you can't inject dependencies using the Spring XML configuration. 
	  That's why Pustefix supports the referencing of parent bean definitions using the <code class="literal">parent-bean-ref</code>
	attribute. Thus it's possible to indirectly inject dependencies 
	into the concrete instances by injecting them into the parent bean 
	definition.
          </p></td></tr></table></div><p>
        </p><pre class="programlisting">
    <span class="hl-tag">&lt;/global-config&gt;</span>
    
    <span class="hl-tag">&lt;context</span> <span class="hl-attribute">defaultpage</span>=<span class="hl-value">"APageName"</span> <span class="hl-attribute">synchronized</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
        </pre><p>
        </p><div class="informaltable"><table rules="all" frame="box"><thead align="left"><tr>
              <th>Attribute</th>
              <th>Description</th>
            </tr></thead><tbody><tr>
              <td><code class="literal">defaultpage</code></td>
              <td><span class="emphasis"><em>Either defaultpage attribute or defaultpage element must be set</em></span>. Must reference
              a valid <code class="literal">pagerequest</code>.</td>
            </tr><tr>
              <td><code class="literal">synchronized</code></td>
              <td>Optional. Defaults to <code class="literal">true</code>. If 
              set to <code class="literal">true</code>, only one request per 
              session is handled concurrently. If set to 
              <code class="literal">false</code> all requests will be handled 
              concurrently, requiring thread-safe business logic.</td>
            </tr></tbody></table></div><p>
        </p><pre class="programlisting">
      <span class="hl-tag">&lt;defaultpage&gt;</span>
        <span class="hl-tag">&lt;variant</span> <span class="hl-attribute">name</span>=<span class="hl-value">"VARIANTNAME"</span><span class="hl-tag">&gt;</span>PAGENAME<span class="hl-tag">&lt;/variant&gt;</span>
        ...
        <span class="hl-tag">&lt;default&gt;</span>PAGENAME<span class="hl-tag">&lt;/default&gt;</span>
      <span class="hl-tag">&lt;/defaultpage&gt;</span>
        </pre><p>
        The <code class="literal">defaultpage</code> element can be used if you want
        to define multiple defaultpages for different variants. 
        <span class="emphasis"><em>[Since: 0.13.1]</em></span>  
        </p><pre class="programlisting">
      <span class="hl-tag">&lt;resource</span> <span class="hl-attribute">class</span>=<span class="hl-value">"A_Resource"</span><span class="hl-tag">&gt;</span>
      <em class="hl-comment" style="color: silver">&lt;!-- optional attributes: bean-name="A_Name" scope="prototype|request|session|singleton"/&gt; --&gt;</em>
        </pre><p>
        <code class="sgmltag-attribute">class</code> is 
        <span class="emphasis"><em>mandatory</em></span>, can be any 
        Java class, that can be created with a default constructor.
        The <code class="sgmltag-attribute">scope</code> attribute is optional
        and defines the scope in which the Spring bean representing
        the resource is instantiated (session scope by default).
        The <code class="sgmltag-attribute">bean-name</code> attribute is 
        optional and specifies the name of the Spring bean that
        is created for this resource.
        There may be multiple resource tags given.
        </p><pre class="programlisting">
        <span class="hl-tag">&lt;implements</span> <span class="hl-attribute">class</span>=<span class="hl-value">"A_Interface"</span><span class="hl-tag">&gt;</span>
        </pre><p>
        The whole <code class="sgmltag-element">implements</code> node is optional. 
        <code class="sgmltag-attribute">class</code> is 
        <span class="emphasis"><em>mandatory</em></span>, must be a Java interface 
        implemented by the resource. 
        There may be more than one <code class="sgmltag-element">implements</code> tag for a 
        resource, but each interface 
        must be unique in the whole context. In other words: it's 
        possible for a resource to 
        implement more than one interface, but not possible for one 
        interface to be implemented by two 
        resources used in the same 
        <code class="classname">Context</code> definition.
        </p><pre class="programlisting">
        <span class="hl-tag">&lt;/implements&gt;</span>
        <span class="hl-tag">&lt;properties&gt;</span>
        </pre><p>
        The whole node is optional.
        </p><pre class="programlisting">
          <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">name</span>=<span class="hl-value">"A_Name"</span><span class="hl-tag">&gt;</span>A_Value<span class="hl-tag">&lt;/prop&gt;</span>
        </pre><p>
        <code class="sgmltag-element">prop</code> is <span class="emphasis"><em>mandatory</em></span> and can 
        be used multiple times. It's similar to the use as a child 
        of <code class="sgmltag-element">pagerequest</code>/<code class="sgmltag-element">properties</code>, but used 
        here to create properties that are related to a context 
        resource implementation. The resulting property looks like this:
        <code class="literal">context.resourceparameter.A_Resource.A_Name=A_Value</code>
        Customization tags may be used around a property to make it 
        depend on a certain makemode or other parameters.
        </p><pre class="programlisting">
        <span class="hl-tag">&lt;/properties&gt;</span>
      <span class="hl-tag">&lt;/resource&gt;</span>
    <span class="hl-tag">&lt;/context&gt;</span>
    
    <span class="hl-tag">&lt;global-output&gt;</span>
 </pre><p>
        The whole section is optional. You can list an arbitrary number of resources here.
        The <code class="literal">node</code> attribute value has to be unique within this section and the <code class="literal">output</code> section of all <code class="literal">pagerequest</code> elements.
        </p><pre class="programlisting">
        <span class="hl-tag">&lt;resource</span> <span class="hl-attribute">node</span>=<span class="hl-value">"AName"</span> <span class="hl-attribute">bean-ref</span>=<span class="hl-value">"aBeanName"</span><span class="hl-tag">/&gt;</span>
        </pre><p>
        </p><div class="informaltable"><table rules="all" frame="box"><thead align="left"><tr>
              <th>Attribute</th>
              <th>Description</th>
            </tr></thead><tbody><tr>
              <td><code class="literal">class</code></td>
              <td><span class="emphasis"><em>Mandatory (if <code class="literal">bean-ref</code> is not present)</em></span>. 
              <code class="sgmltag-attribute">class</code> is one of the 
              <code class="classname">ContextResources</code> defined via 
              implements above.</td>
            </tr><tr>
              <td><code class="literal">bean-ref</code></td>
              <td><span class="emphasis"><em>Mandatory (if <code class="literal">class</code> is not present)</em></span>. 
              Specifies the bean name of the resource that should be
              included in the output tree.</td>
            </tr><tr>
              <td><code class="literal">node</code></td>
              <td><span class="emphasis"><em>Mandatory</em></span>. 
              <code class="sgmltag-attribute">node</code> is the node in the 
              output tree ("<code class="literal">/formresult/AName</code>") under 
              which the <code class="classname">ContextResource</code> inserts 
              it's data.</td>
            </tr></tbody></table></div><p>
        </p><pre class="programlisting">
    <span class="hl-tag">&lt;/global-output&gt;</span>

    <span class="hl-tag">&lt;interceptors&gt;</span>
      <span class="hl-tag">&lt;start&gt;</span>
        <span class="hl-tag">&lt;interceptor</span> <span class="hl-attribute">class</span>=<span class="hl-value">"mypackage.MyInterceptor"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;interceptor</span> <span class="hl-attribute">bean-ref</span>=<span class="hl-value">"myInterceptor"</span><span class="hl-tag">/&gt;</span>
      <span class="hl-tag">&lt;/start&gt;</span>
      <span class="hl-tag">&lt;end&gt;</span> ... <span class="hl-tag">&lt;/end&gt;</span>
      <span class="hl-tag">&lt;postrender&gt;</span> ... <span class="hl-tag">&lt;postrender&gt;</span>
    <span class="hl-tag">&lt;/interceptors&gt;</span>
        </pre><p>
        Within the <code class="sgmltag-element">interceptors</code> section you can configure ContextInterceptors
        grouped by the according interception points (for details see <a class="xref" href="#concepts.interceptors" title="6.6.&nbsp;ContextInterceptors">Section&nbsp;6.6, &#8220;ContextInterceptors&#8221;</a>).
        </p><pre class="programlisting">
    <span class="hl-tag">&lt;scriptedflow</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AName"</span> <span class="hl-attribute">file</span>=<span class="hl-value">"path/to/scriptfile.xml"</span><span class="hl-tag">/&gt;</span>
        </pre><p>
        There may be an arbitrary number of <code class="sgmltag-element">scriptedflow</code> 
        tags, but each one must have a unique name. Scripted flows 
        are a special method to control a session and do automatic 
        requests based on initial user input.
        </p><pre class="programlisting">
    <span class="hl-tag">&lt;role</span> <span class="hl-attribute">name</span>=<span class="hl-value">"A_ROLE"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;condition</span> <span class="hl-attribute">id</span>=<span class="hl-value">"A_CONDITION"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;authconstraint</span> <span class="hl-attribute">id</span>=<span class="hl-value">"AN_AUTHCONSTRAINT"</span><span class="hl-tag">/&gt;</span>
        </pre><p>
         You can define an arbitrary number of roles, conditions and 
         authconstraints here, for details see <a class="xref" href="#advanced.rolebasedauth" title="7.6.&nbsp;Authentication and authorization">Section&nbsp;7.6, &#8220;Authentication and authorization&#8221;</a>.
         </p><pre class="programlisting">
    <span class="hl-tag">&lt;preserve-params&gt;</span>
      <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"myparam"</span><span class="hl-tag">/&gt;</span>
      <em class="hl-comment" style="color: silver">&lt;!-- &lt;config-include file="path/to/config-fragments.xml" section="preserve-params"/&gt; --&gt;</em>
    <span class="hl-tag">&lt;/preserve-params&gt;</span>
         </pre><p>
         Sometimes request parameters should be preserved when redirecting after a request has been processed,
         e.g. for passing tracking information. Here you can configure a global list of such parameters.
         
         <a name="configuration.servlet.contextxml.passthrough"></a></p><pre class="programlisting">
    <span class="hl-tag">&lt;disable-pageflow-passthrough/&gt;</span>
         </pre><p>
         Pustefix by default passes through the name of the last pageflow using the <code class="literal">__lf</code> URL
         parameter, thus indicating the preferred pageflow when a page is part of multiple flows. You can get rid
         of this parameter (e.g. for SEO reasons) by disabling the passthrough, which lets Pustefix store the name
         of the last flow in the session instead. You should be aware that disabling the passthrough can result
         in a different pageflow chosen under certain conditions (search for <code class="literal">PAGEFLOW_PASSTHROUGH_DIFF</code>
         in <code class="literal">pustefix-servlet.log</code> to find out these cases before disabling the passthrough).
         </p><pre class="programlisting">
    <span class="hl-tag">&lt;pageflow</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AName"</span> <span class="hl-attribute">final</span>=<span class="hl-value">"APageName"</span> <span class="hl-attribute">stopnext</span>=<span class="hl-value">"true|false"</span><span class="hl-tag">&gt;</span>
         </pre><p>
         There may be multiple pageflow tags defined, but you need at 
         least one (which must be referenced by the defaultflow attribute 
         above). We only describe the normal case without using variants. 
         See here for more information on how to handle variants of 
         pageflows.
          
         </p><div class="informaltable"><table rules="all" frame="box"><thead align="left"><tr>
              <th>Attribute</th>
              <th>Description</th>
            </tr></thead><tbody><tr>
              <td><code class="literal">name</code></td>
              <td><span class="emphasis"><em>Mandatory</em></span>. Must be a unique name.</td>
            </tr><tr>
              <td><code class="literal">final</code></td>
              <td> Optional, must reference a page with a valid 
              <code class="sgmltag-element">pagerequest</code> definition given in this property 
              file. There may be many pageflows defined for a servlet. 
              A page may well be used in more than one pageflow.</td>
            </tr><tr>
              <td><code class="literal">stopnext</code></td>
              <td> Optional, defaults to false. If given and 
              <code class="literal">true</code>, the pageflow will stop at the 
              next accessible page after the current page even if this 
              page would normally be skipped in the workflow because 
              it doesn't need any input.</td>
            </tr></tbody></table></div><p>
        </p><pre class="programlisting">
      <span class="hl-tag">&lt;flowstep</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AnotherPageName"</span> <span class="hl-attribute">stophere</span>=<span class="hl-value">"true|false"</span><span class="hl-tag">&gt;</span>
        </pre><p>
        </p><div class="informaltable"><table rules="all" frame="box"><thead align="left"><tr>
              <th>Attribute</th>
              <th>Description</th>
            </tr></thead><tbody><tr>
              <td><code class="literal">name</code></td>
              <td><span class="emphasis"><em>Mandatory</em></span>. Must reference a 
              valid <code class="sgmltag-element">pagerequest</code>. Usually there are many 
              flowsteps defined in a pageflow.</td>
            </tr><tr>
              <td><code class="literal">stophere</code></td>
              <td>Optional, if true the pageflow will stop at this 
              step unconditionally if the submit originated from a 
              step that's before this one in the pageflow. See 
              also the <code class="sgmltag-attribute">stopnext</code> 
              attribute of the  tag which is quivalent to 
              specifying <code class="literal">stophere="true"</code> for 
              every single flowstep.</td>
            </tr></tbody></table></div><p>
        </p><pre class="programlisting">
        <span class="hl-tag">&lt;oncontinue</span> <span class="hl-attribute">applyall</span>=<span class="hl-value">"true|false"</span><span class="hl-tag">&gt;</span>
        </pre><p>
        This tag (which is optional) starts a sequence of 
        test/action pairs. The tests are XPath expressions which 
        work on the DOM tree as produced by the flowstep's 
        associated state (note that the navigation is not 
        inserted into the DOM tree at this stage, and the 
        <code class="literal">/formresult/formvalues</code> and 
        <code class="literal">/formresult/formerrors</code> paths are also 
        not present). The pageflow system calls the tests whenever 
        a state returns a ResultDocument (before it continues with 
        other stuff e.g. a pageflow run).
        The <code class="sgmltag-attribute">applyall</code> attribute is 
        optional. If given and <code class="literal">true</code>, all actions 
        with matching conditions are executed, if not given or 
        <code class="literal">false</code> (the default) only the first 
        action with a matching condition is executed.
        </p><pre class="programlisting">
          <span class="hl-tag">&lt;when</span> <span class="hl-attribute">test</span>=<span class="hl-value">"A_XPath_Expression"</span><span class="hl-tag">&gt;</span>
        </pre><p>
        The <code class="sgmltag-element">when</code> tag contains the XPath expression to try 
        in it's <code class="sgmltag-attribute">test</code> attribute. If this 
        attribute is omitted, the whole condition is considered to 
        be true.
        </p><pre class="programlisting">
            <span class="hl-tag">&lt;action</span> <span class="hl-attribute">type</span>=<span class="hl-value">"jumpto"</span> <span class="hl-attribute">page</span>=<span class="hl-value">"APage"</span> <span class="hl-attribute">pageflow</span>=<span class="hl-value">"APageFlow"</span><span class="hl-tag">&gt;</span>
        </pre><p>
        The <code class="sgmltag-element">action</code> tag denotes the 
        <code class="classname">FlowStepAction</code> to execute. The 
        <code class="sgmltag-attribute">type</code> attribute is mandatory and 
        defines the special action to use. The string 
        <code class="literal">jumpto</code> denotes the special 
        <code class="classname">FlowStepAction</code> 
        <code class="classname">de.schlund.pfixcore.workflow.FlowStepJumpToAction</code>  
        which is used to set the jumptopage (defined via the 
        <code class="sgmltag-attribute">page</code> attribute) and/or the 
        jumptopageflow (defined via the 
        <code class="sgmltag-attribute">pageflow</code> attribute).
        </p><pre class="programlisting">
            <span class="hl-tag">&lt;/action&gt;</span>
          <span class="hl-tag">&lt;/when&gt;</span>
          <span class="hl-tag">&lt;when</span> <span class="hl-attribute">test</span>=<span class="hl-value">"A_XPath_Expression"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;action</span> <span class="hl-attribute">type</span>=<span class="hl-value">"A_FlowStepAction"</span> <span class="hl-attribute">somekey</span>=<span class="hl-value">"somevalue"</span><span class="hl-tag">&gt;</span>
        </pre><p>
        If the <code class="sgmltag-attribute">type</code> attribute is not 
        <code class="literal">jumpto</code>, the value is interpreted as a 
        class of type 
        <code class="classname">de.schlund.pfixcore.workflow.FlowStepAction</code>. 
        There can be an arbitrary number of additional 
        attributes (<code class="literal">somekey</code> in this example) which are 
        supplied as named parameters to the special 
        <code class="classname">FlowStepAction</code>.
        </p><pre class="programlisting">
            <span class="hl-tag">&lt;/action&gt;</span>
          <span class="hl-tag">&lt;/when&gt;</span>
        <span class="hl-tag">&lt;/oncontinue&gt;</span>
      <span class="hl-tag">&lt;/flowstep&gt;</span>
    <span class="hl-tag">&lt;/pageflow&gt;</span>
    
    <span class="hl-tag">&lt;pagerequest</span> <span class="hl-attribute">name</span>=<span class="hl-value">"APageName"</span> <span class="hl-attribute">copyfrom</span>=<span class="hl-value">"APageName"</span><span class="hl-tag">&gt;</span>
        </pre><p>
        </p><div class="informaltable"><table rules="all" frame="box"><thead align="left"><tr>
              <th>Attribute</th>
              <th>Description</th>
            </tr></thead><tbody><tr>
              <td><code class="literal">name</code></td>
              <td><span class="emphasis"><em>Mandatory</em></span>. It must be the name of 
              a page defined in the corresponding depend.xml file.</td>
            </tr><tr>
              <td><code class="literal">copyfrom</code></td>
              <td>Optional. If given, and set to the name of a valid 
              <code class="sgmltag-element">pagerequest</code>, all configuration from this 
              referenced <code class="sgmltag-element">pagerequest</code> are used for the current 
              page, disregarding all configuration that is made in this 
              <code class="sgmltag-element">pagerequest</code>. It's a plain and simple copy, no 
              extending, no restricting!</td>
            </tr></tbody></table></div><p>
        </p><pre class="programlisting">
      <span class="hl-tag">&lt;defaultflow</span> <span class="hl-attribute">flow</span>=<span class="hl-value">"FlowName"</span><span class="hl-tag">/&gt;</span>
        </pre><p>
        This node is optional. If a page is part of multiple pageflows,
        here you can set the default pageflow, which should be chosen
        if no other pageflow is specified.
        </p><pre class="programlisting">
      <span class="hl-tag">&lt;force-ssl&gt;</span>true|false<span class="hl-tag">&lt;/force-ssl&gt;</span>
        </pre><p>
        The node is optional. If given, and the content is set to
        <code class="literal">true</code>, the page will only run under SSL when 
        jumped to via a link or a submit of form data. If the session 
        currently does not run under SSL, the system will make sure to 
        redirect to a secure session prior to handling the request. 
        After a session is running under SSL, there is no way back 
        (so all other pages will run securely regardless if they have 
        a <code class="sgmltag-element">ssl</code> node or not).
        You can wrap this tag within a customization element to force 
        use of SSL only in certain modes (e.g. <code class="literal">prod</code> 
        mode).
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can force the servlet as a whole to run only under 
          SSL by specifying the ssl subnode of the servletinfo 
          node.</p></td></tr></table></div><p>
        </p><pre class="programlisting">
  <span class="hl-tag">&lt;state</span> <span class="hl-attribute">class</span>=<span class="hl-value">"AClassName"</span><span class="hl-tag">/&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- Alternative usage forms:
    &lt;state class="..." bean-name="..." scope="..."/&gt;
    &lt;state class="..." parent-bean-ref="..."/&gt;
    &lt;state bean-ref="..."/&gt; 
  --&gt;</em>
        </pre><p>
        The whole node is optional. If given, the 
        <code class="sgmltag-attribute">class</code> attribute must  be the name 
        of a java class implementing the 
        <code class="classname">de.schlund.pfixcore.workflow.ConfigurableState</code> 
        interface. The used <code class="classname">State</code> is determined 
        as follows:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>If state is given, use the value of it's 
            <code class="sgmltag-attribute">class</code> attribute. When no scope attribute is present, singleton-scope
            is used by default.</p></li><li class="listitem"><p>If the pagerequest has an <code class="sgmltag-element">input</code> child, use 
            the value of the <code class="sgmltag-attribute">class</code> 
            attribute of the <code class="sgmltag-element">defaultihandlerstate</code> tag 
            explained above if it is given. If this is not given, just 
            use <code class="classname">de.schlund.pfixcore.workflow.app.DefaultIWrapperState</code>.
            Else:</p></li><li class="listitem"><p>use the value of the <code class="sgmltag-attribute">class</code> 
            attribute of the <code class="sgmltag-element">defaultstate</code> tag explained above 
            if it is given. If this is not given, just use 
            <code class="classname">de.schlund.pfixcore.workflow.app.StaticState</code>.</p></li></ol></div><p>
        You can use the <code class="sgmltag-attribute">scope</code> attribute to specify
        the scope in which the Spring bean created for this page will be 
        instantiated. You may specify the <code class="sgmltag-attribute">bean-name</code>
        attribute to use a fixed name for the automatically created bean.
        You can use any BSF-supported scripting language for writing 
        your State-implementation, too. Use <code class="literal">script:path/to/script</code>
        for the <code class="sgmltag-attribute">class</code> attribute.
        Alternatively you can use an existing Spring bean that implements the 
        <code class="interfacename">de.schlund.workflow.State</code> interface. Use
        the <code class="sgmltag-attribute">bean-ref</code> attribute to specify the
        name of the bean. However the <code class="sgmltag-element">pagerequest</code> may not contain
        any configuration if you are using a Spring bean.
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
          If you're referencing a custom Spring bean using <code class="literal">bean-ref</code>,
          Pustefix can't automatically inject the configuration. So if you're bean is extending
          the <code class="literal">DefaultIWrapperState</code> or <code class="literal">StaticState</code> it
          might not work as you expected (or not at all) due to the lack of configuration.
          </p><p>
	  That's why Pustefix supports the referencing of parent bean definitions using the <code class="literal">parent-bean-ref</code>
	attribute. Thus it's possible to indirectly inject dependencies 
	into the concrete instances by injecting them into the parent bean 
	definition. So, despite the fact, that the beans are automatically 
	created by Pustefix, you're able to inject your own dependencies using
	the Spring XML configuration.
          </p></td></tr></table></div><p>
        </p><pre class="programlisting">
      <span class="hl-tag">&lt;input</span> <span class="hl-attribute">policy</span>=<span class="hl-value">"ANY|ALL|NONE"</span><span class="hl-tag">&gt;</span>
        </pre><p>
        The whole node is optional. It may only be given for a 
        <code class="classname">State</code> that is either 
        <code class="classname">de.schlund.pfixcore.workflow.app.DefaultIWrapperState</code> 
        or a descendent of it!
        <code class="sgmltag-attribute">policy</code> is optional (default is 
        <code class="literal">ANY</code>). The policy decides when a whole page is 
        considered to be accessible:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ANY: just one of the associated handlers needs to be 
            active for the page to be accessible.</p></li><li class="listitem"><p> ALL: all the associated handlers must be active for 
            the page to be accessible.</p></li><li class="listitem"><p> NONE: none of the associated handlers needs to be 
            active for the page to be accessible.</p></li></ul></div><p>
        If one of the associated handlers returns 
        <code class="literal">false</code> on calling 
        <code class="methodname">prerequisitesMet()</code>, the page is of 
        course still inaccessible.
        </p><pre class="programlisting">
        <span class="hl-tag">&lt;wrapper</span> <span class="hl-attribute">prefix</span>=<span class="hl-value">"AName"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"AClassName"</span> <span class="hl-attribute">checkactive</span>=<span class="hl-value">"true|false"</span> <span class="hl-attribute">tenant</span>=<span class="hl-value">"aTenant"</span><span class="hl-tag">/&gt;</span>
        </pre><p>
        </p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="images/docbkx/caution.png"></td><th align="left">Caution</th></tr><tr><td align="left" valign="top"><p>
              Note: The tag name <code class="literal">wrapper</code> can also be called <code class="literal">interface</code> with the same
              allowed attributes for backwards compatibility reasons. This ambiguity may be removed in some future version.
          </p></td></tr></table></div><p>
        There can be many <code class="sgmltag-element">wrapper</code> nodes for a page. Each 
        one references an "atomic" functional entity consisting of an 
        <code class="classname">IWrapper</code> java class (usually 
        autogenerated from a <code class="literal">.iwrp</code> xml file that defines the type and names of the parameters passed 
        between the UI and the functional entity and an associated 
        <code class="classname">IHandler</code> java class that uses the 
        <code class="classname">IWrapper</code> to retrieve the passed 
        parameters via typed getter methods.
        There may be an optional <code class="sgmltag-attribute">scope</code>
        attribute, which specifies the scope in which the handler
        associated with the wrapper will be instantiated.
        
        </p><div class="informaltable"><table rules="all" frame="box"><thead align="left"><tr>
              <th>Attribute</th>
              <th>Description</th>
            </tr></thead><tbody><tr>
              <td><code class="literal">prefix</code></td>
              <td><span class="emphasis"><em>Mandatory</em></span>. The prefix defines a 
              name for the <code class="classname">IWrapper</code> and in effect 
              a namespace for the <code class="classname">IWrapper</code>'s 
              parameters. If the prefix "<code class="literal">bar</code>" is 
              defined for an <code class="classname">IWrapper</code> that 
              contains a parameter called "<code class="literal">Foo</code>", the 
              submitted HTTP parameter must be called 
              <code class="literal">bar.Foo</code>.</td>
            </tr><tr>
              <td><code class="literal">class</code></td>
              <td><span class="emphasis"><em>Mandatory</em></span>. Must be the name of a 
              java class implementing 
              <code class="classname">de.schlund.pfixcore.generator.IWrapper</code>. 
              This implicitly defines a 
              <code class="classname">de.schlund.pfixcore.generator.IHandler</code>, 
              as every <code class="classname">IWrapper</code> knows it's 
              associated <code class="classname">IHandler</code> and can be 
              queried for it.</td>
            </tr><tr>
              <td><code class="literal">checkactive</code></td>
              <td>Optional, default is <code class="literal">true</code>. The 
              <code class="classname">IHandler</code> method 
              <code class="methodname">isActive()</code> is 
              <span class="emphasis"><em>NOT</em></span> called on handlers with 
              <code class="sgmltag-attribute">checkactive</code> set to 
              <code class="literal">false</code>. In other words: the handler is 
              ignored when the system tries to find out if the page is 
              accessible or not. See also the comment for the 
              <code class="sgmltag-attribute">policy</code> attribute above.
              <div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="images/docbkx/caution.png"></td><th align="left">Caution</th></tr><tr><td align="left" valign="top"><p>Replaces the <code class="sgmltag-attribute">activeignore</code> attribute since
                version 0.13.1. You should be aware that setting <code class="sgmltag-attribute">activeignore</code>
		to <code class="literal">true</code> now complies with setting <code class="sgmltag-attribute">checkactive</code>
                to <code class="literal">false</code>. Support for the <code class="sgmltag-attribute">activeignore</code>
                attribute will be removed in future versions.
                </p></td></tr></table></div>
              </td>
            </tr><tr>
              <td><code class="literal">tenant</code></td>
              <td>Optional. Can be used to specify IWrappers for a certain tenant only.</td> 
            </tr></tbody></table></div><p>
        </p><pre class="programlisting">
      <span class="hl-tag">&lt;/input&gt;</span>
        </pre><p>
        </p><pre class="programlisting">
      <span class="hl-tag">&lt;process&gt;</span>
        </pre><p>
        The process node holds a list of actions, which can be referenced from
        the UI when submitting forms or using GET requests to transmitt data.
        These actions group IWrappers into two groups: those that should have
        their handleSubmittedData() method called, and those that should have
        their retrieveCurrentStatus() method called when a submit has been handled
        sucessfully (and the same page is redisplayed).
        
        The idea beind the latter is, that sometimes you want to update
        the submitted form data to some canonical form (e.g. adresses or similar), so you
        don't want to see the exact same input in the form elements as you have submitted it,
        but some changed values. In other cases, submitting data to one wrapper may change the
        values of the form elements of another wrapper - in this case the second wrapper
        needs to be listed under the &lt;retrieve&gt; node.
        </p><pre class="programlisting">
        <span class="hl-tag">&lt;action</span> <span class="hl-attribute">name</span>=<span class="hl-value">"a_name"</span><span class="hl-tag">&gt;</span>
          <span class="hl-tag">&lt;submit&gt;</span>
            <span class="hl-tag">&lt;wrapper</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"a_prefix_1"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;wrapper</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"a_prefix_2"</span><span class="hl-tag">/&gt;</span>
            ...
          <span class="hl-tag">&lt;/submit&gt;</span>
          <span class="hl-tag">&lt;retrieve&gt;</span>
            <span class="hl-tag">&lt;wrapper</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"a_prefix_1"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;wrapper</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"a_prefix_X"</span><span class="hl-tag">/&gt;</span>
            ...
          <span class="hl-tag">&lt;/retrieve&gt;</span>
        <span class="hl-tag">&lt;/action&gt;</span>
        <span class="hl-tag">&lt;action</span> <span class="hl-attribute">name</span>=<span class="hl-value">"another_name"</span><span class="hl-tag">&gt;</span>
        ...
        <span class="hl-tag">&lt;/action&gt;</span>
      <span class="hl-tag">&lt;/process&gt;</span>
      
      <span class="hl-tag">&lt;output&gt;</span>
        </pre><p>
        The whole node is optional. Every page using a 
        <code class="classname">State</code> that is itself or a descendant of 
        <code class="classname">de.schlund.pfixcore.workflow.app.StaticState</code> 
        can use this.
        You can have as many <code class="sgmltag-element">resource</code> childnodes as you like.
        </p><pre class="programlisting">
        <span class="hl-tag">&lt;resource</span> <span class="hl-attribute">node</span>=<span class="hl-value">"AName"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"AClassName"</span><span class="hl-tag">/&gt;</span>
        </pre><p>
        </p><div class="informaltable"><table rules="all" frame="box"><thead align="left"><tr>
              <th>Attribute</th>
              <th>Description</th>
            </tr></thead><tbody><tr>
              <td><code class="literal">class</code></td>
              <td><span class="emphasis"><em>Mandatory (if <code class="literal">bean-ref</code> is not present)</em></span>. 
              <code class="sgmltag-attribute">class</code> is one of the 
              <code class="classname">ContextResources</code> defined via 
              implements above.</td>
            </tr><tr>
              <td><code class="literal">bean-ref</code></td>
              <td><span class="emphasis"><em>Mandatory (if <code class="literal">class</code> is not present)</em></span>. 
              Specifies the bean name of the resource that should be
              included in the output tree.</td>
            </tr><tr>
              <td><code class="literal">node</code></td>
              <td><span class="emphasis"><em>Mandatory</em></span>. 
              <code class="sgmltag-attribute">node</code> is the node in the 
              output tree ("<code class="literal">/formresult/AName</code>") under 
              which the <code class="classname">ContextResource</code> inserts 
              it's data.</td>
            </tr></tbody></table></div><p>
        </p><pre class="programlisting">
      <span class="hl-tag">&lt;/output&gt;</span>
      
      <span class="hl-tag">&lt;properties&gt;</span>
        </pre><p>
        The whole node is optional.
        </p><pre class="programlisting">
        <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">name</span>=<span class="hl-value">"APropertyKey"</span><span class="hl-tag">&gt;</span>AValue<span class="hl-tag">&lt;/prop&gt;</span>
        </pre><p>
        The node is mandatory and can be used multiple times. It will be 
        transformed into a java property that is associated to the page.
        There are some props that are already defined for 
        <code class="classname">de.schlund.pfixcore.workflow.app.StaticState</code> 
        and descendants. These are listed below
        </p><div class="informaltable"><table rules="all" frame="box"><thead align="left"><tr>
              <th>Property Name</th>
              <th>Property Value</th>
              <th>Description</th>
            </tr></thead><tbody><tr>
              <td><code class="literal">mimetype</code></td>
              <td>e.g. <code class="literal">text/css</code></td>
              <td> If given, sets the mimetype of the HttpResponse 
              object to something else than the default 
              <code class="literal">text/html</code>. This is most often used for 
              <code class="literal">text/css</code>.</td>
            </tr><tr>
              <td><code class="literal">responseheader.A_HEADER</code></td>
              <td><code class="literal">A_VALUE</code></td>
              <td>If given, set the header <code class="literal">A_HEADER</code> 
              of the HttpResponse object to <code class="literal">A_VALUE</code>.
              NOTE: the Pustefix system uses a set of default headers 
              that are only used, when no user defined headers are 
              given! The set of default headers is:
              <code class="code">Expires=Mon, 26 Jul 1997 05:00:00 GMT
  Cache-Control=private</code>
              If you want to use some of them in addition to your own 
              headers, you must manually supply them, too. </td>
            </tr></tbody></table></div><p>
        </p><pre class="programlisting">
      <span class="hl-tag">&lt;/properties&gt;</span>
    <span class="hl-tag">&lt;/pagerequest&gt;</span>
    
    <span class="hl-tag">&lt;config-include</span> <span class="hl-attribute">file</span>=<span class="hl-value">"conf/myfile.xml"</span> <span class="hl-attribute">section</span>=<span class="hl-value">"pagerequests"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"mymodule"</span><span class="hl-tag">/&gt;</span>
        </pre><p>
        Includes a part of a config fragments file at this location.
        See <a class="xref" href="#configuration.format.fragments" title="4.3.8.&nbsp;Configuration Fragments">Section&nbsp;4.3.8, &#8220;Configuration Fragments&#8221;</a> for details on how
        to define config fragments.
        </p><div class="informaltable"><table rules="all" frame="box"><thead align="left"><tr>
              <th>Attribute</th>
              <th>Description</th>
            </tr></thead><tbody><tr>
              <td><code class="literal">file</code></td>
              <td><span class="emphasis"><em>Mandatory</em></span>. Path to the file that 
              contains the tags to be included (relative to docroot). </td>
            </tr><tr>
              <td><code class="literal">section</code></td>
              <td><span class="emphasis"><em>Optional</em></span>. 
              Type of the section that shall be included. If more than 
              one section of the specified type exists in the file, the 
              content of all this sections is included.</td>
            </tr><tr>
              <td><code class="literal">refid</code></td>
              <td><span class="emphasis"><em>Optional</em></span>. 
              Include a section identified by the specified id. The 
              refid specified here must match the id attribute of 
              exactly one section in the specified file.</td>
            </tr><tr>
              <td><code class="literal">xpath</code></td>
              <td><span class="emphasis"><em>Optional</em></span>. 
              A XPath expression specifying the node-set to be included. 
              The prefixes to be used for XML namespaces are "fr" for 
              the namespace of the 
              <a class="link" href="#configuration.format.fragments" title="4.3.8.&nbsp;Configuration Fragments">fragments file</a> 
              tags and "pr" for the namespace of the 
              <code class="classname">ContextXMLServlet</code> configuration 
              tags.</td>
            </tr><tr>
              <td><code class="literal">module</code></td>
              <td><span class="emphasis"><em>Optional</em></span>.
              Specifies the Pustefix module where the file is located (by default
              the file is searched in the webapp itself). You can use simple name patterns to include all 
              or a subset of modules availabe in the classpath (e.g. <code class="literal">"*"</code> or <code class="literal">"mod-*-us"</code>).</td>
            </tr></tbody></table></div><p>
        <span class="emphasis"><em>One and only one</em></span> of the section, refid or 
        xpath attribute has to be specified for each config-include.
        </p><pre class="programlisting">
    <span class="hl-tag">&lt;properties&gt;</span>
      <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AProperty"</span><span class="hl-tag">&gt;</span>AValue<span class="hl-tag">&lt;/prop&gt;</span>
        </pre><p>
        </p><div class="informaltable"><table rules="all" frame="box"><thead align="left"><tr>
              <th>Property Name</th>
              <th>Property Value</th>
              <th>Description</th>
            </tr></thead><tbody><tr>
              <td><code class="literal">mimetype</code></td>
              <td>e.g. <code class="literal">text/css</code></td>
              <td> If given, sets the mimetype of the HttpResponse 
              object to something else than the default 
              <code class="literal">text/html</code>. This is most often used for 
              <code class="literal">text/css</code>.</td>
            </tr><tr>
              <td><code class="literal">responseheader.A_HEADER</code></td>
              <td><code class="literal">A_VALUE</code></td>
              <td>If given, set the header <code class="literal">A_HEADER</code> 
              of the HttpResponse object to <code class="literal">A_VALUE</code>.
              Headers set here can be overwritten for specific pages.
              NOTE: the Pustefix system uses a set of default headers 
              that are only used, when no user defined headers are 
              given! The set of default headers is:
              <code class="code">Expires=Mon, 26 Jul 1997 05:00:00 GMT
  Cache-Control=private</code>
              If you want to use some of them in addition to your own 
              headers, you must manually supply them, too. </td>
            </tr></tbody></table></div><p>
         You can also specify properties here that are understood by the 
         <code class="classname">AbstractPustefixRequestHandler</code> and
         <code class="classname">AbstractPustefixXMLRequestHandler</code> classes.
        </p><pre class="programlisting">
    <span class="hl-tag">&lt;/properties&gt;</span>
  <span class="hl-tag">&lt;/context-xml-service-config&gt;</span>
        </pre><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration.servlet.directoutput"></a>4.3.6.&nbsp;DirectOutputService configuration file</h3></div></div></div><p>
        Occasionally you don't want to generate output with an XSLT 
        Transformation, but e.g. deliver binary content directly to the 
        output stream instead. In this case you can use the 
        DirectOutputService. The name of the
        configuration file can be arbitrarily chosen and is configured
        in the project configuration file.
      </p><p>
        The service knows about one or many 
        <code class="literal">directoutputpagerequests</code>. For the XML/XSLT 
        side of things, they look like normal pages (in fact, the value 
        of the <code class="literal">directoutputpagerequest</code>'s name 
        attribute must be a page defined in the <code class="sgmltag-element">navigation</code>
        section of <code class="filename">depened.xml</code>. Of course, no target 
        definition has to be given, only the page in the navigation 
        structure must exist). But other than the usual 
        <code class="literal">pagerequest</code>, a 
        <code class="literal">directoutputpagerequest</code> has an associated 
        <code class="literal">directoutputstate</code> whose class attribute is a 
        java class implementing 
        <code class="classname">de.schlund.pfixcore.workflow.app.DirectOutputState</code>.
      </p><p>
        </p><pre class="programlisting">
  <span class="hl-tag">&lt;direct-output-service-config</span>
    <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://pustefix.sourceforge.net/2004/properties"</span><span class="hl-tag">
  &gt;</span>    
    <span class="hl-tag">&lt;global-config&gt;</span>
      <span class="hl-tag">&lt;force-ssl&gt;</span>false<span class="hl-tag">&lt;/force-ssl&gt;</span>
        </pre><p>
         See the comment for the <code class="sgmltag-element">global-config</code> node in
         <a class="xref" href="#configuration.servlet.contextxml" title="4.3.5.&nbsp;ContextXMLService configuration file">Section&nbsp;4.3.5, &#8220;ContextXMLService configuration file&#8221;</a>.
         </p><pre class="programlisting">
    <span class="hl-tag">&lt;/global-config&gt;</span>
    
    <span class="hl-tag">&lt;authconstraint</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"AN_AUTHCONSTRAINT"</span><span class="hl-tag">/&gt;</span>
         </pre><p>
         You can reference an authconstraint from the context configuration, which
         has to be fulfilled to access a page. This default authconstraint can be overridden
	 for single pages. If no default authconstraint is set here, the context's
         default authconstraint will be used. If no authconstraint is set at all, a
         page requires no authentication.
         </p><pre class="programlisting">
    <span class="hl-tag">&lt;config-include</span> <span class="hl-attribute">file</span>=<span class="hl-value">"conf/myfile.xml"</span> <span class="hl-attribute">section</span>=<span class="hl-value">"directoutputpagerequests"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"mymodule"</span><span class="hl-tag">/&gt;</span>
         </pre><p>
        Includes a part of a config-fragments at this location.
        See <a class="xref" href="#configuration.format.fragments" title="4.3.8.&nbsp;Configuration Fragments">Section&nbsp;4.3.8, &#8220;Configuration Fragments&#8221;</a> for details on how
        to define config fragments.
        </p><div class="informaltable"><table rules="all" frame="box"><thead align="left"><tr>
              <th>Attribute</th>
              <th>Description</th>
            </tr></thead><tbody><tr>
              <td><code class="literal">file</code></td>
              <td><span class="emphasis"><em>Mandatory</em></span>. Path to the file that 
              contains the tags to be included (relative to docroot). </td>
            </tr><tr>
              <td><code class="literal">section</code></td>
              <td><span class="emphasis"><em>Optional</em></span>. 
              Type of the section that shall be included. If more than 
              one section of the specified type exists in the file, the 
              content of all this sections is included. For a 
              <code class="classname">DirectOutputServlet</code> configuration
              only <code class="literal">directoutputpagerequests</code> and 
              <code class="literal">properties</code> are valid.</td>
            </tr><tr>
              <td><code class="literal">refid</code></td>
              <td><span class="emphasis"><em>Optional</em></span>. 
              Include a section identified by the specified id. The 
              refid specified here must match the id attribute of 
              exactly one section in the specified file.</td>
            </tr><tr>
              <td><code class="literal">xpath</code></td>
              <td><span class="emphasis"><em>Optional</em></span>. 
              A XPath expression specifying the node-set to be included. 
              The prefixes to be used for XML namespaces are "fr" for 
              the namespace of the fragments file tags and "d" for the 
              namespace of the <code class="classname">DirectOutputService</code> 
              configuration tags.</td>
            </tr><tr>
              <td><code class="literal">module</code></td>
              <td><span class="emphasis"><em>Optional</em></span>.
              Specifies the Pustefix module where the file is located (by default
              the file is searched in the webapp itself). You can use simple name patterns to include all 
              or a subset of modules availabe in the classpath (e.g. <code class="literal">"*"</code> or <code class="literal">"mod-*-us"</code>).</td>
            </tr></tbody></table></div><p>
        <span class="emphasis"><em>One and only one</em></span> of the section, refid or 
        xpath attribute has to be specified for each config-include.
        </p><pre class="programlisting">
    <span class="hl-tag">&lt;directoutputpagerequest</span> <span class="hl-attribute">name</span>=<span class="hl-value">"APageName"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;directoutputstate</span> <span class="hl-attribute">class</span>=<span class="hl-value">"AClassName"</span><span class="hl-tag">/&gt;</span>
        </pre><p>
        The class specified for the <code class="sgmltag-element">directoutputstate</code> must
        implement the 
        <code class="interfacename">de.schlund.pfixcore.workflow.DirectOutputState</code>
        interface. The tag may have an optional 
        <code class="sgmltag-attribute">scope</code> attribute which specifies the 
        scope in which the corresponding state should be instantiated.
        There may also be an optional <code class="sgmltag-attribute">bean-name</code>
        which, if present, will be used as the name of the Spring bean
        created for this direct output state. Instead of the 
        <code class="sgmltag-attribute">class</code> attribute, you may specify a
        <code class="sgmltag-attribute">bean-ref</code> attribute which has to 
        reference a Spring bean defined in the <code class="filename">spring.xml</code>
        file for this project. In this case, no Spring bean will be 
        created but the existing bean will be used instead.
        </p><pre class="programlisting">
      <span class="hl-tag">&lt;authconstraint</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"AN_AUTHCONSTRAINT"</span><span class="hl-tag">/&gt;</span>
        </pre><p>
        You can optionally reference an authconstraint from the context
        configuration to override the default authconstraint.
        </p><pre class="programlisting">
      <span class="hl-tag">&lt;properties&gt;</span>
        </pre><p>
        The whole <code class="sgmltag-element">properties</code> node is optional.
        </p><pre class="programlisting">
        <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">name</span>=<span class="hl-value">"APropertyKey"</span><span class="hl-tag">&gt;</span>AValue<span class="hl-tag">&lt;/prop&gt;</span>
        </pre><p>
        The node is mandatory and can be used multiple times. It will be 
        transformed into a java property that is associated to the page. 
        The java property that is constructed will look like this: 
        <code class="literal">pagerequest.APpageName.APropertyKey=AValue</code> 
        where <code class="literal">APageName</code> is the value of the 
        <code class="sgmltag-attribute">name</code> attribute.
        </p><pre class="programlisting">
      <span class="hl-tag">&lt;/properties&gt;</span>
    <span class="hl-tag">&lt;/directoutputpagerequest&gt;</span>
  <span class="hl-tag">&lt;/direct-output-service-config&gt;</span>
        </pre><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration.servlet.webservice"></a>4.3.7.&nbsp;WebServices</h3></div></div></div><p>
        The configuration of AJAX / webservices is described in the
        <a class="link" href="#advanced.ajax" title="7.7.&nbsp;AJAX services">corresponding section</a>.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration.format.fragments"></a>4.3.8.&nbsp;Configuration Fragments</h3></div></div></div><p>
        Configuration fragments files contain aggregated configuration 
        directives that are intended to be reused in different 
        configuration files.
      </p><p>
        </p><pre class="programlisting">
<span class="hl-tag">&lt;fr:config-fragments</span>
  <span class="hl-attribute">xmlns:fr</span>=<span class="hl-value">"http://pustefix.sourceforge.net/configfragments200609"</span>
  <span class="hl-attribute">xmlns:c</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/context-xml-service-config"</span>
  <span class="hl-attribute">xmlns:d</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/direct-output-service-config"</span>
  <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://pustefix.sourceforge.net/configfragments200609
                      http://pustefix.sourceforge.net/configfragments200609.xsd"</span><span class="hl-tag">&gt;</span>
  
  <span class="hl-tag">&lt;fr:navigation</span> <span class="hl-attribute">id</span>=<span class="hl-value">"nav1"</span><span class="hl-tag">&gt;</span>
      </pre><p>
      All sections have an <span class="emphasis"><em>optional</em></span> 
      <code class="sgmltag-attribute">id</code> that can be used to identifiy 
      the section when more than one section fo the same type is 
      present in one file. The value of the 
      <code class="sgmltag-attribute">id</code> attribute has to be unique
      within the whole file.
      </p><pre class="programlisting">
    <span class="hl-tag">&lt;page</span> <span class="hl-attribute">name</span>=<span class="hl-value">"MyPage"</span><span class="hl-tag">/&gt;</span>
      </pre><p>
      The structure here is the same as within the navigation tag of the 
      depend.xml file.
      
      </p><pre class="programlisting">
  <span class="hl-tag">&lt;/fr:navigation&gt;</span>
  <span class="hl-tag">&lt;fr:targets&gt;</span>
    <span class="hl-tag">&lt;standardpage</span> <span class="hl-attribute">name</span>=<span class="hl-value">"MyPage"</span> <span class="hl-attribute">xml</span>=<span class="hl-value">"xml/mymaster.xml"</span><span class="hl-tag">/&gt;</span>
      </pre><p>
      The tags allowed here are the same that are allowed for 
      standardpage or target definitions in the depend.xml file.
      
      </p><pre class="programlisting">
  <span class="hl-tag">&lt;/fr:targets&gt;</span>
  <span class="hl-tag">&lt;fr:resources&gt;</span>
    <span class="hl-tag">&lt;c:resource</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.MyResourceImpl"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;pr:implements</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.MyResource"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/c:resource&gt;</span>
      </pre><p>
      The tags allowed here are the same that are allowed for the 
      definition of context resources within the <code class="sgmltag-element">context</code> 
      tag of the <a class="link" href="#configuration.servlet.contextxml" title="4.3.5.&nbsp;ContextXMLService configuration file">ContextXMLServlet configuration</a>.
      </p><pre class="programlisting">
  <span class="hl-tag">&lt;/fr:resources&gt;</span>
  <span class="hl-tag">&lt;fr:interceptors&gt;</span>
    <span class="hl-tag">&lt;c:interceptor</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.MyInterceptor"</span><span class="hl-tag">/&gt;</span>
      </pre><p>
      The tags allowed here are the same that are allowed within the 
      <code class="sgmltag-element">start</code>, <code class="sgmltag-element">end</code> and <code class="sgmltag-element">postrender</code> interceptor tags 
      of the <a class="link" href="#configuration.servlet.contextxml" title="4.3.5.&nbsp;ContextXMLService configuration file">ContextXMLServlet configuration</a>
      (for details also see <a class="xref" href="#concepts.interceptors" title="6.6.&nbsp;ContextInterceptors">Section&nbsp;6.6, &#8220;ContextInterceptors&#8221;</a>).
      </p><pre class="programlisting">
  <span class="hl-tag">&lt;/c:interceptors&gt;</span>
  <span class="hl-tag">&lt;fr:scriptedflows&gt;</span>
    <span class="hl-tag">&lt;c:scriptedflow</span> <span class="hl-attribute">name</span>=<span class="hl-value">"myscript"</span> <span class="hl-attribute">file</span>=<span class="hl-value">"myproject/conf/scriptedflows/myscript.script.xml"</span><span class="hl-tag">/&gt;</span>
      </pre><p>
      The tags allowed here are the same that are allowed within the 
      <code class="sgmltag-element">scriptedflows</code> tag of the 
      <a class="link" href="#configuration.servlet.contextxml" title="4.3.5.&nbsp;ContextXMLService configuration file">ContextXMLServlet configuration</a>.
      </p><pre class="programlisting">
  <span class="hl-tag">&lt;/fr:scriptedflows&gt;</span>
  <span class="hl-tag">&lt;fr:roles&gt;</span>
    <span class="hl-tag">&lt;c:role</span> <span class="hl-attribute">name</span>=<span class="hl-value">"MY_ROLE"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;c:pageaccess</span> <span class="hl-attribute">names</span>=<span class="hl-value">"mypage*"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/c:role&gt;</span>
      </pre><p>
      The tags allowed here are the same that are used for role 
      definition in the
      <a class="link" href="#configuration.servlet.contextxml" title="4.3.5.&nbsp;ContextXMLService configuration file">ContextXMLServlet configuration</a>.
      </p><pre class="programlisting">
  <span class="hl-tag">&lt;/fr:roles&gt;</span>
  <span class="hl-tag">&lt;fr:pageflows&gt;</span>
    <span class="hl-tag">&lt;c:pageflow</span> <span class="hl-attribute">name</span>=<span class="hl-value">"MyFlow"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;c:flowstep</span> <span class="hl-attribute">name</span>=<span class="hl-value">"MyFirstPage"</span><span class="hl-tag">/&gt;</span>
      <span class="hl-tag">&lt;c:flowstep</span> <span class="hl-attribute">name</span>=<span class="hl-value">"MySecondPage"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/c:pageflow&gt;</span>
      </pre><p>
      The tags allowed here are the same that are used for the 
      definition of pageflows in the
      <a class="link" href="#configuration.servlet.contextxml" title="4.3.5.&nbsp;ContextXMLService configuration file">ContextXMLServlet configuration</a>.
      </p><pre class="programlisting">
  <span class="hl-tag">&lt;/fr:pageflows&gt;</span>
  <span class="hl-tag">&lt;fr:pagerequests&gt;</span>
    <span class="hl-tag">&lt;c:pagerequest</span> <span class="hl-attribute">name</span>=<span class="hl-value">"MyPage"</span><span class="hl-tag">/&gt;</span>
      </pre><p>
      The tags allowed here are the same that are used for the 
      definition of pagerequets in the
      <a class="link" href="#configuration.servlet.contextxml" title="4.3.5.&nbsp;ContextXMLService configuration file">ContextXMLServlet configuration</a>.
      </p><pre class="programlisting">
  <span class="hl-tag">&lt;/fr:pagerequests&gt;</span>
  <span class="hl-tag">&lt;fr:properties&gt;</span>
    <span class="hl-tag">&lt;pr:prop</span> <span class="hl-attribute">name</span>=<span class="hl-value">"myproperty"</span><span class="hl-tag">&gt;</span>myvalue<span class="hl-tag">&lt;/pr:prop&gt;</span>
      </pre><p>
      The tags allowed here are the same that are allowed within the 
      <code class="sgmltag-element">properties</code> tag of the 
      <a class="link" href="#configuration.servlet.contextxml" title="4.3.5.&nbsp;ContextXMLService configuration file">ContextXMLServlet configuration</a>.
      </p><pre class="programlisting">
  <span class="hl-tag">&lt;/fr:properties&gt;</span>
  <span class="hl-tag">&lt;fr:directoutputpagerequests&gt;</span>
    <span class="hl-tag">&lt;d:directoutputpagerequest</span> <span class="hl-attribute">name</span>=<span class="hl-value">"foo"</span><span class="hl-tag">&gt;</span>...<span class="hl-tag">&lt;/d:directoutputpagerequest&gt;</span>
      </pre><p>
      Direct output pagerequests can be defined here. See 
      <a class="xref" href="#configuration.servlet.directoutput" title="4.3.6.&nbsp;DirectOutputService configuration file">Section&nbsp;4.3.6, &#8220;DirectOutputService configuration file&#8221;</a> for details 
      on this.
      </p><pre class="programlisting">
  <span class="hl-tag">&lt;/fr:directoutputpagerequests&gt;</span>
<span class="hl-tag">&lt;/fr:config-fragments&gt;</span>
        </pre><p>
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuration.spring"></a>4.4.&nbsp;Spring configuration and customization</h2></div></div></div><p>
      Pustefix is based on Spring MVC and uses its DispatcherServlet to bootstrap the ApplicationContext on webapp startup. It configures its own ApplicationContext implementation by passing the <code class="literal">PustefixWebApplicationContext</code> class as <code class="literal">contextClass</code> init parameter in the webapp's <code class="literal">web.xml</code> configuration file.
    </p><p>
      The configuration file locations are passed to the DispatcherServlet using the standard <code class="literal">contextConfigLocation</code> init parameter. By default Pustefix passes the Pustefix configuration file <code class="literal">WEB-INF/project.xml</code> and, if exisiting, the file <code class="literal">WEB-INF/spring.xml</code>, which is intended to contain a standard Spring XML bean configuration. 
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration.spring.custom"></a>4.4.1.&nbsp;Customizing the Spring configuration</h3></div></div></div><p>
        Spring supports the externalization of property values from Spring XML configuration files into separate standard Java property files. Pustefix extends this mechanism by adding support for the Pustefix XML property file format, which let's you use the <code class="literal">choose/when</code>-customization known from other Pustefix configuration files, like <code class="literal">factory.xml</code>, for Spring properties too.
      </p><p>
        Therefor Pustefix by default registers a Spring <code class="literal">PropertyPlaceholderConfigurer</code>, which looks for a Pustefix XML property file under <code class="literal">WEB-INF/spring-properties.xml</code> and a <code class="literal">PropertyOverrideConfigurer</code>, which looks under <code class="literal">WEB-INF/spring-properties-override.xml</code>.
      </p><p>
        The following example shows the two ways you can externalize property values:
      </p><pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span><span class="hl-tag">&gt;</span>

  <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"mybean1"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"mypackage.MyBeanClass"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"text"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${default.text}"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/bean&gt;</span>

  <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"mybean2"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"mypackage.MyBeanClass"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"text"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"This is the default text"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span>
</pre><p>
        The first bean uses a property placeholder, the second bean already supplies a default value, which should be overwritten by an externalized value.
      </p><p>
        The following <code class="literal">spring-properties.xml</code> file configures the value for the first bean using the Pustefix customization mechanism to provide a mode-dependent value for the property placeholder:
      </p><pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;properties</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/properties-config"</span> 
            <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
            <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/properties-config 
                                http://www.pustefix-framework.org/schema/properties-config.xsd"</span><span class="hl-tag">&gt;</span>    
    <span class="hl-tag">&lt;choose&gt;</span>
      <span class="hl-tag">&lt;when</span> <span class="hl-attribute">test</span>=<span class="hl-value">"$mode='prod'"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"default.text"</span><span class="hl-tag">&gt;</span>I'm in production mode<span class="hl-tag">&lt;/property&gt;</span>
      <span class="hl-tag">&lt;/when&gt;</span>
      <span class="hl-tag">&lt;otherwise&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"default.text"</span><span class="hl-tag">&gt;</span>I'm in development mode<span class="hl-tag">&lt;/property&gt;</span>
      <span class="hl-tag">&lt;/otherwise&gt;</span>
    <span class="hl-tag">&lt;/choose&gt;</span>

<span class="hl-tag">&lt;/properties&gt;</span>
</pre><p>
        The following <code class="literal">spring-properties-override.xml</code> file overrides the value for the second bean by using the format <code class="literal">beanName.property</code> as property name. It also shows how you can use the available environment properties (like <code class="literal">fqdn</code> or <code class="literal">mode</code>) within a property value:
      </p><pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;properties</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/properties-config"</span> 
            <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
            <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/properties-config 
                                http://www.pustefix-framework.org/schema/properties-config.xsd"</span><span class="hl-tag">&gt;</span>
    
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mybean2.text"</span><span class="hl-tag">&gt;</span>I'm in ${mode} mode<span class="hl-tag">&lt;/property&gt;</span>

<span class="hl-tag">&lt;/properties&gt;</span>
</pre><p>
      If you want to register your own <code class="literal">PropertyPlaceholderConfigurer</code> or <code class="literal">PropertyOverrideConfigurer</code> capable of the Pustefix XML property format, e.g. for tests or child ApplicationContexts, you can do so by creating a <code class="literal">PustefixPropertiesPersister</code> bean and referencing it from the configurer's <code class="literal">propertiesPersister</code> property.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration.spring.envprops"></a>4.4.2.&nbsp;Environment-dependent Spring property files</h3></div></div></div><p>
        Pustefix provides a special <code class="literal">PropertyPlaceholderConfigurer</code> implementation which can be used to organize properties in own files for each environment, e.g. based on the <code class="literal">mode</code> value. You can enable it by adding an according bean definition to the Spring configuration.
      </p><pre class="programlisting">
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"propConfig"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.pustefixframework.container.spring.util.EnvironmentPropertyPlaceholderConfigurer"</span><span class="hl-tag">/&gt;</span>
</pre><p>
        By default properties will be loaded from <code class="literal">WEB-INF/spring.properties</code> and <code class="literal">WEB-INF/spring-[MODE].properties</code>, whereas <code class="literal">[MODE]</code> will be replaced by the current value of the according context init parameter and mode specific properties will override the general ones.
      </p><p>Here's an example of a more complex non-default configuration, where properties are loaded from multiple locations using multiple context init parameters as discriminator:</p><pre class="programlisting">
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"propConfig"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.pustefixframework.container.spring.util.EnvironmentPropertyPlaceholderConfigurer"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- optional property, default: WEB-INF/spring.properties --&gt;</em>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"locations"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;list&gt;</span>
      <span class="hl-tag">&lt;value&gt;</span>classpath*:spring.properties<span class="hl-tag">&lt;/value&gt;</span>
      <span class="hl-tag">&lt;value&gt;</span>WEB-INF/spring.properties<span class="hl-tag">&lt;/value&gt;</span>
    <span class="hl-tag">&lt;/list&gt;</span>    
  <span class="hl-tag">&lt;/property&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- optional property, default: mode --&gt;</em>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"parameters"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;list&gt;</span>
      <span class="hl-tag">&lt;value&gt;</span>mode<span class="hl-tag">&lt;/value&gt;</span>
      <span class="hl-tag">&lt;value&gt;</span>locale<span class="hl-tag">&lt;/value&gt;</span>
    <span class="hl-tag">&lt;/list&gt;</span>
  <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>
</pre><p>If the <code class="literal">mode</code> param value will be <code class="literal">test</code> and <code class="literal">locale</code> will be set to <code class="literal">en_US</code>, the properties will be loaded from the following locations (same properties in files loaded later will override already read properties, i.e. have higher precedence).
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">classpath*:spring.properties</li><li class="listitem">classpath*:spring-en_US.properties</li><li class="listitem">classpath*:spring-test.properties</li><li class="listitem">classpath*:spring-test-en_US.properties</li><li class="listitem">WEB-INF/spring.properties</li><li class="listitem">WEB-INF/spring-en_US.properties</li><li class="listitem">WEB-INF/spring-test.properties</li><li class="listitem">WEB-INF/spring-test-en_US.properties</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration.spring.profiles"></a>4.4.3.&nbsp;Environment-dependent Spring profiles</h3></div></div></div><p>
          Pustefix by default activates a Spring profile for the current execution environment mode (using the mode name as profile name).
          Thus you can easily use bean definition profiles or <code class="literal">@Profile</code> Java configuration without having to take care of the profile activation.
       </p><pre class="programlisting">
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span><span class="hl-tag">&gt;</span>
   
   <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mybean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"mypackage.MyBean"</span><span class="hl-tag">/&gt;</span>

   <span class="hl-tag">&lt;beans</span> <span class="hl-attribute">profile</span>=<span class="hl-value">"prod"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mybean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"mypackage.MyBeanAlternative"</span><span class="hl-tag">/&gt;</span>
   <span class="hl-tag">&lt;/beans&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span>
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration.spring.beannames"></a>4.4.4.&nbsp;Reserved Spring bean names</h3></div></div></div><p>
        Some Spring beans created by the core framework are intended for usage by the application, i.e. are registered with fixed/reserved bean names, which can be referred to inject them into application beans. The following table shows those beans with their associated names and aliases. 
      </p><p>
      </p><div class="table"><a name="d0e2580"></a><p class="title"><b>Table&nbsp;4.4.&nbsp;Reserved Spring bean names</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
            <th>Name</th>
            <th>Alias</th>
            <th>Scope</th>
            <th>Description</th>
          </tr></thead><tbody><tr>
            <td>de.schlund.pfixcore.workflow.Context</td>
            <td>pustefixContext</td>
            <td>Session</td>
            <td>The context facade providing access to request-/session-state and configuration.</td>
          </tr><tr>
            <td>de.schlund.pfixxml.TenantInfo</td>
            <td>pustefixTenantInfo</td>
            <td>Singleton</td>
            <td>Bean providing the list of available tenants.</td>
          </tr></tbody></table></div></div><p><br class="table-break">
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuration.logging"></a>4.5.&nbsp;Logging configuration </h2></div></div></div><p>
      The default logging framework used by Pustefix is Log4j. If you want to stay with this default, Pustefix helps you setting up your logging. By default it reads the Log4j configuration
      from <code class="literal">WEB-INF/pfixlog.xml</code>. Within this file you can make use of the Pustefix customization tags (see <a class="xref" href="#configuration.customization" title="4.2.&nbsp;Customization tools">Section&nbsp;4.2, &#8220;Customization tools&#8221;</a>).
    </p><p>
      Often you have to configure different file paths depending on your runtime environment, e.g. for development or production mode. Therefor you can use the customization tag
      <code class="literal">&lt;cus:logroot/&gt;</code> as a placeholder for the <code class="literal">logroot</code> ServletContext init parameter, which can be set when deploying your application
      in the target environment.
    </p><pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hl-tag">&lt;log4j:configuration</span> <span class="hl-attribute">xmlns:log4j</span>=<span class="hl-value">"http://jakarta.apache.org/log4j/"</span>
                     <span class="hl-attribute">xmlns:cus</span>=<span class="hl-value">"http://www.schlund.de/pustefix/customize"</span><span class="hl-tag">&gt;</span>

  <span class="hl-tag">&lt;appender</span> <span class="hl-attribute">name</span>=<span class="hl-value">"LOGGER_GENERAL"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.log4j.RollingFileAppender"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"File"</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;cus:logroot/&gt;</span>pustefix-servlet.log<span class="hl-tag">&lt;/param&gt;</span>
    <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"MaxFileSize"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"10MB"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;layout</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.log4j.PatternLayout"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"ConversionPattern"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"%d{ISO8601} [%t] %-5p %c [%M():%L] %x - %m\n"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/layout&gt;</span>
  <span class="hl-tag">&lt;/appender&gt;</span>
  ...
<span class="hl-tag">&lt;/log4j:configuration&gt;</span>
</pre><p>
      Alternatively you can make use of Pustefix's <code class="literal">&lt;cus:choose&gt;|&lt;cus:when&gt;|&lt;cus:otherwise&gt;</code> customization tags, to branch the configuration depending on the predefined variables, 
      like <code class="literal">mode</code>, <code class="literal">fdqn</code> or <code class="literal">machine</code>, e.g. you can set different log levels for different environments.
    </p><pre class="programlisting">  <span class="hl-tag">&lt;root&gt;</span>
    <span class="hl-tag">&lt;cus:choose&gt;</span>
      <span class="hl-tag">&lt;cus:when</span> <span class="hl-attribute">test</span>=<span class="hl-value">"$mode = 'prod'"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;priority</span> <span class="hl-attribute">value</span>=<span class="hl-value">"WARN"</span><span class="hl-tag">/&gt;</span>
      <span class="hl-tag">&lt;/cus:when&gt;</span>
      <span class="hl-tag">&lt;cus:otherwise&gt;</span>
        <span class="hl-tag">&lt;priority</span> <span class="hl-attribute">value</span>=<span class="hl-value">"DEBUG"</span><span class="hl-tag">/&gt;</span>
      <span class="hl-tag">&lt;/cus:otherwise&gt;</span>
    <span class="hl-tag">&lt;/cus:choose&gt;</span>
    <span class="hl-tag">&lt;appender-ref</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"LOGGER_GENERAL"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/root&gt;</span>
</pre><p>
       By default Log4j is configured at the beginning of the Spring ApplicationContext creation. But it's better to set up logging at the very beginning of the webapp startup to
       be able to log errors or messages that occurred before this phase, e.g. errors from other servlets or filters. Therefor Pustefix provides a ServletContextListener, which
       should be configured as the first listener in the webapp's <code class="literal">web.xml</code>.  
    </p><pre class="programlisting"><span class="hl-tag">&lt;web-app</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://java.sun.com/xml/ns/javaee"</span> <span class="hl-attribute">xmlns:jee</span>=<span class="hl-value">"http://java.sun.com/xml/ns/javaee"</span><span class="hl-tag">&gt;</span>
   <span class="hl-tag">&lt;listener&gt;</span>
     <span class="hl-tag">&lt;listener-class&gt;</span>org.pustefixframework.http.Log4jConfigListener<span class="hl-tag">&lt;/listener-class&gt;</span>
   <span class="hl-tag">&lt;/listener&gt;</span>
   ...
<span class="hl-tag">&lt;/web-app&gt;</span>
</pre><p><a name="configuration.logging.includes"></a>
      The Pustefix customization mechanism can also be used to modularize the logging configuration. Using the customization tag <code class="literal">&lt;cus:include&gt;</code> you can include logging configurations from the classpath or other modules:
    </p><pre class="programlisting"><span class="hl-tag">&lt;log4j:configuration</span> <span class="hl-attribute">xmlns:log4j</span>=<span class="hl-value">"http://jakarta.apache.org/log4j/"</span> <span class="hl-attribute">xmlns:cus</span>=<span class="hl-value">"http://www.schlund.de/pustefix/customize"</span><span class="hl-tag">&gt;</span>

  <span class="hl-tag">&lt;cus:include</span> <span class="hl-attribute">name</span>=<span class="hl-value">"module://pustefix-core/pfixlog.xml"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;cus:include</span> <span class="hl-attribute">name</span>=<span class="hl-value">"classpath:META-INF/pfixlog.xml"</span><span class="hl-tag">/&gt;</span>
  
  <em class="hl-comment" style="color: silver">&lt;!-- additional or overriding appenders/loggers --&gt;</em>

<span class="hl-tag">&lt;/log4j:configuration&gt;</span>
</pre><p>
      Such includes can be placed as top-level elements in your logging configuration. Included configurations can contain includes themselves. If loggers/appenders are configured multiple times, the last occurrence will have precedence. Thus you can later override settings included before, e.g. if you include the default configuration from the Pustefix framework, you can override application specific settings afterwards (see example above).
    </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="xslt"></a>Chapter&nbsp;5.&nbsp;Core Pustefix tag library</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#xslt.structure">5.1. Defining the structure of a document</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2882">5.1.1. Structure of a Type 1 document</a></span></dt><dt><span class="section"><a href="#d0e2895">5.1.2. Structure of a Type 2 document</a></span></dt></dl></dd><dt><span class="section"><a href="#xslt.links">5.2. Creating links to internal and external pages</a></span></dt><dd><dl><dt><span class="section"><a href="#xslt.pfx.button">5.2.1. pfx:button</a></span></dt><dt><span class="section"><a href="#xslt.pfx.url">5.2.2. pfx:url</a></span></dt><dt><span class="section"><a href="#xslt.pfx.elink">5.2.3. pfx:elink</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e3114">5.3. Including text and images</a></span></dt><dd><dl><dt><span class="section"><a href="#xslt.pfx.include">5.3.1. Include parts (&lt;pfx:include&gt;)</a></span></dt><dt><span class="section"><a href="#xslt.pfx.maincontent">5.3.2. Generated include requests (&lt;pfx:maincontent&gt;)</a></span></dt><dt><span class="section"><a href="#xslt.pfx.image">5.3.3. Displaying images (&lt;pfx:image&gt;)</a></span></dt><dt><span class="section"><a href="#xslt.renderextensions">5.3.4. Dynamically including parts at rendering time</a></span></dt><dt><span class="section"><a href="#xslt.pfx.checkinclude">5.3.5. Checking include part existence (&lt;pfx:checkinclude&gt;)</a></span></dt><dt><span class="section"><a href="#xslt.pfx.includeparams">5.3.6. Include parameters (&lt;pfx:includeparam&gt;)</a></span></dt></dl></dd><dt><span class="section"><a href="#xslt.messages">5.4. Displaying messages</a></span></dt><dd><dl><dt><span class="section"><a href="#xslt.messages.tags">5.4.1. Message tags</a></span></dt><dt><span class="section"><a href="#xslt.messages.configuration">5.4.2. MessageSource configuration</a></span></dt><dt><span class="section"><a href="#d0e3884">5.4.3. Message format</a></span></dt></dl></dd><dt><span class="section"><a href="#xslt.forms">5.5. Handling HTML forms</a></span></dt><dd><dl><dt><span class="section"><a href="#xslt.pfx.forminput">5.5.1. Form creation</a></span></dt><dt><span class="section"><a href="#xslt.forms.submit">5.5.2. Submitting forms</a></span></dt><dt><span class="section"><a href="#xslt.controls.arguments">5.5.3. Arguments, comands and anchors</a></span></dt><dt><span class="section"><a href="#xslt.forms.elements">5.5.4. Form elements</a></span></dt><dt><span class="section"><a href="#xslt.forms.errors">5.5.5. Handling error conditions</a></span></dt><dt><span class="section"><a href="#xslt.forms.token">5.5.6. Avoiding duplicate form submission</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e4995">5.6. Miscellaneous utility tags</a></span></dt><dd><dl><dt><span class="section"><a href="#xslt.utility.active">5.6.1. Checking page status</a></span></dt><dt><span class="section"><a href="#xslt.pfx.langselect">5.6.2. Displaying content based on the language</a></span></dt><dt><span class="section"><a href="#xslt.pfx.themeselect">5.6.3. Displaying content based on the theme</a></span></dt><dt><span class="section"><a href="#xslt.consoles">5.6.4. Using the Pustefix console</a></span></dt></dl></dd><dt><span class="section"><a href="#xslt.extensions">5.7. XSLT extensions</a></span></dt><dd><dl><dt><span class="section"><a href="#xslt.extensions.xpathfunctions">5.7.1. XPath functions</a></span></dt><dt><span class="section"><a href="#xslt.extensions.extensionelements">5.7.2. XSL extension elements</a></span></dt></dl></dd></dl></div><p>
    Pustefix includes a small library of tags defined as XSLT templates which implement low level functionality common to all
    Pustefix applications. These templates are mostly concerned with creating links to Pustefix pages or external URLs, sending
    data via HTML forms (including the necessary error handling) and including XML ressources (<span class="emphasis"><em>Include Parts</em></span>).
  </p><p>
    All core tags reside in their own namespace. The prefix usually used is
    <code class="code">pfx</code>, and the namespace is
    <code class="code">http://www.schlund.de/pustefix/core</code>. You are not supposed to enter your own private project 
    specific tags into this namespace.
  </p><p>
    The following table lists these tags together with a very short explanation of what they do. Refer to the relevant subsections
    below to find a detailed explanation on their relevant attributes, subnodes and how to use them.
  </p><p>
  </p><div class="table"><a name="d0e2700"></a><p class="title"><b>Table&nbsp;5.1.&nbsp;The Core Pustefix XSLT Tags</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
        <th>Tag name</th>
        <th>Short information</th>
      </tr></thead><tbody><tr>
        <td>pfx:document</td>
        <td>The top-most container for all Pustefix pages, see <a class="xref" href="#xslt.structure" title="5.1.&nbsp;Defining the structure of a document">Section&nbsp;5.1, &#8220;Defining the structure of a document&#8221;</a></td>
      </tr><tr>
        <td>pfx:frameset, pfx:frame</td>
        <td>Used to define pages with framesets and frames, see <a class="xref" href="#xslt.structure" title="5.1.&nbsp;Defining the structure of a document">Section&nbsp;5.1, &#8220;Defining the structure of a document&#8221;</a></td>
      </tr><tr>
        <td>pfx:button</td>
        <td>This tag creates simple links to internal Pustefix pages (possibly submitting parameters for requests), see <a class="xref" href="#xslt.pfx.button" title="5.2.1.&nbsp;pfx:button">Section&nbsp;5.2.1, &#8220;pfx:button&#8221;</a></td>
      </tr><tr>
        <td>pfx:url</td>
        <td>Used to create only the content of the href attribute of a link to an internal page, see <a class="xref" href="#xslt.pfx.url" title="5.2.2.&nbsp;pfx:url">Section&nbsp;5.2.2, &#8220;pfx:url&#8221;</a></td>
      </tr><tr>
        <td>pfx:elink</td>
        <td>
          This tag creates links to external URLs where care must be taken to strip the session ID from the referer header to not leak
          sensitive information to the outside world, see <a class="xref" href="#xslt.pfx.elink" title="5.2.3.&nbsp;pfx:elink">Section&nbsp;5.2.3, &#8220;pfx:elink&#8221;</a>
        </td>
      </tr><tr>
        <td>pfx:include</td>
        <td>
          This tag references a file via its href attribute, and includes a named snippet of xml content contained in this file
          via the part attribute, see <a class="xref" href="#xslt.pfx.include" title="5.3.1.&nbsp;Include parts (<pfx:include&gt;)">Section&nbsp;5.3.1, &#8220;Include parts (&lt;pfx:include&gt;)&#8221;</a>
        </td>
      </tr><tr>
        <td>pfx:maincontent</td>
        <td>This tag is used to include "computed" include parts, see <a class="xref" href="#xslt.pfx.maincontent" title="5.3.2.&nbsp;Generated include requests (<pfx:maincontent&gt;)">Section&nbsp;5.3.2, &#8220;Generated include requests (&lt;pfx:maincontent&gt;)&#8221;</a></td>
      </tr><tr>
        <td>pfx:image</td>
        <td>
          This tag references images to be included in the final page (via <code class="literal">img</code>-tags), see <a class="xref" href="#xslt.pfx.image" title="5.3.3.&nbsp;Displaying images (<pfx:image&gt;)">Section&nbsp;5.3.3, &#8220;Displaying images (&lt;pfx:image&gt;)&#8221;</a>
        </td>
      </tr><tr>
        <td>pfx:forminput</td>
        <td>This tag creates a HTML form, see <a class="xref" href="#xslt.pfx.forminput" title="5.5.1.&nbsp;Form creation">Section&nbsp;5.5.1, &#8220;Form creation&#8221;</a></td>
      </tr><tr>
        <td>pfx:xinp</td>
        <td>Used to create HTML form elements, see <a class="xref" href="#xslt.forms.elements" title="5.5.4.&nbsp;Form elements">Section&nbsp;5.5.4, &#8220;Form elements&#8221;</a></td>
      </tr><tr>
        <td>pfx:checkfield</td>
        <td>This tag supplies content depending on the error state of a special form field, see <a class="xref" href="#xslt.forms.errors.fields" title="Errors attached to a field">the section called &#8220;Errors attached to a field&#8221;</a></td>
      </tr><tr>
        <td>pfx:checkerror, pfx:checknoerror</td>
        <td>Used to check for the presence of any error condition, see <a class="xref" href="#xslt.forms.errors.fields" title="Errors attached to a field">the section called &#8220;Errors attached to a field&#8221;</a></td>
      </tr><tr>
        <td>pfx:checkmessage</td>
        <td>Used to check for the presence of any page message, see <a class="xref" href="#xslt.forms.errors.page" title="Checking for pagemessages">the section called &#8220;Checking for pagemessages&#8221;</a></td>
      </tr><tr>
        <td>pfx:checkactive, pfx:checknotactive</td>
        <td>These tags check for visibility (or not) of pages or for the activity (or not) of handlers, see <a class="xref" href="#xslt.utility.active" title="5.6.1.&nbsp;Checking page status">Section&nbsp;5.6.1, &#8220;Checking page status&#8221;</a></td>
      </tr><tr>
        <td>pfx:themeselect, pfx:langselect</td>
        <td>Used to select content depending on a matching theme or currently selected language, see <a class="xref" href="#xslt.pfx.themeselect" title="5.6.3.&nbsp;Displaying content based on the theme">Section&nbsp;5.6.3, &#8220;Displaying content based on the theme&#8221;</a> and <a class="xref" href="#xslt.pfx.langselect" title="5.6.2.&nbsp;Displaying content based on the language">Section&nbsp;5.6.2, &#8220;Displaying content based on the language&#8221;</a></td>
      </tr><tr>
        <td>pfx:editconsole, pfx:webserviceconsole</td>
        <td>create panels of shortcut links useful during development, see <a class="xref" href="#xslt.consoles" title="5.6.4.&nbsp;Using the Pustefix console">Section&nbsp;5.6.4, &#8220;Using the Pustefix console&#8221;</a></td>
      </tr></tbody></table></div></div><p><br class="table-break">
</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xslt.structure"></a>5.1.&nbsp;Defining the structure of a document</h2></div></div></div><p>
      This section describes the format for those documents serving as the structure defining
      xml source of the finally transformed documents. These can be found in the xml
      subdirectory of your project.
    </p><p>
      The explanation keeps an eye on the expected usage patterns of these documents.
    </p><p>
      There are basically two kinds of "pages" you deliver with Pustefix.
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Pages that have no frames and may deliver html or any other text based format.
        </p></li><li class="listitem"><p>
          Pages that contain an arbitrary amount of frames and framesets. Those usually deliver html.
        </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2882"></a>5.1.1.&nbsp;Structure of a Type 1 document</h3></div></div></div><p>
        For a html delivering page without frames:
      </p><pre class="programlisting">
<span class="hl-tag">&lt;pfx:document</span> <span class="hl-attribute">xmlns:pfx</span>=<span class="hl-value">"http://www.schlund.de/pustefix/core"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;html&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!--
      Any content valid for an html document
    --&gt;</em>
  <span class="hl-tag">&lt;/html&gt;</span>
<span class="hl-tag">&lt;/pfx:document&gt;</span></pre><p>
        If you don't want to deliver html, just omit the &lt;html&gt; tag. The following
        could be used to implement a CSS stylesheet.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:document&gt;</span>.foo { color: #ffff00; font-family: Helvetica; }<span class="hl-tag">&lt;/pfx:document&gt;</span></pre><p>
        The rule of thumb is: Whatever you put between &lt;pfx:document&gt; is up to you and
        will be delivered just as you write it there. Just remember that the &lt;html&gt; is
        not automatically inserted for you, you have to write it yourself.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2895"></a>5.1.2.&nbsp;Structure of a Type 2 document</h3></div></div></div><p>
        There are only subtle differences. A document is a Type 2 doc by definition
        whenever there is a &lt;pfx:frameset&gt; and possibly a &lt;head&gt; node as the
        only direct children of &lt;pfx:document&gt;.
      </p><pre class="programlisting">
<span class="hl-tag">&lt;pfx:document</span> <span class="hl-attribute">xmlns:pfx</span>=<span class="hl-value">"http://www.schlund.de/pustefix/core"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;head&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!--
      Again, put anything you want to appear in the head of the _top frame! This means
      page title, script stuff or stylesheets.
    --&gt;</em>
  <span class="hl-tag">&lt;/head&gt;</span>
  <span class="hl-tag">&lt;pfx:frameset</span> <span class="hl-attribute">rows</span>=<span class="hl-value">"20,*"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;pfx:frame</span> <span class="hl-attribute">name</span>=<span class="hl-value">"navi"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;html&gt;</span>
        <span class="hl-tag">&lt;head&gt;</span>...<span class="hl-tag">&lt;/head&gt;</span>
        <span class="hl-tag">&lt;body&gt;</span>
          <em class="hl-comment" style="color: silver">&lt;!-- Any HTML content --&gt;</em>
        <span class="hl-tag">&lt;/body&gt;</span>
      <span class="hl-tag">&lt;/html&gt;</span>
    <span class="hl-tag">&lt;/pfx:frame&gt;</span>
    <span class="hl-tag">&lt;pfx:frame</span> <span class="hl-attribute">name</span>=<span class="hl-value">"main"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;html&gt;</span>
        <span class="hl-tag">&lt;body&gt;</span>
          <em class="hl-comment" style="color: silver">&lt;!-- Any HTML content --&gt;</em>
        <span class="hl-tag">&lt;/body&gt;</span>
      <span class="hl-tag">&lt;/html&gt;</span>
    <span class="hl-tag">&lt;/pfx:frame&gt;</span>
  <span class="hl-tag">&lt;/pfx:frameset&gt;</span>
<span class="hl-tag">&lt;/pfx:document&gt;</span></pre><p>
        As you can see there is NO &lt;html&gt; tag just below &lt;pfx:document&gt;.
        This is the one important difference between Type 1) and Type 2). As a rule you
        could say that you only have to insert the &lt;html&gt; yourself wherever the
        "real" content is. In a Type 1) doc this is the whole content of the
        &lt;pfx:document&gt; tag, so we need to set it there. But for a Type 2) doc,
        the "real" content is the content of the &lt;pfx:frame&gt; tags, so you need to
        set it there.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xslt.links"></a>5.2.&nbsp;Creating links to internal and external pages</h2></div></div></div><p>Pustefix provides tags that allow you create links to internal and external pages.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.pfx.button"></a>5.2.1.&nbsp;pfx:button</h3></div></div></div><p>
        The <code class="literal">&lt;pfx:button&gt;</code> tag is responsible for generating links to other
        pages inside the pustefix environment. In fact, it not always creates a link, but depending on
        the fact if the target page is accessible ("invisible") or not, or if the target page is the
        same as the current page ("active", aka "the target page is already active") it can display
        completely different content, and only when the target page is accessible and is different
        from the current page, a <code class="literal">&lt;a href="..."&gt;...&lt;/a&gt;</code> is put around it.
      </p><p>
        The template takes care of constructing the correct url with session information embedded
        and builds up valid, url encoded query strings.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:button</span> <span class="hl-attribute">page</span>=<span class="hl-value">"APage"</span> <span class="hl-attribute">pageflow</span>=<span class="hl-value">"AFlow"</span> <span class="hl-attribute">jumptopage</span>=<span class="hl-value">"APage"</span> <span class="hl-attribute">jumptopageflow</span>=<span class="hl-value">"AFlow"</span> 
            <span class="hl-attribute">forcestop</span>=<span class="hl-value">"true|false|step"</span> <span class="hl-attribute">startwithflow</span>=<span class="hl-value">"true|false"</span> <span class="hl-attribute">altkey</span>=<span class="hl-value">"pageAlternativeKey"</span> <span class="hl-attribute">path</span>=<span class="hl-value">"sub/path"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- Control the submit commands --&gt;</em>
  <span class="hl-tag">&lt;pfx:command</span> <span class="hl-attribute">page</span>=<span class="hl-value">"APage"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"SUBWRP"</span><span class="hl-tag">&gt;</span>prefix<span class="hl-tag">&lt;/pfx:command&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!-- Supply additional parameters --&gt;</em>
  <span class="hl-tag">&lt;pfx:argument</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AName"</span><span class="hl-tag">&gt;</span>AValue<span class="hl-tag">&lt;/pfx:argument&gt;</span>
  
  <span class="hl-tag">&lt;pfx:anchor</span> <span class="hl-attribute">frame</span>=<span class="hl-value">"AFrame"</span><span class="hl-tag">&gt;</span>AnAnchor<span class="hl-tag">&lt;/pfx:anchor&gt;</span>
  
  <em class="hl-comment" style="color: silver">&lt;!-- Select a page at runtime --&gt;</em>
  <span class="hl-tag">&lt;pfx:page&gt;</span>pageName<span class="hl-tag">&lt;/pfx:page&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!-- Select a page alternative by key --&gt;</em> 
  <span class="hl-tag">&lt;pfx:altkey&gt;</span>pageAlternativeKey<span class="hl-tag">&lt;/pfx:altkey&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!-- Set page-relative URL sub path (suffixing the display page name). Segments are URI-encoded automatically. --&gt;</em>
  <span class="hl-tag">&lt;pfx:path&gt;</span>sub/path<span class="hl-tag">&lt;/pfx:path&gt;</span>
  <span class="hl-tag">&lt;pfx:path&gt;</span>
    <span class="hl-tag">&lt;pfx:segment&gt;</span>sub<span class="hl-tag">&lt;/pfx:segment&gt;</span>
    <span class="hl-tag">&lt;pfx:segment&gt;</span>path<span class="hl-tag">&lt;/pfx:segment/&gt;</span>
  <span class="hl-tag">&lt;/pfx:path&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!--
    These three optional child nodes can be used to display different
    content depending on the situation:
  --&gt;</em>
  <span class="hl-tag">&lt;pfx:invisible&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- Displayed when link is not accessible --&gt;</em>
  <span class="hl-tag">&lt;/pfx:invisible&gt;</span>
  <span class="hl-tag">&lt;pfx:normal&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- Displayed when link is accessible --&gt;</em>
  <span class="hl-tag">&lt;/pfx:normal&gt;</span>
  <span class="hl-tag">&lt;pfx:active&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- Displayed when current page == link target --&gt;</em>
  <span class="hl-tag">&lt;/pfx:active&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!--
    Displayed link content
  --&gt;</em>
<span class="hl-tag">&lt;/pfx:button&gt;</span></pre><p>
        The <code class="literal">&lt;pfx:button&gt;</code> tag supports the following attributes:
      </p><div class="table"><a name="d0e2929"></a><p class="title"><b>Table&nbsp;5.2.&nbsp;Attributes of the pfx:button tag</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
            <th>Attribute name</th>
            <th>Mandatory?</th>
            <th>Description</th>
          </tr></thead><tbody><tr>
            <td>page</td>
            <td>optional</td>
            <td>defaults to the current page. Used to give the target page where the link points to. Note: leaving this empty also implies mode="force".</td>
          </tr><tr>
            <td>pageflow / jumptopage / jumptopageflow / forcestop</td>
            <td>optional</td>
            <td>These attributes work the same as for form submit controls</td>
          </tr><tr>
            <td>altkey</td>
            <td>optional</td>
            <td>Select page alternative by key</td>
          </tr><tr>
            <td>startwithflow</td>
            <td>optional</td>
            <td>
              <p>Defaults to false. When set to true, the request will not go to a page directly, but start with the a processing of the chosen pageflow to determine the page to use.</p>
              <p>The meaning of the page attribute also changes: If the submitted page is part of the chosen pageflow, the flow will be queried for the page to use up to the point in the flow where the given page is, which is then used in any case. In other words, this constitutes an end point for the search of a matching page in the flow.</p>
            </td>
          </tr><tr>
            <td>mode</td>
            <td>optional</td>
            <td>
              <p>Default is empty. When set to force, a link is created and the matching CSS is used even in the active button state, i.e. whenever the target page is the current page.</p>
              <p>When set to desc, the button state is not only active when the current page == target page, but also when the current page is a descendent page of the target page.</p>
            </td>
          </tr><tr>
            <td>nodata</td>
            <td>optional</td>
            <td>Default to false. Normally, whenever you use a pfx:argument tag to attach parameters to the query string, the system automatically also adds the parmeter __sendingdata=1 to the query string, thereby signalling to the backend system, that it should process incoming data. Set this attribute to true to prohibit this behaviour.</td>
          </tr><tr>
            <td>frame / target</td>
            <td>optional</td>
            <td>Works the same as for submit controls</td>
          </tr><tr>
            <td>normalclass / activeclass / invisibleclass</td>
            <td>optional</td>
            <td>defaults are: core_button_normal, core_button_active and core_button_invisible. These three attributes define the CSS classes to be used for the three different states of a pfx:button</td>
          </tr></tbody></table></div></div><br class="table-break"><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3045"></a>Commands and arguments</h4></div></div></div><p>
		  It is possible to use the same children to control the submit behaviour as it is done
		  with form controls.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3050"></a>Link contents</h4></div></div></div><p>
          The <code class="literal">pfx:button</code> template allows you to change the link content depending
          on the status of the target page.
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Content of pfx:invisible will be only displayed when the target page is not accessible.</p></li><li class="listitem"><p>Content of pfx:active will be only displayed when the target page is the current page.</p></li><li class="listitem"><p>Content of pfx:normal will be only displayed when the target page is different from the current page and when it's accessible.</p></li></ul></div><p>
          Content outside of these tags will be used in any case. If you only want to have different content for
          the invisible case, just put the content for the active and normal case inside pfx:normal, and add a
          pfx:invisible child with the differing content. The content of a pfx:normal node serves as the fallback
          for the other two cases.
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
            Note that only in the normal (regardless if the content comes from a dedicated pfx:normal child node or not)
            a link is put around the generated content.
          </p></td></tr></table></div><p>
          Note also, that for differences between the three cases that can be expressed with CSS, you don't need to
          use these special child nodes. The system makes sure to use the three associated classes explained above to
          allow styling.
        </p><p>
          It is also possible to change to content, depending on whether a page has already been visited or
          not.
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Content of pfx:visited will be only displayed when the link has been already visited at least once in this session.</p></li><li class="listitem"><p>Content of pfx:visited will be only displayed when the link has not been visited in this session.</p></li></ul></div><p>
          The two tags above may also be put inside pfx:normal and pfx:invisible tags to express different content for accessible
          (or inaccessible) pages depending on the fact if they have been visited at least once already.
        </p><p>
          This makes of course not much sense with pfx:active, because a page where this applies is always the current page
          and by that is always visited.
        </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.pfx.url"></a>5.2.2.&nbsp;pfx:url</h3></div></div></div><p>
        This tag takes mostly the same attributes as <code class="literal">&lt;pfx:button&gt;</code>, but it only creates the URL and does not build up
        any content or generate a whole link. You can use this template if you just need the pure URL string.	  
	  </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.pfx.elink"></a>5.2.3.&nbsp;pfx:elink</h3></div></div></div><p>
        When creating links to external URLs care must be taken to ensure that no sensitive data (especially the session ID)
        leaks into log files of remote servers via the referer header. To make sure that this can't happen, all links to
        external sites must be propagated via a special servlet, the <code class="literal">de.schlund.pfixxml.DerefServer</code>.
      </p><p>
        Every Pustefix project has this servlet configured to be accessible under the path <code class="filename">/deref</code>.
        To make the handling of external URLs easier, there also exists a special tag <code class="literal">&lt;pfx:elink&gt;</code>
        that automates the creation of the correct link.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:elink</span> <span class="hl-attribute">href</span>=<span class="hl-value">"http://some.host/location"</span> <span class="hl-attribute">target</span>=<span class="hl-value">"_popup|SomeName"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!--
    Optional, use the &lt;pfx:host&gt; child instead of the href attribute whenever you
    need to construct the URL with additional code (e.g. from data only available
    at runtime)
  --&gt;</em>
  <span class="hl-tag">&lt;pfx:host&gt;</span>...<span class="hl-tag">&lt;/pfx:host&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!--
    Optional, use as many of &lt;pfx:argument&gt; tags as you need to supply the
    parameters for the query string.
  --&gt;</em>
  <span class="hl-tag">&lt;pfx:argument</span> <span class="hl-attribute">name</span>=<span class="hl-value">"SomeName"</span><span class="hl-tag">&gt;</span>...<span class="hl-tag">&lt;/pfx:argument&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!--
    Place content of the link here
  --&gt;</em>
<span class="hl-tag">&lt;/pfx:elink&gt;</span></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3114"></a>5.3.&nbsp;Including text and images</h2></div></div></div><p>
      There are two types of ressources that need to be included into a Pustefix page. Textual content ("Include Parts") is
      included with the help of the <code class="literal">&lt;pfx:include&gt;</code> tag while images are included via the
      <code class="literal">&lt;pfx:image&gt;</code> tag. Both tags make sure to register the ressources in the runtime system, so at all
      times the system knows which ressources a certain page uses. This information is used to check if the page is still
      up-to-date or needs rebuilding (by comparing file modification times of the ressources with the creation time of the page itself).
    </p><p>
      Of course this check can be disabled for a "live" system, as there is typically no need to check for changed ressources.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.pfx.include"></a>5.3.1.&nbsp;Include parts (&lt;pfx:include&gt;)</h3></div></div></div><p>
        Include parts contain the content that is displayed on your pages.
        The parts are organized into include files. Every part has the same structure:
      </p><p>
        The children of the part tag are theme tags (at least one). The name attribute
        of the theme tag is the name of a theme as it is defined in the projects
        depend.xml.in file. Often these themes are just the project name or "default",
        which is used as the fallback when no more specific theme name matches
        (see here on how to define themes in the depend.xml.in file).
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
          Earlier versions of Pustefix had no special themeing, the only thing that
          was used was the project name itself and "default" as the fallback. Still today,
          the default value for the "themes" attribute in the root node of the depend.xml.in
          file (when not given explicitely) is just "&lt;ProjectName&gt; default", which
          makes the new system behave exactly as the old one did.
        </p></td></tr></table></div><p>
        The resolution of the matching theme is done at the time the part is included
        (see below). Every page "knows" which themes are defined for it, and therefore it
        is possible to decide which product branch to use on generation time. The language
        on the other hand can be changed dynamically while the user clicks through the
        application, so the selection of the right language subtree (if more than one is
        present) is done at runtime.
      </p><pre class="programlisting"><span class="hl-tag">&lt;include_parts&gt;</span>
  <span class="hl-tag">&lt;part</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Foo"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;theme</span> <span class="hl-attribute">name</span>=<span class="hl-value">"default"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;pfx:langselect&gt;</span>
        <span class="hl-tag">&lt;pfx:lang</span> <span class="hl-attribute">name</span>=<span class="hl-value">"default"</span><span class="hl-tag">&gt;</span>
          <em class="hl-comment" style="color: silver">&lt;!--
            The default content of part Foo goes here...
          --&gt;</em>
        <span class="hl-tag">&lt;/pfx:lang&gt;</span>
        <span class="hl-tag">&lt;pfx:lang</span> <span class="hl-attribute">name</span>=<span class="hl-value">"en_GB"</span><span class="hl-tag">&gt;</span>
          <em class="hl-comment" style="color: silver">&lt;!--
            Default content in british english goes here...
          --&gt;</em>
        <span class="hl-tag">&lt;/pfx:lang&gt;</span>
        <span class="hl-tag">&lt;pfx:lang</span> <span class="hl-attribute">name</span>=<span class="hl-value">"en_*"</span><span class="hl-tag">&gt;</span>
          <em class="hl-comment" style="color: silver">&lt;!--
            Default content in any other english language goes here...
          --&gt;</em>
        <span class="hl-tag">&lt;/pfx:lang&gt;</span>
      <span class="hl-tag">&lt;/pfx:langselect&gt;</span>
    <span class="hl-tag">&lt;/theme&gt;</span>
    <span class="hl-tag">&lt;theme</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Theme_A"</span><span class="hl-tag">&gt;</span>
      <em class="hl-comment" style="color: silver">&lt;!--
        The default content for theme Theme_A goes here...
      --&gt;</em>
    <span class="hl-tag">&lt;/theme&gt;</span>
  <span class="hl-tag">&lt;/part&gt;</span>

  <span class="hl-tag">&lt;part</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Baz"</span><span class="hl-tag">&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- Other parts --&gt;</em>
  <span class="hl-tag">&lt;/part&gt;</span>
<span class="hl-tag">&lt;/include_parts&gt;</span></pre><p>
        A part is referenced with two attributes: The filename of the include file that
        contains it, and the name of the part. The filename can be omitted, if you're referencing a part within the same file.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:include</span> <span class="hl-attribute">href</span>=<span class="hl-value">"MyProject/txt/MyIncludefile"</span> <span class="hl-attribute">part</span>=<span class="hl-value">"Foo"</span> <span class="hl-attribute">noerror</span>=<span class="hl-value">"true|false"</span> <span class="hl-attribute">noedit</span>=<span class="hl-value">"true|false"</span><span class="hl-tag">/&gt;</span></pre><p>
        </p><div class="table"><a name="d0e3147"></a><p class="title"><b>Table&nbsp;5.3.&nbsp;Attributes of the pfx:include tag</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
              <th>Attribute name</th>
              <th>Mandatory?</th>
              <th>Description</th>
            </tr></thead><tbody><tr>
              <td>href</td>
              <td>optional</td>
              <td>If not given, it defaults to the current include part file. If it's not given and the module attribute is set, the path of the current include part file will be used as path within the module (omitting the first path component if the current file isn't already from a module).</td>
            </tr><tr>
              <td>part</td>
              <td>mandatory</td>
              <td>The name of the part to include</td>
            </tr><tr>
              <td>noerror</td>
              <td>optional</td>
              <td>Defaults to false. Set this to true to imply that no warning sign should be generated when the include is not found. Only set this when you know what you do.</td>
            </tr><tr>
              <td>noedit</td>
              <td>optional</td>
              <td>Defaults to false. Set this to true to imply that this include part should not be editable via the pustefix editor. Only set this when you know what you do.</td>
            </tr><tr>
              <td>level</td>
              <td>optional</td>
              <td>Not set by default. Set this to <code class="literal">runtime</code> if the part should be included at runtime (on the last transformation level).</td>
            </tr><tr>
              <td>search</td>
              <td>optional</td>
              <td>Not set by default. Set this to <code class="literal">dynamic</code> if a matching part should be dynamically searched. The search order is: current project, common folder, and if a module is specified: overriding module, specified module. See <a class="xref" href="#advanced.dyninclude" title="7.5.&nbsp;Dynamic resource inclusion">Section&nbsp;7.5, &#8220;Dynamic resource inclusion&#8221;</a>.</td>
            </tr><tr>
              <td>module</td>
              <td>optional</td>
              <td>Not set by default. Set this to the name of the module from which the part should be loaded. If dynamic search is set, the module just serves as fallback location if the part can't be found in the project or common location and isn't overrided by another module. See <a class="xref" href="#advanced.dyninclude" title="7.5.&nbsp;Dynamic resource inclusion">Section&nbsp;7.5, &#8220;Dynamic resource inclusion&#8221;</a>. You can also use one of the pre-defined special module names (see <a class="xref" href="#advanced.dyninclude.modinclude.special" title="Special module names">Special module names</a>).</td>
            </tr></tbody></table></div></div><p><br class="table-break">
      </p><p>
        Using this tag results in the matching product branch of the include part to be
        inserted in place of the tag.
      </p><p>
        If you're deferring an include until runtime using <code class="literal">level="runtime"</code>, you can also defer the creation of the <code class="literal">href</code> and <code class="literal">part</code> values until runtime using the <code class="literal">pfx:href</code> and <code class="literal">pfx:part</code> tags instead of the according attributes. The following example shows how to use values coming from the DOM result tree:
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:include</span> <span class="hl-attribute">level</span>=<span class="hl-value">"runtime"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;pfx:href&gt;</span><span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"/formresult/mypartinfo/@myhref"</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/pfx:href&gt;</span>
  <span class="hl-tag">&lt;pfx:part&gt;</span><span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"/formresult/mypartinfo/@mypartname"</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/pfx:part&gt;</span> 
<span class="hl-tag">&lt;/pfx:include&gt;</span></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
        You should be aware that parts included at runtime aren't transformed with the <code class="literal">master.xsl</code> stylesheet, i.e. if the included part contains Pustefix tags (forms, buttons, etc.) they won't work. So the runtime inclusion is primarily intended for including simple text/HTML content.
      </td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.pfx.maincontent"></a>5.3.2.&nbsp;Generated include requests (&lt;pfx:maincontent&gt;)</h3></div></div></div><p>
        Looking at the example naturally leads to the question how it is possible to
        generate different pages with only a small number of structural xml files and
        always the same XSLT stylesheets. The answer is that at least one of the include
        parts isn't included via the pfx:include tag (which only handles static attribute values)
        but instead the filename of the include part is auto generated from the name of the
        page that is to be produced.
      </p><p>
        Looking at this page, one can see that the two transformations which produce BazPage.xml resp. BazPage.xsl have the page name supplied through the use of an XSLT transformation parameter. Using this parameter, the tag pfx:maincontent constructs an include request depending on the page name.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:maincontent</span> <span class="hl-attribute">part</span>=<span class="hl-value">"content"</span> <span class="hl-attribute">path</span>=<span class="hl-value">"MyProject/txt/pages"</span> <span class="hl-attribute">prefix</span>=<span class="hl-value">"main_"</span><span class="hl-tag">/&gt;</span></pre><p>
        </p><div class="table"><a name="d0e3290"></a><p class="title"><b>Table&nbsp;5.4.&nbsp;Attributes of the pfx:maincontent tag</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
              <th>Attribute name</th>
              <th>Mandatory?</th>
              <th>Description</th>
            </tr></thead><tbody><tr>
              <td>path</td>
              <td>optional</td>
              <td>If not given, but a XSLT parameter $maincontentpath has been defined in the depend.xml.in file, the value of the parameter is used. If there's even no $maincontentpath parameter, it defaults to PROJECTNAME/txt/pages</td>
            </tr><tr>
              <td>prefix</td>
              <td>optional</td>
              <td>defaults to main_</td>
            </tr><tr>
              <td>postfix</td>
              <td>optional</td>
              <td>defaults to .xml</td>
            </tr><tr>
              <td>part</td>
              <td>optional</td>
              <td>defaults to content</td>
            </tr><tr>
              <td>search</td>
              <td>optional</td>
              <td>Not set by default. Set this to <code class="literal">dynamic</code> if a matching part should be dynamically searched. The search order is: current project, common folder, and if a module is specified: overriding module, specified module. See <a class="xref" href="#advanced.dyninclude" title="7.5.&nbsp;Dynamic resource inclusion">Section&nbsp;7.5, &#8220;Dynamic resource inclusion&#8221;</a>.</td>
            </tr><tr>
              <td>module</td>
              <td>optional</td>
              <td>Not set by default. Set this to the name of the module from which the part should be loaded. If dynamic search is set, the module just serves as fallback location if the part can't be found in the project or common location and isn't overrided by another module. See <a class="xref" href="#advanced.dyninclude" title="7.5.&nbsp;Dynamic resource inclusion">Section&nbsp;7.5, &#8220;Dynamic resource inclusion&#8221;</a>. You can also use one of the pre-defined special module names (see <a class="xref" href="#advanced.dyninclude.modinclude.special" title="Special module names">Special module names</a>).</td>
            </tr></tbody></table></div></div><p><br class="table-break">
      </p><p>
        For the page "home" this is equivalent to &lt;pfx:include href="MyProject/txt/pages/main_home.xml" part="content"/&gt; and of course similar for every other page.
      </p><p>
        Starting with this page specific include, the content of the page can be included from many different include parts.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.pfx.image"></a>5.3.3.&nbsp;Displaying images (&lt;pfx:image&gt;)</h3></div></div></div><p>
        HTML <code class="literal">&lt;img&gt;</code> tags are usually not written directly, instead they are generated by using
        the <code class="literal">&lt;pfx:image&gt;</code> tag. Using this tag makes sure that the used image is registered in the
        runtime system as a dependency of the current target that's being generated.
      </p><p>
        One important feature of the <code class="literal">&lt;pfx:image&gt;</code> tag is that it inserts the natural height and
        width of the requested image unless they are explicitely given (as attributes width and height of course).
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:image</span> <span class="hl-attribute">src</span>=<span class="hl-value">"some/path/to/img.gif"</span> <span class="hl-attribute">themed-path</span>=<span class="hl-value">"some/path"</span> <span class="hl-attribute">themed-img</span>=<span class="hl-value">"img.gif"</span><span class="hl-tag">/&gt;</span></pre><p>
        </p><div class="table"><a name="d0e3406"></a><p class="title"><b>Table&nbsp;5.5.&nbsp;Attributes of the pfx:image tag</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
              <th>Attribute name</th>
              <th>Mandatory?</th>
              <th>Description</th>
            </tr></thead><tbody><tr>
              <td>src</td>
              <td>optional</td>
              <td>
                <p>
                  The src path references an image in the file system. It must be given as a path relative to the
                  docroot (typically this means something like <code class="filename">MyProject/img/foo.gif</code>.
                  Note that you need to define an alias for the image directories in your project.xml config file
                  for Apache to be able to find the image.
                </p>
                <p>
                  Note that you can either specify the src attribute OR both of themed-path and themed-img
                </p>
              </td>
            </tr><tr>
              <td>themed-path &amp; themed-img</td>
              <td>optional</td>
              <td>
                <p>
                  These two attributes allow for themed images. The mechanism uses the same theme fallback queue
                  as it is used for include parts. The algorithm to find the image to use is quite easy:
                </p>
                <p>
                  Build an image path by concatenating themed-path, a <code class="literal">/</code> sign, the most specific theme, a <code class="literal">/</code> sign,
                  and themed-img. Check if this image exists. If yes, use it as the <code class="literal">src</code> attribute for the resulting
                  <code class="literal">img</code> tag. If not, take the next specific theme from the fallback queue (if it exists) and try again,
                  until the image is found.
                </p>
                <p>
                  Example: The themes fallback list is "foo bar default", themed-path is "MyProject/img" and themed-img is "test.gif".
                  The image file names that are tried one after the other are
                </p>
                <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">MyProject/img/foo/test.gif</li><li class="listitem">MyProject/img/bar/test.gif</li><li class="listitem">MyProject/img/default/test.gif</li></ul></div>
              </td>
            </tr><tr>
              <td>level</td>
              <td>optional</td>
              <td>Not set by default. Set this to <code class="literal">runtime</code> if the image should be included at runtime (on the last transformation level).</td>
            </tr><tr>
              <td>search</td>
              <td>optional</td>
              <td>Not set by default. Set this to <code class="literal">dynamic</code> if the image should be dynamically searched. The search order is: current project, common folder, and if a module is specified: overriding module, specified module. The search ends if a matching image is found, regardless if there are matches with a more specific theme down the search chain. See <a class="xref" href="#advanced.dyninclude" title="7.5.&nbsp;Dynamic resource inclusion">Section&nbsp;7.5, &#8220;Dynamic resource inclusion&#8221;</a>.</td>
            </tr><tr>
              <td>module</td>
              <td>optional</td>
              <td>Not set by default. Set this to the name of the module from which the image should be loaded. If dynamic search is set, the module just serves as fallback location if an according image can't be found in the project or common location or another overriding module. See <a class="xref" href="#advanced.dyninclude" title="7.5.&nbsp;Dynamic resource inclusion">Section&nbsp;7.5, &#8220;Dynamic resource inclusion&#8221;</a>. You can also use one of the pre-defined special module names (see <a class="xref" href="#advanced.dyninclude.modinclude.special" title="Special module names">Special module names</a>).</td>
            </tr><tr>
              <td>other attributes</td>
              <td>optional</td>
              <td>
                <p>
                  All other attributes given (e.g. <code class="literal">alt</code>, <code class="literal">width</code>,
                  <code class="literal">height</code>, <code class="literal">title</code>, etc. are copied unchanged into the resulting img tag      
                </p>
              </td>
            </tr></tbody></table></div></div><p><br class="table-break">
      </p><p>
        If you're including an image at runtime using <code class="literal">level="runtime"</code>, you can also defer the creation of the <code class="literal">src</code>, <code class="literal">alt</code>, <code class="literal">themed-path</code> and <code class="literal">themed-img</code> values until runtime using the <code class="literal">pfx:src</code>, <code class="literal">pfx:alt</code>, <code class="literal">pfx:themed-path</code> and <code class="literal">pfx:themed-img</code> tags instead of the according attributes. The following example shows how to use values coming from the DOM result tree:
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:image</span> <span class="hl-attribute">level</span>=<span class="hl-value">"runtime"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;pfx:src&gt;</span><span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"/formresult/myimginfo/@mysrc"</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/pfx:src&gt;</span>
  <span class="hl-tag">&lt;pfx:alt&gt;</span><span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"/formresult/myimginfo/@myalt"</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/pfx:alt&gt;</span> 
<span class="hl-tag">&lt;/pfx:image&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.renderextensions"></a>5.3.4.&nbsp;Dynamically including parts at rendering time</h3></div></div></div><p>
       Include parts can be also rendered standalone and included at runtime/rendering time on the last transformation level.
       Thus you can include parts dynamically, e.g. you can include a part based on information from the result tree, which
       isn't available on the former transformation levels. This can also help to keep your stylesheets small, but it also has
       some drawbacks: standalone rendering of a part costs more time than doing a regular include and the XML source context
       node can only be relative if the part is rendered within the main transformation, and not standalone, e.g. triggered by an AJAX call.
      </p><p>
         Render includes are done using the <code class="literal">&lt;pfx:render&gt;</code> tag. Its syntax is similar to <code class="literal">&lt;pfx:include&gt;</code>.
         But referenced parts additionally have to be marked as render parts using the <code class="literal">render</code> attribute.
         You can optionally specify in which variants a render part should be available. All this is necessary
         to know which parts can be invoked dynamically when pre-generating all pages for production environments.
         Setting the <code class="literal">contextual</code> attribute to <code class="literal">true</code> you can specify that a part is context-dependent,
         meaning that the initial context node for the transformation will be set to the current context node of the main transformation.
      </p><pre class="programlisting"><span class="hl-tag">&lt;include_parts&gt;</span>
  <span class="hl-tag">&lt;part</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Foo"</span> <span class="hl-attribute">render</span>=<span class="hl-value">"true"</span> <span class="hl-attribute">render-variants</span>=<span class="hl-value">"foo foo:bar:baz"</span> <span class="hl-attribute">contextual</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;theme</span> <span class="hl-attribute">name</span>=<span class="hl-value">"default"</span><span class="hl-tag">&gt;</span>
      ...
    <span class="hl-tag">&lt;/theme&gt;</span>
  <span class="hl-tag">&lt;/part&gt;</span>
<span class="hl-tag">&lt;/include_parts&gt;</span></pre><p>
        A part is referenced with at least a <code class="literal">part</code> attribute. The <code class="literal">path</code> to the include file can be omitted
        if you're referencing a part within the same file. Using <code class="literal">module</code> and/or <code class="literal">search</code> you can reference
        parts from modules or do dynamic lookups. 
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:render</span> <span class="hl-attribute">href</span>=<span class="hl-value">"txt/common.xml"</span> <span class="hl-attribute">part</span>=<span class="hl-value">"Foo"</span><span class="hl-tag">/&gt;</span></pre><p>
        </p><div class="table"><a name="d0e3630"></a><p class="title"><b>Table&nbsp;5.6.&nbsp;Attributes of the pfx:render tag</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
              <th>Attribute name</th>
              <th>Mandatory?</th>
              <th>Description</th>
            </tr></thead><tbody><tr>
              <td>href</td>
              <td>optional</td>
              <td>If not set, it defaults to the current include part file.</td>
            </tr><tr>
              <td>part</td>
              <td>mandatory</td>
              <td>The name of the part to include</td>
            </tr><tr>
              <td>search</td>
              <td>optional</td>
              <td>Not set by default. Set this to <code class="literal">dynamic</code> if a matching part should be dynamically searched. See <a class="xref" href="#advanced.dyninclude" title="7.5.&nbsp;Dynamic resource inclusion">Section&nbsp;7.5, &#8220;Dynamic resource inclusion&#8221;</a>.</td>
            </tr><tr>
              <td>module</td>
              <td>optional</td>
              <td>Not set by default. Set this to the name of the module from which the part should be loaded. See <a class="xref" href="#advanced.dyninclude" title="7.5.&nbsp;Dynamic resource inclusion">Section&nbsp;7.5, &#8220;Dynamic resource inclusion&#8221;</a>.</td>
            </tr></tbody></table></div></div><p><br class="table-break">
      </p><p>
        Render include parts not just can be rendered as part of another page within the main transformation, but they can be also  
        rendered standalone. Therefor Pustefix provides a Javascript API which lets you easily request a part via AJAX. 
      </p><a name="xslt.renderextensions.javascript"></a><pre class="programlisting"><span class="hl-tag">&lt;script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span> <span class="hl-attribute">src</span>=<span class="hl-value">"{$__contextpath}/modules/pustefix-core/script/httpRequest.js"</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;/script&gt;</span>
<span class="hl-tag">&lt;script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span> <span class="hl-attribute">src</span>=<span class="hl-value">"{$__contextpath}/modules/pustefix-core/script/render.js"</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;/script&gt;</span>

<span class="hl-tag">&lt;script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span><span class="hl-tag">&gt;</span>

   function callback(result) {
      document.getElementById("result").innerHTML = result;
   }

   function errorCallback(res) {
      if(res.status == 403) {
         window.location.reload();  
      } else {
	 //do something else
      }
   }

   function test() {
      // Remotely renders an include part and passes the output to a callback function.
      // Arguments can be passed as list (deprecated) or as single JSON object argument:
      //   href          - path to include file
      //   part          - include part name
      //   module        - module name (optional)
      //   search        - search type (optional)
      //   callback      - callback function (optional)
      //   context       - callback object scope (optional)
      //   requestId     - request/response assignment id (optional)
      //   params        - additional request parameters (optional)
      //   requestPath   - alternative request URL path (optional)
      //   errorCallback - callback function for HTTP errors (optional)
      // Deprecated version:
      //   pfx.render("txt/common.xml", "Foo", "", "", callback, null, "1", null, null, errorCallback);
      // Recommended version:
      var args = { "href": "txt/common.xml",
                   "part": "Foo", 
                   "callback": callback, 
                   "requestId": "1", 
		   "errorCallback": errorCallback };
      pfx.render(args);

      // you can alternatively set a global error function which is called
      // for all HTTP request errors in the abscence of a specific funtion:
      pfx.net.HTTPRequest.errorCallback = function(res) { alert(JSON.stringify(res)); };
   }
<span class="hl-tag">&lt;/script&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.pfx.checkinclude"></a>5.3.5.&nbsp;Checking include part existence (&lt;pfx:checkinclude&gt;)</h3></div></div></div><p>
        The <code class="literal">&lt;pfx:checkinclude&gt;</code> and <code class="literal">&lt;pfx:checknoinclude&gt;</code> tags can be used to display content
        depending on the existence of an include part.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:checkinclude</span> <span class="hl-attribute">part</span>=<span class="hl-value">"foo"</span> <span class="hl-attribute">href</span>=<span class="hl-value">"txt/afile.xml"</span><span class="hl-tag">&gt;</span>
  Display if part exists
<span class="hl-tag">&lt;/pfx:checkinclude&gt;</span>

<span class="hl-tag">&lt;pfx:checknoinclude</span> <span class="hl-attribute">part</span>=<span class="hl-value">"bar"</span> <span class="hl-attribute">href</span>=<span class="hl-value">"txt/afile.xml"</span><span class="hl-tag">&gt;</span>
  Display if part not exists
<span class="hl-tag">&lt;/pfx:checknoinclude

&lt;pfx:checkinclude href="txt/afile.xml" module="amodule" search="dynamic" level="runtime"&gt;</span>
  <span class="hl-tag">&lt;pfx:part&gt;</span><span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"/formresult/displaypart/@name"</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/pfx:part&gt;</span>
  Display if part exists
<span class="hl-tag">&lt;/pfx:checkinclude&gt;</span>
</pre><p>Supported attributes and usage comply with the <code class="literal">&lt;pfx:include&gt;</code> element (see <a class="xref" href="#xslt.pfx.include" title="5.3.1.&nbsp;Include parts (<pfx:include&gt;)">Section&nbsp;5.3.1, &#8220;Include parts (&lt;pfx:include&gt;)&#8221;</a>).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.pfx.includeparams"></a>5.3.6.&nbsp;Include parameters (&lt;pfx:includeparam&gt;)</h3></div></div></div><p>
        When including a part using <code class="literal">&lt;pfx:include&gt;</code>, you can pass parameters, which will be available within the templates
        applied during the current XSL transformation.
      </p><p>
        An include parameter can be passed by adding an according <code class="literal">&lt;pfx:includeparam&gt;</code> child element to the <code class="literal">&lt;pfx:include&gt;</code> element.
        The syntax is similar to XSL template parameters.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:include</span> <span class="hl-attribute">part</span>=<span class="hl-value">"foo"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;pfx:includeparam</span> <span class="hl-attribute">name</span>=<span class="hl-value">"myparam"</span><span class="hl-tag">&gt;</span>myvalue<span class="hl-tag">&lt;/pfx:includeparam&gt;</span>
  <span class="hl-tag">&lt;pfx:includeparam</span> <span class="hl-attribute">name</span>=<span class="hl-value">"another"</span> <span class="hl-attribute">select</span>=<span class="hl-value">"/xpath/expression"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;pfx:includeparam</span> <span class="hl-attribute">name</span>=<span class="hl-value">"xmlparam"</span> <span class="hl-attribute">tunnel</span>=<span class="hl-value">"yes"</span><span class="hl-tag">&gt;</span>
     <span class="hl-tag">&lt;item</span> <span class="hl-attribute">id</span>=<span class="hl-value">"foo"</span><span class="hl-tag">/&gt;</span>
     <span class="hl-tag">&lt;item</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bar"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/pfx:include&gt;</span>
<span class="hl-tag">&lt;/pfx:include&gt;</span>
</pre><p>Include parameter values can be simple strings, nodesets or evaluation results of XPath expressions. Include parameters can be tunneled, i.e.
            you can pass parameters to nested includes without having to newly declare the parameter on each include level.
      </p><p>
        Within the included part you can access passed include parameters by declaring them at the top of the part. Like with XSL parameters, you can just declare empty
        parameters, set default values or mark a parameter as tunneled (without marking it, it will be overlaid). 
      </p><pre class="programlisting"><span class="hl-tag">&lt;part</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hey"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;theme</span> <span class="hl-attribute">name</span>=<span class="hl-value">"default"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;pfx:includeparam</span> <span class="hl-attribute">name</span>=<span class="hl-value">"myparam"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;pfx:includeparam</span> <span class="hl-attribute">name</span>=<span class="hl-value">"another"</span><span class="hl-tag">&gt;</span>default<span class="hl-tag">&lt;/pfx:include-param&gt;</span>
    <span class="hl-tag">&lt;pfx:includeparam</span> <span class="hl-attribute">name</span>=<span class="hl-value">"xmlparam"</span> <span class="hl-attribute">tunnel</span>=<span class="hl-value">"yes"</span><span class="hl-tag">/&gt;</span>
</pre><p>
        Having declared an include parameter, you can use one of Pustefix's builtin templates to operate on this parameter, e.g. write its value, iterate over its value
        or check a condition against it. You can not only reference the parameter itself, but write complex XPath expressions.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"$myparam"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;pfx:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"concat($myparam,'xyz')"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;pfx:for-each</span> <span class="hl-attribute">select</span>=<span class="hl-value">"$xmlparam/item"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;pfx:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"@id"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/pfx:for-each&gt;</span>

<span class="hl-tag">&lt;pfx:if</span> <span class="hl-attribute">test</span>=<span class="hl-value">"$another='...'"</span><span class="hl-tag">&gt;</span>...<span class="hl-tag">&lt;/pfx:if&gt;</span>

<span class="hl-tag">&lt;pfx:choose&gt;</span>
  <span class="hl-tag">&lt;pfx:when</span> <span class="hl-attribute">test</span>=<span class="hl-value">"$another='...'"</span><span class="hl-tag">&gt;</span>...<span class="hl-tag">&lt;/pfx:when
  &lt;pfx:otherwise&gt;</span>...<span class="hl-tag">&lt;/pfx:otherwise&gt;</span>
<span class="hl-tag">&lt;/pfx:choose&gt;</span>
</pre><p>
        Basically these tags are working similar to the according XSLT base tags, i.e. the templates matching these tags, are internally calling the suitable XSLT statements. But you have to be aware that there's a difference between applying templates on XML tags and directly executing XSLT statements. Here's the list of all supported tags:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">pfx:value-of</li><li class="listitem">pfx:copy-of</li><li class="listitem">pfx:if</li><li class="listitem">pfx:choose / pfx:when / pfx:otherwise</li><li class="listitem">pfx:for-each / pfx:sort</li><li class="listitem">pfx:element</li><li class="listitem">pfx:attr</li></ul></div><p>
        Besides these special templates some of Pustefix's core templates also have support for include parameters, i.e. the according elements provide
        attributes which support include parameters or XPath expressions. Usually these attributes are prefixed with <code class="literal">select-</code>.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:include</span> <span class="hl-attribute">select-href</span>=<span class="hl-value">"$myparam"</span> <span class="hl-attribute">select-part</span>=<span class="hl-value">"concat($anotherparam,'xyz')"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;pfx:checkinclude</span> <span class="hl-attribute">select-part</span>=<span class="hl-value">"$myparam"</span> <span class="hl-attribute">select-href</span>=<span class="hl-value">"..."</span><span class="hl-tag">/&gt;</span> 

<span class="hl-tag">&lt;pfx:checknoinclude</span> <span class="hl-attribute">select-part</span>=<span class="hl-value">"$myparam"</span> <span class="hl-attribute">select-href</span>=<span class="hl-value">"..."</span><span class="hl-tag">/&gt;</span> 

<span class="hl-tag">&lt;pfx:image</span> <span class="hl-attribute">select-src</span>=<span class="hl-value">"$myparam"</span> <span class="hl-attribute">select-alt</span>=<span class="hl-value">"..."</span><span class="hl-tag">/&gt;</span>
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xslt.messages"></a>5.4.&nbsp;Displaying messages</h2></div></div></div><p>
      Pustefix can display messages coming from a Spring <code class="literal">MessageSource</code>. It's an alternative to outputting text using include parts
      as described in <a class="xref" href="#xslt.pfx.include" title="5.3.1.&nbsp;Include parts (<pfx:include&gt;)">Section&nbsp;5.3.1, &#8220;Include parts (&lt;pfx:include&gt;)&#8221;</a>, especially suitable if you want to use already exisiting internationalization mechanisms, like
      resource bundles or gettext PO files, or if you need to access the messages from within the Java logic.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.messages.tags"></a>5.4.1.&nbsp;Message tags</h3></div></div></div><p>
        Messages can be displayed using the <code class="literal">&lt;pfx:message&gt;</code> tag. You need to specify a <code class="literal">key</code> referencing the
        message ID (or property key in terms of property files).
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:message</span> <span class="hl-attribute">key</span>=<span class="hl-value">"my.message.key"</span><span class="hl-tag">/&gt;</span></pre><p>
        Messages can have arguments which are passed using <code class="literal">&lt;pfx:arg&gt;</code> tags. Pustefix automatically fills them in at the specified
        position (denoted by the message string placeholders <code class="literal">{0}</code>, <code class="literal">{1}</code>, etc.).
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:message</span> <span class="hl-attribute">key</span>=<span class="hl-value">"my.message.key"</span><span class="hl-tag">&gt;</span>
   <span class="hl-tag">&lt;pfx:arg&gt;</span>my argument<span class="hl-tag">&lt;/pfx:arg&gt;</span>
   <span class="hl-tag">&lt;pfx:arg&gt;</span>another argument<span class="hl-tag">&lt;/pfx:arg&gt;</span>
<span class="hl-tag">&lt;/pfx:message&gt;</span>
</pre><p>
        If the message string contains markup or you're passing markup as argument, you have to set the attribute <code class="literal">disable-output-escaping</code>
        to <code class="literal">yes</code>, if you want to render the markup without escaping it:
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:message</span> <span class="hl-attribute">key</span>=<span class="hl-value">"my.message.key"</span> <span class="hl-attribute">disable-output-escaping</span>=<span class="hl-value">"yes"</span><span class="hl-tag">&gt;</span>
   <span class="hl-tag">&lt;pfx:arg&gt;</span><span class="hl-tag">&lt;pfx:button</span> <span class="hl-attribute">page</span>=<span class="hl-value">"test"</span><span class="hl-tag">&gt;</span>testlink<span class="hl-tag">&lt;/pfx:button&gt;</span><span class="hl-tag">&lt;/pfx:arg&gt;</span>
<span class="hl-tag">&lt;/pfx:message&gt;</span>
</pre><p>
        Besides the message arguments, the message key itself can be set at runtime, e.g. for dynamically including messages based on values from
        the DOM tree:
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:message&gt;</span>
   <span class="hl-tag">&lt;pfx:key&gt;</span><span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"/formresult/path/to/@messageid"</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/pfx:key&gt;</span>
<span class="hl-tag">&lt;/pfx:message&gt;</span>
</pre><p>
        Using the <code class="literal">&lt;pfx:checkmessage&gt;</code> and <code class="literal">&lt;pfx:checknomessage&gt;</code> tags you can check if a message is
        existing or not:
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:checkmessage</span> <span class="hl-attribute">key</span>=<span class="hl-value">"my.message.key"</span><span class="hl-tag">&gt;</span>
   <em class="hl-comment" style="color: silver">&lt;!-- Apply if message exists --&gt;</em>
<span class="hl-tag">&lt;/pfx:checkmessage&gt;</span>
<span class="hl-tag">&lt;pfx:checknomessage</span> <span class="hl-attribute">key</span>=<span class="hl-value">"my.message.key"</span><span class="hl-tag">&gt;</span>
   <em class="hl-comment" style="color: silver">&lt;!-- Apply if message not exists --&gt;</em>
<span class="hl-tag">&lt;/pfx:checknomessage&gt;</span>
<span class="hl-tag">&lt;pfx:checkmessage</span> <span class="hl-attribute">key</span>=<span class="hl-value">"my.message.key"</span><span class="hl-tag">&gt;</span>
   <span class="hl-tag">&lt;pfx:checkpassed&gt;</span>
      <em class="hl-comment" style="color: silver">&lt;!-- Apply if message exists --&gt;</em>
   <span class="hl-tag">&lt;/pfx:checkpassed
   &lt;pfx:checkfailed&gt;</span>
      <em class="hl-comment" style="color: silver">&lt;!-- Apply if message not exists --&gt;</em>
   <span class="hl-tag">&lt;/pfx:checkfailed&gt;</span>
<span class="hl-tag">&lt;/pfx:checkmessage&gt;</span>
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.messages.configuration"></a>5.4.2.&nbsp;MessageSource configuration</h3></div></div></div><p>
        The <code class="literal">MessageSource</code> can either be configured using Spring means, or, as recommended, within the Pustefix project configuration
        (which makes it available during pre-generation of the pages too). 
      </p><p>
        You can specify one or more <code class="literal">MessageSources</code> (the latter ones will serve as parent <code class="literal">MessageSource</code> for the former ones).
        For each <code class="literal">MessageSource</code> you have to specify its type (<code class="literal">po</code> or <code class="literal">properties</code>) and one or more 
        <code class="literal">basenames</code>.
      </p><pre class="programlisting"><span class="hl-tag">&lt;messagesources&gt;</span>
   <span class="hl-tag">&lt;messagesource</span> <span class="hl-attribute">type</span>=<span class="hl-value">"po"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;basename&gt;</span>module://common-module/i18n/messages<span class="hl-tag">&lt;/basename&gt;</span>
      <span class="hl-tag">&lt;basename&gt;</span>module://common-module/i18n/errors<span class="hl-tag">&lt;/basename&gt;</span>
   <span class="hl-tag">&lt;/messagesource&gt;</span>
   <span class="hl-tag">&lt;messagesource</span> <span class="hl-attribute">type</span>=<span class="hl-value">"properties"</span> <span class="hl-attribute">basename</span>=<span class="hl-value">"/WEB-INF/messages"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/messagesources&gt;</span>
</pre><p>
        According to the specified type and selected locale Pustefix will look up the messages in all matching files, e.g. for the locale <code class="literal">en_UK</code>
        starting with <code class="literal">messages_en_UK.po</code>, <code class="literal">messages_en.po</code> and <code class="literal">messages.po</code>, whereas messages in previous
        files (previous <code class="literal">basename</code> or <code class="literal">MessageSources</code>) override later ones. 
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3884"></a>5.4.3.&nbsp;Message format</h3></div></div></div><p>
        Messages in property or po files should conform to the Java <code class="literal">java.text.MessageFormat</code> standard, see the following examples:
      </p><pre class="screen">#Sample property file
my.message.key=My message text
another.key=Message text with arguments {0} and {1}
</pre><pre class="screen">#Sample po file
msgid "my.message.key"
msgstr "My message text"
msgid "another.key"
msgstr "Message text with arguments {0} and {1}"
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xslt.forms"></a>5.5.&nbsp;Handling HTML forms</h2></div></div></div><p>
      Pustefix supplies a complete set of tags that replace the standard HTML form element tags.
      The advantage of using these tags is that they are automatically pre-filled with values delivered from the backend.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.pfx.forminput"></a>5.5.1.&nbsp;Form creation</h3></div></div></div><p>
        The creation of a html form is done with the help of the tag <code class="literal">&lt;pfx:forminput&gt;</code>.
        Most often you don't need to set any attributes, the defaults should work just fine.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:forminput</span> <span class="hl-attribute">send-to-page</span>=<span class="hl-value">"APage"</span> <span class="hl-attribute">send-to-pageflow</span>=<span class="hl-value">"APageFlow"</span> <span class="hl-attribute">frame</span>=<span class="hl-value">"AFrameName"</span> <span class="hl-attribute">target</span>=<span class="hl-value">"ATargetName"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"auth|data"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- place form elements here --&gt;</em>
<span class="hl-tag">&lt;/pfx:forminput&gt;</span></pre><p>
        </p><div class="table"><a name="d0e3913"></a><p class="title"><b>Table&nbsp;5.7.&nbsp;Attributes of the pfx:forminput tag</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
              <th>Attribute name</th>
              <th>Mandatory?</th>
              <th>Description</th>
            </tr></thead><tbody><tr>
              <td>type</td>
              <td>optional</td>
              <td>
                <p>
                  Defaults to <code class="literal">data</code>. Must be set to <code class="literal">auth</code>, if the submitted information contains
                  authentication data (e.g. userid, password).
                </p>
              </td>
            </tr><tr>
              <td>target</td>
              <td>optional</td>
              <td>
                <p>
                  Defaults to the parent frame (if frames are used, current window otherwise)
                </p>
              </td>
            </tr><tr>
              <td>frame</td>
              <td>optional</td>
              <td>
                <p>
                  This is used to select which named frame is about to be loaded into the target frame after submit. The default when frames are used is the parent frame.
                </p>
                <p>
                  Most often you have to set neither frame nor target.
                </p>
              </td>
            </tr><tr>
              <td>send-to-page</td>
              <td>optional</td>
              <td>
                <p>
                  Selects the page the submitted data is send to. Default is to use the current page. Most of the time, this is the right thing to do.
                </p>
              </td>
            </tr><tr>
              <td>send-to-pageflow</td>
              <td>optional</td>
              <td>
                <p>
                  Should not be used. Selects the pageflow to use. Default is to not set a pageflow name explicitely, but
                  let the backend reuse the current flow or select a matching one. Leave it that way if you don't know
                  why you want to change it. If you want to select a pageflow to use, better do so via the submit button as
                  explained below. Note that this mechanism will most likely not work when using the
                  <code class="literal">send-to-pageflow</code> attribute here.        
                </p>
              </td>
            </tr></tbody></table></div></div><p><br class="table-break">
      </p><p>
        Pustefix usually by default generates some hidden fields which are placed directly under the HTML <code class="literal">form</code> tag, but you
        can explicitely control where Pustefix should place the fields using the <code class="literal">&lt;pfx:hiddenfields/&gt;</code> element.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:forminput&gt;</span>
  <span class="hl-tag">&lt;div&gt;</span>
    <span class="hl-tag">&lt;pfx:hiddenfields/&gt;</span>
  <span class="hl-tag">&lt;/div&gt;</span>
<span class="hl-tag">&lt;/pfx:forminput&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.forms.submit"></a>5.5.2.&nbsp;Submitting forms</h3></div></div></div><p>
        Make sure that all the other form related tags detailed below are contained inside a <code class="literal">pfx:forminput</code> block.
      </p><p>
        The form can be submitted by clicking on submit controls which can be realized in two ways:
        The simple html submit button is made with the tag <code class="literal">&lt;pfx:xinp type="submit"&gt;</code>, while using an
        image as the submit control is done with <code class="literal">&lt;pfx:xinp type="image"&gt;</code>.
      </p><p>
        A very useful ability of both submit controls is that it's possible to attach additional form parameters to them,
        that are only transmitted when that exact submit control is pressed. This way it's possible for a form to have two or
        more submit controls, each with different additional data attached and submitted, depending on which submit
        control the user clicks on.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:xinp</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit|image"</span> <span class="hl-attribute">pageflow</span>=<span class="hl-value">"APageFlow"</span> <span class="hl-attribute">jumptopage</span>=<span class="hl-value">"APage"</span> <span class="hl-attribute">jumptopageflow</span>=<span class="hl-value">"APageFlow"</span> <span class="hl-attribute">forcestop</span>=<span class="hl-value">"true|false|step"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!--
    Attach additional information to the controls
  --&gt;</em>
  <span class="hl-tag">&lt;pfx:command</span> <span class="hl-attribute">page</span>=<span class="hl-value">"APage"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"SUBWRP"</span><span class="hl-tag">&gt;</span>prefix<span class="hl-tag">&lt;/pfx:command&gt;</span>
  <span class="hl-tag">&lt;pfx:argument</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AName"</span><span class="hl-tag">&gt;</span>AValue<span class="hl-tag">&lt;/pfx:argument&gt;</span>
  <span class="hl-tag">&lt;pfx:anchor</span> <span class="hl-attribute">frame</span>=<span class="hl-value">"AFrame"</span><span class="hl-tag">&gt;</span>AnAnchor<span class="hl-tag">&lt;/pfx:anchor&gt;</span>
<span class="hl-tag">&lt;/pfx:xinp&gt;</span></pre><p>
        </p><div class="table"><a name="d0e4044"></a><p class="title"><b>Table&nbsp;5.8.&nbsp;Attributes of form submit controls</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
              <th>Attribute name</th>
              <th>Mandatory?</th>
              <th>Description</th>
            </tr></thead><tbody><tr>
              <td>type</td>
              <td>mandatory</td>
              <td>
                <p>
                  <code class="literal">submit</code> creates a simple html submit button, <code class="literal">image</code> uses an image as the submit button.
                </p>
              </td>
            </tr><tr>
              <td>pageflow</td>
              <td>optional</td>
              <td>
                <p>
                  Used to explicitely set a pagflow to use after the submit has been handled sucessfully.
                  Note that there is no corresponding way to set the page the submit is directed at, you need to
                  set the send-to-page attribute of the <code class="literal">pfx:forminput</code> tag.
                </p>
              </td>
            </tr><tr>
              <td>jumptopage / jumptopageflow</td>
              <td>optional</td>
              <td>
                <p>
                  If you don't want the pageflow mechanism to control which page to display as the next page after a
                  successful submit, you can set this page via the <code class="literal">jumptopage</code> attribute. In this case,
                  you also have the possibility to set the pageflow to use for this follow-up page and submit circle via
                  the <code class="literal">jumptopageflow</code> attribute.
                </p>
              </td>
            </tr><tr>
              <td>forcestop</td>
              <td>optional</td>
              <td>
                <p>
                  Default is false. If you don't want the pageflow mechanism control wether to stay on the current page
                  after a successful submit or not, you can unconditionally force it to stay on the current page
                  (when setting the attribute to <code class="literal">true</code>). Alternatively, if you want the pageflow mechanism
                  to stop at most no more than one step further in the flow (e.g. a wizard like application) you can set
                  this attribute to <code class="literal">step</code>.
                </p>
              </td>
            </tr></tbody></table></div></div><p><br class="table-break">
      </p><p>
        When setting the type to <code class="literal">image</code>, you may also specify the attributes <code class="literal">src</code>,
        <code class="literal">themed-path</code>, <code class="literal">themed-img</code>, <code class="literal">search</code> and <code class="literal">module</code>. These attributes work exactly as described in
        <a class="xref" href="#xslt.pfx.image" title="5.3.3.&nbsp;Displaying images (<pfx:image&gt;)">Section&nbsp;5.3.3, &#8220;Displaying images (&lt;pfx:image&gt;)&#8221;</a>.
      </p><p>
         You can alternatively use the <code class="literal">pfx:submitbutton</code> tag to produce a <code class="literal">button</code> element instead of an <code class="literal">input</code> element. The <code class="literal">button</code> elements are more flexible than the traditional <code class="literal">input</code> elements, but are not supported by some old browsers.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:submitbutton</span> <span class="hl-attribute">pageflow</span>=<span class="hl-value">"APageFlow"</span> <span class="hl-attribute">jumptopage</span>=<span class="hl-value">"APage"</span> <span class="hl-attribute">jumptopageflow</span>=<span class="hl-value">"APageFlow"</span> <span class="hl-attribute">forcestop</span>=<span class="hl-value">"true|false|step"</span><span class="hl-tag">&gt;</span>
      <em class="hl-comment" style="color: silver">&lt;!-- you can put additional stuff here as described above, but in contrast to the traditional
           submit element you can also have content (like text or images) here --&gt;</em>
<span class="hl-tag">&lt;/pfx:submitbutton&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.controls.arguments"></a>5.5.3.&nbsp;Arguments, comands and anchors</h3></div></div></div><p>
        Command controls (like described in <a class="xref" href="#xslt.forms.submit" title="5.5.2.&nbsp;Submitting forms">Section&nbsp;5.5.2, &#8220;Submitting forms&#8221;</a>) and links (like described in <a class="xref" href="#xslt.pfx.button" title="5.2.1.&nbsp;pfx:button">Section&nbsp;5.2.1, &#8220;pfx:button&#8221;</a>)
        can contain child tags that are used to pass additional data when the link or button is clicked.
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="xslt.pfx.anchor"></a>Anchors</h4></div></div></div><p>
          The <code class="literal">&lt;pfx:anchor&gt;</code> tag is used to supply an anchor for a link or submit button.
        </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:anchor</span> <span class="hl-attribute">frame</span>=<span class="hl-value">"AFrame"</span><span class="hl-tag">&gt;</span>AnAnchor<span class="hl-tag">&lt;/pfx:anchor&gt;</span></pre><p>
          The content gives the name of the anchor as it's defined in the target page.
        </p><p>
          </p><div class="table"><a name="d0e4202"></a><p class="title"><b>Table&nbsp;5.9.&nbsp;Attributes of pfx:anchor</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
                <th>Attribute name</th>
                <th>Mandatory?</th>
                <th>Description</th>
              </tr></thead><tbody><tr>
                <td>frame</td>
                <td>optional</td>
                <td>
                  <p>
                    You need to set it if the page uses frames or not. In this case you can use more than on pfx:anchor tag, one for
                    each frame you want to define an anchor for. This way it's possible to scroll each frame independently to the
                    desired position with one request (without the need for JavaScript). If you don't use frames, only one pfx:anchor
                    tag makes sense, without a frame attribute. 
                  </p>
                </td>
              </tr></tbody></table></div></div><p><br class="table-break">
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="xslt.pfx.argument"></a>Arguments</h4></div></div></div><p>
          The <code class="literal">&lt;pfx:argument&gt;</code> tag is used to supply additional parameters for the request.
        </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:argument</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AName"</span><span class="hl-tag">&gt;</span>AValue<span class="hl-tag">&lt;/pfx:argument&gt;</span></pre><p>
          The content gives the value of the parameter to submit. It's also possible that this value is only known at runtime by using values dynamically supplied from the DOM tree. This may be handled like here:
       </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:argument</span> <span class="hl-attribute">name</span>=<span class="hl-value">"foo"</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"/formresult/bar"</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;pfx:argument&gt;</span></pre><p>
          </p><div class="table"><a name="d0e4249"></a><p class="title"><b>Table&nbsp;5.10.&nbsp;Attributes of pfx:argument</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
                <th>Attribute name</th>
                <th>Mandatory?</th>
                <th>Description</th>
              </tr></thead><tbody><tr>
                <td>name</td>
                <td>mandatory</td>
                <td>
                  <p>
                    The name of the argument to submit.
                  </p>
                </td>
              </tr></tbody></table></div></div><p><br class="table-break">
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="xslt.pfx.command"></a>Commands</h4></div></div></div><p>
          The <code class="literal">&lt;pfx:command&gt;</code> tag can be used to explicitly select the wrappers on a page, which should be used
          for handling the submitted data or retrieving the updated data after a successful submit.
        </p><pre class="programlisting"> <span class="hl-tag">&lt;pfx:command</span> <span class="hl-attribute">page</span>=<span class="hl-value">"APage"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"SUBWRP|RETWRP"</span><span class="hl-tag">&gt;</span>prefix<span class="hl-tag">&lt;/pfx:command&gt;</span></pre><p>
          The content gives the prefix of the wrapper to select as defined on the target page.
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
            If you don't give any selected wrappers for submit handling (<code class="literal">SUBWRP</code>), all wrappers defined on the target page become selected for submit handling.
          </p><p>
            If you don't give any selected wrappers for retrieving data after successful submits (<code class="literal">RETWRP</code>), no wrappers are selected for retrieving data.
          </p><p>
            It's recommended to use actions instead of commands. Actions let you define the selected wrappers within the configuration, which is a much cleaner approach.
          </p></td></tr></table></div><p>
          </p><div class="table"><a name="d0e4307"></a><p class="title"><b>Table&nbsp;5.11.&nbsp;Attributes of pfx:command</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
                <th>Attribute name</th>
                <th>Mandatory?</th>
                <th>Description</th>
              </tr></thead><tbody><tr>
                <td>name</td>
                <td>mandatory</td>
                <td>
                  <p>
                    The name of the command. Currently, the supported commands are <code class="literal">SUBWRP</code>, <code class="literal">RETWRP</code> and
                    the deprecated <code class="literal">SELWRP</code>, which is an equivalent of <code class="literal">SUBWRP</code> and only supported for backwards compatibility.
                  </p>
                  <p>
                    All commands select a wrapper with the matching prefix on the page that is designated by the page attribute
                    (or the current page, when empty).
                  </p>
                  <p>
                    <code class="literal">SUBWRP</code> selects a wrapper that should be used for handling the data that is submitted.
                  </p>
                  <p>
                    <code class="literal">RETWRP</code> selects a wrapper whose data should be retrieved/updated after a successfull submit.
                  </p>
                  <p>
                   You can use more than one pfx:command to select as many wrappers as you want.
                  </p>
                  <p>
                    Note: As the recommended way to select wrappers for submitting/retrieving data is the action mechanism, it is possible that the 
                    whole pfx:command stuff will go away in future releases.
                  </p>
                </td>
              </tr><tr>
                <td>page</td>
                <td>optional</td>
                <td>
                  <p>
                    Most often empty. This should be set to the page the request is directed at if it's not the current page.
                  </p>
                </td>
              </tr></tbody></table></div></div><p><br class="table-break">
        </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.forms.elements"></a>5.5.4.&nbsp;Form elements</h3></div></div></div><p>
        Using these form element tags ensures that values, that are supplied by the backend application are used as
        values for the generated html form elements. This is done dynamically by generating the necessary <code class="literal">ixsl:</code>
        statements that will check the DOM tree for matching values and adding them as value attributes (text, password and hidden
        input fields) or content (text areas) or selecting them according to their value (check boxes, radio boxes, option menus).
      </p><p>
        Another thing these tags do is to automatically check if the runtime DOM tree contains an error attached to their name.
        In this case, the resulting html input field is augmented with special CSS classes to help with styling these fields
        depending on the state they have (error/no error).
      </p><p>
        Typically the CSS used when no attached error is detected is just the value of a class attribute given to the pustefix
        input tag. On the other hand, if an error is attached, the class attribute looks like this:
      </p><pre class="programlisting">[@class] PfxError PfxInputTextError [PfxErrorLevel_$level]</pre><p>
        where <code class="literal">@class</code> is the user supplied class attribute mentioned above (if it's there at all) and
        <code class="literal">$level</code> is an optional attribute of the error element in the runtime DOM tree. The example works the
        same for other input fields of the form <code class="literal">&lt;input type="..."&gt;</code>, by replacing
        <code class="literal">"Text"</code> with <code class="literal">"Password"</code>, <code class="literal">"Check"</code> or <code class="literal">"Radio"</code>
        (Hidden input fields are not visible anyway. Select menus and text areas don't need a special class as they can be easily
        selected via CSS rules. For the last two, the error CSS looks like this:
      </p><pre class="programlisting">[@class] PfxError [PfxErrorLevel_$level])</pre><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="xslt.forms.elements.text"></a>Creating a text input field</h4></div></div></div><p>
          Text input fields are created using the <code class="literal">&lt;pfx:xinp&gt;</code> tag.
        </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:xinp</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AName"</span> <span class="hl-attribute">default</span>=<span class="hl-value">"AValue"</span> <span class="hl-attribute">position</span>=<span class="hl-value">"1|..|n"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"ACssClass"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!--
    name and default can also be set at runtime
  --&gt;</em>
  <span class="hl-tag">&lt;pfx:default&gt;</span>
    <span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"/some/runtime/value"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/pfx:default&gt;</span>
  <span class="hl-tag">&lt;pfx:name&gt;</span>
    <span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"/some/runtime/name"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/pfx:name&gt;</span>
 <span class="hl-tag">&lt;/pfx:xinp&gt;</span></pre><p>
          </p><div class="table"><a name="d0e4436"></a><p class="title"><b>Table&nbsp;5.12.&nbsp;Attributes of pfx:xinp[@type="text"]</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
                <th>Attribute name</th>
                <th>Mandatory?</th>
                <th>Description</th>
              </tr></thead><tbody><tr>
                <td>name or &lt;pfx:name&gt;</td>
                <td>mandatory</td>
                <td>
                  <p>
                    The name of the parameter. Use the name attribute when the name is a known literal value. If it must be
                    computed at runtime (e.g. from the runtime DOM tree), you can use the <code class="literal">&lt;pfx:name&gt;</code>
                    child element. In the end, the form of a parameter name should be prefix.InternalName.
                  </p>
                </td>
              </tr><tr>
                <td>name or &lt;pfx:default&gt;</td>
                <td>optional</td>
                <td>
                  <p>
                    The difference between the attribute and the child element form is analog to the description given above.
                    You can use the default specification to pre-set a value for the case that the backend doesn't
                    set one on it's own.
                  </p>
                </td>
              </tr><tr>
                <td>position</td>
                <td>optional</td>
                <td>
                  <p>
                    Default is <code class="literal">1</code>. Useful only for parameters which are defined to occur multiple times, i.e.
                    the same parameter name may appear more than one time in the output from the backend system to pre-fill
                    elements on the UI. Wiht position you can decide, which of those multiple outputs under the same name you
                    want to reference for the pre-filled value.
                  </p>
                </td>
              </tr><tr>
                <td>class</td>
                <td>optional</td>
                <td>
                  <p>
                    See <a class="xref" href="#xslt.forms.elements" title="5.5.4.&nbsp;Form elements">Section&nbsp;5.5.4, &#8220;Form elements&#8221;</a> for an explanation on how the CSS class(es) for the html
                    element are constructed.
                  </p>
                </td>
              </tr></tbody></table></div></div><p><br class="table-break">
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="xslt.forms.elements.textarea"></a>Creating a text area field</h4></div></div></div><p>
          Text area fields are created the same way as text input fields (see <a class="xref" href="#xslt.forms.elements.text" title="Creating a text input field">the section called &#8220;Creating a text input field&#8221;</a>),
          you only have to set the <code class="literal">type</code> attribute to <code class="literal">area</code>.
        </p><p>
          Basically the same attributes as for <code class="literal">&lt;pfx:xinp type="text"&gt;</code>, with the exception
          that there's no default attribute. The same way as it works for the html textarea tag, the content
          of the element (minus the special <code class="literal">&lt;pfx:name&gt;</code> child) becomes the default value
          for the form input element.
        </p><p>
          If you plan to mix the content with additional non-content markup, you should put the default content into
          a <code class="literal">&lt;pfx:default&gt;</code> element. Thus the non-content markup is copied through, even if the
          default content isn't applied because of existing content from the DOM tree.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="xslt.forms.elements.password"></a>Creating a password field</h4></div></div></div><p>
          Password fields are created the same way as text input fields (see <a class="xref" href="#xslt.forms.elements.text" title="Creating a text input field">the section called &#8220;Creating a text input field&#8221;</a>),
          you only have to set the <code class="literal">type</code> attribute to <code class="literal">password</code>.
        </p><p>
          Similar to <code class="literal">&lt;pfx:xinp type="text"&gt;</code>, but without the ability to set a default value from the UI and the position is fixed to be "1".
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="xslt.forms.elements.hidden"></a>Creating a hidden field</h4></div></div></div><p>
          Hidden fields are created the same way as text input fields (see <a class="xref" href="#xslt.forms.elements.text" title="Creating a text input field">the section called &#8220;Creating a text input field&#8221;</a>),
          you only have to set the <code class="literal">type</code> attribute to <code class="literal">hidden</code>.
        </p><p>
          Basically the same attributes as for <code class="literal">&lt;pfx:xinp type="text"&gt;</code>. Of course no special class attribute handling, as the result is invisible anyway.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="xslt.forms.elements.radio"></a>Creating a radio or check box</h4></div></div></div><p>
          Radio buttons and checkboxes are created using the <code class="literal">&lt;pfx:xinp&gt;</code> tag as well.
        </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:xinp</span> <span class="hl-attribute">type</span>=<span class="hl-value">"radio|check"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"AValue"</span> <span class="hl-attribute">default</span>=<span class="hl-value">"true|false"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"ACssClass"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;pfx:name&gt;</span>
    <span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"/some/runtime/name"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/pfx:name&gt;</span>
  <span class="hl-tag">&lt;pfx:value&gt;</span>
    <span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"/some/runtime/value"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/pfx:value&gt;</span>
  <span class="hl-tag">&lt;pfx:default&gt;</span>
    <span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"/runtime/true/or/false"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/pfx:default&gt;</span>
<span class="hl-tag">&lt;/pfx:xinp&gt;</span></pre><p>
          </p><div class="table"><a name="d0e4591"></a><p class="title"><b>Table&nbsp;5.13.&nbsp;Attributes of pfx:xinp[@type="radio|check"]</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
                <th>Attribute name</th>
                <th>Mandatory?</th>
                <th>Description</th>
              </tr></thead><tbody><tr>
                <td>name or &lt;pfx:name&gt;</td>
                <td>mandatory</td>
                <td>
                  <p>
                    The name of the parameter. Use the name attribute when the name is a known literal value. If it must be computed at
                    runtime (e.g. from the runtime DOM tree), you can use the <code class="literal">&lt;pfx:name&gt;</code> child element. In the end,
                    the form of a parameter name should be prefix.InternalName.
                  </p>
                  <p>
                    A group of radio- or checkboxes share the same name and differ by the value they submit when they are checked. 
                  </p>
                </td>
              </tr><tr>
                <td>value or &lt;pfx:value&gt;</td>
                <td>mandatory</td>
                <td>
                  <p>
                    Needed to set the value that is to be submitted when the element is checked. The difference between the attribute and
                    the child element form is analog to the description given above.
                  </p>
                </td>
              </tr><tr>
                <td>default or &lt;pfx:default&gt;</td>
                <td>optional</td>
                <td>
                  <p>
                    Allowed values are <code class="literal">true</code> and <code class="literal">false</code>. The difference between the attribute and
                    the child element form is analog to the description given above. You can use the default specification to decide if
                    the form element is checked for the case that the backend doesn't supply which of the group's members are to be checked.
                  </p>
                </td>
              </tr><tr>
                <td>class</td>
                <td>optional</td>
                <td>
                  <p>
                    See <a class="xref" href="#xslt.forms.elements" title="5.5.4.&nbsp;Form elements">Section&nbsp;5.5.4, &#8220;Form elements&#8221;</a> for an explanation on how the CSS class(es) for the html
                    element are constructed.
                  </p>
                </td>
              </tr></tbody></table></div></div><p><br class="table-break">
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="xslt.forms.elements.select"></a>Creating option menus</h4></div></div></div><p>
          Radio buttons and checkboxes are created using the <code class="literal">&lt;pfx:xinp&gt;</code> and <code class="literal">&lt;pfx:option&gt;</code> tags.
        </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:xinp</span> <span class="hl-attribute">type</span>=<span class="hl-value">"select"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AName"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"ACssClass"</span> <span class="hl-attribute">multiple</span>=<span class="hl-value">"true|false"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;pfx:name&gt;</span>
    <span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"/some/runtime/name"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/pfx:name&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!--
    One option tag per option that is available in the menu
  --&gt;</em>
  <span class="hl-tag">&lt;pfx:option</span> <span class="hl-attribute">value</span>=<span class="hl-value">"AValue"</span> <span class="hl-attribute">default</span>=<span class="hl-value">"true|false"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;pfx:value&gt;</span>
      <span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"/some/runtime/value"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/pfx:value&gt;</span>
    <span class="hl-tag">&lt;pfx:default&gt;</span>
      <span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"/runtime/true/or/false"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/pfx:default&gt;</span>
  <span class="hl-tag">&lt;/pfx:option&gt;</span>
<span class="hl-tag">&lt;/pfx:xinp&gt;</span></pre><p>
          </p><div class="table"><a name="d0e4693"></a><p class="title"><b>Table&nbsp;5.14.&nbsp;Attributes of pfx:xinp[@type="select"]</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
                <th>Attribute name</th>
                <th>Mandatory?</th>
                <th>Description</th>
              </tr></thead><tbody><tr>
                <td>name or &lt;pfx:name&gt;</td>
                <td>mandatory</td>
                <td>
                  <p>
                    The name of the parameter. Use the name attribute when the name is a known literal value. If it must be computed at
                    runtime (e.g. from the runtime DOM tree), you can use the <code class="literal">&lt;pfx:name&gt;</code> child element. In the end,
                    the form of a parameter name should be prefix.InternalName.
                  </p>
                </td>
              </tr><tr>
                <td>class</td>
                <td>optional</td>
                <td>
                  <p>
                    See <a class="xref" href="#xslt.forms.elements" title="5.5.4.&nbsp;Form elements">Section&nbsp;5.5.4, &#8220;Form elements&#8221;</a> for an explanation on how the CSS class(es) for the html
                    element are constructed.
                  </p>
                </td>
              </tr><tr>
                <td>multiple</td>
                <td>optional</td>
                <td>
                  <p>
                    Defaults to false. Set to true when you want to have a select menu with multiple selectable options.
                  </p>
                </td>
              </tr></tbody></table></div></div><p><br class="table-break">
        </p><p>
          </p><div class="table"><a name="d0e4759"></a><p class="title"><b>Table&nbsp;5.15.&nbsp;Attributes of pfx:option</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
                <th>Attribute name</th>
                <th>Mandatory?</th>
                <th>Description</th>
              </tr></thead><tbody><tr>
                <td>value or &lt;pfx:value&gt;</td>
                <td>mandatory</td>
                <td>
                  <p>
                    Needed to set the value that is to be submitted when the element is checked. The difference between
                    the attribute and the child element form is analog to the description given above.
                  </p>
                </td>
              </tr><tr>
                <td>default or &lt;pfx:default&gt;</td>
                <td>optional</td>
                <td>
                  <p>
                    See <a class="xref" href="#xslt.forms.elements" title="5.5.4.&nbsp;Form elements">Section&nbsp;5.5.4, &#8220;Form elements&#8221;</a> for an explanation on how the CSS class(es) for the html
                    element are constructed.
                  </p>
                </td>
              </tr><tr>
                <td>multiple</td>
                <td>optional</td>
                <td>
                  <p>
                    Allowed values are <code class="literal">true</code> and <code class="literal">false</code>. The difference between the
                    attribute and the child element form is analog to the description given above. You can use the default
                    specification to decide if the option is selected for the case that the backend doesn't supply which
                    of the options are to be selected.
                  </p>
                </td>
              </tr></tbody></table></div></div><p><br class="table-break">
        </p><p>
          All other attributes are copied to the resulting HTML element.
        </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.forms.errors"></a>5.5.5.&nbsp;Handling error conditions</h3></div></div></div><p>
        Errors in Pustefix come in two variants:
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
            Field errors that are attached to a form input field and which must be handled on the page the form element is defined on.
          </p></li><li class="listitem"><p>
            Page messages which are (not neccessary fatal) errors or warnings which may or may not be displayed on the current or the following page.
          </p><p>
            Page messages are not associated to a single form element, but are used for general feedback on the status of the application.
          </p></li></ol></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="xslt.forms.errors.fields"></a>Errors attached to a field</h4></div></div></div><p>
          The <code class="literal">&lt;pfx:checkerror&gt;</code> tag is used to display content depending on the fact if a field error
          (or possibly a field error with a special level, prefix or name attribute) is present in the runtime DOM tree. Optionally
          you can restrict displaying on the request trigger type (<code class="literal">direct</code>, <code class="literal">flow</code> or <code class="literal">submit</code>).
          There's also a tag with the inverted semantics, <code class="literal">&lt;pfx:checknoerror&gt;</code>, displaying content if the conditions
          above don't apply:
        </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:checkerror</span> <span class="hl-attribute">level</span>=<span class="hl-value">"ALevel"</span> <span class="hl-attribute">prefix</span>=<span class="hl-value">"APrefix"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"APrefixedName"</span> <span class="hl-attribute">trigger</span>=<span class="hl-value">"direct|flow|submit"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!--
    Content to be displayed when any error with the matching level, prefix or name attribute is present in the
    runtime DOM tree. All attributes are optional, without restricting attributes, any error will trigger
    the display of the content of the pfx:checkerror tag. If a trigger attribute is set, the content will be only
    displayed if the trigger causing the DOM creation matches the attribute value.
  --&gt;</em>
<span class="hl-tag">&lt;/pfx:checkerror&gt;</span>

<span class="hl-tag">&lt;pfx:checknoerror</span> <span class="hl-attribute">level</span>=<span class="hl-value">"ALevel"</span> <span class="hl-attribute">prefix</span>=<span class="hl-value">"APrefix"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"APrefixedName"</span> <span class="hl-attribute">trigger</span>=<span class="hl-value">"direct|flow|submit"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- 
    Inverted semantics as pfx:checkerror: content is displayed if no errors (matching the optional conditions) are found.
  --&gt;</em>
<span class="hl-tag">&lt;/pfx:checknoerror&gt;</span></pre><p>
          The <code class="literal">&lt;pfx:checkfield&gt;</code> tag is used to display error messages depending on the form
          field they are attached to.
        </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:checkfield</span> <span class="hl-attribute">name</span>=<span class="hl-value">"prefix.Name"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;pfx:error&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!--
      Content that's displayed when an error associated to the form field referenced
      in the name attribute is present in the runtime DOM tree.
    --&gt;</em>
  <span class="hl-tag">&lt;/pfx:error&gt;</span>
  <span class="hl-tag">&lt;pfx:normal&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!--
      Content that's displayed when no error associated to the form field referenced
      in the name attribute is present in the runtime DOM tree.
    --&gt;</em>
  <span class="hl-tag">&lt;/pfx:normal&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!--
    Content outside of the two child nodes is displayed in both cases.
  --&gt;</em>
<span class="hl-tag">&lt;/pfx:checkfield&gt;</span></pre><p>
          There can be more than one of <code class="literal">&lt;pfx:error&gt;</code> and <code class="literal">&lt;pfx:normal&gt;</code>
          child nodes. These can be used to display completely different content based on the presence or not of an error.
        </p><p>
          The <code class="literal">&lt;pfx:checkfield&gt;</code> tag defines a set of ixsl variables that can be used inside its body. These are
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
              <code class="literal">$pfx_scode</code>: The StatusCode node that represents the error. This can be used to call
              <code class="literal">ixsl:apply-templates</code> on to display the error message.
            </li><li class="listitem">
              <code class="literal">$pfx_level</code>: The level attribute of the error in the runtime DOM tree (or empty, if
              there's no level attribute).
            </li><li class="listitem">
              <code class="literal">$pfx_class</code>: The CSS class that has been constructed depending on the presence of the error.
              If there's no error, this variable is empty. Else, if the error is present and has no level attribute set,
              the value is just <code class="literal">PfxError</code>. If the error has a level attribute, the class is set to be
              <code class="literal">PfxError PfxErrorLevel_{$pfx_level}</code>.
            </li></ul></div><div class="example"><a name="d0e4912"></a><p class="title"><b>Example&nbsp;5.1.&nbsp;Using <code class="literal">&lt;pfx:checkfield&gt;</code></b></p><div class="example-contents"><pre class="programlisting"><span class="hl-tag">&lt;tr&gt;</span>
  <span class="hl-tag">&lt;pfx:checkfield</span> <span class="hl-attribute">name</span>=<span class="hl-value">"addr.Street"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;td</span> <span class="hl-attribute">class</span>=<span class="hl-value">"{$pfx_class}"</span><span class="hl-tag">&gt;</span>Street:<span class="hl-tag">&lt;/td&gt;</span>
  <span class="hl-tag">&lt;/pfx:checkfield&gt;</span>
  <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;pfx:xinp</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"addr.Street"</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
<span class="hl-tag">&lt;/tr&gt;</span> 
<span class="hl-tag">&lt;pfx:checkfield</span> <span class="hl-attribute">name</span>=<span class="hl-value">"addr.Street"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;pfx:error&gt;</span>
    <span class="hl-tag">&lt;tr&gt;</span>
      <span class="hl-tag">&lt;td</span> <span class="hl-attribute">colspan</span>=<span class="hl-value">"2"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"{$pfx_class}"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;ixsl:apply-templates</span> <span class="hl-attribute">select</span>=<span class="hl-value">"$pfx_scode"</span><span class="hl-tag">/&gt;</span>
      <span class="hl-tag">&lt;/td&gt;</span>
    <span class="hl-tag">&lt;/tr&gt;</span>
  <span class="hl-tag">&lt;/pfx:error&gt;</span>
<span class="hl-tag">&lt;/pfx:checkfield&gt;</span></pre><p>
          You can see how the second <code class="literal">&lt;pfx:checkfield&gt;</code> inserts a whole new row in the table structure
          when and only when a matching error happens. Also note how the defined <code class="literal">$pfx_class</code> variable is used
          to style content depending on the presence of an error.
        </p></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="xslt.forms.errors.page"></a>Checking for pagemessages</h4></div></div></div><p>
          The <code class="literal">&lt;pfx:checkmessage&gt;</code> tag is used to display content depending on the fact if a
          page message (or possibly a page message with a special level attribute) is present in the runtime DOM tree.
        </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:checkmessage</span> <span class="hl-attribute">level</span>=<span class="hl-value">"AString"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!--
    Content to be displayed when any page message with the matching level attribute is
    present in the runtime DOM tree. The level attribute is optional, when it's missing,
    any page message will trigger the display of the content of the pfx:checkmessage tag.
  --&gt;</em>
<span class="hl-tag">&lt;pfx:checkmessage&gt;</span></pre><p>
          The <code class="literal">&lt;pfx:messageloop&gt;</code> tag can be used to repeat content for every page message
          that is present in the runtime DOM tree.
        </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:checkmessage</span> <span class="hl-attribute">level</span>=<span class="hl-value">"AString"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;pfx:messageloop&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!--
      This content is repeated for all the page messages that match the restrictions imposed by
      the parent's level attribute (or all page messages, if the attribute isn not given).
    --&gt;</em>
  <span class="hl-tag">&lt;/pfx:messageloop&gt;</span>.
<span class="hl-tag">&lt;/pfx:checkmessage&gt;</span></pre><p>
          The <code class="literal">&lt;pfx:messageloop&gt;</code> tag defines a set of ixsl variables that can be used inside its body. These are
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
              <code class="literal">$pfx_scode</code>: The StatusCode node that represents the error. This can be used to call
              <code class="literal">ixsl:apply-templates</code> on to display the error message.
            </li><li class="listitem">
              <code class="literal">$pfx_level</code>: The level attribute of the error in the runtime DOM tree (or empty, if
              there's no level attribute).
            </li><li class="listitem">
              <code class="literal">$pfx_class</code>: The CSS class that has been constructed depending on the presence of the error.
              If there's no error, this variable is empty. Else, if the error is present and has no level attribute set,
              the value is just <code class="literal">PfxError</code>. If the error has a level attribute, the class is set to be
              <code class="literal">PfxError PfxErrorLevel_{$pfx_level}</code>.
            </li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.forms.token"></a>5.5.6.&nbsp;Avoiding duplicate form submission</h3></div></div></div><p>
        You may face situations where you want to prevent, that the same form is submitted multiple times (e.g. by double-click,
        back button) or that a form, opened in a new window/tab, but already opened in another window/tab, can still be
        submitted from the old window/tab.
      </p><p>
        Using the <code class="literal">&lt;pfx:token&gt;</code> tag a hidden field with a random token is included into its parent form.
        The token is stored in the Context, keyed by a customizable name (by default pagename#elementid, which can be overwritten/replaced
        using the name attribute). After the form is submitted, the token is invalidated and submitting the form again causes the setting
        of a page message. Via the errorpage attribute you can optionally jump to an error page.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:forminput&gt;</span>
  <span class="hl-tag">&lt;pfx:token</span> <span class="hl-attribute">errorpage</span>=<span class="hl-value">"multisubmiterror"</span><span class="hl-tag">/&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- place form elements here --&gt;</em>
<span class="hl-tag">&lt;/pfx:forminput&gt;</span></pre><p>
        You should be aware that this mechanism depends on the caching behaviour of the used browser, e.g. for browsers, which don't
        cache but reload pages accessed via the back button, it can't prevent the repeated form submission, because the form in
        fact is a new instance and we can't detect or decide that the submit is illegal.
      </p><p>
        This mechanism by default only prevents forms with illegal tokens from being processed. If you want to ensure that form submits
        including no token will fail too, you can force this behaviour by setting the requirestoken attribute at the pagerequest's input
        element to true. This will force tokens for every form that's submitted to this page.
      </p><pre class="programlisting"><span class="hl-tag">&lt;contextxmlserver&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!--
    servlet config options
  --&gt;</em>
  <span class="hl-tag">&lt;pagerequest</span> <span class="hl-attribute">name</span>=<span class="hl-value">"..."</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;input</span> <span class="hl-attribute">requirestoken</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;interface</span> <span class="hl-attribute">prefix</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/input&gt;</span>
  <span class="hl-tag">&lt;/pagerequest&gt;</span>
<span class="hl-tag">&lt;/contextxmlserver&gt;</span></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4995"></a>5.6.&nbsp;Miscellaneous utility tags</h2></div></div></div><p>Pustefix also provides several utility tags, that might be helpful in your application.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.utility.active"></a>5.6.1.&nbsp;Checking page status</h3></div></div></div><p>
        The <code class="literal">&lt;pfx:checkactive&gt;</code> and <code class="literal">&lt;pfx:checknotactive&gt;</code> allow you
        to check from the XSL-stylesheet, whether a specific IHandler currently is active or not.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:checkactive</span> <span class="hl-attribute">page</span>=<span class="hl-value">"APageName"</span> <span class="hl-attribute">prefix</span>=<span class="hl-value">"AHandlerName"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!--
    Content to be displayed, if the handler is active
  --&gt;</em>
<span class="hl-tag">&lt;/pfx:checkactive&gt;</span></pre><p>
        </p><div class="table"><a name="d0e5015"></a><p class="title"><b>Table&nbsp;5.16.&nbsp;Attributes of the pfx:checkactive and pfx:checknotactive tags</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
              <th>Attribute name</th>
              <th>Mandatory?</th>
              <th>Description</th>
            </tr></thead><tbody><tr>
              <td>page</td>
              <td>optional</td>
              <td>
                <p>
                  When using the page attribute, the content of the tag is only displayed if the referenced page is accessible.
                  This is an easy way to display complete subparts of a page depending on the accessibility of another page.
                </p>
              </td>
            </tr><tr>
              <td>prefix</td>
              <td>optional</td>
              <td>
                <p>
                  When using the prefix, the content of the tag is only displayed if a referenced handler on the current
                  page is active. The prefix is the same name as used in the servlet property file for the handler.
                </p>
                <p>
                  You can only use one of the attributes page and prefix.
                </p>
              </td>
            </tr></tbody></table></div></div><p><br class="table-break">
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.pfx.langselect"></a>5.6.2.&nbsp;Displaying content based on the language</h3></div></div></div><p>
        The selection mechanism of <code class="literal">&lt;pfx:langselect&gt;</code> allows to select matching content anywhere
        inside a include part depending on the current language that is set in the running session.
        The <code class="literal">&lt;pfx:lang name="default"&gt;</code> tag is acting as the fallback for all languages that don't
        have a better, more specific named <code class="literal">&lt;pfx:lang&gt;</code> node.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:langselect&gt;</span>
  <span class="hl-tag">&lt;pfx:lang</span> <span class="hl-attribute">name</span>=<span class="hl-value">"en_*"</span><span class="hl-tag">&gt;</span>...<span class="hl-tag">&lt;/pfx:lang&gt;</span>
  <span class="hl-tag">&lt;pfx:lang</span> <span class="hl-attribute">name</span>=<span class="hl-value">"en_GB"</span><span class="hl-tag">&gt;</span>...<span class="hl-tag">&lt;/pfx:lang&gt;</span>
  <span class="hl-tag">&lt;pfx:lang</span> <span class="hl-attribute">name</span>=<span class="hl-value">"default"</span><span class="hl-tag">&gt;</span>...<span class="hl-tag">&lt;/pfx:lang&gt;</span>
<span class="hl-tag">&lt;/pfx:langselect&gt;</span></pre><p>
        The system doesn't enforce but expects languages to be of the standard form of ISO language codes. In this case,
        a <code class="literal">&lt;pfx:lang&gt;</code> node with a name attribute ending in an asterisk (<code class="literal">*</code>) can be used to
        create a fallback for a whole "family" of languages. In the example above, the <code class="literal">en_*</code> node will serve as a fallback
        for all language codes starting with en_ except <code class="literal">en_GB</code> (which has a more specific node below).
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.pfx.themeselect"></a>5.6.3.&nbsp;Displaying content based on the theme</h3></div></div></div><p>
        The selection mechanism of <code class="literal">&lt;pfx:themeselect&gt;</code> allows to select matching content anywhere inside a
        include part depending on the same selection mechanism that is used to select the include part the first hand as described
        in <a class="xref" href="#xslt.pfx.include" title="5.3.1.&nbsp;Include parts (<pfx:include&gt;)">Section&nbsp;5.3.1, &#8220;Include parts (&lt;pfx:include&gt;)&#8221;</a>
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:themeselect&gt;</span>
  <span class="hl-tag">&lt;pfx:theme</span> <span class="hl-attribute">name</span>=<span class="hl-value">"ATheme"</span><span class="hl-tag">&gt;</span>...<span class="hl-tag">&lt;/pfx:theme&gt;</span>
  <span class="hl-tag">&lt;pfx:theme</span> <span class="hl-attribute">name</span>=<span class="hl-value">"default"</span><span class="hl-tag">&gt;</span>...<span class="hl-tag">&lt;/pfx:theme&gt;</span>
<span class="hl-tag">&lt;/pfx:themeselect&gt;</span></pre><p>
        Of course this makes most sense, when the containing include part uses a general theme, so there are
        specialized themes in the theme fallback queues to select from.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
          This tag is only to be used in very special situations. Normally you would like to use different themes
          for the include part to register itself correctly with the runtime system.
        </p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.consoles"></a>5.6.4.&nbsp;Using the Pustefix console</h3></div></div></div><p>
        Pustefix provides an edit-console and webservice-console that are helpful during debugging.
      </p><p>
        Those consoles can be included in your pages using the <code class="literal">&lt;pfx:editconsole&gt;</code> and
        <code class="literal">&lt;pfx:webserviceconsole&gt;</code> tags. The webservice-console may also be included within the
        editconsole using the following form: <code class="literal">&lt;pfx:editconsole webserviceconsole="true"&gt;</code>.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xslt.extensions"></a>5.7.&nbsp;XSLT extensions</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.extensions.xpathfunctions"></a>5.7.1.&nbsp;XPath functions</h3></div></div></div><p>In addition to the standard XPath functions supplied by the XSLT/XPath implementation Pustefix provides some additional framework specific
          XPath functions in the <code class="literal">xmlns:pfx="http://www.schlund.de/pustefix/core"</code> namespace:</p><p>
    </p><p>Example:
    </p><pre class="programlisting"><span class="hl-tag">&lt;ixsl:if</span> <span class="hl-attribute">test</span>=<span class="hl-value">"pfx:isVisible('mypage')=1"</span><span class="hl-tag">&gt;</span>
  Display if page 'mypage' is accessible 
<span class="hl-tag">&lt;/ixsl:test&gt;</span></pre><p>
    </p><p>
    </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="xslt.extensions.xpathfunctions.page"></a>Page functions</h4></div></div></div><p>
      <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>number</em></span> <span class="strong"><strong>pfx:isVisible</strong></span>(<span class="emphasis"><em>string</em></span>)
    </p><p>
      The <span class="strong"><strong>pfx:isVisible</strong></span> function checks if a page is accessible. The page name is passed as argument.
      The function returns:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">1</code>, if the page is accessible</li><li class="listitem"><code class="literal">0</code>, if the page isn't accessible</li><li class="listitem"><code class="literal">-1</code>, if the page doesn't exist</li></ul></div><p>
    </p><p>
      <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>number</em></span> <span class="strong"><strong>pfx:isVisited</strong></span>(<span class="emphasis"><em>string</em></span>)
    </p><p>
       The <span class="strong"><strong>pfx:isVisited</strong></span> function checks if a page has already been visited within the session. The page name is passed as argument.
      The function returns:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">1</code>, if the page has already been visited</li><li class="listitem"><code class="literal">0</code>, if the page hasn't been visited yet</li><li class="listitem"><code class="literal">-1</code>, if the page isn't configured</li></ul></div><p>
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
          You should be aware that doing a boolean check on results of type <code class="literal">number</code>, <code class="literal">1</code> and 
          <code class="literal">-1</code> both are evaluated as <code class="literal">true</code>, <code class="literal">0</code> as <code class="literal">false</code>.
        </p></td></tr></table></div><p><a name="xslt.extensions.xpathfunctions.getdisplaypagename"></a>
      <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>string</em></span> <span class="strong"><strong>pfx:getDisplayPageName</strong></span>()
    </p><p>
       The <span class="strong"><strong>pfx:getDisplayPageName</strong></span> function returns the display name of the current page.
    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="xslt.extensions.xpathfunctions.include"></a>Include functions</h4></div></div></div><p>
      <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>boolean</em></span> <span class="strong"><strong>pfx:checkInclude</strong></span>(<span class="emphasis"><em>string, string, string, string</em></span>)
    </p><p>
       The <span class="strong"><strong>pfx:checkInclude</strong></span> function checks if an include part exists. The function expects four string arguments: href, part, module, search (same semantics as <a class="xref" href="#xslt.pfx.checkinclude" title="5.3.5.&nbsp;Checking include part existence (<pfx:checkinclude&gt;)">Section&nbsp;5.3.5, &#8220;Checking include part existence (&lt;pfx:checkinclude&gt;)&#8221;</a>).
      The function returns:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">true</code>, if the include part can be found</li><li class="listitem"><code class="literal">false</code>, if the include part can't be found</li></ul></div><p>
    </p><p>
      <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>node-set</em></span> <span class="strong"><strong>pfx:getIncludeInfo</strong></span>(<span class="emphasis"><em>string, string, string</em></span>)
    </p><p>
       The <span class="strong"><strong>pfx:getIncludeInfo</strong></span> function returns information about the include parts contained in a resource or a set of resources (when doing
       a dynamic search). The function expects three string arguments: href, module (optional) and search (optional).
      The function returns a node-set with each node describing a part, e.g. its name.
</p><p>Example:
    </p><pre class="programlisting"><em class="hl-comment" style="color: silver">&lt;!-- iterates over the names of all parts from a file and includes the parts --&gt;</em>
<span class="hl-tag">&lt;pfx:for-each</span> <span class="hl-attribute">select</span>=<span class="hl-value">"pfx:getIncludeInfo('path/to/file.xml','amodule')/part"</span><span class="hl-tag">&gt;</span>
   <span class="hl-tag">&lt;pfx:include</span> <span class="hl-attribute">select-part</span>=<span class="hl-value">"@name"</span> <span class="hl-attribute">href</span>=<span class="hl-value">"path/to/file.xml"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"amodule"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/pfx:for-each&gt;</span></pre><p>
    </p><p>
    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="xslt.extensions.xpathfunctions.string"></a>String functions</h4></div></div></div><p>
        <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>string</em></span> <span class="strong"><strong>pfx:encode-for-uri</strong></span>(<span class="emphasis"><em>string</em></span>)
      </p><p>
        The <span class="strong"><strong>pfx:encode-for-uri</strong></span> encodes reserved characters in a string for usage in the path segment of an URI.
        The function basically works like the according XPath 2.0 function (see <a class="link" href="http://www.w3.org/TR/xpath-functions/#func-encode-for-uri" target="_top">http://www.w3.org/TR/xpath-functions/#func-encode-for-uri</a>).
      </p><p></p><p>
        <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>boolean</em></span> <span class="strong"><strong>pfx:ends-with</strong></span>(<span class="emphasis"><em>string, string</em></span>)
      </p><p>
        The <span class="strong"><strong>pfx:ends-with</strong></span> function returns true if the first argument string ends with the second argument string, and otherwise returns false.
      </p><p></p><p>
        <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>string</em></span> <span class="strong"><strong>pfx:lower-case</strong></span>(<span class="emphasis"><em>string</em></span>)
      </p><p>
        The <span class="strong"><strong>pfx:lower-case</strong></span> function converts all of the characters in the arguments string to lower case.
      </p><p></p><p>
        <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>boolean</em></span> <span class="strong"><strong>pfx:matches</strong></span>(<span class="emphasis"><em>string, string, string?</em></span>)
      </p><p>
        The <span class="strong"><strong>pfx:matches</strong></span> function returns true if the text passed as first argument is matched by the pattern passed as second argument. You can optionally specify one or more pattern mode flags as third argument ('s' dot-all mode, 'm' multi-line mode, 'i' case-insensitive mode, 'x' pattern-whitespace-ignoring mode). The function basically works like the according XPath 2.0 function (see <a class="link" href="http://www.w3.org/TR/xpath-functions/#func-matches" target="_top">http://www.w3.org/TR/xpath-functions/#func-matches</a>).
      </p><p></p><p>
        <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>string</em></span> <span class="strong"><strong>pfx:replace</strong></span>(<span class="emphasis"><em>string, string, string, string?</em></span>)
      </p><p>
        The <span class="strong"><strong>pfx:replace</strong></span> function replaces all substrings of the text passed as first argument, which match the pattern passed a second argument, with the replacement passed as third argument. You can optionally specify one or more pattern mode flags as third argument ('s' dot-all mode, 'm' multi-line mode, 'i' case-insensitive mode, 'x' pattern-whitespace-ignoring mode). The function basically works like the according XPath 2.0 function (see <a class="link" href="http://www.w3.org/TR/xpath-functions/#func-replace" target="_top">http://www.w3.org/TR/xpath-functions/#func-replace</a>).
      </p><p></p><p>
        <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>string</em></span> <span class="strong"><strong>pfx:string-length</strong></span>(<span class="emphasis"><em>string</em></span>)
      </p><p>
        The <span class="strong"><strong>pfx:string-length</strong></span> returns the length of the passed string.
        The function basically works like the according XPath 2.0 function (see <a class="link" href="http://www.w3.org/TR/xpath-functions/#string-length" target="_top">http://www.w3.org/TR/xpath-functions/#string-length</a>).
      </p><p></p><p>
        <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>string</em></span> <span class="strong"><strong>pfx:substring</strong></span>(<span class="emphasis"><em>string, double, double?</em></span>)
      </p><p>
        The <span class="strong"><strong>pfx:substring</strong></span> function returns the portion of the the string passed as first argument,
        beginning at the position passed as second argument (first character is located at position 1!),
        optionally limited to the number of characters passed as third argument.
        The function basically works like the according XPath 2.0 function (see <a class="link" href="http://www.w3.org/TR/xpath-functions/#substring" target="_top">http://www.w3.org/TR/xpath-functions/#substring</a>).
      </p><p></p><p>
        <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>node-set</em></span> <span class="strong"><strong>pfx:tokenize</strong></span>(<span class="emphasis"><em>string, string</em></span>)
      </p><p>
        The <span class="strong"><strong>pfx:tokenize</strong></span> function splits the first argument string into substrings by using the second argument string as separator (in the form of a regular expression).
      </p><p></p><p>
        <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>string</em></span> <span class="strong"><strong>pfx:upper-case</strong></span>(<span class="emphasis"><em>string</em></span>)
      </p><p>
        The <span class="strong"><strong>pfx:upper-case</strong></span> function converts all of the characters in the arguments string to upper case.
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="xslt.extensions.xpathfunctions.date"></a>Date functions</h4></div></div></div><p>
        <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>string</em></span> <span class="strong"><strong>pfx:format-date</strong></span>(<span class="emphasis"><em>string, string?, string?, string?</em></span>)
      </p><p>
        The <span class="strong"><strong>pfx:format-date</strong></span> function formats a timestamp (UNIX time in milliseconds) passed as first argument, using the date format pattern, timezone and locale, which can be optionally passed as further arguments.
      </p><pre class="programlisting"><span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"pfx:format-date(/formresult/path/to/@time)"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"pfx:format-date(/formresult/path/to/@time, '', 'Europe/Berlin')"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"pfx:format-date(/formresult/path/to/@time, 'EEE, d MMM yyyy HH:mm:ss Z', 'Europe/Berlin', 'de-DE')"</span><span class="hl-tag">/&gt;</span></pre><p>
        You can set sensible default values for the optional arguments by adding them as top-level XSL parameters:
      </p><pre class="programlisting"><span class="hl-tag">&lt;xsl:param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"date-format"</span><span class="hl-tag">&gt;</span>EEE, d MMM yyyy HH:mm:ss Z<span class="hl-tag">&lt;/xsl:param&gt;</span>
<span class="hl-tag">&lt;xsl:param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"date-timezone"</span><span class="hl-tag">&gt;</span>Europe/Berlin<span class="hl-tag">&lt;/xsl:param&gt;</span>
<span class="hl-tag">&lt;xsl:param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"date-locale"</span><span class="hl-tag">&gt;</span>de-DE<span class="hl-tag">&lt;/xsl:param&gt;</span></pre></div><p>
       The syntax of all arguments is conforming to the Java standard, see the class 
       <a class="link" href="http://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html" target="_top">java.text.SimpleDateFormat</a> for reference.
     </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="xslt.extensions.xpathfunctions.development"></a>Development functions</h4></div></div></div><p>
        <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>void</em></span> <span class="strong"><strong>pfx:sleep</strong></span>(<span class="emphasis"><em>number</em></span>)
      </p><p>
        The <span class="strong"><strong>pfx:sleep</strong></span> function pauses XSLT processing for the specified number of milliseconds. This function is intended for debugging purpose only.
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="xslt.extensions.xpathfunctions.misc"></a>Miscellaneous functions</h4></div></div></div><p>
      <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>string</em></span> <span class="strong"><strong>pfx:getEnvProperty</strong></span>(<span class="emphasis"><em>string</em></span>)
    </p><p>
       The <span class="strong"><strong>pfx:getEnvProperty</strong></span> function returns then environment property denoted by the passed argument.
    </p><p></p><p>
      <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>string</em></span> <span class="strong"><strong>pfx:escapeJS</strong></span>(<span class="emphasis"><em>string</em></span>)
    </p><p>
       The <span class="strong"><strong>pfx:escapeJS</strong></span> function escapes Javascript data by replacing non-alphanumeric characters by the according \xHH and \uHHHH escape sequences.
    </p><p></p><p>
      <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>boolean</em></span> <span class="strong"><strong>pfx:isBot</strong></span>()
    </p><p>
       The <span class="strong"><strong>pfx:isBot</strong></span> function returns true if the current request is made by a bot, otherwise it returns false.
    </p><p></p><p>
      <span class="strong"><strong>Function:</strong></span> <span class="emphasis"><em>Object</em></span> <span class="strong"><strong>pfx:getBean</strong></span>(<span class="emphasis"><em>string</em></span>)
    </p><p>
       The <span class="strong"><strong>pfx:getBean</strong></span> function gets a bean reference from the Spring ApplicationContext looking it up by its name or type. Thus you can call
       extension functions on instance level by passing the bean as first method argument, e.g.:
    </p><pre class="programlisting"><span class="hl-tag">&lt;ixsl:value-of</span> <span class="hl-attribute">xmlns:my</span>=<span class="hl-value">"java:mypackage.MyClass"</span> <span class="hl-attribute">select</span>=<span class="hl-value">"my:myMethod(pfx:getBean('myname'),'arg1','arg2')"</span><span class="hl-tag">/&gt;</span></pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xslt.extensions.extensionelements"></a>5.7.2.&nbsp;XSL extension elements</h3></div></div></div><p>In addition to the standard XSL elements Pustefix provides some useful XSL extension elements. They can be used by declaring the namespace
          <code class="literal">http://pustefixframework.org/org.pustefixframework.xslt.ExtensionElements</code>, using the prefix <code class="literal">pxsl</code>
          and adding the prefix to the <code class="literal">extension-element-prefixes</code> attribute of the stylesheet:</p><pre class="programlisting"><span class="hl-tag">&lt;xsl:stylesheet</span> <span class="hl-attribute">xmlns:xsl</span>=<span class="hl-value">"http://www.w3.org/1999/XSL/Transform"</span> 
                <span class="hl-attribute">xmlns:pxsl</span>=<span class="hl-value">"http://pustefixframework.org/org.pustefixframework.xslt.ExtensionElements"</span>
                <span class="hl-attribute">extension-element-prefixes</span>=<span class="hl-value">"pxsl"</span> <span class="hl-attribute">version</span>=<span class="hl-value">"1.1"</span><span class="hl-tag">&gt;</span></pre><p>
        There are some extension elements providing extended logging functionality. They work similar to the <code class="literal">&lt;xsl:message/&gt;</code> 
        instruction, but additionally support different log levels and can optionally write to a Log4J logger instead of standard output.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pxsl:log</span> <span class="hl-attribute">level</span>=<span class="hl-value">"DEBUG|INFO|WARN|ERROR"</span>
              <span class="hl-attribute">logger</span>=<span class="hl-value">"SOME_LOG4J_LOGGER"</span><span class="hl-tag">&gt;</span> 
  <em class="hl-comment" style="color: silver">&lt;!-- content --&gt;</em>
<span class="hl-tag">&lt;/pxsl:log&gt;</span>
    
<em class="hl-comment" style="color: silver">&lt;!-- shortcuts for specific log levels --&gt;</em>
<span class="hl-tag">&lt;pxsl:debug&gt;</span> <em class="hl-comment" style="color: silver">&lt;!-- content --&gt;</em> <span class="hl-tag">&lt;/pxsl:debug&gt;</span>
<span class="hl-tag">&lt;pxsl:info&gt;</span> <em class="hl-comment" style="color: silver">&lt;!-- content --&gt;</em> <span class="hl-tag">&lt;/pxsl:info&gt;</span>
<span class="hl-tag">&lt;pxsl:warn&gt;</span> <em class="hl-comment" style="color: silver">&lt;!-- content --&gt;</em> <span class="hl-tag">&lt;/pxsl:warn&gt;</span>
<span class="hl-tag">&lt;pxsl:error&gt;</span> <em class="hl-comment" style="color: silver">&lt;!-- content --&gt;</em> <span class="hl-tag">&lt;/pxsl:error&gt;</span></pre><p>If you don't specify a logger, the content will be written to standard output. But the log levels are bound to the application mode by default,
           i.e. the log messages will be filtered. Here's which messages are displayed in which mode:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">prod</code> =&gt; WARN, ERROR</li><li class="listitem"><code class="literal">test</code> or <code class="literal">devel</code> =&gt; DEBUG, INFO, WARN, ERROR</li><li class="listitem">other modes =&gt; INFO, WARN, ERROR</li></ul></div><p>
        The <code class="literal">&lt;pxsl:fail-safe/&gt;</code> extension element catches an exception thrown during the processing of its child elements and 
        outputs its stacktrace instead of the content. This element shouldn't be used on normal pages. It's intended for tooling and debugging purposes only.  
      </p><pre class="programlisting"><span class="hl-tag">&lt;xsl:variable</span> <span class="hl-attribute">name</span>=<span class="hl-value">"result"</span><span class="hl-tag">&gt;</span>
   <span class="hl-tag">&lt;pxsl:fail-safe&gt;</span>
      <span class="hl-tag">&lt;xsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"call:someExtensionFunction()"</span><span class="hl-tag">/&gt;</span>
   <span class="hl-tag">&lt;/pxsl:fail-safe&gt;</span>
<span class="hl-tag">&lt;/xsl:variable&gt;</span></pre></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="concepts"></a>Chapter&nbsp;6.&nbsp;Important Concepts</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#concepts.servlets">6.1. HTTP request handling</a></span></dt><dd><dl><dt><span class="section"><a href="#concepts.httprequesthandlers.core">6.1.1. HttpRequestHandlers provided by the core framework</a></span></dt></dl></dd><dt><span class="section"><a href="#concepts.request_processing">6.2. Processing of Requests</a></span></dt><dd><dl><dt><span class="section"><a href="#concepts.request_processing.context">6.2.1. The Context</a></span></dt><dt><span class="section"><a href="#concepts.request_processing_pageflow">6.2.2. PageFlow</a></span></dt><dt><span class="section"><a href="#concepts.request_processing_states">6.2.3. States</a></span></dt><dt><span class="section"><a href="#d0e6010">6.2.4. Influencing the page request cycle</a></span></dt><dt><span class="section"><a href="#d0e6389">6.2.5. The basic Pustefix Request Cycle</a></span></dt><dt><span class="section"><a href="#d0e6616">6.2.6. Pustefix <code class="code">State</code> implementations</a></span></dt><dt><span class="section"><a href="#d0e6774">6.2.7. Pustefix <code class="code">PageFlow</code> implementation: <code class="code">DataDrivenPageFlow</code></a></span></dt></dl></dd><dt><span class="section"><a href="#d0e6784">6.3. The data model: Context resources</a></span></dt><dt><span class="section"><a href="#d0e6811">6.4. Wrappers and Handlers</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6816">6.4.1. IWrappers</a></span></dt><dt><span class="section"><a href="#d0e7016">6.4.2. The <code class="literal">InputHandler</code> interface</a></span></dt><dt><span class="section"><a href="#d0e7035">6.4.3. The deprecated <code class="literal">IHandler</code> interface</a></span></dt></dl></dd><dt><span class="section"><a href="#concepts.statuscodes">6.5. StatusCodes</a></span></dt><dt><span class="section"><a href="#concepts.interceptors">6.6. ContextInterceptors</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="concepts.servlets"></a>6.1.&nbsp;HTTP request handling</h2></div></div></div><p>
      In a typical Pustefix application the <code class="classname">DispatcherServlet</code>
      provided by Spring is usually the only servlet. This servlet instantiates a 
      Spring <code class="interfacename">ApplicationContext</code> on startup and delegates
      all requests to the <code class="interfacename">HttpRequestHandler</code>
      found by using the <code class="interfacename">HandlerMapping</code>.
      If you want to do request processing for a certain path without using the
      <code class="interfacename">HttpRequestHandler</code>s provided by Pustefix, you can
      add your own instance of an <code class="interfacename">UriProvidingHttpRequestHandler</code>
      to the Spring configuration file.
    </p><p>
      All request handlers used by Pustefix are based on <code class="classname">AbstractPustefixRequestHandler</code>.
      The main feature of it's session handling is that it's mostly transparent to the user. You can submit data
      to a URL, and the system will take care to store the supplied data (this is done in the form of a
      <code class="literal">PfixServletRequest</code>, which can be seen as basically the same as a
      <code class="literal">HttpServletRequest</code>, with some additional features, e.g. more or less transparent handling of
      file uploads), create a session, redirect to the URL with an embedded session id, and continue with the business
      logic and the data submitted with the original request afterwards.
    </p><p>
      Even SSL is handled transparently. A descending request handler must implement the method <code class="literal">+ needsSession(): boolean</code>
      to decide if the the current request should result into the session to be "secure". You don't have to make sure that
      the webpages use "https://" in all needed links, the target itself tells the system that it want's to run under SSL.
    </p><p>
      If the request handler decides that it want's to run under SSL from now on, a complex redirect sequence happens that makes sure
      that all data is copied from the previous insecure session into a new, secure session (a session is secure if it's
      session id was never transmitted over an insecure channel). After a session has once transformed into a secure one, there's
      no way back: Every time you try to use the session with "http://" it will create a new, secure session dropping the old
      one (because it's tainted now). If the visitor's browser supports cookies, the system manages to map request with the old, 
      original, insecure session id (which can happen whenever the user uses the back button of her browser to go back to a page
      that has still the old session id embedded in every link) to the new, currently running secure session and silenty and
      securely redirects to this session.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="concepts.httprequesthandlers.core"></a>6.1.1.&nbsp;HttpRequestHandlers provided by the core framework</h3></div></div></div><p>
        <a class="xref" href="#concepts.servlets.core.figure" title="Figure&nbsp;6.1.&nbsp;Pustefix HTTP request handlers">Figure&nbsp;6.1, &#8220;Pustefix HTTP request handlers&#8221;</a> shows some of the <code class="interfacename">HttpRequestHandler</code>s 
        that are already provided by the core framework
        and should be sufficient for most of your needs when building a web application with Pustefix.
      </p><div class="figure"><a name="concepts.servlets.core.figure"></a><p class="title"><b>Figure&nbsp;6.1.&nbsp;Pustefix HTTP request handlers</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/reference/concepts-servlets.png" alt="Pustefix HTTP request handlers"></div></div></div><br class="figure-break"><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e5744"></a>DerefRequestHandler</h4></div></div></div><p>
          This is a small request handler that should be used whenever a link to a URL outside the own site is made. All such
          external links must be of the form <code class="uri">/deref?link=http://some.other.domain/foo/bar</code>. This is important
          because for any link that goes directly to a foreign destination (e.g. <code class="literal">&lt;a href="http://some.other.domain/foo/bar"&gt;</code>)
          the session id visible in the logfile of the foreign site's webserver (via the Referer header). This is of course
          a security problem. Using the <code class="literal">DerefServlet</code> avoids this by using a redirect loop so the <code class="literal">Referer</code>
          header transmitted will no longer contain the session id.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e5761"></a>AbstractPustefixXMLRequestHandler</h4></div></div></div><p>
          This HTTP request handler, while still abstract, implements most of the output handling needed for request handlers
          that want use XSLT/XML to produce the final html sent to the browser.
        </p><p>
          The only thing a descendant needs to implement is the abstract method <code class="literal">getDom(PfixServletRequest)</code>,
          whose return value can be thought of as a small container around a <code class="literal">org.w3c.Document</code>. The additional data stored in
          a <code class="literal">SPDocument</code> is among other things a map of XSLT transformation parameters that should be set and the "page name"
          which the system uses to choose the correct target stylesheet to transform the DOM with.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e5777"></a>PustefixContextDirectOutputRequestHandler</h4></div></div></div><p>
          In contrast to <code class="classname">AbstractPustefixXMLRequestHandler</code> and descendants, this request handler
          does not produce it's output by transforming XML with a XSLT
          stylesheet into HTML. There are situations where you need to stream some other format like pdf or images like
          PNG or GIF instead.
          The <code class="classname">PustefixContextDirectOutputRequestHandler</code> is used for exactly this purpose, because 
          it delegates request processing to
          <code class="literal">DirectOutputState</code> objects which are allowed to write directly to the <code class="literal">HttpServletResponse</code>'s
          <code class="literal">OutputStream</code>.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e5797"></a>PustefixContextXMLRequestHandler</h4></div></div></div><p>
          This is the main request handler that handles almost all pages in a typical Pustefix application - everything
          that produces HTML to be
          precise. The servlet doesn't do much on it's own, it delegates the request processing to a
          <code class="literal">de.schlund.pfixcore.workflow.Context</code> object. This Context is created by the 
          <code class="classname">PustefixContextXMLRequestHandler</code>
          once for every session, stored into the <code class="literal">HttpSession</code> and reused for all later requests.
        </p><p>
          A Pustefix application has exactly one <code class="classname">PustefixContextXMLRequestHandler</code>. 
          Although more than one additional <code class="classname">&gt;PustefixContextDirectOutputRequestHandler</code>
          could be used, there is usually no need for such a configuration.
        </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="concepts.request_processing"></a>6.2.&nbsp;Processing of Requests</h2></div></div></div><p>
      Every request that arrives at a pustefix application is processed in a specific way, depending
      on the HTTP request handler that is being
      selected by the <code class="classname">PustefixHandlerMapping</code>.
      In this chapter we will show how <code class="classname">PustefixContextXMLRequestHandler</code> handles
      requests.
    </p><p>
      The special processing of requests by this HTTP request handler is called the
      <span class="emphasis"><em>Pustefix Request Cycle</em></span>. It is important to understand how this cycle works, and how to configure it in such a way to achieve the desired result
      for each request.
    </p><p>
      The main "director" in this cycle is the
      <code class="code">Context</code>
      object, that will handle all the processing logic and call other objects to handle the business logic part of the request
      cycle (aka: do something useful with all the user supplied parameters of the request). The other main participants are
      implementations of the
      <code class="code">State</code>
      and
      <code class="code">PageFlow</code>
      interfaces.
    </p><p>
      Pustefix supplies default implementations of these interfaces.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="concepts.request_processing.context"></a>6.2.1.&nbsp;The Context</h3></div></div></div><p>
        The <code class="classname">PustefixContextXMLRequestHandler</code> does most of the request handling in an object called the
        <code class="literal">"context"</code>. The interface <code class="interfacename">Context</code> provides the applications
        view on this object. From the applications view the context mainly is:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Providing an interface to <code class="literal">de.schlund.pfixcore.workflow.ContextResource</code> objects.
            These objects contain the data and the methods needed to implement the desired functionality of a project.
            Each Context objects initializes one de.schlund.pfixcore.workflow.ContextResourceManager, which in turn
            initializes all the requested ContextResources. All user data must be stored in ContextResources instead
            of directly into the HttpSession (this is by design, because a HttpSession only allows to store untyped
            String-to-Object relations, while the ContextResources can expose arbitrary complex access methods to the stored data).
          </p></li><li class="listitem"><p>
            Providing a pluggable authentication mechanism that is called before any request processing to check if the
            current session has the needed privileges.
          </p></li><li class="listitem"><p>
            Mapping of requested pagenames (aka "PageRequests") to the objects that implement the functionality that should
            be supplied by the page. The Context (with the help of a PageMap object initialized on startup of the Context)
            checks which page is requested and uses the associated de.schlund.pfixcore.workflow.State object to dispatch the
            request processing to. See below for more details on this process. Note that for each State only one instance is
            created, so no local data can be stored in States - all session data must be stored in ContextResources.
          </p></li><li class="listitem"><p>
            Organizing pages into PageFlows to provide a small scale "workflow management". PageFlows are linear lists of
            PageRequests which should be stepped through in order. The Context advances a PageFlow after a request has been
            handled sucessfully, ie. no error has happened as the result of processing the request data. The detailed rules on how
            page flows work and how the Context steps through them are explained below.
          </p></li></ul></div><p>
        The context provides a de.schlund.pfixxml.SPDocument to the servlet. This class is a small wrapper around a
        org.w3c.Document and supplies the XML input document for the final transformation which produces the HTML output.
        Besides the DOM tree it contains the information the system needs to choose the right stylesheet for the desired
        page that is to be shown plus some other stuff like XSLT parameters that should be set for the transformation process.
        The Context doesn't produce the SPDocument itself but delegates this to the State's getDocument() method.      
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="concepts.request_processing_pageflow"></a>6.2.2.&nbsp;PageFlow</h3></div></div></div><p>
      For the <code class="code">PageFlow</code>
      interface there is currently only one implementation, and at the time of this writing it's not yet possible to change this
      implementation by supplying your own, although this is planned for the near future. The current implementation is called
      <code class="code">DataDrivenPageFlow</code>, and it will be explained in more detail below. For the discussion presented 
      here, it is sufficient to know the general <code class="code">PageFlow</code> interface.

      </p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> PageFlow {
    String getName();
    String getRootName();
    <span class="hl-keyword">boolean</span> containsPage(String pagename);
    String findNextPage(PageFlowContext context, String currentpagename, <span class="hl-keyword">boolean</span> stopatcurrentpage,
                        <span class="hl-keyword">boolean</span> stopatnextaftercurrentpage) <span class="hl-keyword">throws</span> PustefixApplicationException;    
    <span class="hl-keyword">boolean</span> precedingFlowNeedsData(PageFlowContext context, String currentpagename) <span class="hl-keyword">throws</span> PustefixApplicationException;
    <span class="hl-keyword">boolean</span> hasHookAfterRequest(String currentpagename);
    <span class="hl-keyword">void</span> hookAfterRequest(Context context, ResultDocument resdoc) <span class="hl-keyword">throws</span> PustefixApplicationException, PustefixCoreException;
    <span class="hl-keyword">void</span> addPageFlowInfo(String currentpagename, Element root);
}
      </pre><p>
          
        Both <code class="code">getName()</code> and <code class="code">getRootName()</code> return the name of the pageflow, the difference being that <code class="code">getName()</code> contains the full qualified name (the root name
        together with any variant name, if present) while get RootName() only returns the root name.   
    </p><p>
      <code class="code">containsPage(String pagename)</code> must return true if the given page name is part of the page flow. 
    </p><p>
      <code class="code">findNextPage(...)</code> is more interesting. It implements the main duty of a page flow: To supply some sort of "next" page, given the context (in the form of a 
      <code class="code">PageFlowContext</code> which is just a stripped down version of the <code class="code">Context</code> interface to only support getting information, but no
      changing the inner state of the context object), the information what the current page name is (<code class="code">currentpagename</code>), and two
      flags:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="code">stopatcurrentpage</code>: If set to true and the current page is part of the pageflow, then the page flow searches no 
          further for another matching page then the current page. I.e. for the linear page flows of the <code class="code">DataDrivenPageFlow</code> implementation
           this means checking all the (accessible) pages starting at the head of the flow if they need data (that means: The associated <code class="code">State</code> returns <code class="code">true</code> for method call
           <code class="code">needsData(...)</code>) - if yes, that page is returned. But if the page under consideration
           is the current page, return it in any case even if it doesn't need data.</p></li><li class="listitem"><p><code class="code">stopatnextaftercurrent</code>: This is is similar to the first flag, only that we don't stop the page flow search at the current page, but 
           instead at the next accessible page <span class="emphasis"><em>after</em></span> the current page.</p></li></ul></div><p>
    </p><p>The rest of the methods will be explained in more detail below.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="concepts.request_processing_states"></a>6.2.3.&nbsp;States</h3></div></div></div><p>
      The situation is different for
      <code class="code">State</code>s; Pustefix supplies implementations to cover most of the needs one may have in a normal application, however there are
      always situations where it is needed or at least much easier to write a specialized
      <code class="code">State</code>
      instead of trying to re- or misuse one of the two "standard" implementations supplied with the framework.
    </p><p>
      These two implementations are
      <code class="code">StaticState</code>
      and
      <code class="code">DefaultIWrapperState</code>. The first is used for all
      <span class="emphasis"><em>static</em></span>
      pages, i.e. pages that don't need to process any input parameters, but merely display more or less static content. The only
      dynamic thing this state can do is to include information from
      <span class="emphasis"><em>context resources</em></span>
      into it's output DOM tree. The second one implements the concept of
      <span class="emphasis"><em>wrappers and handlers</em></span>, which is the standard way in pustefix to handle input data.
    </p><p>
      Both of these states inherit from the abstract class
      <code class="code">StateImpl</code>, a class that implements a bunch of helper methods useful for basically every conceivable state implementation. So it is
      strongly suggested to use this (or one of the two described states) as the base class for your own implementations.
    </p><p>
      While both of these states will be explained in detail below, it is important to note that the context only knows about
      states, not a special implementation of it. So on this level it makes no difference if a request supplies data to be
      processed, or if it only request the display of a certain page. So the only thing we need to know for this chapter is the
      interface all states have to implement:

      </p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> State {
    <span class="hl-keyword">boolean</span>        isAccessible(Context context, PfixServletRequest preq) <span class="hl-keyword">throws</span> Exception;
    <span class="hl-keyword">boolean</span>        needsData(Context context, PfixServletRequest preq) <span class="hl-keyword">throws</span> Exception;
    ResultDocument getDocument(Context context, PfixServletRequest preq) <span class="hl-keyword">throws</span> Exception;
}
      </pre><p>

      These three methods are quite easy to explain.
      <code class="code">isAccessible(...)</code>
      is used to check if a page is accessible (the exact wording would be "the associated
      <code class="code">State</code>
      of the page", but we use page/state interchangeable here, as there is a n:1 association of pages to states anyway, i.e.
      every page has exactly one associated state, but most of the time many pages share the same state. States are singletons, so
      they don't store any data themselves. This allows to share them between many pages).

      <code class="code">getDocument(...)</code>
      is the method that does all the work. Here we produce the result DOM tree that is used to render the final HTML page with.

      <code class="code">needsData(...)</code>
      is (or better: can be) used only during
      <span class="emphasis"><em>page flow processing</em></span>
      to determine what the next page is that needs to be shown. This method will be explained when we describe the
      <code class="code">PageFlow</code>
      and it's default implementation in greater detail below.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6010"></a>6.2.4.&nbsp;Influencing the page request cycle</h3></div></div></div><p>During the request-response cycle, the <code class="code">Context</code> maintains a set of variables that influence the processing of the request.
        These are listed in the following table. Use these as a reference to see how they can be set and changed, either by specifying
        values for them in the request (directly, or by referencing an action that sets them) or by calling a method of <code class="code">Context</code>
        somewhere from Java code during the processing of the request.</p><div class="table"><a name="d0e6021"></a><p class="title"><b>Table&nbsp;6.1.&nbsp;Variables of the context during processing</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
                <th>Variable</th>
                <th>Type</th>
                <th>Usage</th>
                <th>How to set?</th>
              </tr></thead><tbody valign="top"><tr>
                <td>currentpagerequest</td>
                <td>PageRequest</td>
                <td>
                  This is basically the object representing the current page we use to process the request. The value of
                  currentpagerequest that is valid at the end of processing becomes the page to be displayed.
                  <p>
                  This variable must never be unset again after initialization during the whole request cycle (it only changes to other
                  PageRequests).</p>
                </td>
                <td>
                  Supplied by the request via either the first request path element (e.g.
                  http://host.dom/PAGE?...) or if this is not given via the request parameter
                  <code class="code">__page</code>.
                  
                  <p> In Pustefix, this is usually transparent to the user: For POST requests, use the
                  <code class="code">send-to-page</code> attribute of <code class="code">pfx:forminput</code>
                  (this defaults to the current page if <code class="code">send-to-page</code> is not given) and for GET requests, use
                  the <code class="code">page</code> attribute of <code class="code">pfx:button</code>.
                  </p>
                  <p> If no page information can be retrieved from 
                  the request, use the default page given in the configuration.
                  </p>
                </td>
              </tr><tr>
                <td>currentpageflow</td>
                <td>PageFlow</td>
                <td>
                  Default is null. This object represents the currently valid page flow (if any). 
                  If it is null, there is no page flow selected.
                </td>
                <td>
                  Can be explicitly set via the parameter <code class="code">__pageflow</code> (in Pustefix used via the 
                  attribute <code class="code">pageflow</code> to either 
                  <code class="code">pfx:button</code> or <code class="code">pfx:xinp type="submit|image"</code> via the request or by setting
                  the <code class="code">pageflow</code> attribute of a configured action).
                  <p>
                    Can also be set from Java by using the <code class="code">context</code> method <code class="code">setCurrentPageFlow(String name).</code>
                  </p>
                  <p><span class="emphasis"><em>
                  The current page flow is very often not set explicitly, but selected automatically by the context. See below for 
                  a detailed explanation of the rules that apply in these cases.
                  </em></span></p>
                </td>
              </tr><tr>
                <td>prohibitcontinue</td>
                <td>boolean</td>
                <td>
                Default is <code class="code">false</code>, if set to <code class="code">true</code> during the request processing, the context will
                not use the pageflow (if any) to determine the next page to show, but instead use the currentpagerequest and
                display the associated page.</td>
                <td>
                Can be set from the outside by using the request parameter <code class="code">__forcestop=true</code> (maps to setting
                the <code class="code">forcestop</code> attribute of <code class="code">pfx:button</code> or <code class="code">pfx:xinp type="submit|image"</code> 
                to <code class="code">true</code> or by calling a configured action with this attribute set to <code class="code">true</code>).
                <p> 
                There is also a method in the context called <code class="code">prohibitContinue()</code> to set this value to <code class="code">true</code>.
                <span class="emphasis"><em>If by any means this value becomes <code class="code">true</code>, there is no way to reset the value
                to <code class="code">false</code> again!</em></span>
                </p>
                </td>
              </tr><tr>
                <td>jumptopage and jumptopageflow</td>
                <td>String</td>
                <td>
                Default is null for both. If set, <code class="code">jumptopage</code> is interpreted as a page name that should be displayed 
                <span class="emphasis"><em>after</em></span> the current request is processed and only if <code class="code">prohibitcontinue</code> is 
                not set to <code class="code">true</code> (in which case, as described below in more detail, no further processing takes place
                and the current page is displayed).
                <p>
                The <code class="code">jumptopageflow</code> variable only has an effect if also <code class="code">jumptopage</code> is set. It is used to set the current page flow to
                another page flow when jumpting to the target page of <code class="code">jumptopage</code>.
                </p>
                <p>
                With other words, 
                this mechanism is used to <span class="emphasis"><em>jump</em></span> to another page after the current request has been successfully
                handled.</p></td>
                <td>
                  This entry can be set quite similar to the <code class="code">pageflow</code> variable above: We have <code class="code">__jumptopage</code> and
                  <code class="code">__jumptopageflow</code>, normally created via the attributes <code class="code">jumptopage</code> and 
                  <code class="code">jumptopageflow</code> in either <code class="code">pfx:button</code>, <code class="code">pfx:xinp type="submit|image"</code> or a
                  configured action.
                  <p>
                    There are also two methods in the <code class="code">context</code> that can be used to set these values from Java: 
                    <code class="code">setJumpToPage(String name)</code> 
                    and <code class="code">setJumpToPageFlow(String name)</code>.
                  </p>
                </td>
              </tr><tr>
                <td>stopnextforcurrentrequest</td>
                <td>boolean</td>
                <td>Default is <code class="code">false</code>. Only has an effect if a page flow is set, and the current page is indeed 
                a member of this page flow.
                <p> 
                If set to true the pageflow is expected to return the next accessible page <span class="emphasis"><em>after</em></span> the 
                current page in the pageflow. The meaning of "after" depends on the implementation of the <code class="code">PageFlow</code> 
                used for the current flow. The default implementation (<code class="code">DataDrivenPageFlow</code>) 
                works with linear flows, so there is always a clear 
                understanding of what is "before" and "after" a page in the flow. 
                Other implementations may have a more complicated interpretation.
                </p>
                </td>
                <td>
                  Can be set directly in a request by using <code class="code">__forcestop=step</code> (and of course the same for the 
                  attributes to the Pustefix tags and configured actions). 
                  <p>This may seem strange, as that parameter is also 
                  used to set the <code class="code">prohibitcontinue</code> variable, but as it makes no sense to specify both of 
                  them at the same time (<code class="code">prohibitcontinue</code> effectively prohibits the use of a pageflow because the current page
                  is being displayed anyway and no page flow is asked for the next page to display), there is no need to have an independent 
                  parameter or attribute.
                  </p> 
                </td>
              </tr><tr>
                <td>startwithflow</td>
                <td>boolean</td>
                <td>Default is <code class="code">false</code>. This variable is used to instruct the <code class="code">Context</code> to not directly use the page that is 
                submitted with the request (and which is still used to set the <code class="code">currentpagerequest</code> variable), but instead ask the current pageflow for
                the next page to use. So the caller doesn't actually know which page will be the one to display. Most often, setting this parameter also implies explicitely 
                setting a page flow via the methods listed above. We will cover this special case in more detail below.</td>
                <td>This variable can be set via the request parameter <code class="code">__startwithflow</code>. With Pustefix tags this is achived by setting the
                <code class="code">startwithflow</code> attribute of <code class="code">pfx:button</code> to <code class="code">true</code>. 
                <p>There is no such possibility for <code class="code">pfx:xinp type="submit|image"</code>, because 
                it makes no sense for a request which supplies data to not know where to submit to. Also using <code class="code">startwithflow="true"</code> with 
                <code class="code">pfx:button</code> implies that the request will not being marked as one that sends data, even if there are <code class="code">pfx:argument</code> nodes attached.
                </p>
                </td>
              </tr></tbody></table></div></div><br class="table-break"><p>
        The <code class="code">currentpageflow</code> variable needs some more 
        explanation, as in many cases, it is not given explicitly neither by submitting an action that specifies the page flow nor directly from the request parameter <code class="code">__pageflow</code>.
        If this is the case, the <code class="code">Context</code> tries to find a <span class="emphasis"><em>matching</em></span> page flow by using the following algorithm.
        
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
            If the current page is a member of exactly one page flow, this flow will become the current page flow.
          </p></li><li class="listitem"><p>
            If the current page is a member of more than one page flow, the <code class="code">Context</code> checks if one of these flows has been the <span class="emphasis"><em>last flow</em></span> 
            the system has used in any request before (so this even applies if the system didn't use a page flow at all during the last requests). If this is the case,
            the system uses this flow as the current page flow. This has the effect that a page flow will remain the current flow as long as the pages used for requests are at least
            a member of this flow.
          </p></li><li class="listitem"><p>
            If the last flow isn't part of the list of flows matching the current page, the system checks if the current page specifies a <code class="code">defaultflow</code> in its 
            configuration (and makes sure that the page is really a member of this flow!). 
            If yes, this flow is preferred and returned as the current page flow. If not, the first of the list will be returned. 
          </p></li><li class="listitem"><p>
            If the current page is not a member of any flow, the current page flow remains unset (the <code class="code">currentpageflow</code> variable remains <code class="code">null</code>).
          </p></li></ol></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6389"></a>6.2.5.&nbsp;The basic Pustefix Request Cycle</h3></div></div></div><p> 
        In this section we want to explain the way the request cycle is handled in Pustefix by the <code class="code">Context</code> and its peer objects (<code class="code">State</code>, <code class="code">PageFlow</code>) used during
        processing.
      </p><p>
        After the variables have been initialized, we have two different ways to go on. Either <code class="code">startwithflow</code> is set to <code class="code">true</code>, or not.
        The first case will be explained below in more detail, for now we assume that the value of <code class="code">startwithflow</code> is <code class="code">false</code>.
        We also do neglect some other aspects, that have to be taken care of during request processing: Role based authentication isn't mentioned here and also the fact that each 
        <code class="code">State</code> will always be asked if it is accessible before calling one of the other two methods won't be mentioned explicitly for the remainder of this explanation.  
      </p><p>
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
            The first action to take is calling <code class="code">getDocument(...)</code> on the <code class="code">State</code> associated with the current page. 
          </p></li><li class="listitem"><p>
            If the current page flow has <span class="emphasis"><em>After-Request-Hooks</em></span> defined (this is checked by calling the method 
            <code class="code">hasHookAfterRequest(...)</code> on 
            the current <code class="code">PageFlow</code>), these hooks are being run by calling <code class="code">hookAfterRequest(Context context, 
            ResultDocument resdoc)</code>. The <code class="code">ResultDocument</code> used
            here is the return value from the <code class="code">getDocument(...)</code> call above. These hooks can basically do anything that can 
            be achieved with the help of the <code class="code">Context</code>
            interface (changing <code class="code">jumptopage/jumptopageflow</code>, calling <code class="code">prohibitContinue()</code> and so on). The interesting 
            thing here is that they not only have access to the
            <code class="code">Context</code> object, but also the resulting DOM-Tree of the processing of the current page. We will learn about an 
            example of such hooks when we look at the current standard 
            implementation <code class="code">DataDrivenPageFlow</code>. 
          </p></li><li class="listitem"><p>
            Now we check if <code class="code">prohibitcontinue</code> is set to <code class="code">true</code>. If yes, the <code class="code">ResultDocument</code> will be 
            used to display the current page. The request cycle ends here.
          </p></li><li class="listitem"><p>
            If <code class="code">prohibitcontinue</code> is still false, check if  <code class="code">jumptopage</code> is set. If yes, set the 
            <code class="code">currentpagerequest</code> to the <code class="code">jumptopage</code> (and also change
            <code class="code">currentpageflow</code> to something that matches, preferring <code class="code">jumptopageflow</code>, if it is set); 
            <code class="code">jumptopage/jumptopageflow</code> are unset to avoid recursion, then we re-enter the process at point 1.
          </p></li><li class="listitem"><p>
            If <code class="code">jumptopage</code> is not set, we try to use the current page flow to get the next page by calling 
            <code class="code">findNextPage(..., ..., false, stopnextforcurrentrequest)</code>. We set this page to be the current page, 
            call <code class="code">getDocument</code> on its associated <code class="code">State</code> and use the 
            returned <code class="code">ResultDocument</code> to display the page. The request cycle ends here (there is 
            no recursive call of the page flow process!). 
          </p></li><li class="listitem"><p>
            If no current page flow is set (<code class="code">currentpageflow == null</code>), we simply use the resulting ResultDocument
            of the initial call to <code class="code">getDocument(...)</code> and use it
            to display the current page.             
          </p></li></ol></div><p>
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e6532"></a>Accessibility of pages</h4></div></div></div><p>
           Up to now, we mostly neglected the fact that a page could also be not accessible, which it is if the associated <code class="code">State</code>
           returns <code class="code">false</code> for a call to its method <code class="code">isAccessible(...)</code>. This method is checked each time before the
           <code class="code">Context</code> tries to call <code class="code">getDocument(...)</code> for a page. The <code class="code">PageFlow</code> is also expected to only
           return a page that is accessible, and to check the accessibility before each call to <code class="code">needsData(...)</code>. 
           </p><p>
           If the initially requested page is not accessible, but a page flow is set, 
           the <code class="code">Context</code> will try to find a matching page by calling 
           <code class="code">findNextPage(..., ..., false, stopnextforcurrentrequest)</code>. Because this method is expected to only return 
           a page that is accessible (if it doesn't find one, it must throw an exception) we can safely set this page to be 
           the new current page and start with the request cycle as usual.
         </p><p>
            If no page flow is set, the system will try to use the default page from the configuration. If this is indeed accessible,
            it will be set as the new current page, and the whole process continues normally from there. If also the default page
            is not accessible, an exception will be thrown.
         </p><p>
           Usually this case won't happen, because you have to force Pustefix to generate a link to a page that is currently 
           not accessible by using the <code class="code">mode="force"</code> attribute on <code class="code">pfx:button</code>. But this procedure is
           also done when the current page has been set from the <code class="code">jumptopage</code> variable and the request 
           cycle is being restarted (see above). To avoid to see any strange behavior and pages that have never been
           intended to be displayed, it's important to make sure that a <code class="code">jumptopage</code> request only references a page 
           that will be accessible. 
         </p><p>
           This accessibility check must also be run by the <code class="code">PageFlow</code> before calling <code class="code">needsData(...)</code> or 
           before returning any page name from <code class="code">findNextPage(...)</code>. It is expected to simply ignore any page that is not
           accessible and continue searching for another "next" page. As already explained above, if it is not able to find a page that 
           is accessible, it must throw an exception.
         </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e6593"></a>Processing when <code class="code">startwithflow=true</code></h4></div></div></div><p>
         Another change in request processing happens when the startwithflow variable is set to <code class="code">true</code>. In this case,
         the context doesn't expect to get a valid pagerequest from the request itself (although there is one supplied, see below
         for the special meaning of this page name), so it has to "search" for the page to handle
         the request processing. This search is done by directly switching to the page flow handling part of the code to retrieve 
         the "next" page that is suggested by the page flow. 
         </p><p>
           Other than in the case of the usual page flow processing, 
           there is some special trick
           involved: If during searching for the next page the page flow encounters the supplied page from the request, it will return
           this page regardless if it needs data or not. In other words: You can limit the search in the page flow by supplying a 
           page that is part of this flow. If the page is not part of the page flow or it is inaccessible, it is ignored (But note that
           the default page flow implementation <span class="emphasis"><em>DataDrivenPageFlow</em></span> also sets the supplied page to be the <span class="emphasis"><em>
           final page</em></span> (see below for details on this), so essentially every supplied page becomes part of the 
           page flow. But this behavior is not part of the contract between PageFlow and Context and just an implementation detail
           of <code class="code">DataDrivenPageFlow</code>).
         </p><p>
           On a quick look, this seems to be almost the same as what is done when a request comes in to a page, that is not
           accessible (see above). In this case, too, a new page ist searched by asking the page flow for the next page.
           The main difference is that a "normal" request will always use the supplied page, as long as it is accessible, while
           in the startwithflow case it will only be used if no other "earlier" candidates have been returned by the page flow.
         </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6616"></a>6.2.6.&nbsp;Pustefix <code class="code">State</code> implementations</h3></div></div></div><p>
        Despite all the explanation about States, most of the time one doesn't write States directly, but rather uses one of two predefined
        States (or trivial descendants of them).
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e6624"></a>StaticState</h4></div></div></div><p>
           The first is <code class="literal">de.schlund.pfixcore.workflow.app.StaticState</code>literal&gt;. This State is used when the page doesn't
           need to process any input data. This is true for most of the purely informative pages of a website (e.g. documentation,
           product information).  StaticState returns true for any call to needsData, which makes it of course unusable for any
           non-trivial pageflow as described here. Also any call to isAccessible returns true. For the creation of the output DOM tree,
           the State respects the <code class="literal">&lt;output&gt;</code> nodes of the page definition in the context configuration file, but of course any
           <code class="literal">&lt;input&gt;</code> nodes are ignored.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e6638"></a>DefaultIWrapperState and IHandlers</h4></div></div></div><p>
          Of course it would be possible to write specialised States for every page that needs application logic.
          Experience shows however that the reuseable components of the application logic are not complete pages, but smaller
          parts that make up the whole functionality of the page. So we need a way to aggregate these smaller parts into a
          predefined State that delegates and distributes the calls made by the Context.
        </p><p>
          The State that implements this is called <code class="literal">de.schlund.pfixcore.workflow.app.DefaultIWrapperState</code>.
          The corresponding logical "atomic" components are implementations of <code class="literal">de.schlund.pfixcore.generator.IHandler</code>.
          Associated to these IHandlers are container classes (implementations of de.schlund.pfixcore.generator.IWrapper) that
          hold the user supplied input data that these handlers should work on. The IWrapper classes are autogenerated from a
          XML description that is explained in more detail here.
        </p><p>
          An IHandler has the following simple interface:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>boolean needsData(Context)</p></li><li class="listitem"><p>boolean prerequisitesMet(Context)</p></li><li class="listitem"><p>boolean isActive(Context)</p></li><li class="listitem"><p>void retrieveCurrentStatus(Context, IWrapper)</p></li><li class="listitem"><p>void handleSubmittedData(Context, IWrapper)</p></li></ul></div><p>
          The corresponding methods of the <code class="literal">State</code> interface and the mappings to the <code class="literal">IHandler</code> 
          methods are:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">boolean needsData(Context, PfixServletRequest)</code>: 
           this method is just delegated to all defined IHandlers. If any of those returns true, the return value of the State
           methods is true, too and false otherwise.</p></li><li class="listitem"><p><code class="literal">boolean isAccessible(Context, PfixServletRequest)</code>: this method maps on the two 
          IHandler methods prerequisitesMet and isActive. The default algorithm works like this: In a first round, on all 
          IHandlers the prerequisitesMet() method is called. If any of the IHandlers returns false here, the return value of 
          the whole State method is false. If all IHandler return true, a second iteration over the IHandler is made with a call 
          to their isActive method. This time, the logic is reversed: if any IHandler returns true, the State method is true, too.
           It only returns false when no IHandler's isActive method returns true. It's possible to customize the behavior for this 
           second iteration in the config file with the policy attribute of the <code class="literal">&lt;input&gt;</code> node.</p></li><li class="listitem"><p><code class="literal">ResultDocument getDocument(Context, PfixServletRequest)</code>: this method is mapped on 
          either retrieveCurrentStatus or handleSubmittedData depending if the request is submitting user data by means of a GET
           request or a form submit (in this case handleSubmittedData would be called) or if the request just wants a page to be 
           displayed (which would result in retrieveCurrentStatus to be called).</p></li></ul></div><p>
          Some important things to note:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>No IHandler method returns a ResultDocument (which is basically a wrapper around the DOM tree that is 
          used for the final transformation to generate the HTML output). In a State it's possible (in fact needed) to 
          create the ResultDocument itself and it's easy to put additional nodes into the DOM tree inside the getDocument 
          method. By design, this no longer works with IHandlers. All output should be generated from the configured
           ContextRessources listed below the <code class="literal">&lt;output&gt;</code> node of the config file.</p></li><li class="listitem"><p>IHandlers don't have access to the PfixServletRequest (which is basically a wrapper around 
          HttpServletRequest). All in- or output of parameters must take place via the typesave getter and setter methods 
          of the associated IWrapper object. In the handleSubmittedData method one typically reads the values as they are 
          supplied from the request, and in the retrieveCurrentStatus method one sets the parameters as they are given by the
          current status of the application to pre-fill form elements on the user interface (Note: the Pustefix elements
          to create form elements take care to automatically use the values as supplied via the IWrapper to pre-fill form
          elements. If you generate your form with other XSLT tags or with the original html elements, this will no longer
          work ot of the box).</p></li></ul></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="d0e6708"></a>The Context and DefaultIWrapperState</h5></div></div></div><p>
            It's an important property of Pustefix that the Context doesn't know anything of IHandlers/IWrappers. From the view of
            the Context, it always works with States and nothing else. This section describes the way the DefaultIWrapperState and
            the Context play together.
          </p><p>
            A request can be processed in two different ways by the getDocument(...) method of DefaultIWrapperState:
          </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                A request that submits data (as can be detected with the help of the method isSubmittrigger(...)) will be
                processed like this (EOR means end of request):
              </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    All IWrappers will initialize their data from the request.
                  </p></li><li class="listitem"><p>
                    On all IHandlers will be called handleSubmit(...) with the approbiate IWrapper object as a parameter.
                  </p></li><li class="listitem"><p>
                    The system checks if there has been an error during processing the reuqest.
                  </p><p>
                    If yes, put all the error codes into the ResultDocument and tell the context to stop at the current page
                    (by calling context.prohibitContinue()). EOR.
                  </p><p>
                    If no, the system needs to decide to either stay on the current page (and display it again) or hand back the control
                    to the Context to start a pageflow process that determines the next page to display. This decision is made be
                    looking at the state of the context and the set of IHandlers. There are 3 different cases to consider:
                  </p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>
                        First we need to decide if there is anything that actively forces the system to stay on the page even
                        in the case of a successful submit. Two cases must be consideres here: The context method prohibitContinue()
                        has already been called (which can be checked by calling the Context method isProhibitContinueSet()).
                        This will always force the context to stop the process, use the returned ResultDocument and display
                        the current page. For the second case, depending on which IHandlers have been called to handle data
                        (this can be a subset of all the IHandlers on the page, see here on how to restrict the submit to a subset
                        of the full set of defined IHandlers), the DefaultIWrapperState decides to stay on the current page.
                        A simplified explanation of the algorithm is like this: When only a subset of the IHandlers have been
                        used to handle a data submiting request, force the system to stay on the current page. There is an
                        exception to this rule, though: When all the IHandlers of the restricted subset are also marked with
                        the continue attribute on the corresponding <code class="literal">&lt;interface&gt;</code> node in the config file set to
                        <code class="literal">true</code>, then don't force the system to stay on the current page. All of this does NOT
                        apply when the request has set a JumpToPage (this can be queried from the Context with the method
                        isJumpToPageSet()) - in this case the JumpToPage takes precedence. NOTE: this will maybe be removed in
                        the future and the default will be to try to continue with the pageflow in any case, despite any restricted
                        subset of IHandlers.
                      </p></li><li class="listitem"><p>
                        Alternatively we try to check if we really want to give control back to the Context to determine the next page.
                        This will happen if one of three conditions is true:
                      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>A JumpToPage has been set.</p></li><li class="listitem"><p>The current page is part of the current pageflow</p></li><li class="listitem"><p>
                          Or the current pageflow has been set explicitly by the request (in this case, the current page
                          doesn't need to be a member of this flow).</p></li></ul></div></li><li class="listitem"><p>
                        The default for the DefaultIWrapperState if none of the above conditions is true is to stay on the current page.
                      </p><p>
                        If the result of these checks is to stay on the current page, call prohibitContinue() on the Context and
                        call retrieveCurrentStatus() on the suitable IHandlers - suitable in this case means a) if no restriceted
                        subset of IHandlers is selected, use all that are defined or b) use the restricted subset and additionally
                        all IHandlers that have the alwaysretrieve attribute on their corresponding <code class="literal">&lt;interface&gt;</code>
                        node in the config file set to true. EOR.
                      </p></li></ol></div></li></ul></div></li><li class="listitem"><p>
                A request for a page that doesn't submit data (direct trigger), or a request that comes in while a pageflow
                is processed or a request that is the result of a final page instruction.
              </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>All IWrappers will initialize their data from the request.</p></li><li class="listitem"><p>
                  call retrieveCurrentStatus() on all the defined IHandlers, and force the Context to stop
                  further processing by calling prohibitContinue(). EOR.</p></li></ul></div></li></ol></div></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6774"></a>6.2.7.&nbsp;Pustefix <code class="code">PageFlow</code> implementation: <code class="code">DataDrivenPageFlow</code></h3></div></div></div><p> 
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6784"></a>6.3.&nbsp;The data model: Context resources</h2></div></div></div><p>
      Pustefix provides an abstraction layer for management of application state. You generally don't directly work on the Servlet API layer,
      e.g. you don't directly store session state in the <code class="literal">HttpSession</code> object, but you use Java beans which are automatically managed 
      by the framework, so-called <code class="literal">ContextResource</code> beans. 
    </p><p>
      In prior versions Pustefix itself controlled the lifecycle of these beans, e.g. instantiated them on session startup, and you had to
      implement a specific interface (<code class="literal">de.schlund.pfixcore.workflow.ContextResource</code>). Beginning with Pustefix 0.13 
      <code class="literal">ContextResource</code> beans are automatically managed by Spring and can be arbitrary POJOs.
    </p><p>
      <code class="literal">ContextResource</code> beans are not only used to manage application state, but they are also linked to the view. They can be 
      declaratively assigned to pages and thus serialized to the XML tree, which is used as source of the XSL transformation producing the output. 
      A <code class="literal">ContextResource</code> can either be automatically serialized to XML, or it can implement its own method manually creating according
      DOM output.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6811"></a>6.4.&nbsp;Wrappers and Handlers</h2></div></div></div><p>
      Write introduction...
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6816"></a>6.4.1.&nbsp;IWrappers</h3></div></div></div><p>
        IWrappers are used to store the request data that is used as input for corresponding
        IHandler classes. IWrappers are not explicitly written by the developer, but are
        generated from .iwrp files which contain a high level XML description of the parameter
        types and certain checks that should be applied to them. Each .iwrp file is translated
        into a .java file with the same name during the build process, and a java class is
        created. In the corresponding IHandler, you use the IWrapper to access or store data
        by calling the IWrapper's get and set methods.
      </p><p>
        The syntax of the .iwrp file is given below.
      </p><pre class="programlisting"><span class="hl-tag">&lt;interface</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/iwrapper"</span>
  <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/iwrapper 
                      http://www.pustefix-framework.org/2008/namespace/iwrapper.xsd"</span>
  <span class="hl-attribute">extends</span>=<span class="hl-value">"mypackage.MyIWrapperClass"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!--
    The class attribute references the associated IHandler class. Alternatively you can
    reference an existing Spring bean using the bean-ref attribute.
    The ihandler node is optional, but if it is left out, the generated
    IWrapper will be abstract and cannot be used directly, unless an extends attribute
    has been given to the interface node. Normally you will want to specify an ihandler
    class here.
  --&gt;</em>
  <span class="hl-tag">&lt;ihandler</span> <span class="hl-attribute">class</span>=<span class="hl-value">"mypackage.MyIHandlerClass"</span><span class="hl-tag">/&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- or &lt;ihandler bean-ref="aBean"/&gt; --&gt;</em>
  <em class="hl-comment" style="color: silver">&lt;!--
    This node can (and usually will) occur multiple times, one for every parameter that
    should be part of the interface
  --&gt;</em>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"AName"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"some.java.Type"</span> <span class="hl-attribute">occurrence</span>=<span class="hl-value">"optional|mandatory|indexed"</span> <span class="hl-attribute">frequency</span>=<span class="hl-value">"single|multiple"</span>
         <span class="hl-attribute">missingscode</span>=<span class="hl-value">"some.defined.statuscode"</span><span class="hl-tag">&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!--
      The whole node is optional. It allows to specify a default value (or multiple) for
      a parameter to use, when no value is supplied via the request. Note that this makes
      the destinction between optional and mandatory parameters nonsensical.
    --&gt;</em>
    <span class="hl-tag">&lt;default&gt;</span>
      <span class="hl-tag">&lt;value&gt;</span>a_default_value<span class="hl-tag">&lt;/value&gt;</span>
      <span class="hl-tag">&lt;value&gt;</span>an_other_default_value<span class="hl-tag">&lt;/value&gt;</span>
    <span class="hl-tag">&lt;/default&gt;</span>
      
    <em class="hl-comment" style="color: silver">&lt;!--
      To test if a param value conforms to the rules, you can specify Check-Classes here
      whose check method will be called to test if the param value makes sense.
      The Check-Classes must implement de.schlund.pfixcore.generator.IWrapperParamPreCheck
      (the interface defines the check(...) method).
    --&gt;</em>
    <span class="hl-tag">&lt;precheck</span> <span class="hl-attribute">class</span>=<span class="hl-value">"a.prechecker.class"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;cparam</span> <span class="hl-attribute">name</span>=<span class="hl-value">"APreCheckerParamName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"APreCheckerParamValue"</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;/cparam&gt;</span>
    <span class="hl-tag">&lt;/precheck&gt;</span>
      
    <em class="hl-comment" style="color: silver">&lt;!--
      Each parameter must be casted from a String to the specific type (unless the type is java.lang.String itself,
      in this case, no caster need to be supplied). This is done by means of a class implementing 
      de.schlund.pfixcore.generator.IWrapperParamCaster. For the usual simple types you can use a caster from the
      package de.schlund.pfixcore.generator.casters.
    --&gt;</em>
    <span class="hl-tag">&lt;caster</span> <span class="hl-attribute">class</span>=<span class="hl-value">"de.caster.class"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;cparam</span> <span class="hl-attribute">name</span>=<span class="hl-value">"ACasterParamName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"ACasterParamValue"</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;/cparam&gt;</span>
    <span class="hl-tag">&lt;/caster&gt;</span>

    <span class="hl-tag">&lt;postcheck</span> <span class="hl-attribute">class</span>=<span class="hl-value">"a.postchecker.class"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;cparam</span> <span class="hl-attribute">name</span>=<span class="hl-value">"APostCheckerParamName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"APostCheckerParamValue"</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;/cparam&gt;</span>
    <span class="hl-tag">&lt;/postcheck&gt;</span>
  <span class="hl-tag">&lt;/param&gt;</span>
<span class="hl-tag">&lt;/interface&gt;</span></pre><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e6825"></a>Parameters</h4></div></div></div><p>
          When defining the parameters for your wrapper, the following attributes are
          supported in the <code class="literal">iwrp</code> format:
        </p><p>
          </p><div class="table"><a name="d0e6835"></a><p class="title"><b>Table&nbsp;6.2.&nbsp;Attributes of an iwrp parameter</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
                <th>Attribute name</th>
                <th>Mandatory?</th>
                <th>Description</th>
              </tr></thead><tbody><tr>
                <td>name</td>
                <td>mandatory</td>
                <td>The name of the parameter. This is used in the getter and setter methods that are generated. E.g. for the parameter name Foo there will be - amongst others - a corresponding java method called getFoo.</td>
              </tr><tr>
                <td>type</td>
                <td>mandatory</td>
                <td>The java type of the parameter. This will determine the return type of the generated getter method.</td>
              </tr><tr>
                <td>occurrence</td>
                <td>Optional, default is mandatory</td>
                <td>This attribute specifies if the parameter must be given (mandatory), or if it's not considered to be an error if it is omitted (optional). The special value indexed tells the system that it should search for occurrences of the parameter name with a suffix appended of the form AParamName.ASuffix. The suffix string must be unique for every occurrence of the parameter named AParamName. Indexed parameters are never mandatory.</td>
              </tr><tr>
                <td>frequency</td>
                <td>Optional, default is single</td>
                <td>This attribute specifies if only one parameter of the same name should be accepted or multiple. This determines if the generated getter method's return value is a single object or an array.</td>
              </tr><tr>
                <td>missingscode</td>
                <td>Optional, default is de.schlund.pfixcore.generator.MISSING_PARAM</td>
                <td>This attribute applies only to mandatory parameters. It allows to specify a different than the default StatusCode to use when the parameter is not supplied.</td>
              </tr></tbody></table></div></div><p><br class="table-break">
        </p><p>
          IWrappers support different parameter types that result in  different
          method signatures in the generated wrapper code.
        </p><p>
          The parameter type is influenced by the attributes <code class="literal">occurrence</code>
          and <code class="literal">frequency</code>
        </p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="d0e6917"></a>Single mandatory/optional parameters</h5></div></div></div><p>
            In most cases, your wrappers will be used to accept and validate simple input parameters, like
            data entered in input fields. These parameters are created setting <code class="literal">frequency</code>
            to <code class="literal">single</code> and <code class="literal">occurrence</code> to <code class="literal">mandatory</code>
            or <code class="literal">optional</code>.
          </p><p>
            This will lead to the following methods:
          </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWrapper {
    Bar  getFoo();
    <span class="hl-keyword">void</span> setFoo(Bar value);
    <span class="hl-keyword">void</span> setStringValFoo(String str_value);
    <span class="hl-keyword">void</span> addSCodeFoo(de.schlund.util.statuscode.StatusCode scode);
    <span class="hl-keyword">void</span> addSCodeWithArgsFoo(de.schlund.util.statuscode.StatusCode scode, String[] args);
}</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="d0e6941"></a>Multiple mandatory/optional parameters</h5></div></div></div><p>
            In some cases, a parameter might be present in a page more than once. This might be the
            case for a list of checkboxes, where all input tags have the same name, but different
            values. These parameters are created setting <code class="literal">frequency</code>
            to <code class="literal">multiple</code> and <code class="literal">occurrence</code> to <code class="literal">mandatory</code>
            or <code class="literal">optional</code>.
          </p><p>
            This will lead to the following methods:
          </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWrapper {
    Bar[] getFoo();
    <span class="hl-keyword">void</span>  setFoo(Bar[] value);
    <span class="hl-keyword">void</span>  setStringValFoo(String[] str_value);
    <span class="hl-keyword">void</span>  addSCodeFoo(de.schlund.util.statuscode.StatusCode scode);
    <span class="hl-keyword">void</span>  addSCodeWithArgsFoo(de.schlund.util.statuscode.StatusCode scode, String[] args);
}</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="d0e6965"></a>Single indexed parameters</h5></div></div></div><p>
            Pustefix also allows you to repeat a parameter inside a page/request and access
            all occurrences of the parameter using an index. In the request, the parameter and
            the index are separated using a <code class="literal">.</code> (dot).
          </p><p>
            These parameters are created setting <code class="literal">frequency</code>
            to <code class="literal">single</code> and <code class="literal">occurrence</code> to <code class="literal">indexed</code>.
          </p><p>
            This will lead to the following methods:
          </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWrapper {
    Bar  getFoo(String index);
    <span class="hl-keyword">void</span> setFoo(Bar value, String index);
    <span class="hl-keyword">void</span> setStringValFoo(String str_value, String index);
    <span class="hl-keyword">void</span> addSCodeFoo(de.schlund.util.statuscode.StatusCode scode, String index);
    <span class="hl-keyword">void</span> addSCodeWithArgsFoo(de.schlund.util.statuscode.StatusCode scode, String[] args, String index);
}</pre><p>
          This is very helpful, if you have a list of entities (like users, books, etc.) and it is possible
          to edit the data of several of these entities in one form.
        </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="d0e6993"></a>Multiple indexed parameters</h5></div></div></div><p>
            Of course, it is also possible to combine multiple and indexed parameters in
            a wrapper.
          </p><p>
            These parameters are created setting <code class="literal">frequency</code>
            to <code class="literal">multiple</code> and <code class="literal">occurrence</code> to <code class="literal">indexed</code>.
          </p><p>
            This will lead to the following methods:
          </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWrapper {
    Bar[] getFoo(String index);
    <span class="hl-keyword">void</span>  setFoo(Bar[] value, String index);
    <span class="hl-keyword">void</span>  setStringValFoo(String[] str_value, String index);
    <span class="hl-keyword">void</span>  addSCodeFoo(de.schlund.util.statuscode.StatusCode scode, String index);
    <span class="hl-keyword">void</span>  addSCodeWithArgsFoo(de.schlund.util.statuscode.StatusCode scode, String[] args, String index);
}</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7016"></a>6.4.2.&nbsp;The <code class="literal">InputHandler</code> interface</h3></div></div></div><p>
        The <code class="literal">InputHandler</code> interface is the replacement for the deprecated <code class="literal">IHandler</code> interface.
        Its advantages are: you get rid of casting because it's generic, and the methods don't declare to throw <code class="literal">Exception</code>,
        which forces sensible exception handling.
      </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> InputHandler&lt;T <span class="hl-keyword">extends</span> IWrapper&gt; {
    <span class="hl-keyword">void</span>    handleSubmittedData(T wrapper);
    <span class="hl-keyword">void</span>    retrieveCurrentStatus(T wrapper);
    <span class="hl-keyword">boolean</span> prerequisitesMet();
    <span class="hl-keyword">boolean</span> isActive();
    <span class="hl-keyword">boolean</span> needsData();
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7035"></a>6.4.3.&nbsp;The deprecated <code class="literal">IHandler</code> interface</h3></div></div></div><p>
        The <code class="literal">IHandler</code> interface is deprecated. Use <code class="literal">InputHandler</code> instead.
      </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> IHandler {
    <span class="hl-keyword">void</span>    handleSubmittedData(Context context, IWrapper wrapper) <span class="hl-keyword">throws</span> Exception;
    <span class="hl-keyword">void</span>    retrieveCurrentStatus(Context context, IWrapper wrapper) <span class="hl-keyword">throws</span> Exception;
    <span class="hl-keyword">boolean</span> prerequisitesMet(Context context) <span class="hl-keyword">throws</span> Exception;
    <span class="hl-keyword">boolean</span> isActive(Context context) <span class="hl-keyword">throws</span> Exception;
    <span class="hl-keyword">boolean</span> needsData(Context context) <span class="hl-keyword">throws</span> Exception;
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="concepts.statuscodes"></a>6.5.&nbsp;StatusCodes</h2></div></div></div><p>
StatusCodes are assigned to IWrapper parameters and form fields to indicate invalid data and display according error messages. They are automatically assigned by the framework when prechecks, casters or postchecks fail, or they can be assigned programmatically by the application logic.
</p><p>
The framework predefines some common StatusCodes, e.g. <code class="literal">MISSING_PARAM</code> - indicating the missing of a mandatory form value, or StatusCodes for builtin prechecks, casters and postchecks, like <code class="literal">precheck.REGEXP_NO_MATCH</code> - indicating that a form field's value doesn't match a given regular expression. Application developers can arbitrarily define additional StatusCodes.
</p><p>
StatusCodes are defined as normal include parts. They're placed in their own files located under the <code class="literal">dyntxt</code> directory. Within such a statuscode file the part names uniquely identify the StatusCode, the content nested inside the part element represents the message. 
</p><pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;include_parts</span> <span class="hl-attribute">xmlns:ixsl</span>=<span class="hl-value">"http://www.w3.org/1999/XSL/Transform"</span> <span class="hl-attribute">xmlns:pfx</span>=<span class="hl-value">"http://www.schlund.de/pustefix/core"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;part</span> <span class="hl-attribute">name</span>=<span class="hl-value">"ILLEGAL_LOGIN"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;theme</span> <span class="hl-attribute">name</span>=<span class="hl-value">"default"</span><span class="hl-tag">&gt;</span>Illegal login data.<span class="hl-tag">&lt;/theme&gt;</span>
  <span class="hl-tag">&lt;/part&gt;</span>
  ...
<span class="hl-tag">&lt;/include_parts&gt;</span>
</pre><p>
Those StatusCode files are used by the build process to automatically create Java classes containing the StatusCodes as constants, using the part names as field names (in uppercase form). Thus the StatusCodes can be safely referenced from within Java code. 
</p><p>
Before the StatusCode files are recognized by the build process, they have to be configured inside a statuscode metainformation file. The file has to be called statuscodeinfo.xml and has to be located in the project's <code class="literal">conf</code> directory or in the <code class="literal">dyntxt</code> directory. Within this file you define which StatusCode constant class is built from which StatusCode files.
</p><pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;statuscodeinfo</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/statuscodeinfo"</span> 
                <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
                <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/statuscodeinfo 
                                    http://www.pustefix-framework.org/2008/namespace/statuscodeinfo.xsd"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;statuscodes</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.bank.BankStatusCodes"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;file&gt;</span>statusmessages.xml<span class="hl-tag">&lt;/file&gt;</span>
    <span class="hl-tag">&lt;file&gt;</span>...<span class="hl-tag">&lt;/file&gt;</span>
  <span class="hl-tag">&lt;/statuscodes&gt;</span>
  ...
<span class="hl-tag">&lt;/statuscodeinfo&gt;</span>
</pre><p>
Using the above examples Pustefix will build the following Java class (excerpt):
</p><pre class="programlisting">
<span class="hl-keyword">package</span> example.bank;
...
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BankStatusCodes {
    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> StatusCode getStatusCodeByName(String name) { ... }
    ...
    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> StatusCode ILLEGAL_LOGIN = <span class="hl-keyword">new</span> StatusCode(<span class="hl-string">"ILLEGAL_LOGIN"</span>, __RES[<span class="hl-number">0</span>]);
}
</pre><p>
The following login handling example uses the generated StatusCode class to indicate a failed login:
</p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> LoginHandler <span class="hl-keyword">implements</span> InputHandler&lt;Login&gt; {
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> handleSubmittedData(Login login) {
        <em class="hl-comment" style="color: silver">//check login data</em>
        <em class="hl-comment" style="color: silver">//if invalid</em>
        login.addSCodeUser(BankStatusCodes.ILLEGAL_LOGIN);
    }
}
</pre><p>
If you take a look at the resulting XML tree, you see like the according include part is referenced inside the <code class="literal">error</code> element (and thus can be displayed on the page using the <code class="literal">pfx:checkfield</code>, <code class="literal">pfx:error</code> and <code class="literal">pfx:scode</code> tags).
</p><pre class="programlisting">
<span class="hl-tag">&lt;formresult</span> <span class="hl-attribute">...&gt;</span>
   <span class="hl-attribute">...</span>
   <span class="hl-attribute">&lt;formvalues&gt;</span>
      <span class="hl-attribute">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"login.User"</span><span class="hl-tag">&gt;</span>xyz<span class="hl-tag">&lt;/param&gt;</span>
      ...
   <span class="hl-tag">&lt;/formvalues&gt;</span>
   <span class="hl-tag">&lt;formerrors&gt;</span>
     <span class="hl-tag">&lt;error</span> <span class="hl-attribute">name</span>=<span class="hl-value">"login.User"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;pfx:include</span> <span class="hl-attribute">href</span>=<span class="hl-value">"samplebank/dyntxt/statusmessages.xml"</span> <span class="hl-attribute">part</span>=<span class="hl-value">"ILLEGAL_LOGIN"</span><span class="hl-tag">/&gt;</span>
     <span class="hl-tag">&lt;/error&gt;</span>
   <span class="hl-tag">&lt;/formerrors&gt;</span>
   ...
<span class="hl-tag">&lt;/formresult&gt;</span>
</pre><p>
If your error message should contain dynamic data, you can use placeholders, which will be replaced by the arguments passed along with the addScode call at the IWrapper:
</p><pre class="programlisting">
<span class="hl-tag">&lt;part</span> <span class="hl-attribute">name</span>=<span class="hl-value">"ILLEGAL_LOGIN"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;theme</span> <span class="hl-attribute">name</span>=<span class="hl-value">"default"</span><span class="hl-tag">&gt;</span>User <span class="hl-tag">&lt;pfx:argref</span> <span class="hl-attribute">pos</span>=<span class="hl-value">"1"</span><span class="hl-tag">/&gt;</span> is illegal.<span class="hl-tag">&lt;/theme&gt;</span>
<span class="hl-tag">&lt;/part&gt;</span>
</pre><p>
StatusCodes can be also referenced from within IWrapper definitions. If you're using a built-in StatusCode (from org.pustefixframework.generated.CoreStatusCodes), you can just use its name, if you're using a StatusCode from another module, you have to prefix the name with the class name of the generated class separated by a <code class="literal">#</code> sign:
</p><pre class="programlisting">
<span class="hl-tag">&lt;interface</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/iwrapper"</span><span class="hl-tag">&gt;</span>

  <span class="hl-tag">&lt;ihandler</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag">/&gt;</span>
  
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Login"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">missingscode</span>=<span class="hl-value">"example.bank.BankStatusCodes#MISSING_LOGIN_DATA"</span><span class="hl-tag">&gt;</span>
    ...
  <span class="hl-tag">&lt;/param&gt;</span>

<span class="hl-tag">&lt;/interface&gt;</span> 
</pre><p>
The statusmessage files for statuscodes coming from the Pustefix core or arbitrary modules can be edited to customize the messages for your project's requirements. Therefor the original statusmessage files are initially copied or if a copy already exists, the files are merged (statusmessages for new statuscodes are added, statusmessages for omitted statuscodes are removed) by the build process. You should only customize these merged files, changes in the original files will be overwritten with the next module update.
</p><p>
The built-in core and editor statuscodes are merged to <code class="literal">projects/core-override/dyntxt/statusmessages-core-merged.xml</code> and <code class="literal">projects/core-override/dyntxt/statusmessages-editor-merged.xml</code>. Pustefix module statuscodes are merged to <code class="literal">projects/modules-override/MODULENAME/dyntxt/statusmessages-merged.xml</code>.
</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="concepts.interceptors"></a>6.6.&nbsp;ContextInterceptors</h2></div></div></div><p>
    Pustefix provides a mechanism to hook custom logic into the request processing lifecycle. Therefor it provides a set of interception points, where you can register classes or Spring beans implementing the <code class="literal">ContextInterceptor</code> interface, which then are automatically called during the processing of a request. 
  </p><div class="itemizedlist"><p>Common use cases for <code class="literal">ContextInterceptors</code> are:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Implementation of cross-cutting concerns like logging, cleanup.
      </p></li><li class="listitem"><p>
        Implementation of standard design patterns like Hibernate's "Open Session in view".
      </p></li><li class="listitem"><p>
        Triggering logic/setting data independent of the requested page, e.g. setting a variant.
      </p></li><li class="listitem"><p>
        Handling of common, page-independent/shared parameters.
      </p></li></ul></div><p>
  </p><div class="figure"><a name="concepts.interceptors.figure"></a><p class="title"><b>Figure&nbsp;6.2.&nbsp;ContextInterceptors</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/reference/concepts-interceptors.png" alt="ContextInterceptors"></div></div></div><p><br class="figure-break">
  </p><p>
    Currently Pustefix supports three interception points: <code class="literal">start</code>, which is right before the actual request handling gets started, <code class="literal">end</code>, which is right after the DOM result tree has been created, and <code class="literal">postrender</code>, which is right after the view has been rendered.
  </p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ContextInterceptor {
    <span class="hl-keyword">void</span> process(Context context, PfixServletRequest preq);
}
</pre><p>
    The framework calls the <code class="literal">process</code> method of the registered <code class="literal">ContextInterceptor</code> implementations, passing the <code class="literal">Context</code> and <code class="literal">PfixServletRequest</code> as parameters.
  </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
    Comparison with <code class="literal">ServletFilters</code>: <code class="literal">ServletFilters</code> apply right before/right after a request/response enters/leaves the framework's processing layer and give you means to manipulate the incoming <code class="literal">ServletRequest</code> and outgoing <code class="literal">ServletResponse</code>, whereas <code class="literal">ContextInterceptors</code> are part of the framework's lifecycle and give you direct access to the request (but not the response), <code class="literal">Context</code> and other Spring beans, and are meant to trigger logic or set data.
  </td></tr></table></div><p>
   <code class="literal">ContextInterceptors</code> are configured in the <code class="literal">Context's</code> configuration file. Below you can see an a sample configuration fragment showing all available configuration options:
  </p><pre class="programlisting">
<span class="hl-tag">&lt;context-xml-service-config&gt;</span>
 
   <span class="hl-tag">&lt;context&gt;</span> ... <span class="hl-tag">&lt;/context&gt;</span>

   <em class="hl-comment" style="color: silver">&lt;!-- ContextInterceptors are defined within the &lt;interceptors&gt; element directly following the &lt;context&gt; element. --&gt;</em>
   <span class="hl-tag">&lt;interceptors&gt;</span>

     <em class="hl-comment" style="color: silver">&lt;!-- The interceptors are grouped by their interception points (start, end, postrender), which are represented 
            by accordingly named elements. --&gt;</em>
     <span class="hl-tag">&lt;start&gt;</span>

        <em class="hl-comment" style="color: silver">&lt;!-- Interceptors are registered either by setting the ContextInterceptor implementation class or by setting 
               an according reference to a Spring bean configured elsewhere. --&gt;</em>
        <span class="hl-tag">&lt;interceptor</span> <span class="hl-attribute">class</span>=<span class="hl-value">"mypackage.MyStartInterceptor"</span><span class="hl-tag">/&gt;</span>

        <em class="hl-comment" style="color: silver">&lt;!-- If you're setting an implementation class, the framework will create an according Spring bean for you. 
               By default it will get Singleton scope, but you can provide an alternative scope using the scope attribute. --&gt;</em> 
        <span class="hl-tag">&lt;interceptor</span> <span class="hl-attribute">class</span>=<span class="hl-value">"mypackage.MySessionScopedInterceptor"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"session"</span><span class="hl-tag">/&gt;</span>

        <span class="hl-tag">&lt;interceptor</span> <span class="hl-attribute">bean-ref</span>=<span class="hl-value">"myStartInterceptor"</span><span class="hl-tag">/&gt;</span>

     <span class="hl-tag">&lt;/start&gt;</span>

     <span class="hl-tag">&lt;end&gt;</span> ... <span class="hl-tag">&lt;/end&gt;</span>

     <span class="hl-tag">&lt;postrender&gt;</span> ... <span class="hl-tag">&lt;/postrender&gt;</span>

   <span class="hl-tag">&lt;/interceptors&gt;</span>

   ...

<span class="hl-tag">&lt;/context-xml-service-config&gt;</span>
</pre><p>
    The following example interceptor tries to guess from which country the client request is coming and sets a special variant if it comes from Germany. Therefor it checks the client's IP retrieved from the servlet request using a GeoLocationAPI. It sets a flag after the first check to avoid multiple checks. Remembering the flag this way only works when the interceptor has session scope and synchronization can be omitted because the operation is repeatable and boolean access is atomic.
  </p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MySessionScopedInterceptor <span class="hl-keyword">implements</span> ContextInterceptor {
	
	<span class="hl-keyword">private</span> <span class="hl-keyword">boolean</span> checked;

	<em><span class="hl-annotation" style="color: gray">@Override</span></em>
	<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> process(Context context, PfixServletRequest preq) {
		<span class="hl-keyword">if</span>(!checked) {
			String country = GeoLocationAPI.getCountry(preq.getRemoteAddr());
			<span class="hl-keyword">if</span>(country.equals(<span class="hl-string">"DE"</span>)) context.setVariant(<span class="hl-string">"foo"</span>);
			checked = true;
		}
	}
	
}
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="literal">ContextInterceptors</code> are singleton-scoped beans by default. So if you want to store data or call non-threadsafe code, you possibly will have to do some synchronization or use an appropriate scope.</p><p><code class="literal">ContextInterceptors</code> are called on every request. So you shouldn't execute long-running tasks and avoid that time-consuming code is unnecessarily called with each invocation.</p></td></tr></table></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="advanced"></a>Chapter&nbsp;7.&nbsp;Advanced topics</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#advanced.variantsandthemes">7.1. Variants and Themes</a></span></dt><dd><dl><dt><span class="section"><a href="#advanced.variantsandthemes.themes">7.1.1. Themes</a></span></dt><dt><span class="section"><a href="#advanced.variantsandthemes.variants">7.1.2. Variants</a></span></dt></dl></dd><dt><span class="section"><a href="#advanced.pagealternatives">7.2. Page alternatives</a></span></dt><dt><span class="section"><a href="#advanced.i18n">7.3. Internationalization</a></span></dt><dt><span class="section"><a href="#advanced.multitenancy">7.4. Multitenancy</a></span></dt><dt><span class="section"><a href="#advanced.dyninclude">7.5. Dynamic resource inclusion</a></span></dt><dd><dl><dt><span class="section"><a href="#advanced.dyninclude.modinclude">7.5.1. Including resources from modules</a></span></dt><dt><span class="section"><a href="#advanced.dyninclude.dynamic">7.5.2. Dynamic search</a></span></dt><dt><span class="section"><a href="#advanced.dyninclude.override">7.5.3. Overriding module resources</a></span></dt></dl></dd><dt><span class="section"><a href="#advanced.rolebasedauth">7.6. Authentication and authorization</a></span></dt><dd><dl><dt><span class="section"><a href="#advanced.rolebasedauth.roles">7.6.1. Managing Roles</a></span></dt><dt><span class="section"><a href="#rolebasedauth_customconditions">7.6.2. Custom conditions</a></span></dt><dt><span class="section"><a href="#rolebasedauth_customroleprovider">7.6.3. Custom RoleProvider</a></span></dt></dl></dd><dt><span class="section"><a href="#advanced.ajax">7.7. AJAX services</a></span></dt><dd><dl><dt><span class="section"><a href="#advanced.ajax.config">7.7.1. Service configuration</a></span></dt><dt><span class="section"><a href="#advanced.ajax.exception">7.7.2. Exception handling</a></span></dt><dt><span class="section"><a href="#advanced.ajax.tools">7.7.3. Development tools</a></span></dt><dt><span class="section"><a href="#advanced.ajax.callback">7.7.4. Callback mechanisms</a></span></dt><dt><span class="section"><a href="#advanced.ajax.typemapping">7.7.5. Type mapping</a></span></dt></dl></dd><dt><span class="section"><a href="#advanced.object2xml">7.8. Object-to-XML mapping</a></span></dt><dd><dl><dt><span class="section"><a href="#advanced.object2xml.serializationprocess">7.8.1. Serialization process</a></span></dt><dt><span class="section"><a href="#advanced.object2xml.builtinserializers">7.8.2. Built-in serializers</a></span></dt><dt><span class="section"><a href="#advanced.object2xml.customserializers">7.8.3. Custom serializers</a></span></dt><dt><span class="section"><a href="#advanced.object2xml.jaxb">7.8.4. Using JAXB serialization</a></span></dt></dl></dd><dt><span class="section"><a href="#advanced.iwrapperannotations">7.9. Annotation-based IWrapper creation</a></span></dt><dd><dl><dt><span class="section"><a href="#advanced.iwrapperannotations.reference">7.9.1. IWrapper annotations</a></span></dt></dl></dd><dt><span class="section"><a href="#advanced.scriptedflows">7.10. Scripted workflows</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8977">7.10.1. Parameters and Variables</a></span></dt><dt><span class="section"><a href="#d0e8997">7.10.2. Statements</a></span></dt></dl></dd><dt><span class="section"><a href="#advanced.scripting">7.11. Scripting Langauge support</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e9123">7.11.1. IHandler</a></span></dt><dt><span class="section"><a href="#d0e9138">7.11.2. State</a></span></dt><dt><span class="section"><a href="#d0e9145">7.11.3. Implementation Details</a></span></dt></dl></dd><dt><span class="section"><a href="#advanced.eventbus">7.12. The Pustefix EventBus</a></span></dt><dt><span class="section"><a href="#advanced.requestid">7.13. Request IDs for log correlation</a></span></dt><dt><span class="section"><a href="#advanced.editor">7.14. The Pustefix Editor</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advanced.variantsandthemes"></a>7.1.&nbsp;Variants and Themes</h2></div></div></div><p></p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="advanced.variantsandthemes.themes"></a>7.1.1.&nbsp;Themes</h3></div></div></div><p>
        Describe themes here.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="advanced.variantsandthemes.variants"></a>7.1.2.&nbsp;Variants</h3></div></div></div><p>
        Variants are a way to have the same page look and behave different depending
        on a variant id that can be set freely at runtime. This allows to select different
        look and behaviour depending on data collected during the user sesion.
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e7253"></a>Selecting a variant</h4></div></div></div><p>
          Variants can be selected by calling the method <code class="literal">setVariant(Variant var)</code>
          in the Context. This will store and reuse the id for the current and all following
          requests until it is set to a different id (or erased by setting it to null).
        </p><p>
          The <code class="literal">Context</code> takes care to set the variant in the
          <code class="literal">SPDocument</code> it returnes to the AbstractXMLServer which
          in turn tries to get the matching target for the requested page and
          requested variant.
          If no target matching the variant is found, the "root" variant
          (in other words, the page without a variant at all) will be tried.
        </p><p>
          When defining variants of pages, the system automatically makes sure
          that you can only define variants for a page that has also a no-variant
          definition. This works for pages defined using the &lt;standardpage&gt; tag and
          for pages defined by hand using &lt;target&gt; tags directly.
        </p><p>
          The valid characters for variants are a-zA-Z0-9_+- (but see below for compound variants and the use of the : character).
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e7273"></a>Compound Variants</h4></div></div></div><p>
          Variants can be variants of variants themself which in turn can be considered variants of another variant. The name of a variant that is a subvariant of another variant must be expressed in the following way: foo:bar:baz
        </p><p>
          Here we have a variant that is a subvariant of foo:bar which in turn is a subvariant of foo. This information is used when determining the right Target for generating the output. Say the variant foo:bar:baz has been set via the setVariant(Variant var) method of the Context and the request wants to display the page Home. When trying to get the matching Target for transforming the output the system first tries to get the matching Target for Home, variant foo:bar:baz. If it gets no result, it goes on trying Home, variant foo:bar; then Home, variant foo before finally requesting the "root" variant of page Home.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e7280"></a>Variant features</h4></div></div></div><p>
          Variants can influence the way an application works:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
              They can change the look and content of a page. This is implemented in
              terms of themes that depend on the selected variant. See below for more
              details.
            </li><li class="listitem">
              They can change the backend definition of a pagerequest
              (aka: Handlers, State, and output from ContextRessources)
            </li><li class="listitem">
              They can change the definition of a pageflow
            </li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e7295"></a>Defining variants of pages</h4></div></div></div><p>
          Different variants of pages are usually defined via the standardpage tag:
        </p><pre class="programlisting"><span class="hl-tag">&lt;standardpage</span> <span class="hl-attribute">xml</span>=<span class="hl-value">"MyProject/xml/frame.xml"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Home"</span> <span class="hl-attribute">variant</span>=<span class="hl-value">"foo:bar:baz"</span><span class="hl-tag">&gt;</span></pre><p>
          What's interesting here is how the system produces the themes attribute used for
          the two targets that result from the expansion of the standardpage tag.
        </p><p>
          If we have not given a special local themes attribute to the standardpage tag,
          and no global themes attribute has been given (see here), then the value of the
          themes attribute for both targets is in this example <code class="literal">baz bar foo MyProject default</code>.
        </p><p>
          As can be seen, the use of the variant attribute will expand the themes as they would
          be valid for the targets produced from the standardpage tag (either by using a
          locally defined themes attribute of the standardpage tag, or automatically by
          using the global fallback) by putting more specific themes in front of the
          themes list, which are generated from the given variant id. If the variant id
          is a compount variant, then each segment of the compound variant will be used,
          from right to left, to generate a theme name to be put before the "normal"
          themes valid for the page.
        </p><p>
          If the standardpage had its own themes attribute given (say for example
          "<code class="literal">theme_a theme_b default</code>"), the resulting themes after taking the
          variant id into account would of course be <code class="literal">baz bar foo theme_a theme_b default</code>.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e7319"></a>Defining variants of pagerequests</h4></div></div></div><p>
          Variants can also be used to create different implementations for the same
          pagerequest. This is done by a simple extension to the way a pagerequest is
          defined in the servlet configuration file.
        </p><pre class="programlisting"><span class="hl-tag">&lt;pagerequest</span> <span class="hl-attribute">name</span>=<span class="hl-value">"foo"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;default&gt;</span>
    [Any other tag that is allowed inside a pagerequest]
  <span class="hl-tag">&lt;/default&gt;</span>
  <span class="hl-tag">&lt;variant</span> <span class="hl-attribute">name</span>=<span class="hl-value">"var_id"</span><span class="hl-tag">&gt;</span>
    [Any other tag that is allowed inside a pagerequest]
  <span class="hl-tag">&lt;/variant&gt;</span>
  <span class="hl-tag">&lt;variant</span> <span class="hl-attribute">name</span>=<span class="hl-value">"another_var_id"</span><span class="hl-tag">&gt;</span>
    [Any other tag that is allowed inside a pagerequest]
  <span class="hl-tag">&lt;/variant&gt;</span>
 <span class="hl-tag">&lt;/pagerequest&gt;</span></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You must give a <code class="literal">&lt;default&gt;</code> definition when using named variants.</p><p>Each of the <code class="literal">&lt;default&gt;</code> and all <code class="literal">&lt;variant&gt;</code> definitions are self contained, full definitions of pagerequests. Nothing is shared between them.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e7340"></a>Defining variants of pageflows</h4></div></div></div><p>
          Variants can also be used to create different implementations for the
          same pageflow. This is done by a simple extension to the way a pageflow is
          defined in the servlet configuration file.
        </p><pre class="programlisting"><span class="hl-tag">&lt;pageflow</span> <span class="hl-attribute">name</span>=<span class="hl-value">"fooFlow"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;default&gt;</span>
    [Any other tag that is allowed inside a pageflow]
  <span class="hl-tag">&lt;/default&gt;</span>
  <span class="hl-tag">&lt;variant</span> <span class="hl-attribute">name</span>=<span class="hl-value">"var_id"</span><span class="hl-tag">&gt;</span>
    [Any other tag that is allowed inside a pageflow]
  <span class="hl-tag">&lt;/variant&gt;</span>
  <span class="hl-tag">&lt;variant</span> <span class="hl-attribute">name</span>=<span class="hl-value">"another_var_id"</span><span class="hl-tag">&gt;</span>
    [Any other tag that is allowed inside a pageflow]
  <span class="hl-tag">&lt;/variant&gt;</span>
<span class="hl-tag">&lt;/pageflow&gt;</span></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You must give a <code class="literal">&lt;default&gt;</code> definition when using named variants.</p><p>Each of the <code class="literal">&lt;default&gt;</code> and all <code class="literal">&lt;variant&gt;</code> definitions are self contained, full definitions of pagerequests. Nothing is shared between them.</p></td></tr></table></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advanced.pagealternatives"></a>7.2.&nbsp;Page alternatives</h2></div></div></div><p>
        Page alternatives are different representations of the same logical page. Page
        alternatives are internally used to create different versions for languages/tenants, but can be also used for
        pages which are based on a common page, assigned to the same logical page, but with different content and display pagename, e.g.
        landing pages (see <a class="xref" href="#configuration.sitemap" title="4.3.4.&nbsp;Sitemap configuration">Section&nbsp;4.3.4, &#8220;Sitemap configuration&#8221;</a>).
      </p><p>
        Conceptually related to page variants, page alternatives are implemented on a lower level. Creating a page alternative
        automatically creates alternatives for all variants of a page, i.e. all existing standardpage definitions of a page
        are copied, thus providing an own stylesheet per alternative.
      </p><p>
        The definition of page alternatives is done within the sitemap configuration:
      </p><pre class="programlisting"><span class="hl-tag">&lt;sitemap&gt;</span>
  <span class="hl-tag">&lt;page</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Info"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;alt</span> <span class="hl-attribute">key</span>=<span class="hl-value">"cities"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Cities"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;alt</span> <span class="hl-attribute">key</span>=<span class="hl-value">"nationalparks"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"NationalParks"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;alt</span> <span class="hl-attribute">key</span>=<span class="hl-value">"mountains"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Mountains"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/page&gt;</span>
<span class="hl-tag">&lt;/sitemap&gt;</span></pre><p>
         Every page alternative has a key, which is referred to select the matching alternative. The key can be programmatically
         set using the <code class="literal">Context</code> method <code class="literal">setPageAlternative(String key)</code>. During the XSL transformation
         the key can be accessed using the parameter <code class="literal">$pageAlternative</code>. The key will be also inserted into
         the theme fallback chain. Thus you can produce different content per alternative.
      </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advanced.i18n"></a>7.3.&nbsp;Internationalization</h2></div></div></div><p>
      Pustefix provides various mechanisms to implement internationalized applications. You can write applications
      which have a fixed language which is selected/resolved at buildtime using the theme mechanism 
      (see <a class="xref" href="#advanced.variantsandthemes" title="7.1.&nbsp;Variants and Themes">Section&nbsp;7.1, &#8220;Variants and Themes&#8221;</a>) or the dynamic include mechanism 
      (see <a class="xref" href="#advanced.dyninclude" title="7.5.&nbsp;Dynamic resource inclusion">Section&nbsp;7.5, &#8220;Dynamic resource inclusion&#8221;</a>). You can make the language
      switchable at runtime using the language-aware core tags (see <a class="xref" href="#xslt.pfx.langselect" title="5.6.2.&nbsp;Displaying content based on the language">Section&nbsp;5.6.2, &#8220;Displaying content based on the language&#8221;</a>).
    </p><p>
      Using Pustefix's multitenancy support (see <a class="xref" href="#advanced.multitenancy" title="7.4.&nbsp;Multitenancy">Section&nbsp;7.4, &#8220;Multitenancy&#8221;</a> you get a combination
      of both mechanisms. Pages have a fixed language, but an own instance is created for each language, and thus
      the language is switchable at runtime too.
    </p><p>
		Your business logic can query the currently selected language using the <code class="literal">Context</code>
	        method <code class="literal">getLanguage()</code>, using <code class="literal">setLanguage(String language)</code>,
		you can change the selected language at runtime.
      </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advanced.multitenancy"></a>7.4.&nbsp;Multitenancy</h2></div></div></div><p>
      Pustefix provides basic multitenancy support, i.e. a single application instance can serve multiple tenants, like markets or 
      countries. Tenants are automatically selected by matching host name patterns against the requested
      host name. Tenant configuration is done within <code class="literal">project.xml</code> or included configuration fragments 
      (see <a class="xref" href="#configuration.project.projectxml" title="4.3.2.&nbsp;Project descriptor (project.xml)">Section&nbsp;4.3.2, &#8220;Project descriptor (project.xml)&#8221;</a>).
    </p><pre class="programlisting"><span class="hl-tag">&lt;project-config&gt;</span>
  
  <span class="hl-tag">&lt;tenant</span> <span class="hl-attribute">name</span>=<span class="hl-value">"CA_market"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;choose&gt;</span>
      <span class="hl-tag">&lt;when</span> <span class="hl-attribute">test</span>=<span class="hl-value">"$mode='prod'"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;host&gt;</span>.*\.ca$<span class="hl-tag">&lt;/host&gt;</span>
      <span class="hl-tag">&lt;/when&gt;</span>
      <span class="hl-tag">&lt;otherwise&gt;</span>
        <span class="hl-tag">&lt;host&gt;</span>^ca\..*<span class="hl-tag">&lt;/host&gt;</span>
      <span class="hl-tag">&lt;/otherwise&gt;</span>
    <span class="hl-tag">&lt;/choose&gt;</span>
    <span class="hl-tag">&lt;lang</span> <span class="hl-attribute">default</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>en_CA<span class="hl-tag">&lt;/lang&gt;</span>
    <span class="hl-tag">&lt;lang&gt;</span>fr_CA<span class="hl-tag">&lt;/lang&gt;</span>
  <span class="hl-tag">&lt;/tenant&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!-- include tenants config fragments from all modules found in classpath --&gt;</em>
  <span class="hl-tag">&lt;config-include</span> <span class="hl-attribute">file</span>=<span class="hl-value">"conf/project-fragment.xml"</span> <span class="hl-attribute">section</span>=<span class="hl-value">"tenants"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"*"</span><span class="hl-tag">/&gt;</span>
  
<span class="hl-tag">&lt;/project-config&gt;</span></pre><p>
      The current multitenancy support concentrates on the view layer. Pustefix automatically creates tenant and language specific 
      versions of all pages. Tenant/language specific page content is created by applying filters to the dynamic include mechanism, 
      thus overriding and extending the core page content with tenant- and/or language-specific content from according 
      tenant/language modules (see the following examples of a tenant and language Pustefix module descriptor, also see 
      (<a class="xref" href="#modulessupport.types.new" title="9.1.&nbsp;Resources within library JARs">Section&nbsp;9.1, &#8220;Resources within library JARs&#8221;</a>).
    </p><pre class="programlisting"><span class="hl-tag">&lt;module-descriptor&gt;</span>

  <span class="hl-tag">&lt;module-name&gt;</span>pustefix-i18n-tenant-ca<span class="hl-tag">&lt;/module-name&gt;</span>

  <span class="hl-tag">&lt;default-search</span> <span class="hl-attribute">priority</span>=<span class="hl-value">"1"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;filter-attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"tenant"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"CA_market"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/default-search&gt;</span>
  
<span class="hl-tag">&lt;/module-descriptor&gt;</span></pre><pre class="programlisting"><span class="hl-tag">&lt;module-descriptor&gt;</span>

  <span class="hl-tag">&lt;module-name&gt;</span>pustefix-i18n-lang-fr<span class="hl-tag">&lt;/module-name&gt;</span>

  <span class="hl-tag">&lt;override-modules&gt;</span>
    <span class="hl-tag">&lt;filter-attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"lang"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"fr"</span><span class="hl-tag">/&gt;</span>
    ...
  <span class="hl-tag">&lt;/override-modules&gt;</span>

<span class="hl-tag">&lt;/module-descriptor&gt;</span></pre><p>
       Application developers can query the currently set tenant at runtime using the <code class="literal">Context</code> method 
       <code class="literal">getTenant()</code>. Additionally Pustefix automatically adds an element <code class="literal">&lt;tenant&gt;</code>
       to the result DOM tree. During XSL transformations the tenant targeted by the transformation can be accessed
       using the XSL parameter <code class="literal">$tenant</code>.
    </p><p>
       Static resources, like error pages, can also be delivered in a language/tenant-specific way. Optionally resources can be
       searched using tenant and language as path components, e.g. with tenant set to "Canada" and language set to "fr_CA", the
       static page <code class="literal">/pages/error404.html</code> will be searched in the following locations (highest priority first):
    </p><pre class="screen">/pages/Canada/fr_CA/error404.html
/pages/Canada/fr/error404.html
/pages/Canada/error404.html
/pages/fr_CA/error404.html
/pages/fr/error404.html
/pages/error404.html
</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advanced.dyninclude"></a>7.5.&nbsp;Dynamic resource inclusion</h2></div></div></div><p>
      Pustefix applications can be modularized by packaging/sharing application parts or components as Pustefix modules, which are regular
      Jar files with a defined directory structure and a special deployment descriptor (see <a class="xref" href="#modulessupport" title="Chapter&nbsp;9.&nbsp;Module Support">Chapter&nbsp;9, <i>Module Support</i></a>). Pustefix modules
      not only contain Java classes, but can contain any kind of resource, like XML, XSL, Javascript, CSS or image files.
    </p><p>
      Prior Pustefix releases required that these resources were extracted to the file system by the build process to be usable in an application.
      Meanwhile Pustefix supports that XML and XSL files used by the rendering engine (TargetGenerator) can be directly loaded from the module
      jar files.
    </p><p>
      Developing strongly modularized applications often requires, that you want to be able to adapt parts of a shared
      module to your application's context without breaking the modularization. Therefor Pustefix supports the dynamic inclusion of resources,
      which allows you to provide a local version of a resource, which will be automatically taken instead of the according version from a module jar.
      Additionally resources from modules can be overridden by other modules.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="advanced.dyninclude.modinclude"></a>7.5.1.&nbsp;Including resources from modules</h3></div></div></div><p>
        Resources from modules are directly used by additionally specifying the name of the module. Therefor the according tags from the Pustefix tag library and
        the configuration elements in <code class="literal">depend.xml</code> provide a <code class="literal">module</code> attribute.
      </p><p>
        samplemodule.jar
        </p><pre class="screen">META-INF/pustefix-module.xml
PUSTEFIX-INF/img/image.png
PUSTEFIX-INF/img/theme/image.png
PUSTEFIX-INF/txt/common.xml
PUSTEFIX-INF/txt/pages/main_page.xml
PUSTEFIX-INF/xml/frame.xml
PUSTEFIX-INF/xsl/metatags.xsl
PUSTEFIX-INF/xsl/skin.xsl</pre><p>
      </p><p>
        Let's take a look at how the various resources from the sample module can be directly included using the Pustefix tag library:
        </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:xinp</span> <span class="hl-attribute">type</span>=<span class="hl-value">"image"</span> <span class="hl-attribute">src</span>=<span class="hl-value">"img/image.png"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"samplemodule"</span><span class="hl-tag">/&gt;</span></pre><p>
        </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:image</span> <span class="hl-attribute">themed-path</span>=<span class="hl-value">"img"</span> <span class="hl-attribute">themed-img</span>=<span class="hl-value">"image.png"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"samplemodule"</span><span class="hl-tag">/&gt;</span></pre><p>
        </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:include</span> <span class="hl-attribute">part</span>=<span class="hl-value">"foo"</span> <span class="hl-attribute">href</span>=<span class="hl-value">"txt/common.xml"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"samplemodule"</span><span class="hl-tag">/&gt;</span></pre><p>
        </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:maincontent</span> <span class="hl-attribute">part</span>=<span class="hl-value">"content"</span> <span class="hl-attribute">path</span>=<span class="hl-value">"txt/pages"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"samplemodule"</span><span class="hl-tag">/&gt;</span></pre><p>
      </p><p>
        You just have to set the <code class="literal">module</code> attribute and be aware that the file paths are relative to the <code class="literal">PUSTEFIX-INF</code> root folder from the module jar file.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
        If you're using includes from within a module and you're omitting the <code class="literal">href</code> or <code class="literal">module</code> attribute, you should be aware of the following behaviour:
        <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">if you're only specifying the <code class="literal">part</code> attribute, the include is loaded from the current file from within the current module</li><li class="listitem">if you're specifying <code class="literal">part</code> and <code class="literal">href</code>, the include is loaded from the specified href/path from within the current module</li><li class="listitem">if you're specifying <code class="literal">part</code> and <code class="literal">module</code>, the include is loaded from the href/path of the current file from within the specified module</li></ul></div></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Special module names"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left"><a name="advanced.dyninclude.modinclude.special"></a>Special module names</th></tr><tr><td align="left" valign="top">
        If you want to explicitly reference an include from the application, you can use the special module name <span class="emphasis"><em>webapp</em></span>, which indicates
        Pustefix, that it shouldn't look in the current module as done by default, but load the file from the webapp folder.
        If you want to explicitly reference an include from the module where the page is defined (where the config fragment with the <code class="literal">standardpage</code> definition resides), you can use the special name <span class="emphasis"><em>pagedef</em></span>.
      </td></tr></table></div><p>
        If you want to directly reference XML/XSL files in the <code class="literal">depend.xml</code> configuration file, this works the same way by adding a <code class="literal">module</code> attribute to the according elements:
      </p><pre class="programlisting">
<span class="hl-tag">&lt;standardmaster&gt;</span>
  <span class="hl-tag">&lt;include</span> <span class="hl-attribute">stylesheet</span>=<span class="hl-value">"xsl/skin.xsl"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"samplemodule"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/standardmaster&gt;</span>
</pre><pre class="programlisting">
<span class="hl-tag">&lt;standardmetatags&gt;</span>
  <span class="hl-tag">&lt;include</span> <span class="hl-attribute">stylesheet</span>=<span class="hl-value">"xsl/metatags.xsl"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"samplemodule"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/standardmetatags&gt;</span>
</pre><pre class="programlisting">
<span class="hl-tag">&lt;standardpage</span> <span class="hl-attribute">name</span>=<span class="hl-value">"page"</span> <span class="hl-attribute">xml</span>=<span class="hl-value">"xml/frame.xml"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"samplemodule"</span><span class="hl-tag">/&gt;</span>
</pre><p>
        Including or importing a stylesheet from a module into another stylesheet can be done using a <code class="literal">module</code> URI:
      </p><pre class="programlisting">
<span class="hl-tag">&lt;xsl:import</span> <span class="hl-attribute">href</span>=<span class="hl-value">"module://samplemodule/xsl/test.xsl"</span><span class="hl-tag">/&gt;</span>
</pre><p>
         A module URI complies with the hierarchical URI syntax <code class="literal">[scheme:][//authority][path][?query][#fragment]</code>. The <code class="literal">scheme</code> has to be set to <code class="literal">module</code> and the authority part is set to the module name. The <code class="literal">path</code> has to be relative to the <code class="literal">PUSTEFIX-INF</code> folder.
      </p><p>
        Such URIs also can be programmatically used to get a module resource with the <code class="literal">ResourceUtil</code> helper class:
      </p><pre class="programlisting">Resource res = ResourceUtil.getResource(<span class="hl-string">"module://samplemodule/txt/test.txt"</span>);</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="advanced.dyninclude.dynamic"></a>7.5.2.&nbsp;Dynamic search</h3></div></div></div><p>
        Resources included from modules can be overridden by providing an alternative version in the project itself or in the common folder. Resources included from the common folder can be overridden by a project specific version as well.
      </p><p>
        Therefor you have to place the overriding file under the same relative path in your project/application or the common directory and set the <code class="literal">search</code> attribute of the according Pustefix tag to <code class="literal">dynamic</code>.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:include</span> <span class="hl-attribute">part</span>=<span class="hl-value">"foo"</span> <span class="hl-attribute">href</span>=<span class="hl-value">"txt/common.xml"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"samplemodule"</span> <span class="hl-attribute">search</span>=<span class="hl-value">"dynamic"</span><span class="hl-tag">/&gt;</span></pre><pre class="programlisting"><span class="hl-tag">&lt;pfx:image</span> <span class="hl-attribute">src</span>=<span class="hl-value">"img/image.png"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"samplemodule"</span> <span class="hl-attribute">search</span>=<span class="hl-value">"dynamic"</span><span class="hl-tag">/&gt;</span></pre><p>
        Setting <code class="literal">search</code> to <code class="literal">dynamic</code> the resource will be searched at different pre-defined locations in the following order:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">In the project's folder: <code class="literal">projects/myproject/path/to/resource</code></li><li class="listitem">In the common folder: <code class="literal">projects/common/path/to/resource</code></li><li class="listitem">In all overriding modules (see next section): <code class="literal">PUSTEFIX-INF/path/to/resource</code></li><li class="listitem">In the specified module: <code class="literal">PUSTEFIX-INF/path/to/resource</code></li></ul></div><p>
        If you omit the <code class="literal">module</code> attribute, the resource will be only searched in the project's and the common folder.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
        If you're dynamically searching for an include part and a file is found in the fallback chain, but doesn't contain the requested part, the search will move along to the next level. In contrast, themes aren't taken into account, i.e. the first file containing the searched part will be returned, regardless of how specific the contained themes are.
      </td></tr></table></div><pre class="programlisting"><span class="hl-tag">&lt;pfx:image</span> <span class="hl-attribute">themed-path</span>=<span class="hl-value">"img"</span> <span class="hl-attribute">themed-img</span>=<span class="hl-value">"image.png"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"samplemodule"</span> <span class="hl-attribute">search</span>=<span class="hl-value">"dynamic"</span><span class="hl-tag">/&gt;</span></pre><p>
        If you're dynamically including a themed image, the search iterates over the theme list on each fallback level, e.g. the theme fallback list "<code class="literal">foo bar default</code>" will result in the following search:
      </p><pre class="screen">projects/myproject/img/foo/image.png
projects/myproject/img/bar/image.png
projects/myproject/img/default/image.png
projects/common/img/foo/image.png
projects/common/img/bar/image.png
projects/common/img/default/image.png
...
      </pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
        If you're dynamically searching for a themed image and a matching file is found, the returned image will be the one with the most specific theme on the current fallback level, images matching more specific themes down in the fallback chain aren't taken into account.  
      </td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="advanced.dyninclude.override"></a>7.5.3.&nbsp;Overriding module resources</h3></div></div></div><p>
        Resources from modules can be overridden by other modules. Therefor a module can declare, which resources from which module it wants to override. This declaration is done within its module descriptor (see <a class="xref" href="#modulessupport" title="Chapter&nbsp;9.&nbsp;Module Support">Chapter&nbsp;9, <i>Module Support</i></a>).
      </p><pre class="programlisting"><span class="hl-tag">&lt;module-descriptor</span> 
     <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/module-descriptor"</span>
     <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
     <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/module-descriptor
                         http://www.pustefix-framework.org/2008/namespace/module-descriptor.xsd"</span><span class="hl-tag">&gt;</span>

  <span class="hl-tag">&lt;module-name&gt;</span>module-B<span class="hl-tag">&lt;/module-name&gt;</span>

  <span class="hl-tag">&lt;override-modules&gt;</span>
    <span class="hl-tag">&lt;module</span> <span class="hl-attribute">name</span>=<span class="hl-value">"module-A"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;resource</span> <span class="hl-attribute">path</span>=<span class="hl-value">"txt/common.xml"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/module&gt;</span>
  <span class="hl-tag">&lt;/override-modules&gt;</span>

<span class="hl-tag">&lt;/module-descriptor&gt;</span>
</pre><p>
        In this example <code class="literal">module-B</code> overrides a resource of <code class="literal">module-A</code>. This means that <code class="literal">module-B</code> is inserted into the fallback chain for the resource right after the <code class="literal">common</code> folder and right before <code class="literal">module-A</code>.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:include</span> <span class="hl-attribute">part</span>=<span class="hl-value">"foo"</span> <span class="hl-attribute">href</span>=<span class="hl-value">"txt/common.xml"</span> <span class="hl-attribute">module</span>=<span class="hl-value">"module-A"</span> <span class="hl-attribute">search</span>=<span class="hl-value">"dynamic"</span><span class="hl-tag">/&gt;</span></pre><p>
        Trying to dynamically include part <code class="literal">foo</code> from <code class="literal">txt/common.xml</code> and <code class="literal">module-A</code> will result in the following fallback chain:
      </p><pre class="screen">projects/myproject/txt/common.xml
projects/common/txt/common.xml
module://module-B/txt/common.xml
module://module-A/txt/common.xml</pre><p>
        An overriding module itself can be overridden by another module. Consider the following descriptor for <code class="literal">sample-module-C</code>:
      </p><pre class="programlisting"><span class="hl-tag">&lt;module-descriptor</span> 
     <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/module-descriptor"</span>
     <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
     <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/module-descriptor
                         http://www.pustefix-framework.org/2008/namespace/module-descriptor.xsd"</span><span class="hl-tag">&gt;</span>

  <span class="hl-tag">&lt;module-name&gt;</span>module-C<span class="hl-tag">&lt;/module-name&gt;</span>

  <span class="hl-tag">&lt;override-modules&gt;</span>
    <span class="hl-tag">&lt;module</span> <span class="hl-attribute">name</span>=<span class="hl-value">"module-B"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;resource</span> <span class="hl-attribute">path</span>=<span class="hl-value">"txt/common.xml"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/module&gt;</span>
  <span class="hl-tag">&lt;/override-modules&gt;</span>

<span class="hl-tag">&lt;/module-descriptor&gt;</span>
</pre><p>
      This will result in the following new fallback chain:
    </p><pre class="screen">projects/myproject/txt/common.xml
projects/common/txt/common.xml
module://module-C/txt/common.xml
module://module-B/txt/common.xml
module://module-A/txt/common.xml</pre><p>
      Now we add another module, called <code class="literal">module-A-ext</code>, which is also overriding <code class="literal">module-A</code>:
    </p><pre class="programlisting"><span class="hl-tag">&lt;module-descriptor</span> 
     <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/module-descriptor"</span>
     <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
     <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/module-descriptor
                         http://www.pustefix-framework.org/2008/namespace/module-descriptor.xsd"</span><span class="hl-tag">&gt;</span>

  <span class="hl-tag">&lt;module-name&gt;</span>module-A-ext<span class="hl-tag">&lt;/module-name&gt;</span>

  <span class="hl-tag">&lt;override-modules&gt;</span>
    <span class="hl-tag">&lt;module</span> <span class="hl-attribute">name</span>=<span class="hl-value">"module-A"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;resource</span> <span class="hl-attribute">path</span>=<span class="hl-value">"txt/common.xml"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/module&gt;</span>
  <span class="hl-tag">&lt;/override-modules&gt;</span>

<span class="hl-tag">&lt;/module-descriptor&gt;</span>
</pre><p>
      The new fallback chain looks as follows:
    </p><pre class="screen">projects/myproject/txt/common.xml
projects/common/txt/common.xml
module://module-C/txt/common.xml
module://module-B/txt/common.xml
module://module-A-ext/txt/common.xml
module://module-A/txt/common.xml</pre><p>
       Module <code class="literal">module-A-ext</code> is inserted right before <code class="literal">module-A</code>. This is done because the override mechanism processes the modules in alphabetic order to ensure predictable behaviour, i.e. it iterates over all modules overriding the current module resource, adding the overriding module on top of the module fallback list, and then recursively processes this module the same way. So changing the module name to <code class="literal">module-D</code> would have been resulted in placing the module right before <code class="literal">module-C</code>.
     </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advanced.rolebasedauth"></a>7.6.&nbsp;Authentication and authorization</h2></div></div></div><p>
      Pustefix provides a role-based authorization mechanism. You can define arbitrary <code class="literal">roles</code>, 
      declare logical operations/combinations on this roles using <code class="literal">authconstraints</code>, 
      and assign these authconstraints to <code class="literal">pagerequests</code>.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="advanced.rolebasedauth.roles"></a>7.6.1.&nbsp;Managing Roles</h3></div></div></div><p>
        A <code class="literal">role</code> is defined using an according XML element with a unique 
        <code class="literal">name</code> attribute value. Setting the <code class="literal">initial</code> 
        attribute to <code class="literal">true</code> the <code class="literal">role</code> will be automatically 
        set on context initialization.
      </p><pre class="programlisting"><span class="hl-tag">&lt;role</span> <span class="hl-attribute">name</span>=<span class="hl-value">"MYROLE"</span> <span class="hl-attribute">initial</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span></pre><p>
        <code class="literal">Authconstraints</code> can combine various authorization conditions, 
        supported conditions are: <code class="literal">hasrole</code>, <code class="literal">and</code>, 
        <code class="literal">or</code> and <code class="literal">not</code>, represented by according XML elements. 
        Using the <code class="literal">authpage</code> attribute you can define the page, which should be 
        called on authorization failure. Using the <code class="literal">default</code> attribute you can 
        set one toplevel <code class="literal">authconstraint</code> to be the default one for 
        all <code class="literal">pagerequests</code> having no <code class="literal">authconstraint</code> asssigned.
      </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/docbkx/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>
          In addition to the <code class="literal">authpage</code>-attribute one can define more fine-grained, 
          conditional navigation-cases via the new <code class="literal">navigateTo</code>-child-element to <code class="literal">authconstraint</code>.
        </p></td></tr></table></div><pre class="programlisting"><span class="hl-tag">&lt;authconstraint</span> <span class="hl-attribute">id</span>=<span class="hl-value">"MYCONSTRAINT"</span> <span class="hl-attribute">authpage</span>=<span class="hl-value">"login"</span> <span class="hl-attribute">default</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;or&gt;</span>
    <span class="hl-tag">&lt;hasrole</span> <span class="hl-attribute">name</span>=<span class="hl-value">"MYROLE"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;hasrole</span> <span class="hl-attribute">name</span>=<span class="hl-value">"OTHERROLE"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/or&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!-- navigate to page guests, if constraints above fail, but user still has the "GUEST"-role --&gt;</em>
  <span class="hl-tag">&lt;navigateTo</span> <span class="hl-attribute">page</span>=<span class="hl-value">"guests"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;hasrole</span> <span class="hl-attribute">name</span>=<span class="hl-value">"GUEST"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/navigateTo&gt;</span>
<span class="hl-tag">&lt;/authconstraint&gt;</span></pre><p>
        <code class="literal">Pagerequests</code> can either define new <code class="literal">authconstraints</code> as 
        child elements or can reference existing toplevel <code class="literal">authconstraints</code> by 
        their <code class="literal">id</code>.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pagerequest</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mypage"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;authconstraint</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"MYCONSTRAINT"</span><span class="hl-tag">/&gt;</span>
  ...
<span class="hl-tag">&lt;/pagerequest&gt;</span>

<span class="hl-tag">&lt;pagerequest</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mypage"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;authconstraint</span> <span class="hl-attribute">authpage</span>=<span class="hl-value">"login"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;hasrole</span> <span class="hl-attribute">name</span>=<span class="hl-value">"MYROLE"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/authconstraint&gt;</span>
  ...
<span class="hl-tag">&lt;/pagerequest&gt;</span></pre><p>
        You can programmatically set/query roles using the <code class="literal">de.schlund.pfixcore.auth.Authentication</code>
        object, which can be retrieved from the <code class="literal">Context</code> calling its <code class="literal">getAuthentication()</code>
        method.
      </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Authentication {
    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> hasRole(String roleName);
    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> addRole(String roleName);
    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> revokeRole(String roleName);
    
    <span class="hl-keyword">public</span> Role[] getRoles();    
}</pre><p>
        You can add a new role using <code class="literal">addRole()</code>, revoke exisiting
        roles using <code class="literal">revokeRole()</code> or check for a role using 
        <code class="literal">hasRole()</code>. Using <code class="literal">getRoles()</code> you get an array 
        of all currently set roles.  If a default role is defined, this role will be initially set.
      </p><p>
        You can also query the current roles from within your XML/XSLT code using the
        XPath extension function <code class="literal">pfx:hasRole(rolename)</code>
      </p><pre class="programlisting"><span class="hl-tag">&lt;ixsl:if</span> <span class="hl-attribute">test</span>=<span class="hl-value">"pfx:hasRole('MYROLE')"</span><span class="hl-tag">&gt;</span>
  ...
<span class="hl-tag">&lt;/ixsl:if&gt;</span></pre><p>
        If you try to access a page for which the authconstraint isn't fulfilled, you're forwarded
        to the according login page. The login page has to be a regular page, e.g. containing a login form.
        Login forms require the <code class="literal">type</code> attribute set to <code class="literal">auth</code>.
      </p><pre class="programlisting"><span class="hl-tag">&lt;pfx:forminput</span> <span class="hl-attribute">type</span>=<span class="hl-value">"auth"</span><span class="hl-tag">&gt;</span>
  ...
<span class="hl-tag">&lt;/pfx:forminput&gt;</span></pre><p>
        The framework automatically inserts an <code class="literal">authentication</code> element into
        the login page's DOM tree. This element contains the state of the <code class="literal">authenticated</code>
        flag, the <code class="literal">targetpage</code> which should be accessed, the current <code class="literal">roles</code>
        and the <code class="literal">authorizationfailure</code> containing the violated
        <code class="literal">authconstraint</code>.
      </p><pre class="programlisting"><span class="hl-tag">&lt;formresult&gt;</span>
  <span class="hl-tag">&lt;authentication</span> <span class="hl-attribute">authenticated</span>=<span class="hl-value">"true"</span> <span class="hl-attribute">targetpage</span>=<span class="hl-value">"mypage"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;roles&gt;</span>
      <span class="hl-tag">&lt;role</span> <span class="hl-attribute">name</span>=<span class="hl-value">"SOMEROLE"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/roles&gt;</span>
    <span class="hl-tag">&lt;authorizationfailure</span> <span class="hl-attribute">authorization</span>=<span class="hl-value">"pageaccess"</span> <span class="hl-attribute">target</span>=<span class="hl-value">"mypage"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;authconstraint&gt;</span>
        <span class="hl-tag">&lt;hasrole</span> <span class="hl-attribute">name</span>=<span class="hl-value">"MYROLE"</span><span class="hl-tag">/&gt;</span>
      <span class="hl-tag">&lt;/authconstraint&gt;</span>
    <span class="hl-tag">&lt;/authorizationfailure&gt;</span>
  <span class="hl-tag">&lt;/authentication&gt;</span>
  ...
<span class="hl-tag">&lt;/formresult&gt;</span></pre><p>
        You can use this information to decide which information to display on the login page.
      </p><div class="example"><a name="rolebasedauth_example"></a><p class="title"><b>Example&nbsp;7.1.&nbsp;Configuring roles</b></p><div class="example-contents"><p>
          The following example defines three <code class="literal">roles</code>. The <code class="literal">role</code> 
          <code class="literal">ANONYMOUS</code> is configured as <code class="literal">initial</code> <code class="literal">role</code>,
          i.e. every session/context has this <code class="literal">role</code> automatically set from the beginning.
        </p><p>
          There are two top-level <code class="literal">authconstraints</code>. The <code class="literal">authconstraint</code> 
          <code class="literal">AC_DEFAULT</code> is declared as <code class="literal">default</code>, i.e. pages, having no explicitly set 
          <code class="literal">authconstraint</code>, will get this one. The <code class="literal">authconstraint's authpage</code> 
          is set to <code class="literal">login</code> and it has a simple condition saying that it requires the <code class="literal">role</code> 
          <code class="literal">ANONYMOUS</code>.
        </p><p>
          The <code class="literal">authconstraint</code> <code class="literal">AC_KNOWN</code> declares that
          it requires the <code class="literal">USER</code> or the <code class="literal">ADMIN</code> <code class="literal">role</code>. This
          <code class="literal">authconstraint</code> is referenced by the <code class="literal">pagerequest</code> <code class="literal">userpage</code>, using
          an empty <code class="literal">authconstraint</code> element having a <code class="literal">ref</code> attribute containing the
          <code class="literal">authconstraint's</code> id.
        </p><p>
          The <code class="literal">pagerequest</code> <code class="literal">adminpage</code> contains an anonymous
          <code class="literal">authconstraint</code> element, which defines the <code class="literal">role</code> 
          <code class="literal">ADMIN</code> as requirement.
        </p><pre class="programlisting"><span class="hl-tag">&lt;contextxmlserver&gt;</span>

  <span class="hl-tag">&lt;role</span> <span class="hl-attribute">name</span>=<span class="hl-value">"ANONYMOUS"</span> <span class="hl-attribute">initial</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;role</span> <span class="hl-attribute">name</span>=<span class="hl-value">"USER"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;role</span> <span class="hl-attribute">name</span>=<span class="hl-value">"ADMIN"</span><span class="hl-tag">/&gt;</span>
  
  <span class="hl-tag">&lt;authconstraint</span> <span class="hl-attribute">id</span>=<span class="hl-value">"AC_DEFAULT"</span> <span class="hl-attribute">authpage</span>=<span class="hl-value">"login"</span> <span class="hl-attribute">default</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;hasrole</span> <span class="hl-attribute">name</span>=<span class="hl-value">"ANONYMOUS"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/authconstraint&gt;</span>
  
  <span class="hl-tag">&lt;authconstraint</span> <span class="hl-attribute">id</span>=<span class="hl-value">"AC_KNOWN"</span> <span class="hl-attribute">authpage</span>=<span class="hl-value">"login"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;or&gt;</span>
      <span class="hl-tag">&lt;hasrole</span> <span class="hl-attribute">name</span>=<span class="hl-value">"USER"</span><span class="hl-tag">/&gt;</span>
      <span class="hl-tag">&lt;hasrole</span> <span class="hl-attribute">name</span>=<span class="hl-value">"ADMIN"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/or&gt;</span>
  <span class="hl-tag">&lt;/authconstraint&gt;</span>
  
  <span class="hl-tag">&lt;pagerequest</span> <span class="hl-attribute">name</span>=<span class="hl-value">"home"</span><span class="hl-tag">&gt;</span>
    ...
  <span class="hl-tag">&lt;/pagerequest&gt;</span>
  
  <span class="hl-tag">&lt;pagerequest</span> <span class="hl-attribute">name</span>=<span class="hl-value">"login"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;input&gt;</span>
      ...
    <span class="hl-tag">&lt;/input&gt;</span>
  <span class="hl-tag">&lt;/pagerequest&gt;</span>

  <span class="hl-tag">&lt;pagerequest</span> <span class="hl-attribute">name</span>=<span class="hl-value">"adminpage"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;authconstraint</span> <span class="hl-attribute">authpage</span>=<span class="hl-value">"login"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;hasrole</span> <span class="hl-attribute">name</span>=<span class="hl-value">"ADMIN"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/authconstraint&gt;</span>
    ...
  <span class="hl-tag">&lt;/pagerequest&gt;</span>
  
  <span class="hl-tag">&lt;pagerequest</span> <span class="hl-attribute">name</span>=<span class="hl-value">"userpage"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;authconstraint</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"AC_KNOWN"</span><span class="hl-tag">/&gt;</span>
    ...
  <span class="hl-tag">&lt;/pagerequest&gt;</span>
  ...
<span class="hl-tag">&lt;/contextxmlserver&gt;</span></pre></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rolebasedauth_customconditions"></a>7.6.2.&nbsp;Custom conditions</h3></div></div></div><p>
        You can extend the authentication mechanism by providing custom conditions (additionally to the predefined conditions: <code class="literal">hasrole</code>, <code class="literal">and</code>, <code class="literal">or</code>, <code class="literal">not</code>). Therefore you just have to implement the <code class="literal">Condition</code> interface and register your implementation class in the context configuration file. Then your custom condition can be used within authconstraints, just as the builtin conditions and arbitrarily mixed with them.
      </p><p>
</p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Condition {
    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> evaluate(Context context);
}
</pre><p>
      </p><p>
        You have to implement the <code class="literal">evaluate</code> method, which returns if the condition is fulfilled. Therefore the evaluation logic can access the Context. Implementations shouldn't change the data model, perform fast and hold only immutable state (or be stateless).
      </p><p>
        The following example shows a condition which retrieves a <code class="literal">ContextResource</code> for a customer and checks if its debit exceeds a configured limit. The limit is automatically set to a value configured as property in the condition's configuration.
      </p><pre class="programlisting"><span class="hl-keyword">package</span> example;

<span class="hl-keyword">import</span> de.schlund.pfixcore.auth.Condition;
<span class="hl-keyword">import</span> de.schlund.pfixcore.workflow.Context;
<span class="hl-keyword">import</span> example.ContextCustomer;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PremiumCustomerCondition <span class="hl-keyword">implements</span> Condition {
    
    <span class="hl-keyword">private</span> <span class="hl-keyword">float</span> limit;

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> evaluate(Context context) {
        ContextCustomer contextCustomer=context.getContextResourceManager().getResource(ContextCustomer.<span class="hl-keyword">class</span>);
        <span class="hl-keyword">return</span> contextCustomer.getTotalDebit() &gt;= limit;
    }
    
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setLimit(<span class="hl-keyword">float</span> limit) {
        <span class="hl-keyword">this</span>.limit = limit;
    }
    
}
</pre><p>
        Let's look how this condition is registered and used in the context configuration:
      </p><pre class="programlisting"><span class="hl-tag">&lt;condition</span> <span class="hl-attribute">id</span>=<span class="hl-value">"isPremiumCustomer"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.PremiumCustomerCondition"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"limit"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100000"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/condition&gt;</span>
  
<span class="hl-tag">&lt;authconstraint</span> <span class="hl-attribute">id</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">authpage</span>=<span class="hl-value">"..."</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;and&gt;</span>
    <span class="hl-tag">&lt;hasrole</span> <span class="hl-attribute">name</span>=<span class="hl-value">"..."</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;condition</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"isPremiumCustomer"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/and&gt;</span>
<span class="hl-tag">&lt;/authconstraint&gt;</span></pre><p>
        Conditions are registered using top-level <code class="literal">condition</code> elements. They require an <code class="literal">id</code> and a <code class="literal">class</code> attribute. Authconstraints can reference conditions using <code class="literal">condition</code> elements with an according <code class="literal">ref</code> attribute.
      </p><p>
        Conditions can be checked from within XML/XSL using the <code class="literal">pfx:condition</code> function, e.g.:
      </p><pre class="programlisting"><span class="hl-tag">&lt;ixsl:if</span> <span class="hl-attribute">test</span>=<span class="hl-value">"pfx:condition('isPremiumCustomer')"</span><span class="hl-tag">&gt;</span>
  ...
<span class="hl-tag">&lt;/ixsl:if&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rolebasedauth_customroleprovider"></a>7.6.3.&nbsp;Custom RoleProvider</h3></div></div></div><p>
        Roles by default are configured within the context configuration.
        As an alternative approach you're able to plug-in your own RoleProvider
        implementation. Thus you can provide roles programmatically or from
        another source.
      </p><p>
      	You just have to implement the RoleProvider interface and register the implementation
      	class in the context configuration.
      </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> RoleProvider {
    <span class="hl-keyword">public</span> Role getRole(String roleName) <span class="hl-keyword">throws</span> RoleNotFoundException;
    <span class="hl-keyword">public</span> List&lt;Role&gt; getRoles();
}</pre><p>
        The <code class="literal">getRole</code> method returns a <code class="literal">Role</code> object by name. 
        The <code class="literal">getRoles</code> method returns a list of all available roles.
      </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Role {
    <span class="hl-keyword">public</span> String getName();
    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> isInitial();
}</pre><p>
        <code class="literal">Role</code> objects can either be created by implementing the 
        <code class="literal">Role</code> interface or by using the default implementation
        <code class="literal">de.schlund.pfixcore.auth.RoleImpl</code>. Role implementations
        have to return a unique name and if they should be initially set.
      </p><p>
        The following example shows a simple <code class="literal">RoleProvider</code> implementation,
        which holds the roles in a programmatically filled map.  
      </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyRoleProvider <span class="hl-keyword">implements</span> RoleProvider {
    <span class="hl-keyword">private</span> Map&lt;String, Role&gt; roles;

    <span class="hl-keyword">public</span> MyRoleProvider() {
        roles = <span class="hl-keyword">new</span> HashMap&lt;String, Role&gt;();
        Role role = <span class="hl-keyword">new</span> RoleImpl(<span class="hl-string">"ADMIN"</span>, false);
        roles.put(role.getName(), role);
    	...
    }

    <span class="hl-keyword">public</span> Role getRole(String roleName) <span class="hl-keyword">throws</span> RoleNotFoundException {
        Role role = roles.get(roleName);
        <span class="hl-keyword">if</span>(role == null) <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> RoleNotFoundException(roleName);
        <span class="hl-keyword">return</span> role;
    }

    <span class="hl-keyword">public</span> List&lt;Role&gt; getRoles() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ArrayList&lt;Role&gt;(roles.values());
    }
}</pre><p>
        The <code class="literal">RoleProvider</code> implementation is registered using the
       	context configuration top-level <code class="literal">roleprovider</code> element with
       	a <code class="literal">class</code> attribute. You can optionally configure properties,
       	which will be automatically injected into the RoleProvider instance using
       	according setter methods (Spring bean-style setter injection).
      </p><pre class="programlisting"><span class="hl-tag">&lt;roleprovider</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.MyRoleProvider"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">value</span>=<span class="hl-value">"..."</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/roleprovider&gt;</span></pre><p>
      You should be aware that the current mechanism doesn't support
      dynamic RoleProviders. The provided roles have to be constant, i.e. they're read
      at application startup time and aren't updated at a later time.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advanced.ajax"></a>7.7.&nbsp;AJAX services</h2></div></div></div><p>
	  Pustefix provides AJAX-support via SOAP webservices and JSON RPC-style services. Autogenerated
      stubs and dynamic proxies make it easy to implement new services without any knowledge of the protocol
      details, among other things the protocol can be switched without changing the Javascript or Java code,
      additionally a service can work with both protocols at the same time.
    </p><p>
      Implementing a service can be done in two ways: Either you can export an arbitrary Spring bean as a
      webservice or you have to create a special service class which derives from an abstract framework class.
      The first way is recommended, because your service can be a POJO without any framework dependencies.
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
      A <span class="emphasis"><em>managed service</em></span> can be an arbitrary POJO that's managed by the Spring container. 
      Such a Spring bean can be exported as webservice within the Spring configuration file using a special namespace
      (see Configuration section below). 
    </li><li class="listitem">
      An <span class="emphasis"><em>unmanaged service</em></span> consists of a Java interface, which defines all remotely available service methods, and the
      service implementation, implementing this interface and extending the abstract service base class
      <code class="literal">org.pustefixframework.webservices.AbstractService</code>. Thus the implementation class
      inherits the method <code class="literal">getContextResourceManager()</code>, which can be used to access
      <code class="literal">ContextResources</code>. The service has to be declared explicitly in the project's
      central webservice configuration file <code class="filename">projectdir/conf/webservice.conf.xml</code> (see Configuration section below).
    </li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/docbkx/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
        If you want to use SOAP as service protocol, you have to note that the SOAP runtime used by Pustefix (Sun's JAXWS implementation)
        requires that service classes are annotated with the <code class="literal">javax.jws.WebService</code> annotation. 
      </p></td></tr></table></div><p>
      The Pustefix build process automatically generates Javascript SOAP stubs for all declared services (if the
      SOAP protocol is enabled). It also generates the deployment descriptors needed by Axis, the SOAP/webservices
      library used in Pustefix. Optionally it can create WSDL descriptions for all webservices. The JSON protocol support
      needs no build time processing, cause the stubs can either be dynamic proxies or generated at runtime by the server.
    </p><p>
      Using the services on the client-side is quite easy too. You just have to include the necessary Javascript libraries
      provided by Pustefix and instantiate a service proxy object via Javascript. The service proxy object delegates your
      local method calls to the server, which invokes the according methods on your service implementation and returns the result.
      The remote invocation works completely transparent for the client, just as a local method call.
    </p><p>
      The SOAP proxy is an autogenerated Javascript stub, which uses Pustefix's home-brewed Javascript SOAP implementation
      (as long as the native browser support for SOAP isn't sufficient). JSON provides two different proxy models: a dynamic
      proxy which is set up dynamically at runtime (during its instantiation the service's method list is requested from the
      server and according Javascript methods are created) and a stub which is generated at runtime by the server.
    </p><p>
      The client-server communication is done using the XmlHttpRequest object (supported by most modern browsers). Thus
      service requests can be done either synchronous or asynchronous (passing a callback function as parameter instead of
      getting the result directly from the service method). There's also a fallback mechanism (via hidden iframes) for
      older browsers that do not know a XmlHttpRequest object.
	</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="advanced.ajax.config"></a>7.7.1.&nbsp;Service configuration</h3></div></div></div><p>
        Spring-managed services are configured as part of the Spring configuration. You can export an arbitrary bean as webservice
        using the <code class="literal">webservice</code> element (from the <code class="literal">http://pustefixframework.org/schema/webservices</code> 
        namespace). Therefor you have to reference it using the <code class="literal">ref</code> attribute and set a unique 
	<code class="literal">servicename</code>.
      </p><pre class="programlisting">
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:ws</span>=<span class="hl-value">"http://pustefixframework.org/schema/webservices"</span>
       <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
            http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd
            http://pustefixframework.org/schema/webservices
            http://pustefixframework.org/schema/webservices/pustefix-webservices.xsd"</span><span class="hl-tag">&gt;</span>

  <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"MyBeanId"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"mypackage.MyBean"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"session"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;aop:scoped-proxy/&gt;</span>
  <span class="hl-tag">&lt;/bean&gt;</span>
  
  <span class="hl-tag">&lt;ws:webservice</span>
    <span class="hl-attribute">id</span>=<span class="hl-value">"Webservice_MyBean"</span> 
    <span class="hl-attribute">servicename</span>=<span class="hl-value">"MyBean"</span> 
    <span class="hl-attribute">interface</span>=<span class="hl-value">"MyBeanServiceInterface"</span>
    <span class="hl-attribute">ref</span>=<span class="hl-value">"MyBeanId"</span><span class="hl-tag"> 
  /&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!-- configuration with optional settings --&gt;</em> 
  <span class="hl-tag">&lt;ws:webservice</span>
    <span class="hl-attribute">id</span>=<span class="hl-value">"Another_Webservice"</span>
    <span class="hl-attribute">servicename</span>=<span class="hl-value">"MyService"</span>
    <span class="hl-attribute">interface</span>=<span class="hl-value">"MySeviceInterface"</span>
    <span class="hl-attribute">ref</span>=<span class="hl-value">"AnotherBean"</span>
    <span class="hl-attribute">protocol</span>=<span class="hl-value">"ANY"</span>
    <span class="hl-attribute">authconstraint</span>=<span class="hl-value">"MyConstraint"</span>
    <span class="hl-attribute">synchronize</span>=<span class="hl-value">"false"</span>
    <span class="hl-attribute">whitelist</span>=<span class="hl-value">"mypackage.MyClass otherpackage.*"</span><span class="hl-tag">
  /&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span>
      </pre><p>
        You can optionally set an <code class="literal">interface</code> which defines the methods which should be exported (by default all
        public methods are exported, if you're using SOAP/JAXWS you can also exclude methods using the <code class="literal">@WebMethod(exclude=true)</code>
        annotation). Using the <code class="literal">protocol</code> attribute you can set the webservice protocol (default is <code class="literal">JSONWS</code>,
        other options are <code class="literal">SOAP</code> or <code class="literal">ANY</code>).
      </p><p>
        If you're using class hinting, all permitted classes have to be listed as value of the <code class="literal">whitelist</code> attribute. You can either directly
        list the full class names (space or comma separated), or you can use regular expressions.
     </p><p>
        The webservice configuration file <code class="filename">PROJECTNAME/conf/webservices.conf.xml</code> contains global settings
	for the runtime system, default settings for webservices, and optionally webservice-specific settings.
        If you're using Spring-managed services only, you can ignore the webservice-specific settings in this file as they're
        done as part of the Spring configuration. The global and default settings are applied to the managed services too.
      </p><pre class="programlisting"><span class="hl-tag">&lt;webservice-config</span>
  <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/webservice-config"</span>
  <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/webservice-config
                      http://www.pustefix-framework.org/2008/namespace/webservice-config.xsd"</span><span class="hl-tag">&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!--
    The webservice-global section contains general configuration options, which are applied to
    all webservices. Some of the options can be overridden individually for single webservices.
  --&gt;</em>
  <span class="hl-tag">&lt;webservice-global&gt;</span>

    <em class="hl-comment" style="color: silver">&lt;!--
      Set if WSDL should be generated for SOAP-enabled webservices and where to store it (absolute path within
      the project's webapp directory)
      
      [Optional - Default: enabled="true" repository="/wsdl"]
    --&gt;</em>
    <span class="hl-tag">&lt;wsdlsupport</span> <span class="hl-attribute">enabled</span>=<span class="hl-value">"true"</span> <span class="hl-attribute">repository</span>=<span class="hl-value">"/wsdl"</span><span class="hl-tag">/&gt;</span>

    <em class="hl-comment" style="color: silver">&lt;!--
      Set if Javascript stubs should be generated and where to store it (absolute path within the
      project's webapp directory - only for SOAP). The jsnamespace attribute controls what namespace
      prefix the generated Javascript should use (COMPAT: WS_, COMPAT_UNIQUE: WS_ for SOAP JWS_ for JSON,
      JAVA_NAME: full Java class name, other values are used as namespace themselves, dot-separated
      namespaces are supported too, code to setup the according JS context objects gets auto-generated)
      
      [Optional - Default: enabled="true" repository="/wsscript" jsnamespace="COMPAT"]
    --&gt;</em>
    <span class="hl-tag">&lt;stubgeneration</span> <span class="hl-attribute">enabled</span>=<span class="hl-value">"true"</span> <span class="hl-attribute">repository</span>=<span class="hl-value">"/wsscript"</span> <span class="hl-attribute">jsnamespace</span>=<span class="hl-value">"COMPAT"</span><span class="hl-tag">/&gt;</span>

    <em class="hl-comment" style="color: silver">&lt;!--
      Set which service protocol should be used. You can set a certain protocol (SOAP|JSONWS) or allow all
      protocols (ANY). If you choose to use JSONWS only, you should set the type to JSONWS to accelerate
      the build process, otherwise the SOAP stubs will be generated unnecessarily.
      
      [Optional - Default: type="JSONWS"]
    --&gt;</em>
    <span class="hl-tag">&lt;protocol</span> <span class="hl-attribute">type</span>=<span class="hl-value">"ANY"</span><span class="hl-tag">/&gt;</span>

    <em class="hl-comment" style="color: silver">&lt;!--
      Set which SOAP encoding style should be used. The best supported style is rpc/encoded.
      The server-side also supports other styles like rpc/literal and document/literal, but the client-side
      support for these styles is rudimentary.
      
      [Optional - Default: style="rpc" use="encoded"]
    --&gt;</em>
    <span class="hl-tag">&lt;encoding</span> <span class="hl-attribute">style</span>=<span class="hl-value">"rpc"</span> <span class="hl-attribute">use</span>=<span class="hl-value">"encoded"</span><span class="hl-tag">/&gt;</span>

    <em class="hl-comment" style="color: silver">&lt;!--
      Set if the JSON representation of serialized Java beans should be augmented with
      type meta information (classhinting).
      
      [Optional - Default: classhinting="false"]
    --&gt;</em>
    <span class="hl-tag">&lt;json</span> <span class="hl-attribute">classhinting</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>

    <em class="hl-comment" style="color: silver">&lt;!--
      Set if webservice requests need to have a valid HTTP/Pustefix-Session (servlet) or they should
      work without one too (none).
      
      [Optional - Default: type="servlet"]
    --&gt;</em>
    <span class="hl-tag">&lt;session</span> <span class="hl-attribute">type</span>=<span class="hl-value">"servlet"</span><span class="hl-tag">/&gt;</span>

    <em class="hl-comment" style="color: silver">&lt;!--
      Set the service object's scope. Scope application means that the service object is created only
      once and shared between all sessions, session, that it's created once per session, request, that
      it's created newly for each request.
      
      [Optional - Default: type="application"]
    --&gt;</em>
    <span class="hl-tag">&lt;scope</span> <span class="hl-attribute">type</span>=<span class="hl-value">"application"</span><span class="hl-tag">/&gt;</span>

    <em class="hl-comment" style="color: silver">&lt;!--
      Set if only https requests should be allowed.
      
      [Optional - Default: force="false"]
    --&gt;</em>
    <span class="hl-tag">&lt;ssl</span> <span class="hl-attribute">force</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>

    <em class="hl-comment" style="color: silver">&lt;!--
      Configure if service requests should be synchronized on the Pustefix Context (default is true).
      [Optional - Default: synchronize="true"]
    --&gt;</em>
    <span class="hl-tag">&lt;context</span> <span class="hl-attribute">synchronize</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>


    <em class="hl-comment" style="color: silver">&lt;!--
      There are some options which should be configured differently in development and production mode.
      Therefor you can use the following choose/when elements (which are optional, you can just leave them out).
    --&gt;</em>
    <span class="hl-tag">&lt;choose&gt;</span>
      <span class="hl-tag">&lt;when</span> <span class="hl-attribute">test</span>=<span class="hl-value">"$mode = 'prod'"</span><span class="hl-tag">&gt;</span>
        <em class="hl-comment" style="color: silver">&lt;!--
          Set if admin tool should be available (see Development Tools).
          
          [Optional - Default: enabled="false"]
        --&gt;</em>
        <span class="hl-tag">&lt;admin</span> <span class="hl-attribute">enabled</span>=<span class="hl-value">"false"</span><span class="hl-tag">/&gt;</span>

        <em class="hl-comment" style="color: silver">&lt;!--
          Set if monitor tool should be available (see Development Tools).
          
          [Optional - Default: enabled="false"]
        --&gt;</em>
        <span class="hl-tag">&lt;monitoring</span> <span class="hl-attribute">enabled</span>=<span class="hl-value">"false"</span><span class="hl-tag">/&gt;</span>

        <em class="hl-comment" style="color: silver">&lt;!--
          Set if extensive logging should be enabled (i.e. logging of all request/response messages in
          pustefix-webservice.log).
          
          [Optional - Default: enabled="false"]
        --&gt;</em>
        <span class="hl-tag">&lt;logging</span> <span class="hl-attribute">enabled</span>=<span class="hl-value">"false"</span><span class="hl-tag">/&gt;</span>

        <em class="hl-comment" style="color: silver">&lt;!--
          Set a FaultHandler, which will process exceptions before they are sent to the client
          (see Exception Handling).
          
          [Optional - Default: none]
        --&gt;</em>
        <span class="hl-tag">&lt;faulthandler</span> <span class="hl-attribute">class</span>=<span class="hl-value">"de.schlund.pfixcore.webservice.fault.EmailNotifyingHandler"</span><span class="hl-tag">&gt;</span>
          <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"recipients"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"errors@domain.de"</span><span class="hl-tag">/&gt;</span>
          <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sender"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"pfxerror@domain.de"</span><span class="hl-tag">/&gt;</span>
          <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"smtphost"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"localhost"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/faulthandler&gt;</span>
      <span class="hl-tag">&lt;/when&gt;</span>
      <span class="hl-tag">&lt;otherwise&gt;</span>
        <span class="hl-tag">&lt;admin</span> <span class="hl-attribute">enabled</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;monitoring</span> <span class="hl-attribute">enabled</span>=<span class="hl-value">"true"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"session"</span> <span class="hl-attribute">historysize</span>=<span class="hl-value">"10"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;logging</span> <span class="hl-attribute">enabled</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;faulthandler</span> <span class="hl-attribute">class</span>=<span class="hl-value">"de.schlund.pfixcore.webservice.fault.LoggingHandler"</span><span class="hl-tag">/&gt;</span>
      <span class="hl-tag">&lt;/otherwise&gt;</span>
    <span class="hl-tag">&lt;/choose&gt;</span>
  <span class="hl-tag">&lt;/webservice-global&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!--
    Each service has to define name, interface and implementation. All other options are
    optional and inherited from the global section respectively. Some global options
    can be overridden here (stubgeneration, protocol, encoding, json, session, scope,
    ssl, context, faulthandler).
  --&gt;</em>

  <span class="hl-tag">&lt;webservice</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Counter"</span><span class="hl-tag">&gt;</span>
  
    <em class="hl-comment" style="color: silver">&lt;!--
      Set the service interface. [Mandatory]
    --&gt;</em>
    <span class="hl-tag">&lt;interface</span> <span class="hl-attribute">name</span>=<span class="hl-value">"de.schlund.pfixcore.example.webservices.Counter"</span><span class="hl-tag">/&gt;</span>

    <em class="hl-comment" style="color: silver">&lt;!--
      Set the service implementation class. [Mandatory]
    --&gt;</em>
    <span class="hl-tag">&lt;implementation</span> <span class="hl-attribute">name</span>=<span class="hl-value">"de.schlund.pfixcore.example.webservices.CounterImpl"</span><span class="hl-tag">/&gt;</span>

    <em class="hl-comment" style="color: silver">&lt;!--
      List which classes are permitted to be deserialized using class hinting
    --&gt;</em>
    <span class="hl-tag">&lt;whitelist&gt;</span>mypackage.MyClass otherpackage.*<span class="hl-tag">&lt;/whitelist&gt;</span>
  <span class="hl-tag">&lt;/webservice&gt;</span>
  <span class="hl-tag">&lt;webservice</span> <span class="hl-attribute">name</span>=<span class="hl-value">"..."</span><span class="hl-tag">&gt;</span>...<span class="hl-tag">&lt;/webservice&gt;</span>...
<span class="hl-tag">&lt;/webservice-config&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="advanced.ajax.exception"></a>7.7.2.&nbsp;Exception handling</h3></div></div></div><p>
        Pustefix provides a special exception handling mechanism for AJAX services. You can register predefined or
        custom FaultHandlers, which are automatically called before an exception is sent to the client. Thus you
        can filter exceptions, change them or do some logging or notification stuff.
      </p><p>
        There are three predefined FaultHandlers:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
            <code class="literal">de.schlund.pfixcore.webservice.fault.LoggingHandler</code>: as its name denotes, it just logs all Exceptions
            via log4j (location can be configured within the general log4j configuration)
          </li><li class="listitem">
            <code class="literal">de.schlund.pfixcore.webservice.fault.EmailNotifyingHandler</code>: this handler sends Email notifications (recipients, sender and smtphost can be configured as parameters, see the Configuration section)
          </li><li class="listitem">
            <code class="literal">de.schlund.pfixcore.webservice.fault.ExceptionProcessorAdapter</code>: this handler implements a direct connection to the general Pustefix exception processing mechanism via ExceptionProcessors (and only makes sense if the configured ExceptionProcessor only consumes exceptions, but doesn't produce any output, like a HTML error page)
          </li></ul></div><p>
        You are free to implement your own FaultHandler and register it with your services in the webservice configuration file.
        You just have to extend the abstract base class <code class="literal">de.schlund.pfixcore.webservice.fault.FaultHandler</code> and
        implement the abstract methods <code class="literal">init()</code> and <code class="literal">handleFault(Fault)</code>. The Fault object
        methods <code class="literal">getThrowable()</code> and <code class="literal">setThrowable</code> can be used to get the thrown exception and
        to change or replace it.
      </p><p>
        You also can derive from one of the predefined handlers. E.g. you can extend the EmailNotifyingHandler by overriding the
        two methods public boolean isInternalServerError(Fault fault) and public boolean isNotificationError(Fault fault) to
        customize if error details should be hidden from the client and if a notification mail should be sent for certain exceptions.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="advanced.ajax.tools"></a>7.7.3.&nbsp;Development tools</h3></div></div></div><p>
        Pustefix provides some tools, which can help you during the development process. It provides an admin and monitoring
        webinterface. The admin tool lists all registered services with their service methods. The monitoring tool shows a history
        of the last requests including the request and response messages.
      </p><p>
        You can access these tools by including the special tag <code class="literal">&lt;pfx:webserviceconsole/&gt;</code> (see <a class="xref" href="#xslt.consoles" title="5.6.4.&nbsp;Using the Pustefix console">Section&nbsp;5.6.4, &#8220;Using the Pustefix console&#8221;</a>)
        into your Pustefix page and enabling them in the global webservice configuration (as shown in the Configuration section:
        the admin and monitoring elements within the choose/when elements).
      </p><p>
        By the way, if any unexplainable problems occur, you're recommended to take a look into the logfile pustefix-webservice.log,
        where (if log4j log level is set to DEBUG) among other things the request and response messages are logged too.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="advanced.ajax.callback"></a>7.7.4.&nbsp;Callback mechanisms</h3></div></div></div><p>
        Doing asynchronous webservice calls, you can choose between two different webservice callback mechanisms.
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="advanced.ajax.callback.function"></a>Callback functions</h4></div></div></div><p>
          You can pass a function reference as last argument of the service method call (or last but one, if you want
          to set a request ID too). After receiving the server's response your function will be automatically called,
          passing the result (if no exception occurred), the request ID (if set) and an Error object (if exception occurred).
        </p><pre class="programlisting">var service=new WS_Service();
var callback=function(result,requestid,exception) {
   if(exception) {
      ...
   } else {
      ...
   }
}
var requestid="...";
service.serviceMethod(arg0, arg1, ... , callback); //asynchronous with callback
service.serviceMethod(arg0, arg1, ... , callback, requestid); //asynchronous with callback and requestid</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="advanced.ajax.callback.object"></a>Callback objects</h4></div></div></div><p>
          You can instantiate the webservice stub with an object reference as argument of the constructor function.
          Your object has to provide methods of the same name as the service methods which are automatically called
          back by the stub (you don't have to pass a callback object or function to the serviceMethod).
        </p><pre class="programlisting">var object={
   serviceMethod: function(result,requestid,exception) {
      if(exception) {
         ...
      } else {
         ...
      }
   }
};
var service=new WS_Service(object); //instantiate service with callback object 
//optionally you can pass the scope object within 
var requestid="...";
service.serviceMethod(arg0, arg1, ...); //asynchronous
service.serviceMethod(arg0, arg1, ... , requestid); //asynchronous with requestid
</pre><p>
         If you're using JSON stubs, you can optionally pass a scope object as second constructor argument.
         Thus this scope is used as the "this" context argument instead of the object 
	 itself when the object's callback method is called. <span class="emphasis"><em>[Since: 0.13.1]</em></span>
      </p><pre class="programlisting">
        var service = new WS_Service(object, scope);
</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="advanced.ajax.typemapping"></a>7.7.5.&nbsp;Type mapping</h3></div></div></div><p>
        Supported Java types are:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Primitive Java types (boolean, byte, short, int, long, float, double)</li><li class="listitem">Object wrappers for primitive types (Boolean, Byte, Short, Integer, Long, Float, Double from java.lang)</li><li class="listitem">String type (java.lang.String)</li><li class="listitem">Date types (java.util.Calendar, java.util.Date)</li><li class="listitem">Java beans (nested arbitrarily)</li><li class="listitem">Arrays of all other supported types (except for java.util.Date with SOAP), including multidimensional arrays</li></ul></div><p>
        Primitive, wrapper, String and Date types are mapped to their according Javascript counterpart
        (Number, Boolean, String, Date). Java beans are mapped to general Javascript objects with the according properties
        (there's no representation/simulation of the Java bean's type hierarchy, using JSON you optionally can enable
        classhinting, which provides every object instance with a special property - javaClass - containing the full Java class name).
      </p><p>
        The Java bean mapping mechanism supports both, so-called simple properties (having according getter and setter methods as
        defined in the Java Bean Specification) and public members (without access methods).
      </p><p>
        Additional Java types supported by JSON services:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Primitive and object wrapper type for characters (char and java.lang.Character)</li><li class="listitem">Arbitrary Lists (Java -&gt; JSON), parameterized Lists with type parameter of instantiable type (JSON -&gt; Java)</li><li class="listitem">Arbitrary Maps with keys of type java.lang.String (Java -&gt; JSON), parameterized Maps with key type parameter of type java.lang.String and value type parameter of instantiable type (JSON -&gt; Java)</li></ul></div><p>
        Because of the restrictions of the JSON format, especially the absence of type information and the usage of
        builtin Javascript types (arrays for Lists, objects for Maps), the support for Lists and Maps itself is restricted:
        deserializing Lists to Java requires a parameterized type parameter and this type has to be instantiable
        (or be a parameterized List or Map itself), the same with Map values, Map keys have to be java.lang.String instances.
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e8343"></a>Custom bean mapping via Java annotations</h4></div></div></div><p>
          The JSON bean (de-)serialization mechanism supports customizable bean property mappings via Java annotations.
          You can exclude individual properties from (de-)serialization by marking the according getter with an <code class="literal">@Exclude</code>
          annotation or you can exclude all properties by marking the bean class with an <code class="literal">@ExcludeByDefault</code>
          annotation and include individual properties with @Include annotations at their getters (marking public members is
          supported too).
        </p><p>
          The following examples show the different annotations in action. Both class definitions give access to the foo and
          baz property and restrict access to the bar property. The first class definition includes all properties by default
          (which is the default behaviour without a type annotation) and excludes the bar property, while the second excludes
          all properties by default and includes the foo and baz properties:
        </p><pre class="programlisting">public class A {

    int foo;
    int bar;
    int baz;

    public int getFoo() {return foo;}
    public void setFoo(int foo) {this.foo=foo;}

    @Exclude
    public int getBar() {return bar;}
    public void setBar(int bar) {this.bar=bar;}

    public int getBaz() {return baz;}
    public void setBaz(int baz) {this.baz=baz;}

}</pre><pre class="programlisting">@ExcludeByDefault
public class A {

    int foo;
    int bar;
    int baz;

    @Include
    public int getFoo() {return foo;}
    public void setFoo(int foo) {this.foo=foo;}

    public int getBar() {return bar;}
    public void setBar(int bar) {this.bar=bar;}

    @Include
    public int getBaz() {return baz;}
    public void setBaz(int baz) {this.baz=baz;}                                                                                                           }

}</pre><p>
          All annotations only take effect in the declaring class and aren't inherited. Thus, if you derive your bean
          class, the type annotation of your base class has no effect, so declaring new properties in your class will
          include them by default. Properties included or excluded in your base class will be included/excluded in your
          inherited class too, if you don't redeclare or override this properties. The following example demonstrates this behaviour:
        </p><pre class="programlisting">public class A {

    int foo;
    int bar;
    int baz;

    public int getFoo() {return foo;}
    public void setFoo(int foo) {this.foo=foo;}

    @Exclude
    public int getBar() {return bar;}
    public void setBar(int bar) {this.bar=bar;}

    public int getBaz() {return baz;}
    public void setBaz(int baz) {this.baz=baz;}
}

@ExcludeByDefault
public class B extends A {

    int hey;
    int ho;

    @Include
    public int getHey() {return hey;}
    public void setHey(int hey) {this.hey=hey;}

    public int getHo() {return ho;}
    public void setHo(int ho) {this.ho=ho;}

    @Override
    public int getBaz() {return super.getBaz();}

}</pre><p>
          Using the @Alias annotation you can control the name used for (de-)serialization (i.e. the name used as
          JSON property name). The following example shows how to add aliases to a public member and a property getter.
        </p><pre class="programlisting">public class A {

    @Alias("mybaz")
    public int baz;
    int foo;

    @Alias("myfoo")
    public int getFoo() {return foo;}
    public void setFoo(int foo) {this.foo=foo;}

}</pre><p>
          If you don't like Java annotations or you want to overwrite existing annotations, you can also customize
          your beans using a XML configuration file. The file has to be named beanmetadata.xml and has to be placed
          in the project configuration directory or in a META-INF directory that's part of the classpath.
        </p><pre class="programlisting"><span class="hl-tag">&lt;bean-metadata</span> <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://pustefix.sourceforge.net/bean-metadata 
                                   http://pustefix.sourceforge.net/beanmetadata.xsd"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"de.schlund.pfixcore.webservice.beans.A"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"foo"</span> <span class="hl-attribute">alias</span>=<span class="hl-value">"myfoo"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"bar"</span> <span class="hl-attribute">exclude</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/bean&gt;</span>
  <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"de.schlund.pfixcore.webservice.beans.B"</span> <span class="hl-attribute">exclude-by-default</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hey"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/bean-metadata&gt;</span></pre><p>
         The format is very simple: Create a bean element referencing the class you want to annotate. Add property
         elements referencing the properties you want to annotate. All Java annotations have an according XML attribute
         counterpart you can add to these elements.      
       </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advanced.object2xml"></a>7.8.&nbsp;Object-to-XML mapping</h2></div></div></div><p>
	  Pustefix provides a lightweight object serialization mechanism, which can be used to 
	  serialize arbitrary objects into the result DOM without having to do any DOM operations by 
	  yourself. The XML binding is customizable via Java annotations within the bean classes.
	</p><p>
	  The framework supports arbitrary <code class="literal">Beans</code>, <code class="literal">Arrays</code>, 
	  <code class="literal">Collections</code>, <code class="literal">Maps</code>, <code class="literal">Numbers</code> (including
	  the primitive types and their object wrapper types), <code class="literal">Strings</code>, 
	  and <code class="literal">Date/Calendar</code>. To support other types or to serialize
	  to a custom format, it's possible to write your own serializers and annotations (to attach
	  them to the according bean properties). 
	</p><p>
	  The serialization of beans can be customized using the generic Pustefix bean annotations,
	  which are known from the JSON serialization framework. You can exclude individual properties 
	  from serialization by marking the according getter with an <code class="literal">@Exclude</code> 
	  annotation or you can exclude all properties by marking the bean class with an 
	  <code class="literal">@ExcludeByDefault</code> annotation and include individual properties with
	  <code class="literal">@Include</code> annotations at their getters (marking public members is supported 
	  too). Using the <code class="literal">@Alias</code> annotation you can control 
	  the name used as the resulting attribute or element name.
	</p><p>
	  The serialization to the result tree is done by calling one of the static <code class="literal">addObject</code>
	  methods of the <code class="literal">ResultDocument</code> class. The <code class="literal">element</code> 
	  argument is the parent DOM element at which the serialized XML will be appended, the optional <code class="literal">name</code>
	  argument can be used to create an additional child element for the serialized XML. The
	  <code class="literal">object</code> argument is the object, which should be serialized.
	</p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ResultDocument {
    ...
    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> Element addObject(Element element, Object object) {...}
    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> Element addObject(Element element, String name, Object object) {...}
}</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="advanced.object2xml.serializationprocess"></a>7.8.1.&nbsp;Serialization process</h3></div></div></div><p>
	    The default serialization process tries to produce relatively compact XML. Thus it favours
	    attributes over elements and serializes so-called simple types, which can be represented
	    as strings, into attributes where it's possible and makes sense, e.g. for bean properties.
	  </p><p>
	    Let's look at an example, which shows the serialization of a simple bean using 
	    bean and serializer annotations to customize the serialization behaviour:
	  </p><pre class="programlisting">...
	  
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Account {
  
    <span class="hl-keyword">private</span> <span class="hl-keyword">long</span> accountNo;
    <span class="hl-keyword">private</span> <span class="hl-keyword">float</span> debit;
    ...
  
    <span class="hl-keyword">public</span> <span class="hl-keyword">long</span> getAccountNo() {
        <span class="hl-keyword">return</span> accountNo;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setAccountNo(<span class="hl-keyword">long</span> accountNo) {
        <span class="hl-keyword">this</span>.accountNo = accountNo;
    }
  
    <em><span class="hl-annotation" style="color: gray">@Alias("balance")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">float</span> getDebit() {
        <span class="hl-keyword">return</span> debit;
    }
  
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDebit(<span class="hl-keyword">float</span> debit) {
        <span class="hl-keyword">this</span>.debit = debit;
    }
  
    <span class="hl-keyword">public</span> Currency getCurrency() {
        <span class="hl-keyword">return</span> currency;
    }
  
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setCurrency(Currency currency) {
        <span class="hl-keyword">this</span>.currency = currency;
    }
  
    <em><span class="hl-annotation" style="color: gray">@DateSerializer("yyyy-MM-dd HH:mm:ss")</span></em>
    <span class="hl-keyword">public</span> Calendar getOpeningDate() {
        <span class="hl-keyword">return</span> openingDate;
    }
  
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setOpeningDate(Calendar openingDate) {
        <span class="hl-keyword">this</span>.openingDate = openingDate;
    }
  
    <em><span class="hl-annotation" style="color: gray">@Exclude</span></em>
    <span class="hl-keyword">public</span> String getComment() {
        <span class="hl-keyword">return</span> comment;
    }
  
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setComment(String comment) {
        <span class="hl-keyword">this</span>.comment = comment;
    }
}</pre><p>
  	    Here you see how the bean's serialized to the <code class="literal">ResultDocument</code> within 
  	    a <code class="literal">ContextResource</code>:
  	  </p><pre class="programlisting">...
        
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ContextAccountImpl <span class="hl-keyword">implements</span> ContextAccount {

    <span class="hl-keyword">private</span> Account account;
    ...

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> insertStatus(ResultDocument resdoc, Element elem) <span class="hl-keyword">throws</span> Exception {
        ResultDocument.addObject(elem,<span class="hl-string">"account"</span>,account);
    }    
}</pre><p>
        The resulting DOM fragment looks like this:
      </p><pre class="programlisting"><span class="hl-tag">&lt;formresult</span> <span class="hl-attribute">serial</span>=<span class="hl-value">"1199439160721"</span><span class="hl-tag">&gt;</span>
  ...
  <span class="hl-tag">&lt;data&gt;</span>
    <span class="hl-tag">&lt;account</span> <span class="hl-attribute">accountNo</span>=<span class="hl-value">"2000123"</span> <span class="hl-attribute">currency</span>=<span class="hl-value">"EUR"</span> <span class="hl-attribute">balance</span>=<span class="hl-value">"332.54"</span> <span class="hl-attribute">openingDate</span>=<span class="hl-value">"2003-11-04 09:15:38"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/data&gt;</span>
  ...
<span class="hl-tag">&lt;/formresult&gt;</span></pre><p>
        The <code class="literal">data</code> element is the ContextResource's root node as configured
        in the configuration file. Calling <code class="literal">addObject</code> with the additional
        <code class="literal">account</code> argument, the serialized bean isn't added directly to the
        data element, but an additional element is used. The bean's properties are serialized
        as attributes of this element.
      </p><p>
        The <code class="literal">debit</code> property is renamed to <code class="literal">balance</code> using
        the <code class="literal">@Alias</code> annotation. The <code class="literal">comment</code> property is
        excluded using the <code class="literal">@Exclude</code> annotation. The <code class="literal">openingDate</code>
        property is serialized using the built-in <code class="literal">DateSerializer</code>, which can
        be customized using the <code class="literal">@DateSerializer</code> annotation. Thus you can
        provide your own date format pattern (must be a pattern supported by
        <code class="literal">java.text.SimpleDateFormat</code>).
      </p><p>
        Only simple type properties, i.e. properties which can be serialized to string values, can
        be represented as attributes. If the <code class="literal">Account</code> bean would have an additional
        property <code class="literal">customer</code> of a bean type, e.g. a <code class="literal">Customer</code> class, 
        this property would be serialized as a child element:  
      </p><pre class="programlisting"><span class="hl-tag">&lt;formresult</span> <span class="hl-attribute">serial</span>=<span class="hl-value">"1199439160721"</span><span class="hl-tag">&gt;</span>
  ...
  <span class="hl-tag">&lt;data&gt;</span>
    <span class="hl-tag">&lt;account</span> <span class="hl-attribute">accountNo</span>=<span class="hl-value">"2000123"</span> <span class="hl-attribute">balance</span>=<span class="hl-value">"EUR"</span> <span class="hl-attribute">debit</span>=<span class="hl-value">"332.54"</span> <span class="hl-attribute">openingDate</span>=<span class="hl-value">"2003-11-04 09:15:38"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;customer</span> <span class="hl-attribute">customerId</span>=<span class="hl-value">"100000"</span> <span class="hl-attribute">firstName</span>=<span class="hl-value">"Mike"</span> <span class="hl-attribute">lastName</span>=<span class="hl-value">"Foo"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/account&gt;</span>
  <span class="hl-tag">&lt;/data&gt;</span>
  ...
<span class="hl-tag">&lt;/formresult&gt;</span></pre><p>
        <code class="literal">Collections</code> and <code class="literal">Arrays</code> are represented using
        an element for each entry. The element name is derived from the the simple name
        of the entry's class (without package name and starting lowercase):
      </p><pre class="programlisting"><span class="hl-tag">&lt;formresult</span> <span class="hl-attribute">serial</span>=<span class="hl-value">"1199439160721"</span><span class="hl-tag">&gt;</span>
  ...
  <span class="hl-tag">&lt;data&gt;</span>
    <span class="hl-tag">&lt;account</span> <span class="hl-attribute">accountNo</span>=<span class="hl-value">"2000000"</span> <span class="hl-attribute">currency</span>=<span class="hl-value">"EUR"</span> <span class="hl-attribute">balance</span>=<span class="hl-value">"3124.49"</span> <span class="hl-attribute">openingDate</span>=<span class="hl-value">"2003-10-23 08:05:10"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;account</span> <span class="hl-attribute">accountNo</span>=<span class="hl-value">"2000123"</span> <span class="hl-attribute">currency</span>=<span class="hl-value">"EUR"</span> <span class="hl-attribute">balance</span>=<span class="hl-value">"332.54"</span> <span class="hl-attribute">openingDate</span>=<span class="hl-value">"2003-11-04 09:15:38"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;account</span> <span class="hl-attribute">accountNo</span>=<span class="hl-value">"2001405"</span> <span class="hl-attribute">currency</span>=<span class="hl-value">"EUR"</span> <span class="hl-attribute">balance</span>=<span class="hl-value">"25123.11"</span> <span class="hl-attribute">openingDate</span>=<span class="hl-value">"2005-01-13 10:10:10"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/data&gt;</span>
  ...
<span class="hl-tag">&lt;/formresult&gt;</span></pre><p>
        The element name can be changed using the <code class="literal">@ClassNameAlias</code> annotation, e.g.
        to rename the <code class="literal">account</code> element to <code class="literal">bankaccount</code>:
      </p><pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ClassNameAlias("bankaccount")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Account {
    ...
}</pre><p>
        <code class="literal">Maps</code> are represented using an <code class="literal">entry</code> element for each
        map entry. Key and value are represented by child elements (whereas the element names are
        derived from the class names):
      </p><pre class="programlisting"><span class="hl-tag">&lt;formresult</span> <span class="hl-attribute">serial</span>=<span class="hl-value">"1199439160721"</span><span class="hl-tag">&gt;</span>
  ...
  <span class="hl-tag">&lt;data&gt;</span>
    <span class="hl-tag">&lt;entry&gt;</span>
      <span class="hl-tag">&lt;long&gt;</span>2000000<span class="hl-tag">&lt;/long&gt;</span>
      <span class="hl-tag">&lt;account</span> <span class="hl-attribute">accountNo</span>=<span class="hl-value">"2000000"</span> <span class="hl-attribute">currency</span>=<span class="hl-value">"EUR"</span> <span class="hl-attribute">debit</span>=<span class="hl-value">"3124.49"</span> <span class="hl-attribute">openingDate</span>=<span class="hl-value">"2003-10-23 08:05:34"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/entry&gt;</span>
    <span class="hl-tag">&lt;entry&gt;</span>
      <span class="hl-tag">&lt;key&gt;</span>2001405<span class="hl-tag">&lt;/key&gt;</span>
      <span class="hl-tag">&lt;account</span> <span class="hl-attribute">accountNo</span>=<span class="hl-value">"2001405"</span> <span class="hl-attribute">currency</span>=<span class="hl-value">"EUR"</span> <span class="hl-attribute">debit</span>=<span class="hl-value">"25123.11"</span> <span class="hl-attribute">openingDate</span>=<span class="hl-value">"2005-01-13 10:10:34"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/entry&gt;</span>
    <span class="hl-tag">&lt;entry&gt;</span>
      <span class="hl-tag">&lt;key&gt;</span>2000123<span class="hl-tag">&lt;/key&gt;</span>
      <span class="hl-tag">&lt;account</span> <span class="hl-attribute">accountNo</span>=<span class="hl-value">"2000123"</span> <span class="hl-attribute">currency</span>=<span class="hl-value">"EUR"</span> <span class="hl-attribute">debit</span>=<span class="hl-value">"332.54"</span> <span class="hl-attribute">openingDate</span>=<span class="hl-value">"2003-11-04 09:15:34"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/entry&gt;</span>
  <span class="hl-tag">&lt;/data&gt;</span>
  ...
<span class="hl-tag">&lt;/formresult&gt;</span></pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Changing the tag name for map entries"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/docbkx/tip.png"></td><th align="left">Changing the tag name for map entries</th></tr><tr><td align="left" valign="top"><p>
          The tag name, that is used for the entries in the map can be changed using the
          <code class="literal">@MapSerializer</code> (see <a class="xref" href="#advanced.object2xml.advanced.object2xml.builtinserializers.map" title="@MapSerializer">the section called &#8220;@MapSerializer&#8221;</a>).
        </p></td></tr></table></div><p>
        Circular object references are handled by adding a <code class="literal">xpathref</code> attribute to
        the according element. Its value is an absolute XPath expression referencing the according
        object's element:
      </p><pre class="programlisting"><span class="hl-tag">&lt;formresult</span> <span class="hl-attribute">serial</span>=<span class="hl-value">"1199702214819"</span><span class="hl-tag">&gt;</span>
  ...
  <span class="hl-tag">&lt;data&gt;</span>
    <span class="hl-tag">&lt;account</span> <span class="hl-attribute">accountNo</span>=<span class="hl-value">"2000123"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;customer</span> <span class="hl-attribute">customerId</span>=<span class="hl-value">"100000"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;accounts&gt;</span>
          <span class="hl-tag">&lt;account</span> <span class="hl-attribute">accountNo</span>=<span class="hl-value">"2000000"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;customer</span> <span class="hl-attribute">xpathref</span>=<span class="hl-value">"/formresult/data[1]/account[1]/customer[1]"</span><span class="hl-tag">/&gt;</span>
          <span class="hl-tag">&lt;/account&gt;</span>
          <span class="hl-tag">&lt;account</span> <span class="hl-attribute">xpathref</span>=<span class="hl-value">"/formresult/data[1]/account[1]"</span><span class="hl-tag">/&gt;</span>
          <span class="hl-tag">&lt;account</span> <span class="hl-attribute">accountNo</span>=<span class="hl-value">"2001405"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;customer</span> <span class="hl-attribute">xpathref</span>=<span class="hl-value">"/formresult/data[1]/account[1]/customer[1]"</span><span class="hl-tag">/&gt;</span>
          <span class="hl-tag">&lt;/account&gt;</span>
        <span class="hl-tag">&lt;/accounts&gt;</span>
      <span class="hl-tag">&lt;/customer&gt;</span>
    <span class="hl-tag">&lt;/account&gt;</span>
  <span class="hl-tag">&lt;/data&gt;</span>
  ...
<span class="hl-tag">&lt;/formresult&gt;</span></pre><p>
        In this example the <code class="literal">Account</code> bean has a reference to a <code class="literal">Customer</code>
        bean, which itself has a reference to all of its <code class="literal">Accounts</code>. You can see that all
        beans, which were already serialized (as ancestors in the tree) contain an according back-reference.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="advanced.object2xml.builtinserializers"></a>7.8.2.&nbsp;Built-in serializers</h3></div></div></div><p>
        Pustefix already provides several XML serializers for common serialization tasks.
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="advanced.object2xml.builtinserializers.simple"></a>Simple serializers</h4></div></div></div><p>
          Simple serializers serialize scalar values (like strings, numbers or booleans). They
          are added as a new attribute on the current tag.
        </p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="advanced.object2xml.advanced.object2xml.builtinserializers.simple.date"></a>@DateSerializer</h5></div></div></div><p>
            The <code class="literal">@DateSerializer</code> is used to select the date format when serializing
            <code class="literal">Date</code> or <code class="literal">Calendar</code> objects.
          </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="advanced.object2xml.builtinserializers.complex"></a>Complex serializers</h4></div></div></div><p>
          Complex serializers are used to serialize complex data structures. These always
          result in new tags that are being added to the document.
        </p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="advanced.object2xml.advanced.object2xml.builtinserializers.complex.forceelement"></a>@ForceElementSerializer</h5></div></div></div><p>
            The <code class="literal">@ForceElementSerializer</code> will create an XML tag for primitive
            values instead of writing the value to an XML attribute.
          </p><p>
            It can be combined with any simple type serializer (see <a class="xref" href="#advanced.object2xml.builtinserializers.simple" title="Simple serializers">the section called &#8220;Simple serializers&#8221;</a>.
          </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="advanced.object2xml.advanced.object2xml.builtinserializers.cdata"></a>@CDataSerializer</h5></div></div></div><p>
            The <code class="literal">@CDataSerializer</code> will create a CData section in the resulting 
            XML document.
          </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="advanced.object2xml.advanced.object2xml.builtinserializers.map"></a>@MapSerializer</h5></div></div></div><p>
            The <code class="literal">@MapSerializer</code> is used to serialize instances of <code class="literal">java.util.Map</code>.
          </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="advanced.object2xml.advanced.object2xml.builtinserializers.complex.xmlfragment"></a>@XMLFragmentSerializer</h5></div></div></div><p>
            Strings that contain XML code can be inserted as XML fragment the the resulting document by using
            the <code class="literal">@XMLFragmentSerializer</code>:
          </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FragmentBean {
      
    <span class="hl-keyword">private</span> String myFragment = <span class="hl-string">"&lt;foo&gt;&lt;bar baz=\"true\"/&gt;character data&lt;/foo&gt;"</span>;

    <em><span class="hl-annotation" style="color: gray">@XMLFragmentSerializer</span></em>
    <span class="hl-keyword">public</span> String getMyFragment() {
        <span class="hl-keyword">return</span> myFragment;
    }
}</pre><p>
            The XML, that is returned by the <code class="literal">getMyFragment</code> method is not treated
            as a simple string, but as an XML fragment and thus, the content is not escaped, when
            inserted in the document:
          </p><pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hl-tag">&lt;result&gt;</span>
  <span class="hl-tag">&lt;myFragment&gt;</span>
    <span class="hl-tag">&lt;foo&gt;</span><span class="hl-tag">&lt;bar</span> <span class="hl-attribute">baz</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>character data<span class="hl-tag">&lt;/foo&gt;</span>
  <span class="hl-tag">&lt;/myFragment&gt;</span>
<span class="hl-tag">&lt;/result&gt;</span></pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="advanced.object2xml.customserializers"></a>7.8.3.&nbsp;Custom serializers</h3></div></div></div><p>
        If you don't like the default serialization mechanism or you use unsupported types, you can
        write your own serializers. There are two types of serializers: <code class="literal">SimpleTypeSerializers</code>, 
        which can produce <code class="literal">String</code> values (e.g. for primitive types), 
        and <code class="literal">ComplexTypeSerializers</code>, which can produce structured XML data
        (e.g. for bean types). 
      </p><p>
        Implementing your own serializer just requires to implement the <code class="literal">SimpleTypeSerializer</code>
        or <code class="literal">ComplexTypeSerializer</code> interface and create a custom annotation to be able
        to attach your serializer to a bean property.
      </p><p>
        Let's look at an example of a <code class="literal">SimpleTypeSerializer</code>: 
        a custom <code class="literal">String</code> serializer, which allows to configure if 
        <code class="literal">Strings</code> should be ouput lower- or uppercase. Here's the implementation:
      </p><pre class="programlisting">...
<span class="hl-keyword">import</span> de.schlund.pfixcore.oxm.impl.AnnotationAware;
<span class="hl-keyword">import</span> de.schlund.pfixcore.oxm.impl.SimpleTypeSerializer;
<span class="hl-keyword">import</span> de.schlund.pfixcore.oxm.impl.annotation.StringSerializer;
...

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> StringTypeSerializer <span class="hl-keyword">implements</span> SimpleTypeSerializer, AnnotationAware {

    <span class="hl-keyword">private</span> <span class="hl-keyword">boolean</span> doLowerCase;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setAnnotation(Annotation annotation) {
        StringSerializer s=(StringSerializer)annotation;
        doLowerCase=s.value();
    }

    <span class="hl-keyword">public</span> String serialize(Object obj, SerializationContext context) <span class="hl-keyword">throws</span> SerializationException {
        <span class="hl-keyword">if</span>(obj <span class="hl-keyword">instanceof</span> String) {
          String str=(String)obj;
          <span class="hl-keyword">if</span>(doLowerCase) str=str.toLowerCase();
          <span class="hl-keyword">else</span> str=str.toUpperCase();
          <span class="hl-keyword">return</span> str;
        } 
        <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> SerializationException(<span class="hl-string">"Illegal type: "</span>+obj.getClass().getName());
    }
}</pre><p>
        The serializer implements the <code class="literal">SimpleTypeSerializer</code> interface.
        Its <code class="literal">serialize</code> method checks if the passed object is of type <code class="literal">String</code>
        and calls <code class="literal">toLowerCase</code> or <code class="literal">toUpperCase</code> before returning
        the new <code class="literal">String</code>. The <code class="literal">doLowerCase</code> property controls which method is used.
        This property is set within the <code class="literal">setAnnotation</code> method. The method is defined
        in the <code class="literal">AnnotationAware</code> interface. This method is called by the framework
        after the serializer is instantiated and passes the annotation set at the according bean
        property. So you can access the configured values and configure your serializer.
        Let's look at the according annotation definition:
      </p><pre class="programlisting">...
        
<em><span class="hl-annotation" style="color: gray">@SimpleTypeSerializerClass(StringTypeSerializer.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@Target({ElementType.METHOD,ElementType.FIELD})</span></em>
<em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
<span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> StringSerializer {
    <span class="hl-keyword">boolean</span> value();
}</pre><p>
        You have to annotate the custom annotation with a <code class="literal">SimpleTypeSerializerClass</code>
        annotation with the serializer class as value, make the annotation available to
        methods and fields using the <code class="literal">@Target</code> annotation and make it visible
        at runtime using the <code class="literal">@Retention</code> annotation. The rest of the annotation
        definition can be done according to your needs. In the example we just define a boolean
        property indicating if the <code class="literal">String</code> should be converted to lower- or uppercase. Here you
        see how the annotation is applied to serialize a customer's lastname as uppercase:
      </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Customer {
    ...
    <em><span class="hl-annotation" style="color: gray">@StringSerializer(false)</span></em>
    <span class="hl-keyword">public</span> String getLastName() {...}
}</pre><p>
        Let's look at an example of a <code class="literal">ComplexTypeSerializer</code>. We want to customize
        the serialization of a <code class="literal">Customer</code> bean: the <code class="literal">firstName</code> and
        <code class="literal">lastName</code> properties should be output together within a <code class="literal">name</code>
        element:
      </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Customer {
    ...
    <span class="hl-keyword">public</span> <span class="hl-keyword">long</span> getCustomerId() {...}
    <span class="hl-keyword">public</span> String getFirsstName() {...}
    <span class="hl-keyword">public</span> String getLastName() {...}
    <span class="hl-keyword">public</span> List&lt;Account&gt; getAccounts() {...}
    ...
}</pre><p>
        The serializer just implements <code class="literal">ComplexTypeSerializer</code>. We don't need to
        implement <code class="literal">AnnotationAware</code> because our annotation will have no parameter
        we may want to read:
      </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CustomerTypeSerializer <span class="hl-keyword">implements</span> ComplexTypeSerializer {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> serialize(Object obj, SerializationContext context, XMLWriter writer) <span class="hl-keyword">throws</span> SerializationException {
        <span class="hl-keyword">if</span>(obj <span class="hl-keyword">instanceof</span> Customer) {
            Customer customer=(Customer)obj;
            writer.writeStartElement(<span class="hl-string">"name"</span>);
            writer.writeCharacters(customer.getFirstName()+<span class="hl-string">" "</span>+customer.getLastName());
            writer.writeEndElement(<span class="hl-string">"name"</span>);
            context.serialize(customer.getAccounts(),writer);
        } <span class="hl-keyword">else</span> {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> SerializationException(<span class="hl-string">"Illegal type: "</span>+obj.getClass().getName());
        }
    }
}</pre><p>
        The <code class="literal">serialize</code> method gets a <code class="literal">XMLWriter</code> object, which
        is used to write the <code class="literal">name</code> element. Then the passed <code class="literal">SerializationContext</code>
        is used to serialize the customer's accounts using the default serialization mechanism.
      </p><p>
        Finally we implement a custom annotation:
      </p><pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ComplexTypeSerializerClass(de.schlund.pfixcore.example.bank.oxm.CustomerTypeSerializer.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@Target({ElementType.METHOD,ElementType.FIELD})</span></em>
<em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
<span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> CustomerSerializer {}</pre><p>
        Here we apply the annotation to the <code class="literal">Account</code> bean's 
        <code class="literal">customer</code> property:
      </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Account {
    ...
    <em><span class="hl-annotation" style="color: gray">@CustomerSerializer</span></em>
    <span class="hl-keyword">public</span> Customer getCustomer() {...}
    ...
}</pre><p>
        Here's an excerpt of the resulting XML:
      </p><pre class="programlisting"><span class="hl-tag">&lt;formresult</span> <span class="hl-attribute">serial</span>=<span class="hl-value">"1199705488403"</span><span class="hl-tag">&gt;</span>
  ...
  <span class="hl-tag">&lt;data&gt;</span>
    <span class="hl-tag">&lt;account</span> <span class="hl-attribute">accountNo</span>=<span class="hl-value">"2000000"</span> <span class="hl-attribute">balance</span>=<span class="hl-value">"3124.49"</span> <span class="hl-attribute">currency</span>=<span class="hl-value">"EUR"</span> <span class="hl-attribute">openingDate</span>=<span class="hl-value">"2003-10-23 08:05:22"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;customer&gt;</span>
        <span class="hl-tag">&lt;name&gt;</span>Mike Foo<span class="hl-tag">&lt;/name&gt;</span>
        <span class="hl-tag">&lt;account</span> <span class="hl-attribute">accountNo</span>=<span class="hl-value">"..."</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;account</span> <span class="hl-attribute">accountNo</span>=<span class="hl-value">"..."</span><span class="hl-tag">/&gt;</span>
        ...
      <span class="hl-tag">&lt;/customer&gt;</span>
    <span class="hl-tag">&lt;/account&gt;</span>
  <span class="hl-tag">&lt;/data&gt;</span>
  ...
<span class="hl-tag">&lt;/formresult&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="advanced.object2xml.jaxb"></a>7.8.4.&nbsp;Using JAXB serialization</h3></div></div></div><p>As an alternative to the builtin XML marshalling you can use JAXB. Pustefix checks if the class definition of an object is annotated with the JAXB annotation 
            <code class="literal">javax.xml.bind.annotation.XmlRootElement</code> and, if so, hands over the serialization to JAXB.
      </p><pre class="programlisting">...
	 
<em><span class="hl-annotation" style="color: gray">@XmlRootElement</span></em> 
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Account {
  
    <span class="hl-keyword">private</span> <span class="hl-keyword">long</span> accountNo;
  
    <em><span class="hl-annotation" style="color: gray">@XmlAttribute</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">long</span> getAccountNo() {
        <span class="hl-keyword">return</span> accountNo;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setAccountNo(<span class="hl-keyword">long</span> accountNo) {
        <span class="hl-keyword">this</span>.accountNo = accountNo;
    }

    ...

}</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advanced.iwrapperannotations"></a>7.9.&nbsp;Annotation-based IWrapper creation</h2></div></div></div><p>
      The annotation-based IWrapper creation provides an alternative to the usual,
      XML configuration based, IWrapper creation. Using this approach you create IWrappers
      from standard Java Beans by adding the necessary configuration data in the form
      of annotations.
    </p><p>
      The IWrappers are automatically created during the build process using the Sun JVM's <code class="literal">apt</code>
      tool and a custom <code class="literal">AnnotationProcessor</code> which analyzes the Java bean's
      source code and generates the according IWrapper sources.
    </p><p>
      You're making a bean to a template for an <code class="literal">IWrapper</code> by adding an 
      <code class="literal">@IWrapper</code> annotation to its class declaration. By default every 
      bean property that is of a so-called builtin type, i.e. has a pre-defined 
      <code class="literal">IWrapperParamCaster</code> implementation, will be automatically added
      as an IWrapper parameter.
    </p><p>
      Builtin types are <code class="literal">boolean, byte, double, float, int, long,
      java.lang.Boolean, java.lang.Byte, java.lang.Double, java.lang.Float, java.lang.Integer, 
      java.lang.Long, java.lang.String, java.util.Date</code> and <code class="literal">Arrays</code>
      with components of these types.
    </p><p>
      Bean properties of an unknown type are either ignored or require a <code class="literal">@Caster</code>
      annotation specifying an appropriate caster. Bean properties can be annotated at their
      getter methods or at the field itself, if it's public. If a property of a builtin type should
      be skipped you can mark the according property with a <code class="literal">@Transient</code> annotation.
    </p><p>
      Bean based IWrappers can be used to create new beans or fill existing beans with
      the IWrapper's state. Therefore the <code class="literal">IWrapperToBean</code> class provides
      the two static methods <code class="literal">&lt;T&gt; T createBean(IWrapper wrapper, Class&lt;T&gt; beanClass)</code>
      and <code class="literal">populateBean(IWrapper wrapper, Object obj)</code>.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="advanced.iwrapperannotations.reference"></a>7.9.1.&nbsp;IWrapper annotations</h3></div></div></div><p>
        Every IWrapper configuration element known from the XML configuration has an annotation
        counterpart. Besides there are some special annotations like <code class="literal">@IWrapper</code>
        and <code class="literal">@Transient</code>. In the following we'll give a short overview of
        all avaible annotations:
      </p><p>
      </p><pre class="programlisting">
        <em><span class="hl-annotation" style="color: gray">@Target(ElementType.TYPE)</span></em>
        <em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
        <span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> IWrapper {
          String name() <span class="hl-keyword">default</span> <span class="hl-string">""</span>;
          Class&lt;? <span class="hl-keyword">extends</span> IHandler&gt; ihandler() <span class="hl-keyword">default</span> IHandler.<span class="hl-keyword">class</span>;
          String beanRef() <span class="hl-keyword">default</span> <span class="hl-string">""</span>;
        }
        
        <em><span class="hl-annotation" style="color: gray">@IWrapper(name="MyBeanWrapper",ihandler=MyBeanHandler.class)</span></em>
        <span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyBean {
          ...
        }
      </pre><p>
      </p><p>
        The <code class="literal">@IWrapper</code> annotation is used to mark a class as template for
        an IWrapper. The <code class="literal">name</code> attribute denotes the class name of the
        generated IWrapper class (without package). By default the bean name with the
        suffix <code class="literal">Wrapper</code> is used (and the same package). The <code class="literal">ihandler</code>
        attribute denotes the <code class="literal">IHandler</code> implementation class. Alternatively you can
        use the <code class="literal">beanRef</code> attribute to reference a Spring managed IHandler bean by name.
      </p><p>
      </p><pre class="programlisting">
        <em><span class="hl-annotation" style="color: gray">@Target({ElementType.METHOD,ElementType.FIELD})</span></em>
        <em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
        <span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> Param {
          String name() <span class="hl-keyword">default</span> <span class="hl-string">""</span>;
          <span class="hl-keyword">boolean</span> mandatory() <span class="hl-keyword">default</span> true;
          <span class="hl-keyword">boolean</span> trim() <span class="hl-keyword">default</span> true;
          String missingscode() <span class="hl-keyword">default</span> <span class="hl-string">""</span>;
          String[] defaults() <span class="hl-keyword">default</span> {};
        }
        
        <em><span class="hl-annotation" style="color: gray">@IWrapper(name="MyBeanWrapper",ihandler=MyBeanHandler.class)</span></em>
        <span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyBean {
          ...
          <em><span class="hl-annotation" style="color: gray">@Param(name="MyValue",mandatory=false)</span></em>
          <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getValue() {...}
        }
      </pre><p>
      </p><p>
        The <code class="literal">@Param</code> annotation is used to mark a bean property as parameter
        and configure its <code class="literal">name</code> and all the other options known from the
        IWrapper XML configuration. This annotation is optional, leaving it out, the property name
        is used as name and the other attributes are set to their default values.
      </p><p>
      </p><pre class="programlisting">
        <em><span class="hl-annotation" style="color: gray">@Target({ElementType.METHOD,ElementType.FIELD})</span></em>
        <em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
        <span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> Caster {
          Class&lt;? <span class="hl-keyword">extends</span> IWrapperParamCaster&gt; type();
          Property[] properties() <span class="hl-keyword">default</span> {};
        }
        
        <em><span class="hl-annotation" style="color: gray">@IWrapper(name="MyBeanWrapper",ihandler=MyBeanHandler.class)</span></em>
        <span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyBean {
          ...
          <em><span class="hl-annotation" style="color: gray">@Caster(type=SomeClassCaster.class)</span></em>
          <span class="hl-keyword">public</span> SomeClass getValue() {...}
        }
      </pre><p>
      </p><p>
        The <code class="literal">@Caster</code> annotation denotes the caster implementation class.
        The nested <code class="literal">properties</code> attribute can be used to set properties via
        <code class="literal">@Property</code> annotations. That's the same as the <code class="literal">cparam</code>
        elements in the XML configuration (the params/properties are set using according methods
        prefixed with <code class="literal">put_</code>).
      </p><p>
      </p><pre class="programlisting">
        <em><span class="hl-annotation" style="color: gray">@Target({ElementType.METHOD,ElementType.FIELD})</span></em>
        <em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
        <span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> Property {
          String name();
          String value();
        }
      </pre><p>
      </p><p>
        The <code class="literal">@Property</code> annotation is used as nested annotation within
        the <code class="literal">properties</code> array attribute of various annotations. It consists
        of simple <code class="literal">name/value</code> pairs. 
      </p><p>
      </p><pre class="programlisting">
        <em><span class="hl-annotation" style="color: gray">@Target({ElementType.METHOD,ElementType.FIELD})</span></em>
        <em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
        <span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> PreCheck {
          Class&lt;? <span class="hl-keyword">extends</span> IWrapperParamPreCheck&gt; type();
          Property[] properties() <span class="hl-keyword">default</span> {};
        }
        
        <em><span class="hl-annotation" style="color: gray">@IWrapper(name="MyBeanWrapper",ihandler=MyBeanHandler.class)</span></em>
        <span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyBean {
          ...
          <em><span class="hl-annotation" style="color: gray">@PreCheck(
            type=de.schlund.pfixcore.generator.prechecks.RegexpCheck.class,
            properties={
              @Property(name="regexp",value="/^(M|L|XL)$/")
            }
          )</span></em>
          <span class="hl-keyword">public</span> String getValue() {...}
        }
      </pre><p>
      </p><p>
        The <code class="literal">@PreCheck</code> annotation denotes the precheck implementation class
        with optional properties/parameters.
      </p><p>
      </p><pre class="programlisting">
        <em><span class="hl-annotation" style="color: gray">@Target({ElementType.METHOD,ElementType.FIELD})</span></em>
        <em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
        <span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> PostCheck {
          Class&lt;? <span class="hl-keyword">extends</span> IWrapperParamPostCheck&gt; type();
          Property[] properties() <span class="hl-keyword">default</span> {};
        }
        
        <em><span class="hl-annotation" style="color: gray">@IWrapper(name="MyBeanWrapper",ihandler=MyBeanHandler.class)</span></em>
        <span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyBean {
          ...
          <em><span class="hl-annotation" style="color: gray">@PostCheck(
            type=de.schlund.pfixcore.generator.postchecks.IntegerRange.class,
            properties={
              @Property(name="range",value="0:2")
            }
          )</span></em>
          <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getValue() {...}
        }
      </pre><p>
      </p><p>
        The <code class="literal">@PostCheck</code> annotation denotes the postcheck implementation class
        with optional properties/parameters.
      </p><p>
      </p><pre class="programlisting">
        <em><span class="hl-annotation" style="color: gray">@Target({ElementType.METHOD,ElementType.FIELD})</span></em>
        <em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
        <span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> Transient {}
        
        <em><span class="hl-annotation" style="color: gray">@IWrapper(name="MyBeanWrapper",ihandler=MyBeanHandler.class)</span></em>
        <span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyBean {
          ...
          <em><span class="hl-annotation" style="color: gray">@Transient</span></em>
          <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getValue() {...}
        }
      </pre><p>
      </p><p>
        The <code class="literal">@Transient</code> annotation can be used to avoid that a bean property
        of a builtin type is made to an IWrapper parameter.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advanced.scriptedflows"></a>7.10.&nbsp;Scripted workflows</h2></div></div></div><p>
      Scripted flows are script files written in XML that can be used to control a
      user session. The script file has the following form:
    </p><pre class="programlisting"><span class="hl-tag">&lt;scriptedflow</span> <span class="hl-attribute">version</span>=<span class="hl-value">"1.0"</span>
  <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://pustefix.oss.schlund.de/scriptedflow200602"</span><span class="hl-tag">&gt;</span>
  <em class="hl-comment" style="color: silver">&lt;!--
    The instructions are placed here.
  --&gt;</em>
  <span class="hl-tag">&lt;/scriptedflow&gt;</span></pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e8977"></a>7.10.1.&nbsp;Parameters and Variables</h3></div></div></div><p>
        A scripted flow is started by using the special __scriptedflow=[FLOWNAME] parameter
        in the query string of a request URI. In this query string additonal parameters
        can be given which are then made available inside the script.
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e8982"></a>Variables</h4></div></div></div><p>
          Variables can be used to store character data between steps within a scripted flow.
          A variable is set using the &lt;set-variable name="variablename"&gt;content&lt;/set-variable&gt;
          command. The content may consist of character data as well as the special
          &lt;value-of select="&lt;XPath-Expression&gt;"/&gt; command. Within XPath expressions
          variables can be referenced using $variablename.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e8987"></a>Parameters</h4></div></div></div><p>
          Parameters are set when a scripted flow is started. If the query string contains e.g.
          "name=value" the value can be accessed from within XPath expressions using
          the special variable name $__param_name$. Parameters can not be overwritten from
          within the script and never change during the execution.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e8992"></a>Special variables</h4></div></div></div><p>
          There is a special variable called $__pagename$ which contains the name of the page
          that would have been sent to the browser, if the last request was done directly by
          the browser. You can use this variable to check on which page you are at the moment.
          This variable cannot be written to by the script.
        </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e8997"></a>7.10.2.&nbsp;Statements</h3></div></div></div><p>
        Scripted Flows are programmed using assorted statements which are explained here:
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e9002"></a>&lt;interactive-request&gt;</h4></div></div></div><p>
          Gives control back to the user. The output page is rendered based on the current
          ResultDocument (which was generated by the last request) and sent to the browser.
          When the browser sends the next request (e.g. by sending a form or clicking on a
          link) it is processed as usual but instead of returning the resulting document
          directly to the browser the active scripted flow is continued right at the location
          it was suspended, using the new ResultDocument as the base for further processing.
        </p><pre class="programlisting"><span class="hl-tag">&lt;interactive-request&gt;</span>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"thename"</span><span class="hl-tag">&gt;</span>static text combined with <span class="hl-tag">&lt;value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"$thevar"</span><span class="hl-tag">/&gt;</span> calculated text (if needed)<span class="hl-tag">&lt;/param&gt;</span>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"otherparam"</span><span class="hl-tag">&gt;</span>other text<span class="hl-tag">&lt;/param&gt;</span>
<span class="hl-tag">&lt;/interactive-request&gt;</span></pre><p>
          This statement can take an arbitrary number of param tags as children. These tags
          can be used to provide values to pre-fill html form input elements.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e9011"></a>&lt;virtual-request&gt;</h4></div></div></div><p>
          Triggers a virtual request which is processed by the context like a user request.
          This statement can have an optional attribute page which specifies the name of the
          page the request should be sent to. If omitted, the current page (as defined by the
          Context) is used. This statement can take an arbitrary number of param tags below
          itself. These tags can be used to provide arguments to the request (e.g. to simulate
          submitted form data). The tag follows the scheme:
        </p><pre class="programlisting"><span class="hl-tag">&lt;virtual-request</span> <span class="hl-attribute">page</span>=<span class="hl-value">"thepage"</span> <span class="hl-attribute">dointeractive</span>=<span class="hl-value">"false|true|reuse"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"thename"</span><span class="hl-tag">&gt;</span>static text combined with <span class="hl-tag">&lt;value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">"$thevar"</span><span class="hl-tag">/&gt;</span> calculated text (if needed)<span class="hl-tag">&lt;/param&gt;</span>
  <span class="hl-tag">&lt;param</span> <span class="hl-attribute">name</span>=<span class="hl-value">"otherparam"</span><span class="hl-tag">&gt;</span>other text<span class="hl-tag">&lt;/param&gt;</span>
<span class="hl-tag">&lt;/virtual-request&gt;</span></pre><p>
          The <code class="literal">dointeractive</code> attribute is used in case the virtual request
          returns an error. If set to <code class="literal">"true"</code> or <code class="literal">"reuse"</code>,
          the system will automatically fall back to do an interactive request (the
          default is <code class="literal">"false"</code> which will just go on with the scripted flow
          ignoring any errors). All errors will be cleared from the document used in the
          interactive request. The difference between <code class="literal">"true"</code> and
          <code class="literal">"reuse"</code> is that in the latter case, the param tags given to the
          virtual request will be reused in the automatic interactive request, providing for
          pre-filled input fields.
        </p><p>
          Please note that the <code class="literal">__sendingdata</code> or <code class="literal">__sendingauthdata</code>
          parameter will not be added automatically but has to be added by the script developer,
          if needed. The ResultDocument returned by this request is used as the basis for
          further processing (e.g. XPath testing).
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e9046"></a>&lt;set-variable&gt;</h4></div></div></div><p>
          Sets the value of a variable. As the param tag within the virtual-request tag this
          tag can contain text data combined with the value-of tag. See Parameters &amp; Variables
          for details on how to use variables.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e9051"></a>&lt;if&gt;</h4></div></div></div><p>
          Allows conditional execution of a code block. Based on a XPath expression which
          is given using the test attribute the VM decides whether to execute the statements
          given below the <code class="literal">&lt;if&gt;</code> tag or not. The XPath expression can
          test for variables and parameters as well as querying the ResultDocument returned
          by the last request.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e9059"></a>&lt;choose&gt;</h4></div></div></div><p>
          This is the multi-branch equivalent to <code class="literal">&lt;if&gt;</code>. The form is
        </p><pre class="programlisting"><span class="hl-tag">&lt;choose&gt;</span>
  <span class="hl-tag">&lt;when</span> <span class="hl-attribute">test</span>=<span class="hl-value">"..."</span><span class="hl-tag">&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- ... --&gt;</em>
  <span class="hl-tag">&lt;/when&gt;</span>
  <span class="hl-tag">&lt;when</span> <span class="hl-attribute">test</span>=<span class="hl-value">"..."</span><span class="hl-tag">&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- ... --&gt;</em>
  <span class="hl-tag">&lt;/when&gt;</span>
  <span class="hl-tag">&lt;otherwise&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- ... --&gt;</em>
  <span class="hl-tag">&lt;/otherwise&gt;</span>
<span class="hl-tag">&lt;/choose&gt;</span></pre><p>
          The <code class="literal">&lt;otherwise&gt;</code> branch is optional and only executed if
          none of the <code class="literal">&lt;when&gt;</code> conditions is met. Only the first
          <code class="literal">&lt;when&gt;</code> branch whose condition is met is executed,
          branches following this branch are not evaluated regardless of their condition.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e9080"></a>&lt;while&gt;</h4></div></div></div><p>
          Loops as long as condition is true. Like the <code class="literal">&lt;if&gt;</code> statement
          this one takes a test attribute specifying a XPath expression. When the condition is
          true, the code block below this tag is executed, otherwise the next statement after
          the <code class="literal">&lt;while&gt;</code> statement is executed. After executing the block
          the condition is rechecked, so the block is executed repeatedly until the condition
          becomes false.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e9091"></a>&lt;break&gt;</h4></div></div></div><p>
          Jumps out of a <code class="literal">&lt;while&gt;</code> loop. This statement is allowed
          anywhere below a <code class="literal">&lt;while&gt;</code> statement. It can be used to quit
          the loop immediately and to go on with the next statement after the loop.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e9102"></a>&lt;exit&gt;</h4></div></div></div><p>
          Quits the current scripted flow, returning the current ResultDocument to the browser.
        </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advanced.scripting"></a>7.11.&nbsp;Scripting Langauge support</h2></div></div></div><p>
      Consider these questions:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Do you miss fast-prototyping in Pustefix?</li><li class="listitem">Do you think dynamic programming languages (sometimes called scripting languages) can do more than just interpreting one liners or providing a new form of poetry?</li></ul></div><p>
      If you answered any of the questions above with yes ... Then this is for you!
    </p><p>
      This feature brings scripting support to IHandlers and States. It's possible to develop
      any of them in any Bean Scripting Framework supported language, by providing a script
      file's location inside any IWrapper definition file or inside a pagerequest's definition.
      Script files can be located in either the application's docroot or the classpath.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e9123"></a>7.11.1.&nbsp;IHandler</h3></div></div></div><p>
        Instead of providing a class name inside an IWrapper's IHander definition like this:
      </p><pre class="programlisting"><span class="hl-tag">&lt;ihandler</span> <span class="hl-attribute">class</span>=<span class="hl-value">"de.schlund.pfixcore.example.TShirtHandler"</span><span class="hl-tag">/&gt;</span></pre><p>
        you can define that a file containing dynamic language code should be used as an
        IHandler. It's done like this:
      </p><pre class="programlisting"><span class="hl-tag">&lt;ihandler</span> <span class="hl-attribute">class</span>=<span class="hl-value">"script:sample1/script/ScriptingTShirt.js"</span><span class="hl-tag">/&gt;</span></pre><p>
        ... that's it! (see below under "Path Definitions" on details about difference between
        scripts under docroot and scripts placed in classpath).
      </p><p>
        Simply create a file containing the dynamic language code inside the docroot or the classpath.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e9138"></a>7.11.2.&nbsp;State</h3></div></div></div><p>
        If you want to script a State, then simply use the above definition format inside a
        pagerequest's state definition, like in the following example:
      </p><pre class="programlisting"><span class="hl-tag">&lt;pagerequest</span> <span class="hl-attribute">name</span>=<span class="hl-value">"scriptingstate"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;state</span> <span class="hl-attribute">class</span>=<span class="hl-value">"script:sample1/script/ScriptingState?.bsh"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/pagerequest&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e9145"></a>7.11.3.&nbsp;Implementation Details</h3></div></div></div><p>
        The following rules have to be considered, when scripting IHandlers and States alike.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
            You must define all methods of the respective interfaces
            (<code class="literal">de.schlund.pfixcore.generator.IHandler</code> and/or
            <code class="literal">de.schlund.pfixcore.workflow.State</code>)
            as functions inside your scripts.
          </li><li class="listitem">
            The functions inside your scripts have to return the correct type, if they
            return values at all. Note that for example en empty String is a valid boolean
            expression in Javascript.
          </li><li class="listitem">
            The file suffix must be one that's recognized by BSF. The listing of current
            supported language mappings of BSF helps you find the correct suffix for your
            used scripting lanuage. Basically they're the common suffixes like js for
            javascript, bsh for Beanshell and py for python.
          </li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e9166"></a>State</h4></div></div></div><p>
          Because the StateFactory caches and reuses State-instances across sessions and
          requests, you should be aware that script-wide global variables inside your
          scripts will be available to all requests and session.
        </p><p>
          This is basically the same behaviour as for States implemented in Java.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e9173"></a>Path Definitions</h4></div></div></div><p>
          There are two alternatives for defining the location of your script file.
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
              If you prepend a <code class="literal">/</code> (slash character) to the location,
              the script file is searched for in the classpath of your application.
              No magic (or great effort) is applied when searching for the script file.
              Instead simply <code class="literal">ScriptingIHandler.getClass().getResourceAsStream()</code>
              is called to get the source of the script file.
            </li><li class="listitem">
              If the script: String is not followed by a slash, the string is assumed to be a
              file's location relative to the docroot of the running pustefix application.
              This usually means everything downwards from the projects-folder.
            </li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e9191"></a>Libraries</h4></div></div></div><p>
          Of course the Java platform can't interpret every arbitrary on it's own.
          Special Language libraries must be available to the application in order to execute
          script code in the respective languages.
        </p><p>
          Pfixcore comes with the Mozilla's Javascript implementation and the Beanshell
          distribution, so you can write IHandlers and States in Javascript or Beanshell
          without any further requirements.
        </p><p>
          For other languages, like groovy, python or ruby, you'll need their respective
          implementations for the Java platform. The BSF site holds information about where
          to find these implementations.
        </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advanced.eventbus"></a>7.12.&nbsp;The Pustefix EventBus</h2></div></div></div><p>
      Pustefix provides a simple Spring/annotation-based event mechanism following the publish-subscribe principle.
    </p><p>
      The event system is enabled by adding two bean definitions to the Spring configuration. A <code class="literal">BeanPostProcessor</code> for
      automatic registration of event subscribers (based on method annotations) and an <code class="literal">EventBus</code> responsible for 
      publishing events to their subscribers.
    </p><pre class="programlisting">
  <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"eventPostProcessor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.pustefixframework.eventbus.EventSubscriberBeanPostProcessor"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"eventBus"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.pustefixframework.eventbus.EventBus"</span><span class="hl-tag">/&gt;</span>
</pre><p>
      A Spring bean can subcribe to an event by adding the <code class="literal">@Subscribe</code> method annotation. The method signature requires
      a single parameter of the event's type (subtypes or interfaces are supported too).
    </p><pre class="programlisting">
<span class="hl-keyword">import</span> org.pustefixframework.eventbus.Subscribe;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MySubscriberBean {

    <em><span class="hl-annotation" style="color: gray">@Subscribe</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> listen(MyEvent event) {
        <em class="hl-comment" style="color: silver">//process event </em>
    }

}
</pre><p>
      An event can be published by calling the <code class="literal">publish</code> method at the <code class="literal">EventBus</code>,
      The passed event object can be of an arbitrary type. The <code class="literal">EventBus</code> will immediately publish the
      event to all registered listeners, i.e. to all listeners which are registered for the event type, a subtype or
      one of its implemented interfaces.
    </p><pre class="programlisting">
<span class="hl-keyword">import</span> org.pustefixframework.eventbus.EventBus;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyPublisherBean {
    
    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    EventBus eventBus;
    
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doSomething() {
        <em class="hl-comment" style="color: silver">//do something</em>
        eventBus.publish(<span class="hl-keyword">new</span> MyEvent());
    }
    
}
</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advanced.requestid"></a>7.13.&nbsp;Request IDs for log correlation</h2></div></div></div><p>
      Request IDs let you correlate log entries with a specific web request. Pustefix can generate a unique ID for each
      request which is available during request processing, i.e. it can be added to each log entry created by a request.
      The ID is set by a servlet filter as request attribute, Log4J MDC key and HTTP response header.
    </p><p>
      To enable request IDs you have to add the following configuration to your application's <code class="literal">web.xml</code>:
    </p><pre class="programlisting">
  <span class="hl-tag">&lt;filter&gt;</span>
     <span class="hl-tag">&lt;filter-name&gt;</span>RequestIdFilter<span class="hl-tag">&lt;/filter-name&gt;</span>
     <span class="hl-tag">&lt;filter-class&gt;</span>org.pustefixframework.http.RequestIdFilter<span class="hl-tag">&lt;/filter-class&gt;</span>
     <em class="hl-comment" style="color: silver">&lt;!-- supported init parameters with default values --&gt;</em>
     <em class="hl-comment" style="color: silver">&lt;!--
     &lt;init-param&gt;
       &lt;param-name&gt;mdcKey&lt;/param-name&gt;
       &lt;param-value&gt;requestId&lt;/param-value&gt;
     &lt;/init-param&gt;
     &lt;init-param&gt;
       &lt;param-name&gt;attributeName&lt;/param-name&gt;
       &lt;param-value&gt;requestId&lt;/param-value&gt;
     &lt;/init-param&gt;
     &lt;init-param&gt;
       &lt;param-name&gt;headerName&lt;/param-name&gt;
       &lt;param-value&gt;X-Request-Id&lt;/param-value&gt;
     &lt;/init-param&gt;
     --&gt;</em>
   <span class="hl-tag">&lt;/filter&gt;</span>
   <span class="hl-tag">&lt;filter-mapping&gt;</span>
     <span class="hl-tag">&lt;filter-name&gt;</span>RequestIdFilter<span class="hl-tag">&lt;/filter-name&gt;</span>
     <span class="hl-tag">&lt;url-pattern&gt;</span>/*<span class="hl-tag">&lt;/url-pattern&gt;</span>
     <span class="hl-tag">&lt;dispatcher&gt;</span>REQUEST<span class="hl-tag">&lt;/dispatcher&gt;</span>
   <span class="hl-tag">&lt;/filter-mapping&gt;</span>
</pre><p>
      You can configure under which name the ID is stored in the different contexts. Setting the init parameter name
      to an empty value will disable it.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advanced.editor"></a>7.14.&nbsp;The Pustefix Editor</h2></div></div></div><p>
      This has to be re-written from scratch. The old wiki did not contain any
      useful information.
    </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="springmvc"></a>Chapter&nbsp;8.&nbsp;Using Spring MVC</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#springmvc.controllerstates">8.1. Pustefix states as Spring MVC controllers</a></span></dt><dt><span class="section"><a href="#springmvc.annotationmethodhandleradapter">8.2. AnnotationMethodHandlerAdapter customization</a></span></dt><dt><span class="section"><a href="#springmvc.paginationexample">8.3. Example: Pagination</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="springmvc.controllerstates"></a>8.1.&nbsp;Pustefix states as Spring MVC controllers</h2></div></div></div><p>Pustefix <code class="literal">States</code> are very similar to Spring MVC <code class="literal">Controllers</code>. They are called for processing request data and return the data model needed to display a page. They are no native <code class="literal">Controllers</code>, which get automatically picked up by Spring MVC, but Pustefix supports delegating processing to Spring, if a <code class="literal">State</code> contains according Spring <code class="literal">RequestMapping</code> annotations.
    </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TestState <span class="hl-keyword">extends</span> DefaultIWrapperState {

    <em><span class="hl-annotation" style="color: gray">@RequestMapping("/test/{myId}")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> list(<em><span class="hl-annotation" style="color: gray">@PathVariable</span></em> String myId, Model model) {
        model.addAttribute(<span class="hl-string">"test"</span>, myId);
    }</pre><p>
      A matching <code class="literal">RequestMapping</code>-annotated method is called after <code class="literal">IHandlers</code> are processed, but before the <code class="literal">ResultDocument</code> is created. Data added to the model will be automatically serialized to XML (after the configured output resources/beans are serialized). 
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="springmvc.annotationmethodhandleradapter"></a>8.2.&nbsp;AnnotationMethodHandlerAdapter customization</h2></div></div></div><p>Spring MVC's request mapping and parameter binding can be customized by configuring the responsible <code class="literal">AnnotationMethodHandlerAdapter</code> instance. Pustefix by default registers such an instance, which can be customized by adding a bean definition of type <code class="literal">org.pustefixframework.web.mvc.AnnotationMethodHandlerAdapterConfig</code> to the Spring configuration. See the following example which configures two argument resolvers:
    </p><pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.pustefixframework.web.mvc.AnnotationMethodHandlerAdapterConfig"</span><span class="hl-tag">&gt;</span>
   <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"customArgumentResolvers"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;list&gt;</span>
         <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.data.web.PageableArgumentResolver"</span><span class="hl-tag">/&gt;</span>
         <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.pustefixframework.web.mvc.filter.FilterResolver"</span><span class="hl-tag">/&gt;</span>
      <span class="hl-tag">&lt;/list&gt;</span>
   <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="springmvc.paginationexample"></a>8.3.&nbsp;Example: Pagination</h2></div></div></div><p>
      The following example shows how you can do pagination using the <code class="literal">Spring Data</code> approach 
      (see <a class="link" href="http://docs.spring.io/spring-data/data-commons/docs/current/reference/html/" target="_top">see reference documentation</a>). 
    </p><p>
      By adding an argument of type <code class="literal">org.springframework.data.domain.Pageable</code> to the method, paging parameters like page number and page size are automatically bound to that bean.
      Then you can pass this bean to your backend to return the matching data page implementing <code class="literal">org.springframework.data.domain.Page</code>. Add the result to the model, so that the data,
      including some paging meta information, is automatically serialized to XML.
    </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TestState <span class="hl-keyword">extends</span> DefaultIWrapperState {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> ContextData contextData;

    <em><span class="hl-annotation" style="color: gray">@RequestMapping("/test")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> list(Model model, Pageable pageable, Filter filter) {

        <span class="hl-keyword">if</span>(pageable.getSort() == null) {
            <em class="hl-comment" style="color: silver">//initially create default Pageable </em>
            pageable = <span class="hl-keyword">new</span> PageRequest(<span class="hl-number">0</span>, <span class="hl-number">10</span>, <span class="hl-keyword">new</span> Sort(Sort.Direction.ASC, <span class="hl-string">"id"</span>));
        }
        model.addAttribute(<span class="hl-string">"data"</span>, contextData.getDataList(pageable));
        model.addAttribute(<span class="hl-string">"filter"</span>, filter);
    }
}</pre><p>
       The following parameters are bound to the <code class="literal">Pageable</code> bean: 
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">page.size - number of items per page</li><li class="listitem">page.page - the page number, starting with 1</li><li class="listitem">page.sort - the property to be sorted by</li><li class="listitem">page.sort.dir - sort direction: asc or desc</li></ul></div><p>
       Often you not just want to paginate and sort data, but you also want to filter it, e.g. based on single property values or more complex conditions. Therefor Pustefix introduced the
       <code class="literal">org.pustefixframework.web.mvc.filter.Filter</code> interface. Filter parameters are also automatically bound, multiple parameters having the same name are interpreted as disjunction,
       different parameters as conjunction.
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">filter.foo=x</li><li class="listitem">filter.foo=y</li><li class="listitem">filter.bar=123</li></ul></div><p>
       The filter parameters above will result in a Filter data structure representing the logical expression <code class="literal">( foo=x OR foo=y ) AND bar=123</code>, i.e. by matching objects with 
       property <code class="literal">foo</code> set to <code class="literal">x</code> or <code class="literal">y</code> and property <code class="literal">bar</code> set to <code class="literal">123</code>. The default implementation supports
       checking an object candidate using the method <code class="literal">Filter.isSatisfiedBy(candidate)</code>.
     </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="modulessupport"></a>Chapter&nbsp;9.&nbsp;Module Support</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#modulessupport.types.new">9.1. Resources within library JARs</a></span></dt><dt><span class="section"><a href="#modulessupport.maven">9.2. Creating new modules using the Maven archetype</a></span></dt></dl></div><p>
      Modules allow you to share functionality, configuration options and view elements
      between different Pustefix applications.
    </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="modulessupport.types.new"></a>9.1.&nbsp;Resources within library JARs</h2></div></div></div><p>
          You can put resources into JAR files and make them available via the classpath.
          Such Pustefix modules can be normal JAR files, but must contain a special deployment descriptor,
          which has to be named <code class="filename">META-INF/pustefix-module.xml</code> in
          order to be recognized by Pustefix at build- and runtime. This deployment descriptor
          is a XML file with the following format:
        </p><pre class="programlisting"><span class="hl-tag">&lt;module-descriptor</span> 
  <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/module-descriptor"</span>
  <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.pustefix-framework.org/2008/namespace/module-descriptor
                      http://www.pustefix-framework.org/2008/namespace/module-descriptor.xsd"</span><span class="hl-tag">&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!--
    The module name is used to construct the path the resources will be extracted to.
    In this example the path would be modules/mytest/.
  --&gt;</em>  
  <span class="hl-tag">&lt;module-name&gt;</span>mytest<span class="hl-tag">&lt;/module-name&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!--
    Controls if module resources are editable via the CMS (if the module is loaded using
    the live mechanism). By default module resources are readonly.
  --&gt;</em>
  <span class="hl-tag">&lt;content-editable&gt;</span>true<span class="hl-tag">&lt;/content-editable&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!-- Here you can define which folders under PUSTEFIX-INF contain static webapp resources 
       and should be publicly available. The resources then can be accessed under the URL 
       path '/modules/[module-name]/[static-path]'. If you only want to grant access depending 
       on the application using the module, you can alternatively configure the static module 
       path in the project configuration.
  --&gt;</em>
  <span class="hl-tag">&lt;static&gt;</span>
    <span class="hl-tag">&lt;path&gt;</span>css<span class="hl-tag">&lt;/path&gt;</span>
    <span class="hl-tag">&lt;path&gt;</span>img<span class="hl-tag">&lt;/path&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- set i18n attribute to "true" for multitenancy/-language support --&gt;</em>
    <span class="hl-tag">&lt;path</span> <span class="hl-attribute">i18n</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>errorpages<span class="hl-tag">&lt;/path&gt;</span>
  <span class="hl-tag">&lt;/static&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!--
    Here you can define if your module should be part of the dynamic search chain.
    Using the priority attribute you can influence the search order (lower value 
    means higher priority, leaving out the attribute the default priority is 10)
  --&gt;</em>
  <span class="hl-tag">&lt;default-search</span> <span class="hl-attribute">priority</span>=<span class="hl-value">"5"</span><span class="hl-tag">&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- you can restrict dynamic search participation depending on a specific market 
         or language by specifying according filter-attributes --&gt;</em>
    <em class="hl-comment" style="color: silver">&lt;!--
    &lt;filter-attribute name="tenant" value="DE_market"/&gt;
    &lt;filter-attribute name="lang" value="de"/&gt;
    --&gt;</em>
  <span class="hl-tag">&lt;/default-search&gt;</span>

  <em class="hl-comment" style="color: silver">&lt;!--
    Here you can configure which resources from which other module should be
    overridden by your module (see "Dynamic resource resolution").
  --&gt;</em>
  <span class="hl-tag">&lt;override-modules&gt;</span>
    <em class="hl-comment" style="color: silver">&lt;!-- you can restrict overriding depending on a specific market or language 
         by specifying according filter-attributes --&gt;</em>
    <em class="hl-comment" style="color: silver">&lt;!--
    &lt;filter-attribute name="tenant" value="US_market"/&gt;
    &lt;filter-attribute name="lang" value="en"/&gt;
    --&gt;</em>
    <span class="hl-tag">&lt;module</span> <span class="hl-attribute">name</span>=<span class="hl-value">"modulename"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;resource</span> <span class="hl-attribute">path</span>=<span class="hl-value">"path/to/resource"</span><span class="hl-tag">/&gt;</span>
      ...
    <span class="hl-tag">&lt;/module&gt;</span>
    ...
  <span class="hl-tag">&lt;/override-modules&gt;</span>

<span class="hl-tag">&lt;/module-descriptor&gt;</span></pre><p>
    Resources placed in module jar files not only can be accessed via the classpath, but Pustefix also supports
    loading them using its resource abstraction layer. Therefor you have to place the resources in the <code class="literal">PUSTEFIX-INF</code> folder.
  </p><p>
    Referencing such module resources is done by specifying the originating module using the <code class="literal">module</code> attribute, which is supported
    by all according tags used on configuration or view level, e.g. <code class="literal">&lt;config-include/&gt;</code>, <code class="literal">&lt;pfx:include/&gt;</code>
    and <code class="literal">&lt;pfx:image/&gt;</code>.
    For details on how to reference module resources and how to override modules, see <a class="xref" href="#advanced.dyninclude" title="7.5.&nbsp;Dynamic resource inclusion">Section&nbsp;7.5, &#8220;Dynamic resource inclusion&#8221;</a>.
  </p><p>
    Statusmessages placed under <code class="literal">PUSTEFIX-INF/dyntxt</code> within a module jar are automatically merged to <code class="literal">src/main/webapp/modules-override/MODULENAME/dyntxt</code> (see also <a class="xref" href="#concepts.statuscodes" title="6.5.&nbsp;StatusCodes">Section&nbsp;6.5, &#8220;StatusCodes&#8221;</a>). You optionally can disable merging in the according plugin configuration and use dynamic resource lookup instead.
  </p><p>
    Static resources which should be publicly available/delivered by the server (e.g. resources referenced by HTML pages, like images, CSS or Javascript)
    can be made accessible by adding according <code class="literal">&lt;path/&gt;</code> entries to the <code class="literal">&lt;static/&gt;</code> section of the
    module descriptor. This is just a kind of whitelist saying which directories under <code class="literal">PUSTEFIX-INF</code> should be publicly available.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="modulessupport.maven"></a>9.2.&nbsp;Creating new modules using the Maven archetype</h2></div></div></div><p>
        Pustefix provides a Maven archetype, which can be used to create new modules. It sets up
        a maven project with pre-configured POM, deployment descriptor and statusmessage support.
      </p><pre class="screen">
mvn archetype:create \
-DarchetypeGroupId=org.pustefixframework.maven.archetypes \
-DarchetypeArtifactId=pustefix-archetype-module \
-DarchetypeVersion=0.16.5 \
-DgroupId=mytld.myorg.mysection \
-DartifactId=mymodule \
-Dversion=1.0  
      </pre><p>
        You have to supply your own values for the <code class="option">groupId</code>, <code class="option">artifactId</code>
        and <code class="option">version</code> parameters. The chosen <code class="option">artifactId</code> will be used as 
	default module and target folder name, the <code class="option">groupId</code> as Java package name. 
        The <code class="literal">archetypeVersion</code> should be replaced by the Pustefix version you're
        currently using.
        Executing the above command creates the following directory structure and artifacts: 
      </p><pre class="screen">
mymodule
mymodule/src
mymodule/src/main
mymodule/src/main/java
mymodule/src/main/java/mytld
mymodule/src/main/java/mytld/myorg
mymodule/src/main/java/mytld/myorg/mysection
mymodule/src/main/java/mytld/myorg/mysection/mymodule
mymodule/src/main/resources
mymodule/src/main/resources/META-INF
mymodule/src/main/resources/META-INF/pustefix-module.xml
mymodule/src/main/resources/PUSTEFIX-INF
mymodule/src/main/resources/PUSTEFIX-INF/dyntxt
mymodule/src/main/resources/PUSTEFIX-INF/dyntxt/statuscodeinfo.xml
mymodule/src/main/resources/PUSTEFIX-INF/dyntxt/statusmessages.xml
mymodule/pom.xml
      </pre><p>
        Building with <code class="literal">mvn clean package</code> creates a deployable Pustfix module. At the moment
        the only addition to the Maven standard build is the generation of StatusCode constant classes.
      </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="testing"></a>Chapter&nbsp;10.&nbsp;Testing</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#testing.unit">10.1. Unit testing</a></span></dt><dt><span class="section"><a href="#testing.integration">10.2. Integration testing</a></span></dt></dl></div><p>
      Since release 0.13 Pustefix applications are regular Spring applications. Thus the benefit from building
      IoC based applications also applies to Pustefix: you can either make isolated, container-independent unit tests of your POJOs, or you can make integration tests within the Spring container.
    </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testing.unit"></a>10.1.&nbsp;Unit testing</h2></div></div></div><p>
        Ideally your business logic is container and webframework-independent and you can test your components
	without any dependency to the Pustefix framework - unlike the view logic, which naturally depends on
        Pustefix framework classes.
      </p><p>
        The most frequently used Pustefix framework classes/interfaces are IWrappers, IHandlers and ContextResources.
      </p><p>
        In former Pustefix versions view logic objects collaborated using the Context object to programmatically retrieve
	the required references. Thus the objects were not only coupled to the Context object but also had implicit
	references to collaborating view objects.
      </p><p>
	Since release 0.13 you're recommended to wire your objects using Dependency Injection. So you often don't
        have a dependency to the Context object any more and the references to other objects are explicit.
        ContextResources implemented this way can be tested like other POJOs, in isolation and without providing
        a Context object.
      </p><p>
        But sometimes your ContextResource has to access the Context object (to call one of the various other methods)
	or you want to test an IHandler which still needs a Context object (passed as argument to the framework callback
	methods). If you want to test such an object in isolation, you can use a mock object that implements the Context
	interface.
      </p><p>
        The class <code class="classname">org.pustefixframework.test.MockContext</code> provides a very simple implementation of the Context interface.
        It doesn't really mimic the complex behaviour of the real implementation, but provides methods to set nearly all
	kind of state which can be accessed using this interface. It's intended to be used within isolated tests. Testing
	complex behaviour and object collaborations (like pageflow processing) has to be done as integration test using
	the real Context implementation.
      </p><p>
	The following example shows how you can test an IHandler, which uses a ContextResource to store data and will return true for <code class="literal">needsData</code> calls as long as no data has been submitted:
      </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AdultInfoHandlerTest {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testHandler() <span class="hl-keyword">throws</span> Exception {
        
        MockContext context = <span class="hl-keyword">new</span> MockContext();
        ContextAdultInfo info = <span class="hl-keyword">new</span> ContextAdultInfo();
        AdultInfoHandler handler = <span class="hl-keyword">new</span> AdultInfoHandler();
        handler.setContextAdultInfo(info);
        
        Assert.assertTrue(handler.needsData(context));
        
        AdultInfo iwrapper = <span class="hl-keyword">new</span> AdultInfo();
        iwrapper.init(<span class="hl-string">"info"</span>);
        iwrapper.setStringValAdult(<span class="hl-string">"false"</span>);
        iwrapper.loadFromStringValues();
             
        handler.handleSubmittedData(context, iwrapper);
        
        Assert.assertFalse(handler.needsData(context));
    
    }
    
}</pre><p>
      You programmatically create a MockContext and instances of the required IHandlers, IWrappers and ContextResources.
      Then you wire your objects using the according setters. The first assertion is made by checking the handler's <code class="literal">needsData</code>
      method passing the MockContext. Then the IWrapper is populated with data and passed as argument to the <code class="literal">handleSumittedData</code>
      method. After that an assertion is made to check if <code class="literal">needsData</code> is satisfied now.
    </p><p>
      The above example worked with an injected ContextResource. If you have to test classes with implicit ContextResource references, which are retrieved using the ContextResourceManager, you also have to mock the ContextResourceManager. Therefore Pustefix provides the <code class="classname">org.pustefixframework.test.MockContextResourceManager</code> class:
    </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AdultInfoHandlerTest {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testHandler() <span class="hl-keyword">throws</span> Exception {
        
        MockContext context = <span class="hl-keyword">new</span> MockContext();
        MockContextResourceManager resourceManager = <span class="hl-keyword">new</span> MockContextResourceManager();
        context.setContextResourceManager(resourceManager);

        ContextAdultInfo info = <span class="hl-keyword">new</span> ContextAdultInfo();
        resourceManager.addResource(info);
        
    }
    
}</pre><p>
      You have to create a MockContextResourceManager instance and set it at the MockContext object. Then you can create and add your ContextResource instances. 
    </p><p>
      The above example programmatically created an IWrapper instance and set String data, which was casted and checked calling <code class="literal">loadFromStringValues</code>. The following example shows how the population of an IWrapper itself can be tested:    
    </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TShirtWrapperTest {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testIWrapper() <span class="hl-keyword">throws</span> Exception {
        
        TShirt tshirt = <span class="hl-keyword">new</span> TShirt();   
        tshirt.init(<span class="hl-string">"shirt"</span>);
        tshirt.setStringValSize(<span class="hl-string">"MX"</span>);
        tshirt.loadFromStringValues();
        Assert.assertTrue(tshirt.errorHappened());
        IWrapperParam[] params = tshirt.gimmeAllParamsWithErrors();
        <span class="hl-keyword">for</span>(IWrapperParam param:params) {
            <span class="hl-keyword">if</span>(param.getName().equals(<span class="hl-string">"Color"</span>)) {
                Assert.assertSame(param.getStatusCodeInfos()[<span class="hl-number">0</span>].getStatusCode(), CoreStatusCodes.MISSING_PARAM);
            } <span class="hl-keyword">else</span> <span class="hl-keyword">if</span>(param.getName().equals(<span class="hl-string">"Size"</span>)) {
                Assert.assertSame(param.getStatusCodeInfos()[<span class="hl-number">0</span>].getStatusCode(), CoreStatusCodes.PRECHECK_REGEXP_NO_MATCH);
            }
        }

        tshirt.init(<span class="hl-string">"shirt"</span>);
        tshirt.setStringValSize(<span class="hl-string">"XL"</span>);
        tshirt.setStringValColor(<span class="hl-string">"1"</span>);
        tshirt.loadFromStringValues();
        Assert.assertFalse(tshirt.errorHappened());
        Assert.assertEquals(<span class="hl-number">1</span>, tshirt.getColor());

    }

}</pre><p>
      First we instantiate and populate the IWrapper. After calling <code class="literal">loadFromStringValues</code> an assertion is made
      to check if an error occurred. Then we iterate over all parameters and assert the expected statuscodes.
    </p><p>
      After that we're initializing the wrapper again, this time with valid values. Now we can check if the wrapper returns the
      correct values (after they have been checked and casted calling the <code class="literal">loadFromStringValues</code> method).
      If an error happened during casting or checking, the value won't be set and the according getter method will return <code class="literal">null</code>.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testing.integration"></a>10.2.&nbsp;Integration testing</h2></div></div></div><p>
        Pustefix applications are regular Spring applications, thus all the integration testing benefit provided
        by Spring is also available for Pustefix: e.g. the IoC container caching between test executions, DI of test fixtures, etc.
      </p><p>
	Pustefix supports Spring's TestContext framework by providing a custom ContextLoader implementation. The following example
	shows how you can use it to set up a (pre JUnit-4.4) test:
      </p><pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextConfiguration(loader=PustefixWebApplicationContextLoader.class,
                      locations={"file:projects/sample1/conf/project.xml","file:projects/sample1/conf/spring.xml"})</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest <span class="hl-keyword">extends</span> AbstractJUnit38SpringContextTests {
}</pre><p>
      You set up the Pustefix specific ApplicationContext by setting the loader attribute of the <code class="classname">org.springframework.test.context.ContextConfiguration</code> annotation to <code class="classname">org.pustefixframework.test.PustefixWebApplicationContextLoader</code>. Using the <code class="literal">locations</code> attribute you can set the location of the ApplicationContext's configuration files (normally <code class="literal">project.xml</code> and <code class="literal">spring.xml</code>).
    </p><p>
      In this example we use a JUnit version prior to 4.4. Therefor we have to derive an according Spring class. If you use JUnit 4.4 or newer you can alternatively set a Spring-specific Runner implementation using the JUnit <code class="literal">@RunWith</code> annotation.
    </p><pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration(loader=PustefixWebApplicationContextLoader.class,
                      locations={"file:projects/sample1/conf/project.xml","file:projects/sample1/conf/spring.xml"})</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
}</pre><p>
      Setting up your test this way, you can use Spring's autowiring to inject the required beans into your test class. The following example test uses a singleton scoped bean, which is automatically injected by its name using the <code class="literal">Autowired</code> and <code class="literal">Qualifier</code> annotations:
    </p><pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration(loader=PustefixWebApplicationContextLoader.class,
                      locations={"file:projects/sample1/conf/project.xml","file:projects/sample1/conf/spring.xml"})</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <em><span class="hl-annotation" style="color: gray">@Qualifier("global_testdata")</span></em>
    <span class="hl-keyword">private</span> TestData testData;
    
    <em><span class="hl-annotation" style="color: gray">@Test</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testBean() {
        Assert.assertEquals(testData.getText(), <span class="hl-string">"bar"</span>);
    }
    
}</pre><p>
      You aren't forced to use Spring's <code class="literal">TestContext</code> framework, alternatively you can manually use the Pustefix <code class="literal">ContextLoader</code> to create a <code class="literal">PustefixWebApplicationContext</code>, but you loose the benefit of context caching and dependency injection:
    </p><pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest <span class="hl-keyword">extends</span> TestCase {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testBean() {
        
        File docroot = <span class="hl-keyword">new</span> File(<span class="hl-string">"projects"</span>);
        PustefixWebApplicationContextLoader loader = <span class="hl-keyword">new</span> PustefixWebApplicationContextLoader(docroot);
        String[] locations = {<span class="hl-string">"pfixroot:/sample1/conf/spring.xml"</span>, <span class="hl-string">"pfixroot:/sample1/conf/project.xml"</span>};
        PustefixWebApplicationContext appContext = (PustefixWebApplicationContext) loader.loadContext(locations);
     
        TestData testData = (TestData)appContext.getBean(<span class="hl-string">"global_testdata"</span>);
        assertEquals(testData.getText(), <span class="hl-string">"bar"</span>);
        
    }
    
}</pre><p>
       Now follows a more advanced example, which shows how you can test HTTP requests and session scoped beans
       outside of the application server using mock objects. This example shows how to request a page and test the resulting HTML document:
    </p><pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextConfiguration(loader=PustefixWebApplicationContextLoader.class,
                      locations={"file:projects/sample1/conf/project.xml","file:projects/sample1/conf/spring.xml"})</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HomePageTest <span class="hl-keyword">extends</span> AbstractJUnit38SpringContextTests {
    
    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> ServletContext servletContext;
    
    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> PustefixContextXMLRequestHandler requestHandler;
    
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testPageRequest() <span class="hl-keyword">throws</span> Exception {
   
        MockHttpServletRequest req = <span class="hl-keyword">new</span> MockHttpServletRequest();
        req.setPathInfo(<span class="hl-string">"/home"</span>);
        req.setMethod(<span class="hl-string">"GET"</span>);
        MockHttpServletResponse res = <span class="hl-keyword">new</span> MockHttpServletResponse();
        MockHttpSession session = <span class="hl-keyword">new</span> MockHttpSession(servletContext);
        req.setSession(session);
        RequestContextHolder.setRequestAttributes(<span class="hl-keyword">new</span> ServletRequestAttributes(req));
        session.setAttribute(SessionHelper.SESSION_ID_URL, SessionHelper.getURLSessionId(req));
        
        requestHandler.handleRequest(req, res);
        Assert.assertTrue(res.getContentAsString().contains(<span class="hl-string">"&lt;title&gt;Pustefix Sample&lt;/title&gt;"</span>));
        
    }

}</pre><p>
      First we create a mock object for the <code class="literal">HttpServletRequest</code> and set the path to the requested page. Then we're creating an according <code class="literal">HttpServletResponse</code> mock object. Next we create an <code class="literal">HttpSession</code> mock object an set it at the request. At last we have to set the request at Spring's <code class="literal">RequestContextHolder</code> and a special session attribute.
    </p><p>
      Now we can call the <code class="literal">handleRequest</code> method at the injected <code class="classname">PustefixContextXMLRequestHandler</code>, passing the request and response objects as arguments. At last we're checking if the resulting
HTML from the <code class="literal">HttpServletResponse</code> contains the expected content.
    </p><p>
      The final example shows you how to test a pageflow by checking the collaborating <code class="literal">IHandlers</code> and <code class="literal">States</code>, <code class="literal">isAccessible</code> and <code class="literal">needsData</code> checks, submitting to handlers and checking of the <code class="literal">ResultDocument</code>:
    </p><pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextConfiguration(loader=PustefixWebApplicationContextLoader.class,
                      locations={"file:projects/sample1/conf/project.xml","file:projects/sample1/conf/spring.xml"})</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> OrderFlowTest <span class="hl-keyword">extends</span> AbstractJUnit38SpringContextTests {
    
    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> ServletContext servletContext;
    
    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> Context pustefixContext;
    
    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> OverviewState overviewState;
    
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testHandler() <span class="hl-keyword">throws</span> Exception {
        
        MockHttpServletRequest req = <span class="hl-keyword">new</span> MockHttpServletRequest();
        req.setPathInfo(<span class="hl-string">"/home"</span>);
        req.setMethod(<span class="hl-string">"GET"</span>);
        MockHttpSession session = <span class="hl-keyword">new</span> MockHttpSession(servletContext);
        req.setSession(session);
        RequestContextHolder.setRequestAttributes(<span class="hl-keyword">new</span> ServletRequestAttributes(req));
        PfixServletRequest pfxReq = <span class="hl-keyword">new</span> PfixServletRequestImpl(req,<span class="hl-keyword">new</span> Properties());
        ((ContextImpl)pustefixContext).prepareForRequest();
        ((ContextImpl)pustefixContext).setPfixServletRequest(pfxReq);
        
        Assert.assertFalse(overviewState.isAccessible(pustefixContext, pfxReq));
        AdultInfoHandler handler = (AdultInfoHandler)applicationContext.getBean(AdultInfoHandler.<span class="hl-keyword">class</span>.getName()+<span class="hl-string">"#home#info"</span>);
        Assert.assertTrue(handler.needsData(pustefixContext));
        
        AdultInfo adultInfo = <span class="hl-keyword">new</span> AdultInfo();
        adultInfo.init(<span class="hl-string">"info"</span>);
        adultInfo.setStringValAdult(<span class="hl-string">"false"</span>);
        adultInfo.loadFromStringValues();
        handler.handleSubmittedData(pustefixContext, adultInfo);
        
        TShirtHandler tshirtHandler = (TShirtHandler)applicationContext.getBean(TShirtHandler.<span class="hl-keyword">class</span>.getName()+<span class="hl-string">"#order#shirt"</span>);
        TShirt tshirt = <span class="hl-keyword">new</span> TShirt();
        tshirt.init(<span class="hl-string">"shirt"</span>);
        tshirt.setStringValColor(<span class="hl-string">"3"</span>);
        tshirt.setStringValSize(<span class="hl-string">"XL"</span>);
        tshirt.setStringValFeature(<span class="hl-keyword">new</span> String[] {<span class="hl-string">"0"</span>,<span class="hl-string">"1"</span>,<span class="hl-string">"2"</span>});
        tshirt.loadFromStringValues();
        tshirtHandler.handleSubmittedData(pustefixContext, tshirt);
        Assert.assertTrue(overviewState.isAccessible(pustefixContext, pfxReq));
        
        ResultDocument resDoc = overviewState.getDocument(pustefixContext, pfxReq);
        Document doc = resDoc.getSPDocument().getDocument();
        Node expNode = XMLUtils.parse(<span class="hl-string">"&lt;adultinfo adult=\"false\"/&gt;"</span>).getDocumentElement();
        XmlAssert.assertEquals(expNode, doc.getElementsByTagName(<span class="hl-string">"adultinfo"</span>).item(<span class="hl-number">0</span>));
    }
}</pre><p>
      You have to be aware that some beans, e.g. <code class="literal">States</code>, require that the Context has set a current pagerequest 
      and that the Context is prepared (meaning that some ThreadLocal initialization is done). So you can't just reference an arbitrary 
      bean in the midst of the processing lifecycle and expect it to work outside of this lifecycle. Testing States at the moment requires
      a cast to its implementation class and some initialization (as shown in this example). But this can be subject to change in future Pustefix
      versions.
    </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="tooling"></a>Chapter&nbsp;11.&nbsp;Tooling</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#tooling.pfxinternals">11.1. Pustefix internals page</a></span></dt><dt><span class="section"><a href="#tooling.specialparams">11.2. Special parameters for development</a></span></dt><dt><span class="section"><a href="#tooling.mavenplugins">11.3. Maven plugins</a></span></dt><dd><dl><dt><span class="section"><a href="#tooling.mavenplugins.generate.xsl">11.3.1. Pustefix XSL Generate Plugin</a></span></dt><dt><span class="section"><a href="#tooling.mavenplugins.pagelist">11.3.2. Pustefix Pagelist Plugin</a></span></dt></dl></dd></dl></div><p>
    </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tooling.pfxinternals"></a>11.1.&nbsp;Pustefix internals page</h2></div></div></div><p>
        The Pustefix internals page provides some useful information for application developers (e.g. about configuration and status 
        of the system, the JVM and Pustefix itself). You can additionally find some useful links triggering actions like scheduling a
        webapp reload or invalidating all sessions.
      </p><p>
        The page is only available at development time and can be accessed under the URL path <code class="literal">/pfxinternals</code> (the 
        <code class="literal">&lt;pfx:editconsole/&gt;</code> contains an according link too). On the different tabs you can find the following information:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="emphasis"><em>Framework:</em></span> Pustefix version and related links</li><li class="listitem"><span class="emphasis"><em>Environment:</em></span> Pustefix environment and system properties</li></ul></div><div class="figure"><a name="tooling.pfxinternals.framework"></a><p class="title"><b>Figure&nbsp;11.1.&nbsp;Pustefix internals - Framework information</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/reference/pfxinternals-framework.png" alt="Pustefix internals - Framework information"></div></div></div><br class="figure-break"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="emphasis"><em>JVM:</em></span> JVM information and statistics, e.g. memory usage and garbage collection</li><li class="listitem"><span class="emphasis"><em>System:</em></span> Basic system information, like memory usage and CPU load</li></ul></div><div class="figure"><a name="tooling.pfxinternals.jvm"></a><p class="title"><b>Figure&nbsp;11.2.&nbsp;Pustefix internals - JVM information</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/reference/pfxinternals-jvm.png" alt="Pustefix internals - JVM information"></div></div></div><br class="figure-break"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="emphasis"><em>Cache:</em></span> XSL caching statistics</li><li class="listitem"><span class="emphasis"><em>Modules:</em></span> Loaded Pustefix modules</li><li class="listitem"><span class="emphasis"><em>Targets:</em></span> XSL target dependency visualization, list of available XSL templates</li></ul></div><div class="figure"><a name="tooling.pfxinternals.targets"></a><p class="title"><b>Figure&nbsp;11.3.&nbsp;Pustefix internals - Target generator information</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/reference/pfxinternals-targets.png" alt="Pustefix internals - Target generator information"></div></div></div><br class="figure-break"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="emphasis"><em>Search:</em></span> Full text search of files within webapp, modules and classpath</li></ul></div><div class="figure"><a name="tooling.pfxinternals.search"></a><p class="title"><b>Figure&nbsp;11.4.&nbsp;Pustefix internals - Full text search</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/reference/pfxinternals-search.png" alt="Pustefix internals - Full text search"></div></div></div><br class="figure-break"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="emphasis"><em>Actions:</em></span> List of available actions, e.g. webapp or target generator reload, session invalidation, etc.</li><li class="listitem"><span class="emphasis"><em>Message:</em></span> Message board showing results of last triggered actions</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tooling.specialparams"></a>11.2.&nbsp;Special parameters for development</h2></div></div></div><p>
        Pustefix supports some special parameters triggering special behaviour/functions useful during development:
      </p><div class="table"><a name="d0e9742"></a><p class="title"><b>Table&nbsp;11.1.&nbsp;Special parameters for development</b></p><div class="table-contents"><table rules="all" frame="box"><thead><tr>
            <th>Name</th>
            <th>Value</th>
            <th>Description</th>
          </tr></thead><tbody><tr>
            <td>__xmlonly</td>
            <td>1|2|3</td>
            <td>Adding this parameter to an URL the page isn't rendered, but the originating DOM tree model is displayed. 
                Setting the value to <code class="literal">1</code> the last DOM tree plus some additional data about the application state is rendered as HTML.
                Setting the value to <code class="literal">2</code> the pure XML is returned (always creating a new DOM tree for the current page).
                Setting the value to <code class="literal">3</code> the pure XML of the last DOM tree is returned.</td>
          </tr><tr>
            <td>__staticdom</td>
            <td>-</td>
            <td>Adding this parameter to an URL the page is rendered using the default DOM tree as created by the default <code class="literal">State</code> implementation.
                Not using the designated <code class="literal">State</code> can be useful for debugging, e.g. when the page isn't reachable because of pageflow or 
                exception issues.</td>
          </tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tooling.mavenplugins"></a>11.3.&nbsp;Maven plugins</h2></div></div></div><p>Pustefix provides various Maven plugins, e.g. for generating code (IWrapper beans, Status code constants), for generating 
             all pages of the view (XSL stylesheets) and other optional plugins.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="tooling.mavenplugins.generate.xsl"></a>11.3.1.&nbsp;Pustefix XSL Generate Plugin</h3></div></div></div><p>This plugin generates the XSL stylesheets for all pages. It's useful for finding XSL errors before releasing and rolling out on production systems,
                additionally pre-generating the pages reduces the time initially spent when rendering a page for the first time.</p><p>The plugin also makes a simple analysis of the generated XSL files, e.g. detecting abnormally big XSL files potentially having
                bad impact on memory and performance (a summary is output at the end of the plugin execution).</p><pre class="programlisting">      <span class="hl-tag">&lt;plugin&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>org.pustefixframework.maven.plugins<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>pustefix-generate-plugin<span class="hl-tag">&lt;/artifactId&gt;</span>
        <span class="hl-tag">&lt;version&gt;</span>${pustefix.version}<span class="hl-tag">&lt;/version&gt;</span>
        <span class="hl-tag">&lt;executions&gt;</span>
          <span class="hl-tag">&lt;execution&gt;</span>
            <span class="hl-tag">&lt;goals&gt;</span>
              <span class="hl-tag">&lt;goal&gt;</span>generate<span class="hl-tag">&lt;/goal&gt;</span>
            <span class="hl-tag">&lt;/goals&gt;</span>
          <span class="hl-tag">&lt;/execution&gt;</span>
        <span class="hl-tag">&lt;/executions&gt;</span>
      <span class="hl-tag">&lt;/plugin&gt;</span></pre><p>The plugin usage can be customized using the following configuration options:</p><pre class="programlisting">      <span class="hl-tag">&lt;configuration&gt;</span>
        <span class="hl-tag">&lt;docroot&gt;</span>${basedir}/src/main/webapp<span class="hl-tag">&lt;/docroot&gt;</span> <em class="hl-comment" style="color: silver">&lt;!-- The document root directory. Default: src/main/webapp --&gt;</em>
        <span class="hl-tag">&lt;parallel&gt;</span>true<span class="hl-tag">&lt;/parallel&gt;</span> <em class="hl-comment" style="color: silver">&lt;!-- Generate page XSLs in parallel using one thread per CPU core. Default: false --&gt;</em>
        <span class="hl-tag">&lt;cleanup&gt;</span>false<span class="hl-tag">&lt;/cleanup&gt;</span> <em class="hl-comment" style="color: silver">&lt;!-- Remove intermediate output files after page XSLs are created. Default: true --&gt;</em>
        <span class="hl-tag">&lt;maxPageSize&gt;</span>10m<span class="hl-tag">&lt;/maxPageSize&gt;</span> <em class="hl-comment" style="color: silver">&lt;!-- The maximum size of a generated page XSL file. Default: not set --&gt;</em>
        <span class="hl-tag">&lt;maxPageSizeIgnore&gt;</span>myfile.xsl afile.xsl<span class="hl-tag">&lt;/maxPageSizeIgnore&gt;</span> <em class="hl-comment" style="color: silver">&lt;!-- XSL files to ignore when checking the maximum size. --&gt;</em>
        <span class="hl-tag">&lt;maxTotalPageSize&gt;</span>0.5g<span class="hl-tag">&lt;/maxTotalPageSize&gt;</span> <em class="hl-comment" style="color: silver">&lt;!-- Maximum total size of all generated page XSL files. Default: not set --&gt;</em>
      <span class="hl-tag">&lt;/configuration&gt;</span></pre><p>
          The plugin will abort the build, if there are exceptions during the XSL page generation or configured maximum values are exceeded. 
        </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="tooling.mavenplugins.pagelist"></a>11.3.2.&nbsp;Pustefix Pagelist Plugin</h3></div></div></div><p>This plugin generates a complete list with the display names of all renderable pages (respecting alias names, page alternatives, languages and tenants).</p><p>By default the plugin will be bound to the <code class="literal">generate-test-resources</code> phase and will write the pagelist to 
                <code class="literal">target/generated-test-resources</code>.</p><pre class="programlisting">      <span class="hl-tag">&lt;plugin&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>org.pustefixframework.maven.plugins<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>pustefix-pagelist-plugin<span class="hl-tag">&lt;/artifactId&gt;</span>
        <span class="hl-tag">&lt;version&gt;</span>${pustefix.version}<span class="hl-tag">&lt;/version&gt;</span>
        <span class="hl-tag">&lt;executions&gt;</span>
          <span class="hl-tag">&lt;execution&gt;</span>
            <span class="hl-tag">&lt;goals&gt;</span>
              <span class="hl-tag">&lt;goal&gt;</span>generate<span class="hl-tag">&lt;/goal&gt;</span>
            <span class="hl-tag">&lt;/goals&gt;</span>
          <span class="hl-tag">&lt;/execution&gt;</span>
        <span class="hl-tag">&lt;/executions&gt;</span>
      <span class="hl-tag">&lt;/plugin&gt;</span></pre><p>The plugin usage can be customized using the following configuration options (here showing the default values):</p><pre class="programlisting">      <span class="hl-tag">&lt;configuration&gt;</span>
        <span class="hl-tag">&lt;docroot&gt;</span>${basedir}/src/main/webapp<span class="hl-tag">&lt;/docroot&gt;</span>
        <span class="hl-tag">&lt;mode&gt;</span>prod<span class="hl-tag">&lt;/mode&gt;</span>
        <span class="hl-tag">&lt;outputDirectory&gt;</span>${project.build.directory}/generated-test-resources<span class="hl-tag">&lt;/outputDirectory&gt;</span>
      <span class="hl-tag">&lt;/configuration&gt;</span></pre></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="upgrade"></a>Chapter&nbsp;12.&nbsp;Upgrading to a newer Pustefix version</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#upgrade.0_18_to_0_19">12.1. Upgrading from Pustefix 0.18 to 0.19</a></span></dt><dd><dl><dt><span class="section"><a href="#upgrade.0_18_to_0_19.dependencies">12.1.1. Library dependencies</a></span></dt></dl></dd><dt><span class="section"><a href="#upgrade.0_17_to_0_18">12.2. Upgrading from Pustefix 0.17 to 0.18</a></span></dt><dd><dl><dt><span class="section"><a href="#upgrade.0_17_to_0_18.depend_xml">12.2.1. depend.xml</a></span></dt></dl></dd><dt><span class="section"><a href="#upgrade.0_16_to_0_17">12.3. Upgrading from Pustefix 0.16 to 0.17</a></span></dt><dt><span class="section"><a href="#upgrade.0_15_to_0_16">12.4. Upgrading from Pustefix 0.15 to 0.16</a></span></dt><dd><dl><dt><span class="section"><a href="#upgrade.0_15_to_0_16.web_xml">12.4.1. web.xml</a></span></dt><dt><span class="section"><a href="#upgrade.0_15_to_0_16.project_xml">12.4.2. project.xml</a></span></dt><dt><span class="section"><a href="#upgrade.0_15_to_0_16.depend_xml">12.4.3. depend.xml</a></span></dt><dt><span class="section"><a href="#upgrade.0_15_to_0_16.taglib">12.4.4. Tag library</a></span></dt><dt><span class="section"><a href="#upgrade.0_15_to_0_16.modules">12.4.5. Modules</a></span></dt><dt><span class="section"><a href="#upgrade.0_15_to_0_16.sessions">12.4.6. Session handling</a></span></dt><dt><span class="section"><a href="#upgrade.0_15_to_0_16.webservices">12.4.7. AJAX webservices</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="upgrade.0_18_to_0_19"></a>12.1.&nbsp;Upgrading from Pustefix 0.18 to 0.19</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade.0_18_to_0_19.dependencies"></a>12.1.1.&nbsp;Library dependencies</h3></div></div></div><p>
        Pustefix 0.19 itself is completely backwards compatible, i.e. neither API, behaviour, configuration or XSL templates have changed.
        But some of its dependencies on other Java libraries have changed. 
      </p><p>
        The main change is the upgrade to Spring 4, i.e. if your application is relying on the transitive Maven dependencies of Pustefix, it
        will get Spring 4 after the upgrade too. If your application requires an older version of Spring, it has to explicitely specify
        an alternative version in its Maven POM now.
      </p><p>
        Another dependency change, that possibly affects your application, is the removal of the Apache ORO library. The library was used for
        regular expression checks in IWrappers and was replaced by using the JDK standard library. While Apache ORO regular expressions only slightly
        differ from the JDK ones, and Pustefix automatically tries to convert them on the fly, there's still a small chance that you're using
        some special expression which isn't compatible or can't be converted correctly.
      </p><p>
        To support you in finding these incompatible regular expressions, Pustefix, since version 0.18.64, checks regular expressions in IWrappers 
        for compatibility and logs if they can't be converted or behave different. Just search your application's <code class="literal">pustefix-servlet.log</code> for 
        occurrences of <code class="literal">INCOMPATIBLE_REGEX</code> (different result) or <code class="literal">REGEX_ERROR</code> (conversion error) to fix them manually
        (you should ensure first, that Log4J is configured accordingly, i.e. that warnings from logger 
        <code class="literal">de.schlund.pfixcore.generator.prechecks.RegexpCheck</code> are really logged).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="upgrade.0_17_to_0_18"></a>12.2.&nbsp;Upgrading from Pustefix 0.17 to 0.18</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade.0_17_to_0_18.depend_xml"></a>12.2.1.&nbsp;depend.xml</h3></div></div></div><p>
        With Pustefix 0.18 the navigation tree in <code class="literal">depend.xml</code> became obsolete. You should completely remove the
        <code class="literal">&lt;navigation&gt;</code> element and its content. If you still need a declarative page structure available during
        the XSL transformations, you can alternatively move the child elements of <code class="literal">&lt;navigation&gt;</code> into an own
        file called <code class="literal">sitemap.xml</code> under the <code class="literal">&lt;sitemap&gt;</code> root tag 
        (see <a class="xref" href="#configuration.sitemap" title="4.3.4.&nbsp;Sitemap configuration">Section&nbsp;4.3.4, &#8220;Sitemap configuration&#8221;</a>).
      </p><p> 
        Making the navigation tree obsolete, the XSL parameter <code class="literal">$navitree</code> was also removed. If you're application's
        providing a <code class="literal">sitemap.xml</code> file, you can reference its content instead by using the new XSL parameter
        <code class="literal">$sitemap</code>. Without a <code class="literal">sitemap.xml</code> the parameter value will be empty.
      </p><p>
        If you didn't use the navigation tree within you XSL transformations you can remove the navigation without substitution because
        Pustefix itself doesn't need it any longer.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="upgrade.0_16_to_0_17"></a>12.3.&nbsp;Upgrading from Pustefix 0.16 to 0.17</h2></div></div></div><p>
      Pustefix 0.17 should be fully backwards compatible with 0.16. But the new render include mechanism required massive refactoring of
      the core XSL templates to make them independent of the page parameter on the master and metatags transformation levels. So you should
      invest some time into QA and especially check if buttons and links work as expected.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="upgrade.0_15_to_0_16"></a>12.4.&nbsp;Upgrading from Pustefix 0.15 to 0.16</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade.0_15_to_0_16.web_xml"></a>12.4.1.&nbsp;web.xml</h3></div></div></div><p>
        With Pustefix 0.16 URLs referencing pages no longer contain the <code class="literal">/xml/xyz</code> path prefix. Thus the according servlet
        mappings in <code class="literal">src/main/webapp/WEB-INF/web.xml</code> became obsolete. You can remove all <code class="literal">&lt;servlet-mapping/&gt;</code>
        elements containing an <code class="literal">&lt;url-pattern&gt;</code> starting with <code class="literal">/xml</code>.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade.0_15_to_0_16.project_xml"></a>12.4.2.&nbsp;project.xml</h3></div></div></div><p>
        In Pustefix 0.16 URL paths no longer start with <code class="literal">/xml/xyz</code>. You should adapt the according path configurations
        in <code class="literal">src/main/webapp/WEB-INF/project.xml</code>.
        Within the <code class="literal">&lt;application/&gt;</code> section you can remove the according path configurations:
        the <code class="literal">&lt;default-path&gt;</code> element and 
        the <code class="literal">&lt;path/&gt;</code> elements beneath <code class="literal">&lt;context-xml-service/&gt;</code>,
        <code class="literal">&lt;direct-output-service/&gt;</code> and <code class="literal">&lt;deref-service/&gt;</code> (if available).
      </p><p>
        The <code class="literal">&lt;additional-trail-info&gt;</code> element now is optional. If missing, Pustefix by default registers
        the default <code class="literal">AdditionalTrailInfo</code> implementation <code class="literal">org.pustefixframework.http.DefaultAdditionalTrailInfoImpl</code>.
        You have to be aware that the package name of the interface and the implementation changed from <code class="literal">de.schlund.pfixxml.perflogging</code>
        to <code class="literal">org.pustefixframework.http</code>. You either will have to adapt the package names, or if you're relying on
        the default implementation, you can just remove the complete <code class="literal">&lt;additional-trail-info/&gt;</code> element.
      </p><p>
        The elements <code class="literal">&lt;perflogging&gt;</code> and <code class="literal">&lt;testrecording&gt;</code> became obsolete because the 
        performance logging and testrecording mechanisms are no longer 
        part of the Pustefix core framework. You can just remove these elements. The <code class="literal">&lt;authadmin&gt;</code> element is also no 
        longer supported and should be removed.
      </p><p>
        If you're referencing a XML schema, you can change the schema location to
        <code class="literal">http://www.pustefix-framework.org/2008/namespace/project-config-0_16.xsd</code> to get an updated version.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade.0_15_to_0_16.depend_xml"></a>12.4.3.&nbsp;depend.xml</h3></div></div></div><p>
        With Pustefix 0.16 URLs of all kind of pages (dynamic, directoutput) are directly served under the servlet context without using an additional
        path prefix. Therefore every page requires a unique name. If you use the same page name multiple times, e.g. for normal and directoutput pages,
        you will have to rename it making it unique.
      </p><p>
        No longer requiring a path prefix for pages, you can remove all <code class="literal">handler</code> attributes from the
        <code class="literal">&lt;page/&gt;</code> elements within the <code class="literal">&lt;navigation/&gt;</code> section.
      </p><p>
        If you're referencing a XML schema, you can change the schema location to
        <code class="literal">http://www.pustefix-framework.org/2008/namespace/xml-generator-config-0_16.xsd</code>
        to get an updated version.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade.0_15_to_0_16.taglib"></a>12.4.4.&nbsp;Tag library</h3></div></div></div><p>
        The <code class="literal">&lt;pfx:image/&gt;</code> tag behaviour changed when used within XML includes coming from modules. Without specifying
        a module using the <code class="literal">module</code> attribute, the image source now is searched within the module itself instead of the
        webapp. You either have to add the <code class="literal">search="dynamic"</code> attribute to look up the image in the webapp before trying to
        get it from the module or you can set the <code class="literal">module</code> attribute to the special value <code class="literal">WEBAPP</code> to force
        getting it from the webapp.  
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade.0_15_to_0_16.modules"></a>12.4.5.&nbsp;Modules</h3></div></div></div><p>
        Pustefix 0.16 no longer extracts resources from modules (the former <code class="literal">resource-mappings</code> from the Pustefix module
        descriptor are ignored now). Pustefix itself meanwhile can load every type of required resource directly from the module Jar files.
        If your application code directly accesses extracted resources, e.g. using <code class="literal">java.io.File</code>, you will have to change
        this and switch over to loading the resources via the classpath, ServletContext or Pustefix's resource abstraction layer.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade.0_15_to_0_16.sessions"></a>12.4.6.&nbsp;Session handling</h3></div></div></div><p>
        Since 0.16 Pustefix supports different session tracking strategies, whereas the new cookie based approach became the default strategy.
        Although Pustefix tries to make session id handling transparent to the application by hiding it in its core templates and internal code,
        there are use cases where applications directly access the session id, e.g. for creating links without using the core tags.
      </p><p>
      	Because URL rewriting of the session id now by default is only done if the client disabled cookies, you will have to adapt code, which
        manually creates session-aware links. You should only include the session id, if necessary. Therefore Pustefix introduced two new 
        XSL parameters: <code class="literal">__sessionId</code>, which is always set to the current session id, and <code class="literal">__sessionIdPath</code>, which
        is set to the path extension for the session on demand , e.g. <code class="literal">;jsessionid=xyz</code>. The <code class="literal">__sessionIdPath</code> parameter
        will be empty if the session id came from a cookie. Thus you can easily create session-aware URLs by just adding the value to your URL
        without having to take care if cookies are enabled or not.
      </p><p>
        The XSL parameter <code class="literal">__sessid</code> was removed as its contract doesn't exactly match one of the new parameters. You will have to
        replace it according to your requirements using one the new ones.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade.0_15_to_0_16.webservices"></a>12.4.7.&nbsp;AJAX webservices</h3></div></div></div><p>
        The JSON and SOAP Javascript libraries were moved from the Pustefix core module to the Pustefix webservice modules.
        If your application uses these libraries, you will have to adapt the according <code class="literal">script</code> tags, replacing
        <code class="literal">pustefix-core</code> by <code class="literal">pustefix-webservices-jaxws</code> or <code class="literal">pustefix-webservices-jsonws</code>,
        e.g.
</p><pre class="programlisting"><span class="hl-tag">&lt;script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span> <span class="hl-attribute">src</span>=<span class="hl-value">"{$__contextpath}/modules/pustefix-core/script/webservice.js"</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;/script&gt;</span>
<span class="hl-tag">&lt;script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span> <span class="hl-attribute">src</span>=<span class="hl-value">"{$__contextpath}/modules/pustefix-core/script/webservice_json.js"</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;/script&gt;</span></pre><p>
        has to be changed to:
</p><pre class="programlisting"><span class="hl-tag">&lt;script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span> <span class="hl-attribute">src</span>=<span class="hl-value">"{$__contextpath}/modules/pustefix-webservices-jaxws/script/webservice.js"</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;/script&gt;</span>
<span class="hl-tag">&lt;script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span> <span class="hl-attribute">src</span>=<span class="hl-value">"{$__contextpath}/modules/pustefix-webservices-jsonws/script/webservice_json.js"</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;/script&gt;</span></pre><p>
      </p><p>
        Generated Javascript SOAP stubs aren't delivered statically any longer, i.e. you also have to use the <code class="literal">pfx:wsscript</code> tag
        to include the stub file (instead of statically referencing it), e.g.
</p><pre class="programlisting"><span class="hl-tag">&lt;script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span> <span class="hl-attribute">src</span>=<span class="hl-value">"{$__contextpath}/xml/wsscript/MyService.js"</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;/script&gt;</span></pre><p>
        has to be changed to:
</p><pre class="programlisting"><span class="hl-tag">&lt;pfx:wsscript</span> <span class="hl-attribute">name</span>=<span class="hl-value">"MyService"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"soap"</span><span class="hl-tag">/&gt;</span></pre><p>
        The <code class="literal">type</code> attribute only is required if you enabled multiple webservice protocols for the service within the configuration.
      </p><p>
        If you manually build webservice URLs, e.g. if you don't want to use the generated stubs, you have to be aware that the request path no
        longer contains the <code class="literal">xml</code> part, e.g. you will have to change <code class="literal">http://anyhost/xml/webservice/MyService</code> to
        <code class="literal">http://anyhost/webservice/MyService</code>.
      </p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="newsarchive"></a>Chapter&nbsp;13.&nbsp;What's new (coming from the preceding release line)</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#news.0_15_6">13.1. What's new in Pustefix 0.15.6</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_15_6.modules">13.1.1. Module enhancements</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_15_7">13.2. What's new in Pustefix 0.15.7</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_15_7.modules">13.2.1. Module enhancements</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_15_11">13.3. What's new in Pustefix 0.15.11</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_15_11.config">13.3.1. Configuration system enhancements</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_15_13">13.4. What's new in Pustefix 0.15.13</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_15_13.config">13.4.1. Module/configuration enhancements</a></span></dt><dt><span class="section"><a href="#news.0_15_13.tooling">13.4.2. Tooling enhancements</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_15_14">13.5. What's new in Pustefix 0.15.14</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_15_14.iwrapper">13.5.1. IWrapper enhancements</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_15_17">13.6. What's new in Pustefix 0.15.17</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_15_17.modules">13.6.1. Module enhancements</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_16_0">13.7. What's new in Pustefix 0.16.0</a></span></dt><dt><span class="section"><a href="#news.0_16_5">13.8. What's new in Pustefix 0.16.5</a></span></dt><dt><span class="section"><a href="#news.0_17_0">13.9. What's new in Pustefix 0.17.0</a></span></dt><dt><span class="section"><a href="#news.0_18_0">13.10. What's new in Pustefix 0.18.0</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_0.multitenancy">13.10.1. Multi-tenancy</a></span></dt><dt><span class="section"><a href="#news.0_18_0.multilanguage">13.10.2. Multi-language</a></span></dt><dt><span class="section"><a href="#news.0_18_0.sitemap">13.10.3. Sitemap and i18n pagenames</a></span></dt><dt><span class="section"><a href="#news.0_18_0.pagealt">13.10.4. Page alternatives</a></span></dt><dt><span class="section"><a href="#news.0_18_0.modules">13.10.5. Pustefix modules</a></span></dt><dt><span class="section"><a href="#news.0_18_0.autoconfig">13.10.6. Automatic configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_2">13.11. What's new in Pustefix 0.18.2</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_2.xslterrors">13.11.1. Context information for XSLT errors</a></span></dt><dt><span class="section"><a href="#news.0_18_2.xslttooling">13.11.2. Switchable XSLT tooling extensions</a></span></dt><dt><span class="section"><a href="#news.0_18_2.sitemap">13.11.3. Search-engine sitemap generation</a></span></dt><dt><span class="section"><a href="#news.0_18_2.pagealts">13.11.4. Direct page alternative linking</a></span></dt><dt><span class="section"><a href="#news.0_18_2.oxm">13.11.5. OXM support for BigDecimal and BigInteger</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_5">13.12. What's new in Pustefix 0.18.5</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_5.cmis">13.12.1. CMIS support</a></span></dt><dt><span class="section"><a href="#news.0_18_5.pagealiases">13.12.2. Page aliases</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_6">13.13. What's new in Pustefix 0.18.6</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_6.xslt">13.13.1. Include part existence check</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_7">13.14. What's new in Pustefix 0.18.7</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_7.sitemap">13.14.1. Custom sitemap attributes</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_9">13.15. What's new in Pustefix 0.18.9</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_9.logging">13.15.1. Log directory configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_13">13.16. What's new in Pustefix 0.18.13</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_13.xslt">13.16.1. Getting environment properties from within XSLT</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_14">13.17. What's new in Pustefix 0.18.14</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_14.session">13.17.1. External session invalidation synchronization support</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_27">13.18. What's new in Pustefix 0.18.27</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_27.contextresources">13.18.1. Global output resources</a></span></dt><dt><span class="section"><a href="#news.0_18_27.sessiontracking">13.18.2. Cookie-only session tracking</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_29">13.19. What's new in Pustefix 0.18.29</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_29.renderextensions">13.19.1. Contextual render includes</a></span></dt><dt><span class="section"><a href="#news.0_18_29.xslt">13.19.2. XSL parameters within include parameter XPath expressions</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_30">13.20. What's new in Pustefix 0.18.30</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_30.oxm">13.20.1. Object-to-XML mapping with JAXB</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_31">13.21. What's new in Pustefix 0.18.31</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_31.pfxinternals">13.21.1. TargetGenerator tooling extensions toggle</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_34">13.22. What's new in Pustefix 0.18.34</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_34.includeparams">13.22.1. Extended include parameter support</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_35">13.23. What's new in Pustefix 0.18.35</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_35.logging">13.23.1. Early logging configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_38">13.24. What's new in Pustefix 0.18.38</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_38.pfxinternals">13.24.1. Full text search</a></span></dt><dt><span class="section"><a href="#news.0_18_38.sitemap">13.24.2. Default page alternatives</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_39">13.25. What's new in Pustefix 0.18.39</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_39.xslt">13.25.1. Setting pfx:button page at runtime</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_42">13.26. What's new in Pustefix 0.18.42</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_42.multitenancy">13.26.1. Multitenancy/-language support for static resources</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_59">13.27. What's new in Pustefix 0.18.59</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_59.tooling">13.27.1. Rendering pages with static DOM tree during development</a></span></dt><dt><span class="section"><a href="#news.0_18_59.xslt">13.27.2. Added XSL extension elements for logging and debugging</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_63">13.28. What's new in Pustefix 0.18.63</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_63.xslt">13.28.1. Instance level XSLT extension functions</a></span></dt><dt><span class="section"><a href="#news.0_18_63.urls">13.28.2. Preserving parameters on redirect</a></span></dt><dt><span class="section"><a href="#news.0_18_63.includes">13.28.3. Reflective include information</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_64">13.29. What's new in Pustefix 0.18.64</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_64.iwrapper">13.29.1. Support standard Java regular expressions in IWrapper checks</a></span></dt><dt><span class="section"><a href="#news.0_18_64.multitenancy">13.29.2. Support multitenant property configuration</a></span></dt><dt><span class="section"><a href="#news.0_18_64.tooling">13.29.3. Configurable result DOM viewing</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_70">13.30. What's new in Pustefix 0.18.70</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_70.aliases">13.30.1. Page alias names with slashes</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_71">13.31. What's new in Pustefix 0.18.71</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_71.spring">13.31.1. Environment-dependent Spring property files</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_18_87">13.32. What's new in Pustefix 0.18.87</a></span></dt><dd><dl><dt><span class="section"><a href="#news.0_18_87.xslt">13.32.1. New XPath string functions using pattern matching</a></span></dt></dl></dd><dt><span class="section"><a href="#news.0_19_0">13.33. What's new in Pustefix 0.19.0</a></span></dt><dt><span class="section"><a href="#news.0_19_4">13.34. What's new in Pustefix 0.19.4</a></span></dt><dt><span class="section"><a href="#news.0_19_8">13.35. What's new in Pustefix 0.19.8</a></span></dt><dt><span class="section"><a href="#news.0_19_9">13.36. What's new in Pustefix 0.19.9</a></span></dt><dt><span class="section"><a href="#news.0_19_11">13.37. What's new in Pustefix 0.19.11</a></span></dt><dt><span class="section"><a href="#news.0_19_14">13.38. What's new in Pustefix 0.19.14</a></span></dt><dt><span class="section"><a href="#news.0_19_15">13.39. What's new in Pustefix 0.19.15</a></span></dt><dt><span class="section"><a href="#news.0_19_17">13.40. What's new in Pustefix 0.19.17</a></span></dt><dt><span class="section"><a href="#news.0_19_21">13.41. What's new in Pustefix 0.19.21</a></span></dt><dt><span class="section"><a href="#news.0_19_23">13.42. What's new in Pustefix 0.19.23</a></span></dt><dt><span class="section"><a href="#news.0_19_24">13.43. What's new in Pustefix 0.19.24</a></span></dt><dt><span class="section"><a href="#news.0_19_25">13.44. What's new in Pustefix 0.19.25</a></span></dt><dt><span class="section"><a href="#news.0_19_27">13.45. What's new in Pustefix 0.19.27</a></span></dt><dt><span class="section"><a href="#news.0_19_28">13.46. What's new in Pustefix 0.19.28</a></span></dt><dt><span class="section"><a href="#news.0_19_29">13.47. What's new in Pustefix 0.19.29</a></span></dt><dt><span class="section"><a href="#news.0_19_30">13.48. What's new in Pustefix 0.19.30</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_15_6"></a>13.1.&nbsp;What's new in Pustefix 0.15.6</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_15_6.modules"></a>13.1.1.&nbsp;Module enhancements</h3></div></div></div><p>
        Introduced pre-defined special module names <code class="literal">WEBAPP</code> and 
        <code class="literal">PAGEDEF</code>, which can be set as <code class="literal">module</code> values at <code class="literal">&lt;pfx:include&gt;</code>
        and <code class="literal">&lt;pfx:image&gt;</code> tags to explicitly refer to resources from the webapp folder
        or resources from within the module where a page is defined (see <a class="xref" href="#advanced.dyninclude.modinclude.special" title="Special module names">Special module names</a>).
      </p><p>
        The config-include mechanism now supports directly referencing config
        fragment files from modules by adding a <code class="literal">module</code> attribute to the according
        <code class="literal">&lt;config-include&gt;</code> elements (see <a class="xref" href="#configuration.depend" title="4.3.3.&nbsp;Page Configuration (depend.xml)">Section&nbsp;4.3.3, &#8220;Page Configuration (depend.xml)&#8221;</a> and <a class="xref" href="#configuration.servlet.contextxml" title="4.3.5.&nbsp;ContextXMLService configuration file">Section&nbsp;4.3.5, &#8220;ContextXMLService configuration file&#8221;</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_15_7"></a>13.2.&nbsp;What's new in Pustefix 0.15.7</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_15_7.modules"></a>13.2.1.&nbsp;Module enhancements</h3></div></div></div><p>
        Static web resources now can be delivered directly from modules without having to extract them to the webapp folder first
        by the build process. Thus it's no longer necessary to define resource mappings in the module's descriptor file (see
        <a class="xref" href="#modulessupport" title="Chapter&nbsp;9.&nbsp;Module Support">Chapter&nbsp;9, <i>Module Support</i></a>). Making
        resources from modules publicly available now just requires to define an according static path in the project configuration,
        e.g. <code class="literal">&lt;path&gt;/modules/mymodule/mypath/img&lt;/path&gt;</code> makes available the according folder 
        <code class="literal">/PUSTEFIX-INF/mypath/img</code> from the module/JAR file <code class="literal">mymodule</code>.
      </p><p>
        Status message files no longer require to be extracted using a resource mapping. 
        Now they're automatically detected within module jars
        and merged to the according <code class="literal">modules-override</code> folder.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_15_11"></a>13.3.&nbsp;What's new in Pustefix 0.15.11</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_15_11.config"></a>13.3.1.&nbsp;Configuration system enhancements</h3></div></div></div><p>
        We improved the configuration customization support by making context init parameters available as environment properties
        and thus usable as XPath variables during the customization process (see <a class="xref" href="#configuration.customization" title="4.2.&nbsp;Customization tools">Section&nbsp;4.2, &#8220;Customization tools&#8221;</a>).
      </p><p>
        Besides we dropped the storage of environment properties during the build (and the reusage at runtime). Thus a WAR file
        doesn't contain build-dependent settings any longer and can be used in different environments. Environment specific
        config customizations can be controlled by setting according context init parameters.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_15_13"></a>13.4.&nbsp;What's new in Pustefix 0.15.13</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_15_13.config"></a>13.4.1.&nbsp;Module/configuration enhancements</h3></div></div></div><p>
        Including configuration fragments from modules now can be done without having to directly specify the module names.
        Therefor the <code class="literal">config-include</code> element now supports <code class="literal">module</code> attribute values
        containing simple patterns, which will be matched against the names of the modules available in the classpath,
        e.g. <code class="literal">module="*"</code> will include all according configuration fragments found in the classpath,
        <code class="literal">module="*-us"</code> will include only fragments from modules whose name ends with <code class="literal">-us</code>.
      </p><p>
        Added support for conditional unpacking of module resources.
        Within the module descriptor you can set the optional <code class="literal">resources</code> element's 
        attribute <code class="literal">unpack</code> to <code class="literal">obsolete</code>. Thus the resources won't be extracted
	in the current or newer Pustefix versions (despite containing resource mappings).
        If you still want that obsolete resources are extracted, you can configure the Maven <code class="literal">pustefix-webapp-plugin</code>
	by adding <code class="literal">&lt;unpackObsolete&gt;true&lt;/unpackObsolete&gt;</code> to its configuration.
	This should help migrating modules and applications towards avoiding extracting resources at all, while keeping
        backwards compatibility for modules shared between different applications (see <a class="xref" href="#modulessupport" title="Chapter&nbsp;9.&nbsp;Module Support">Chapter&nbsp;9, <i>Module Support</i></a>).
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_15_13.tooling"></a>13.4.2.&nbsp;Tooling enhancements</h3></div></div></div><p>
        When hovering the closing include part delimiters displayed in edit mode, the tooltip now shows additional information for dynamic
        includes. It prints out the complete dynamic search chain, e.g. something like 
        <code class="literal">webapp(?) module-a(-) module-aa(+) module-ab(+)</code>, whereas <code class="literal">(?)</code> means that the file doesn't
        exist, <code class="literal">(-)</code> says that the file exists but doesn't contain the part, and <code class="literal">(+)</code> implies 
        that a file containing the part is found.
      </p><p>
        Introduced the Pustefix internals page. Similar to the DOM tree view this page provides some additional information useful
        during development, e.g. environment, JVM and module information (see <a class="xref" href="#tooling.pfxinternals" title="11.1.&nbsp;Pustefix internals page">Section&nbsp;11.1, &#8220;Pustefix internals page&#8221;</a>). 
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_15_14"></a>13.5.&nbsp;What's new in Pustefix 0.15.14</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_15_14.iwrapper"></a>13.5.1.&nbsp;IWrapper enhancements</h3></div></div></div><p>Annotation-based IWrappers now also support assigning IHandler beans by name. Therefor the <code class="literal">@IWrapper</code>
            annotation provides the new <code class="literal">beanRef</code> attribute (see <a class="xref" href="#advanced.iwrapperannotations.reference" title="7.9.1.&nbsp;IWrapper annotations">Section&nbsp;7.9.1, &#8220;IWrapper annotations&#8221;</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_15_17"></a>13.6.&nbsp;What's new in Pustefix 0.15.17</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_15_17.modules"></a>13.6.1.&nbsp;Module enhancements</h3></div></div></div><p>Modules now can define which directories contain static resources and should be publicly available. Thus you don't have
            to configure it in every application using the module. This configuration is done in the module deployment descriptor
            using <code class="literal">&lt;path/&gt;</code> elements within the <code class="literal">&lt;static/&gt;</code> top-level section 
            (see <a class="xref" href="#modulessupport" title="Chapter&nbsp;9.&nbsp;Module Support">Chapter&nbsp;9, <i>Module Support</i></a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_16_0"></a>13.7.&nbsp;What's new in Pustefix 0.16.0</h2></div></div></div><p>Pustefix 0.16.0 focuses on SEO. It brings more user and search engine friendly URLs. The main features are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          New session tracking strategies:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">Cookie-based session tracking</li><li class="listitem">Specialized session tracking strategy for search engine bots</li></ul></div><p>
        </p></li><li class="listitem"><p>
          URL cleanup
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">Page URLs without /xml prefix</li><li class="listitem">Use __frame parameter only on demand</li><li class="listitem">Sessionless URLs</li><li class="listitem">Home page under / (without redirect)</li></ul></div><p> 
        </p></li></ul></div><p>If you're migrating an existing appliation to Pustefix 0.16.0, you should have a look at <a class="xref" href="#upgrade" title="Chapter&nbsp;12.&nbsp;Upgrading to a newer Pustefix version">Chapter&nbsp;12, <i>Upgrading to a newer Pustefix version</i></a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_16_5"></a>13.8.&nbsp;What's new in Pustefix 0.16.5</h2></div></div></div><p>Pustefix 0.16.5 brings some CMS improvements. The CMS editor now supports editing of resources coming from modules
          (if they're loaded via the live mechanism). Modules are readonly by default, but can be made editable by adding
          <code class="literal">&lt;content-editable&gt;true&lt;/content-editable&gt;</code> to the module descriptor 
          (see <a class="xref" href="#modulessupport.types.new" title="9.1.&nbsp;Resources within library JARs">Section&nbsp;9.1, &#8220;Resources within library JARs&#8221;</a>). 
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_17_0"></a>13.9.&nbsp;What's new in Pustefix 0.17.0</h2></div></div></div><p>Pustefix 0.17.0 focuses on XSLT rendering improvements. It brings the so-called render extensions, a mechanism which allows
          to call an extension function to produce additional output and write it to the result of the main transformation (on the last
          transformation level).
    </p><p>The default render extension implementation, the so-called render include mechanism, supports the standalone rendering/outputting of 
        include parts.
        Thus you're able to include parts at runtime, e.g. based on the data from the result tree. In contrast to the traditional runtime
        includes, which are restricted to simple content and a subset of tags available on the last transformation level, the render includes support     
        arbitrary content because the metatags and master XSLT transformations are also applied (see <a class="xref" href="#xslt.renderextensions" title="5.3.4.&nbsp;Dynamically including parts at rendering time">Section&nbsp;5.3.4, &#8220;Dynamically including parts at rendering time&#8221;</a>).
    </p><p>
        Render include parts not just can be rendered within a regular main transformation, but can be also rendered standalone, i.e. you can 
        request a rendered part via AJAX to dynamically update your page. 
    </p><p>If you're migrating an existing appliation to Pustefix 0.17.0, you should have a look at <a class="xref" href="#upgrade" title="Chapter&nbsp;12.&nbsp;Upgrading to a newer Pustefix version">Chapter&nbsp;12, <i>Upgrading to a newer Pustefix version</i></a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_0"></a>13.10.&nbsp;What's new in Pustefix 0.18.0</h2></div></div></div><p>Pustefix 0.18.0 focuses on new internationalization features. It brings multi-tenancy on the view layer, supporting
          different views for different tenants (like countries or markets) within a single application instance, along with
	  runtime-switchable multi-language support, including internationalized page names.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_0.multitenancy"></a>13.10.1.&nbsp;Multi-tenancy</h3></div></div></div><p>
        Pustefix 0.18 provides multi-tenancy support on the view layer, i.e. it can create and deliver alternative versions of a page
        depending on a selected tenant. Tenants are automatically selected by matching host name patterns against the requested
        host name. Alternative page versions are created by applying filters to the dynamic include mechanism, thus overriding
        and extending the core page content with tenant- and/or language-specific content from according tenant/language modules
        (see <a class="xref" href="#advanced.multitenancy" title="7.4.&nbsp;Multitenancy">Section&nbsp;7.4, &#8220;Multitenancy&#8221;</a>).
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_0.multilanguage"></a>13.10.2.&nbsp;Multi-language</h3></div></div></div><p>
        Up to Pustefix 0.17 the only way to make the language of your application switchable at runtime was using
        the <code class="literal">&lt;pfx:langselect&gt;</code> tags to directly embed all language dependent content into the same
        part and theme side by side. With Pustefix 0.18 it's possible to automatically create different versions of a page serving
        different languages using the dynamic override mechanism, e.g. you can source out all language dependent content
        into own modules (language packs) which override a language independent core module (see <a class="xref" href="#advanced.i18n" title="7.3.&nbsp;Internationalization">Section&nbsp;7.3, &#8220;Internationalization&#8221;</a>).
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_0.sitemap"></a>13.10.3.&nbsp;Sitemap and i18n pagenames</h3></div></div></div><p>
        Pustefix 0.18 differentiates between logical page names and display page names. Thus you can rename pages or provide
        internationalized page names without having to change existing page references (to the logical page name). Such page aliases
        are configured in a file called <code class="literal">sitemap.xml</code> which is replacing the <code class="literal">navigation</code> configuration
        from <code class="literal">depend.xml</code> (see <a class="xref" href="#configuration.sitemap" title="4.3.4.&nbsp;Sitemap configuration">Section&nbsp;4.3.4, &#8220;Sitemap configuration&#8221;</a>).
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_0.pagealt"></a>13.10.4.&nbsp;Page alternatives</h3></div></div></div><p>
        Page alternatives are a new concept for creating different representations of a page (including possible variants). Page
        alternatives are internally used to create different versions for languages/tenants, but can be also used for
        pages which are based on a common page, assigned to the same logical page, but with different content and display pagename, e.g.
        landing pages (see <a class="xref" href="#advanced.pagealternatives" title="7.2.&nbsp;Page alternatives">Section&nbsp;7.2, &#8220;Page alternatives&#8221;</a>).
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_0.modules"></a>13.10.5.&nbsp;Pustefix modules</h3></div></div></div><p>
        The module mechanism has been extended to support sourcing out every kind of resource into modules, e.g. you
        can put arbitrary configuration files into modules (like <code class="literal">project.xml</code>, <code class="literal">depend.xml</code> or
        <code class="literal">spring.xml</code>). The Pustefix resource loading mechanism has been extended and now additionally 
        implements Spring's Resource abstraction layer. Thus you can use module URIs within the Spring configuration, e.g.
        for injecting module resources into beans.
      </p><p>
        The dynamic search mechanism now supports adding modules to the default search chain. This is declaratively done
        in the module descriptor <code class="literal">pustefix-module.xml</code>. You can additionally set a search priority to define
        a search order. Using filter attributes you can define a dynamic search filter allowing to include/exclude certain
        modules from searching/overriding, which is useful for multi-tenant/language applications to filter by tenant or language
        (see <a class="xref" href="#modulessupport.types.new" title="9.1.&nbsp;Resources within library JARs">Section&nbsp;9.1, &#8220;Resources within library JARs&#8221;</a>).
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_0.autoconfig"></a>13.10.6.&nbsp;Automatic configuration</h3></div></div></div><p>
        Pustefix 0.18 extends the <code class="literal">depend.xml</code> configuration by providing a <code class="literal">&lt;auto-standardpage&gt;</code>
        element which can be used as template, which automatically creates standardpage definitions for pages found in a specified
        folder (see <a class="xref" href="#configuration.depend.autostandardpage" title="Page auto-configuration">Page auto-configuration</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_2"></a>13.11.&nbsp;What's new in Pustefix 0.18.2</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_2.xslterrors"></a>13.11.1.&nbsp;Context information for XSLT errors</h3></div></div></div><p>
        The default error page for XSLT errors now provides additional contextual information. The error line from the XML file causing the
        error is cut out (including some surrounding lines) and added to the error page.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_2.xslttooling"></a>13.11.2.&nbsp;Switchable XSLT tooling extensions</h3></div></div></div><p>
        In prior versions the XSLT tooling extensions (dynamic include information, console, etc.) were always enabled if not running
        in production mode. Now you can selectively enable/disable the tooling extensions in all modes (except production mode). Therefore
        Pustefix introduced the configuration element <code class="literal">&lt;tooling-extensions&gt;</code> (see 
        <a class="xref" href="#configuration.project.projectxml" title="4.3.2.&nbsp;Project descriptor (project.xml)">Section&nbsp;4.3.2, &#8220;Project descriptor (project.xml)&#8221;</a>).
      </p><p>
        Besides the XSLT tooling has been decoupled from the editor settings, i.e. you can use the include information tooling without
        having the editor enabled.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_2.sitemap"></a>13.11.3.&nbsp;Search-engine sitemap generation</h3></div></div></div><p>
        Pustefix now supports generating search-engine sitemaps according to the sitemaps protocol (see
        <a class="link" href="http://www.sitemaps.org/protocol.html" target="_top">Sitemaps protocol specification</a>).
        Sitemap generation can be enabled by adding the <code class="literal">&lt;searchengine-sitemap/&gt;</code> element to the
        project configuration (see <a class="xref" href="#configuration.project.projectxml" title="4.3.2.&nbsp;Project descriptor (project.xml)">Section&nbsp;4.3.2, &#8220;Project descriptor (project.xml)&#8221;</a>).
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_2.pagealts"></a>13.11.4.&nbsp;Direct page alternative linking</h3></div></div></div><p>
        In prior Pustefix versions links to page alternatives created with <code class="literal">&lt;pfx:button&gt;</code> referenced the logical page
        and the application logic was responsible for detecting/setting the page alternative and thus triggering a redirect to the 
        according page alternative by Pustefix. 
      </p><p>
        Now <code class="literal">&lt;pfx:button&gt;</code> supports directly setting the page alternative key using the <code class="literal">altkey</code>
        attribute or <code class="literal">&lt;pfx:altkey&gt;</code> element. Thus Pustefix can directly reference the according page alternative
        name without having to do a redirect (see <a class="xref" href="#xslt.pfx.button" title="5.2.1.&nbsp;pfx:button">Section&nbsp;5.2.1, &#8220;pfx:button&#8221;</a>).
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_2.oxm"></a>13.11.5.&nbsp;OXM support for BigDecimal and BigInteger</h3></div></div></div><p>
        Pustefix's object-to-XML mapping mechanism now can serialize BigDecimal and BigInteger objects.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_5"></a>13.12.&nbsp;What's new in Pustefix 0.18.5</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_5.cmis"></a>13.12.1.&nbsp;CMIS support</h3></div></div></div><p>
        Added basic support for loading resources from content management systems using CMIS/AtomPub. 
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_5.pagealiases"></a>13.12.2.&nbsp;Page aliases</h3></div></div></div><p>
        Added XPath function to get current display page name during rendering (see <a class="xref" href="#xslt.extensions.xpathfunctions.getdisplaypagename">the section called &#8220;Page functions&#8221;</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_6"></a>13.13.&nbsp;What's new in Pustefix 0.18.6</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_6.xslt"></a>13.13.1.&nbsp;Include part existence check</h3></div></div></div><p>
        Added support for checking the existence of an include part during rendering, e.g. for displaying an include part depending on the existence of another include part (see <a class="xref" href="#xslt.pfx.checkinclude" title="5.3.5.&nbsp;Checking include part existence (<pfx:checkinclude&gt;)">Section&nbsp;5.3.5, &#8220;Checking include part existence (&lt;pfx:checkinclude&gt;)&#8221;</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_7"></a>13.14.&nbsp;What's new in Pustefix 0.18.7</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_7.sitemap"></a>13.14.1.&nbsp;Custom sitemap attributes</h3></div></div></div><p>
        Added support for using custom XML attributes at page elements within the sitemap configuration (see <a class="xref" href="#configuration.sitemap" title="4.3.4.&nbsp;Sitemap configuration">Section&nbsp;4.3.4, &#8220;Sitemap configuration&#8221;</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_9"></a>13.15.&nbsp;What's new in Pustefix 0.18.9</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_9.logging"></a>13.15.1.&nbsp;Log directory configuration</h3></div></div></div><p>
        Added support for setting the log directory using the context init parameter <code class="literal">logroot</code>. 
        The directory can be referenced in the log configuration file <code class="literal">pfixlog.xml</code> using the custom tag <code class="literal">&lt;cus:logroot/&gt;</code>.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_13"></a>13.16.&nbsp;What's new in Pustefix 0.18.13</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_13.xslt"></a>13.16.1.&nbsp;Getting environment properties from within XSLT</h3></div></div></div><p>
        Added support for getting environment from within XSLT using the XPath function <code class="literal">pfx:getEnvProperty</code> (see <a class="xref" href="#xslt.extensions.xpathfunctions" title="5.7.1.&nbsp;XPath functions">Section&nbsp;5.7.1, &#8220;XPath functions&#8221;</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_14"></a>13.17.&nbsp;What's new in Pustefix 0.18.14</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_14.session"></a>13.17.1.&nbsp;External session invalidation synchronization support</h3></div></div></div><p>
        Invalidating sessions outside of Pustefix, e.g. within a ServletFilter or Spring WebRequestInterceptor, can break concurrently running requests operating on the same session.
        Pustefix now can block such a session invalidation until all requests using this session are processed. Therefor Pustefix provides the new utility method 
        <code class="literal">SessionUtils.invalidate(session)</code>, which can be used instead of directly calling <code class="literal">invalidate()</code> at the <code class="literal">HttpSession</code>
        object.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_27"></a>13.18.&nbsp;What's new in Pustefix 0.18.27</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_27.contextresources"></a>13.18.1.&nbsp;Global output resources</h3></div></div></div><p>
        Added support for global output resources, i.e. output resources/ContextResources can be globally declared, thus being automatically added as output resources to all pagerequests.
        That's an alternative solution for adding global data and could replace the necessity of doing this programmatically via a basic <code class="literal">State</code> implementation.
        Global resources can be added to the new <code class="literal">&lt;global-output/&gt;</code> section of the context configuration
        (see <a class="xref" href="#configuration.servlet.contextxml" title="4.3.5.&nbsp;ContextXMLService configuration file">Section&nbsp;4.3.5, &#8220;ContextXMLService configuration file&#8221;</a>).
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_27.sessiontracking"></a>13.18.2.&nbsp;Cookie-only session tracking</h3></div></div></div><p>
        Added new sessiontracking strategy which forces cookie-based session tracking without falling back to URL rewriting when the browser has cookies disabled.
        The new strategy can be enabled by setting <code class="literal">&lt;session-tracking-strategy&gt;</code> to <code class="literal">COOKIEONLY</code> in the project configuration
        (see <a class="xref" href="#configuration.project.projectxml" title="4.3.2.&nbsp;Project descriptor (project.xml)">Section&nbsp;4.3.2, &#8220;Project descriptor (project.xml)&#8221;</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_29"></a>13.19.&nbsp;What's new in Pustefix 0.18.29</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_29.renderextensions"></a>13.19.1.&nbsp;Contextual render includes</h3></div></div></div><p>
        Added support for setting the context node of the main transformation as the context node of a render include sub-transformation by specifying 
        render parts as <code class="literal">contextual</code>.
        (see <a class="xref" href="#xslt.renderextensions" title="5.3.4.&nbsp;Dynamically including parts at rendering time">Section&nbsp;5.3.4, &#8220;Dynamically including parts at rendering time&#8221;</a>).
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_29.xslt"></a>13.19.2.&nbsp;XSL parameters within include parameter XPath expressions</h3></div></div></div><p>
        Added support for using XSL parameters within include parameter XPath expressions, e.g. you can access the page and sitemap parameters to dynamically create include part names. 
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_30"></a>13.20.&nbsp;What's new in Pustefix 0.18.30</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_30.oxm"></a>13.20.1.&nbsp;Object-to-XML mapping with JAXB</h3></div></div></div><p>
        Pustefix's object-to-XML mapping layer now alternatively supports marshalling via JAXB, e.g. <code class="literal">ContextResources</code> annotated with the according JAXB annotation 
        now are automatically serialized to the DOM tree via <code class="literal">JAXB</code> instead of the builtin serialization mechanism (see <a class="xref" href="#advanced.object2xml.jaxb" title="7.8.4.&nbsp;Using JAXB serialization">Section&nbsp;7.8.4, &#8220;Using JAXB serialization&#8221;</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_31"></a>13.21.&nbsp;What's new in Pustefix 0.18.31</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_31.pfxinternals"></a>13.21.1.&nbsp;TargetGenerator tooling extensions toggle</h3></div></div></div><p>
        Pustefix now supports toggling of the XSL tooling extensions at runtime. Thus you can generate pages in development mode being fully identical with the production version, which
        can be very helpful if you're debugging problems caused by the additional markup from the XSL tooling (like whitespace differences). The toggle can be found as action on the
        Pustefix internals page (see <a class="xref" href="#tooling.pfxinternals" title="11.1.&nbsp;Pustefix internals page">Section&nbsp;11.1, &#8220;Pustefix internals page&#8221;</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_34"></a>13.22.&nbsp;What's new in Pustefix 0.18.34</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_34.includeparams"></a>13.22.1.&nbsp;Extended include parameter support</h3></div></div></div><p>
        More Pustefix templates now support using include parameter expressions in attribute values (see <a class="xref" href="#xslt.pfx.includeparams" title="5.3.6.&nbsp;Include parameters (<pfx:includeparam&gt;)">Section&nbsp;5.3.6, &#8220;Include parameters (&lt;pfx:includeparam&gt;)&#8221;</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_35"></a>13.23.&nbsp;What's new in Pustefix 0.18.35</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_35.logging"></a>13.23.1.&nbsp;Early logging configuration</h3></div></div></div><p>
        Pustefix now supports setting up Log4j at early application startup time using a ServletContextListener, thus being able to log errors/messages occurring
        before the Spring application context is started (see <a class="xref" href="#configuration.logging" title="4.5.&nbsp;Logging configuration">Section&nbsp;4.5, &#8220;Logging configuration &#8221;</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_38"></a>13.24.&nbsp;What's new in Pustefix 0.18.38</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_38.pfxinternals"></a>13.24.1.&nbsp;Full text search</h3></div></div></div><p>
        Pustefix's development tooling now offers a full text search (at runtime). The search can be found on the <code class="literal">pfxinternals</code> page and supports searching the webapp, modules and the classpath using file name patterns and regular expressions (see <a class="xref" href="#tooling.pfxinternals.search" title="Figure&nbsp;11.4.&nbsp;Pustefix internals - Full text search">Figure&nbsp;11.4, &#8220;Pustefix internals - Full text search&#8221;</a>).
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_38.sitemap"></a>13.24.2.&nbsp;Default page alternatives</h3></div></div></div><p>
        Now you can choose a page alternative to be the default page alternative for a page. Thus linking or directly calling the logical page will trigger the according default page alternative
        (see <a class="xref" href="#configuration.sitemap" title="4.3.4.&nbsp;Sitemap configuration">Section&nbsp;4.3.4, &#8220;Sitemap configuration&#8221;</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_39"></a>13.25.&nbsp;What's new in Pustefix 0.18.39</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_39.xslt"></a>13.25.1.&nbsp;Setting pfx:button page at runtime</h3></div></div></div><p>
        The <code class="literal">&lt;pfx:button/&gt;</code> template now supports setting the page name at runtime using the <code class="literal">&lt;pfx:page/&gt;</code> child element (see <a class="xref" href="#xslt.pfx.button" title="5.2.1.&nbsp;pfx:button">Section&nbsp;5.2.1, &#8220;pfx:button&#8221;</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_42"></a>13.26.&nbsp;What's new in Pustefix 0.18.42</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_42.multitenancy"></a>13.26.1.&nbsp;Multitenancy/-language support for static resources</h3></div></div></div><p>
        Static resources now can be delivered in language/tenant-specific versions, whereas tenant/language act as additional path components, e.g. <code class="literal">/bar/foo.gif</code> is searched under <code class="literal">/bar/en_CA/foo.gif</code> and <code class="literal">/bar/en/foo.gif</code> first (see example in <a class="xref" href="#advanced.multitenancy" title="7.4.&nbsp;Multitenancy">Section&nbsp;7.4, &#8220;Multitenancy&#8221;</a>). This feature can be enabled on directory basis by addding the boolean attribute <code class="literal">i18n</code> to the according static path configurations (see <a class="xref" href="#configuration.project.projectxml" title="4.3.2.&nbsp;Project descriptor (project.xml)">Section&nbsp;4.3.2, &#8220;Project descriptor (project.xml)&#8221;</a> and <a class="xref" href="#modulessupport.types.new" title="9.1.&nbsp;Resources within library JARs">Section&nbsp;9.1, &#8220;Resources within library JARs&#8221;</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_59"></a>13.27.&nbsp;What's new in Pustefix 0.18.59</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_59.tooling"></a>13.27.1.&nbsp;Rendering pages with static DOM tree during development</h3></div></div></div><p>
        Introduced new special parameter <code class="literal">__staticdom</code>, which lets you render pages with the static DOM tree provided by the default <code class="literal">State</code>, e.g. for
        debugging view problems (see <a class="xref" href="#tooling.specialparams" title="11.2.&nbsp;Special parameters for development">Section&nbsp;11.2, &#8220;Special parameters for development&#8221;</a>).
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_59.xslt"></a>13.27.2.&nbsp;Added XSL extension elements for logging and debugging</h3></div></div></div><p>
        Added some XSL extension elements extending the standard way of outputting messages in XSL by supporting log level and Log4J loggers. Added extension element for fail-safe
        XSLT processing, e.g. on tooling or test pages (see <a class="xref" href="#xslt.extensions.extensionelements" title="5.7.2.&nbsp;XSL extension elements">Section&nbsp;5.7.2, &#8220;XSL extension elements&#8221;</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_63"></a>13.28.&nbsp;What's new in Pustefix 0.18.63</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_63.xslt"></a>13.28.1.&nbsp;Instance level XSLT extension functions</h3></div></div></div><p>
        Using the new XSLT extension function <code class="literal">pfx:getBean()</code> you can look up Spring beans and pass them as first argument to XSLT extension functions
        for making instance level method calls (see <a class="xref" href="#xslt.extensions.xpathfunctions.misc" title="Miscellaneous functions">the section called &#8220;Miscellaneous functions&#8221;</a>).
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_63.urls"></a>13.28.2.&nbsp;Preserving parameters on redirect</h3></div></div></div><p>
        Sometimes request parameters should be preserved when redirecting after a request has been processed, e.g. for tracking purposes. See <a class="xref" href="#configuration.servlet.contextxml" title="4.3.5.&nbsp;ContextXMLService configuration file">Section&nbsp;4.3.5, &#8220;ContextXMLService configuration file&#8221;</a>
        for details about the <code class="literal">&lt;preserve-params&gt;</code> configuration.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_63.includes"></a>13.28.3.&nbsp;Reflective include information</h3></div></div></div><p>
        Pustefix now provides some reflective include information during the XSL transformation. Using the new <code class="literal">pfx:getIncludeInfo</code> XPath function you can query the names 
        of all parts contained in a file, e.g. useful to automatically include generated include parts based on naming conventions 
        (see <a class="xref" href="#xslt.extensions.xpathfunctions.include" title="Include functions">the section called &#8220;Include functions&#8221;</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_64"></a>13.29.&nbsp;What's new in Pustefix 0.18.64</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_64.iwrapper"></a>13.29.1.&nbsp;Support standard Java regular expressions in IWrapper checks</h3></div></div></div><p>
        IWrapper parameters now can be checked using standard Java regular expressions instead of the special Perl5/Apache ORO expressions. To be backwards-compatible existing expressions, starting
        with <code class="literal">/</code>, still will be handled as Perl5 expressions. Other expressions will be treated as Java standard expression. Future Pustefix versions will completely remove
        the Apache ORO and convert Perl5 expressions to Java standard expression under the hood.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_64.multitenancy"></a>13.29.2.&nbsp;Support multitenant property configuration</h3></div></div></div><p>
        Properties within the Pustefix configuration files now can be configured tenant-dependent. The tenant can be specified using a <code class="literal">tenant</code> attribute, 
        e.g. <code class="literal">&lt;prop name="foo" tenant="UK"&gt;bar&lt;/prop&gt;</code> (see <a class="xref" href="#configuration.format.props" title="4.3.1.&nbsp;XML property files syntax">Section&nbsp;4.3.1, &#8220;XML property files syntax&#8221;</a>).
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_64.tooling"></a>13.29.3.&nbsp;Configurable result DOM viewing</h3></div></div></div><p>
        Viewing of the result DOM now is configurable using the <code class="literal">&lt;show-dom/&gt;</code> configuration element (see <a class="xref" href="#configuration.project.projectxml" title="4.3.2.&nbsp;Project descriptor (project.xml)">Section&nbsp;4.3.2, &#8220;Project descriptor (project.xml)&#8221;</a>).
        Additionally you can mark selected sessions as debuggable via JMX and thus make the DOM tree available for debugging purposes on production systems too.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_70"></a>13.30.&nbsp;What's new in Pustefix 0.18.70</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_70.aliases"></a>13.30.1.&nbsp;Page alias names with slashes</h3></div></div></div><p>
        Pustefix now supports using slashes in page alias names, e.g. <code class="literal">mysection/mypage</code>, which can help to create more user- or SEO-friendly URLs.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_71"></a>13.31.&nbsp;What's new in Pustefix 0.18.71</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_71.spring"></a>13.31.1.&nbsp;Environment-dependent Spring property files</h3></div></div></div><p>
        Pustefix provides a new <code class="literal">PropertyPlaceholderConfigurer</code> implementation which can be used to organize Spring properties in different environment-dependent files (see <a class="xref" href="#configuration.spring.envprops" title="4.4.2.&nbsp;Environment-dependent Spring property files">Section&nbsp;4.4.2, &#8220;Environment-dependent Spring property files&#8221;</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_18_87"></a>13.32.&nbsp;What's new in Pustefix 0.18.87</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="news.0_18_87.xslt"></a>13.32.1.&nbsp;New XPath string functions using pattern matching</h3></div></div></div><p>
        Pustefix provides the new XPath functions <code class="literal">pfx:matches()</code> and <code class="literal">pfx:replace()</code>, which basically are a backport of the according XPath 2.0 function, making pattern matching available in XSLT 1 (see <a class="xref" href="#xslt.extensions.xpathfunctions.string" title="String functions">the section called &#8220;String functions&#8221;</a>).
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_19_0"></a>13.33.&nbsp;What's new in Pustefix 0.19.0</h2></div></div></div><p>Pustefix 0.19.0 focuses on upgrading the underlying technologies/libraries. It added support for Servlet API 3 and Spring 4.
          The legacy dependency to Apache ORO was removed, i.e. stuff like regular expressions and LRU caches now are implemented completely
          based on the JDK standard library.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_19_4"></a>13.34.&nbsp;What's new in Pustefix 0.19.4</h2></div></div></div><p>Beginning with this version the Pustefix 0.19 line becomes the main development line. All new features from 0.18 now are available
          in 0.19 too and the development of the 0.18 line will be discontinued. It's recommended to upgrade existing applications to 0.19 soon
          (see <a class="xref" href="#upgrade.0_18_to_0_19" title="12.1.&nbsp;Upgrading from Pustefix 0.18 to 0.19">Section&nbsp;12.1, &#8220;Upgrading from Pustefix 0.18 to 0.19&#8221;</a>).
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_19_8"></a>13.35.&nbsp;What's new in Pustefix 0.19.8</h2></div></div></div><p>Passing through the last pageflow using the <code class="literal">__lf</code> URL parameter has become optional. It can be disabled using the new configuration switch
          <code class="literal">&lt;disable-pageflow-passthrough/&gt;</code> (see <a class="link" href="#configuration.servlet.contextxml.passthrough">configuration section</a>).
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_19_9"></a>13.36.&nbsp;What's new in Pustefix 0.19.9</h2></div></div></div><p>Pustefix now supports modularized log4j configurations and provides an appropriate default configuration, which helps keeping the logging configuration
          up-to-date with the latest Pustefix version and simplifies the maintenance of complex application logging configurations 
          (see <a class="link" href="#configuration.logging.includes">logging configuration</a>). Additionally Pustefix now allows changing of log levels at runtime
          via JMX.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_19_11"></a>13.37.&nbsp;What's new in Pustefix 0.19.11</h2></div></div></div><p>Extended form error checking tag by optionally supporting IWrapper parameter prefix/name and request trigger conditions, and adding a new tag
          with inverted semantics (see <a class="link" href="#xslt.forms.errors.fields" title="Errors attached to a field">tag reference</a>).
    </p><p>Improved render include Javascript library: support for passing arguments as JSON object, HTTP error callback functions
          (see <a class="link" href="#xslt.renderextensions.javascript">Javascript example</a>).
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_19_14"></a>13.38.&nbsp;What's new in Pustefix 0.19.14</h2></div></div></div><p>Added new Maven plugin for generating a complete list with display names of all renderable pages, e.g. can be used for automatic testing.
          (see <a class="xref" href="#tooling.mavenplugins.pagelist" title="11.3.2.&nbsp;Pustefix Pagelist Plugin">Section&nbsp;11.3.2, &#8220;Pustefix Pagelist Plugin&#8221;</a>).
    </p><p>Beautified and more SEO-friendly URLs by removing the <code class="literal">__reuse</code> parameter from redirect URLs (replaced by Spring flash attributes).</p><p>Pustefix now provides a simple Spring/annotation-based event mechanism. It should replace the deprecated way of coupling <code class="literal">ContextResources</code>
          using the <code class="literal">ContextResourceObserver</code> and <code class="literal">ObservableContextResource</code> interfaces (see <a class="xref" href="#advanced.eventbus" title="7.12.&nbsp;The Pustefix EventBus">Section&nbsp;7.12, &#8220;The Pustefix EventBus&#8221;</a>).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_19_15"></a>13.39.&nbsp;What's new in Pustefix 0.19.15</h2></div></div></div><p>Added support for rendering pages with non-200 status code (see <code class="literal">SPDocument.setResponseStatus()</code>) and 
          overriding declared error pages (see <code class="literal">SPDocument.setResponseErrorPageOverride()</code>).
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_19_17"></a>13.40.&nbsp;What's new in Pustefix 0.19.17</h2></div></div></div><p>Added support for Spring profiles. Pustefix now by default activates a profile for the current execution environment mode
          (see <a class="xref" href="#configuration.spring.profiles" title="4.4.3.&nbsp;Environment-dependent Spring profiles">Section&nbsp;4.4.3, &#8220;Environment-dependent Spring profiles&#8221;</a>).
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_19_21"></a>13.41.&nbsp;What's new in Pustefix 0.19.21</h2></div></div></div><p>Added support for using Google Closure Compiler to compress inline Javascript (default compressor will be the YUI compressor, if available in the classpath).
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_19_23"></a>13.42.&nbsp;What's new in Pustefix 0.19.23</h2></div></div></div><p>Improved rendering perforamnce (by extension function caching).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_19_24"></a>13.43.&nbsp;What's new in Pustefix 0.19.24</h2></div></div></div><p>Added new <code class="literal">DefaultIWrapperState</code> method <code class="literal">handleWrapperErrors</code> for processing validation errors,
          e.g. to log them.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_19_25"></a>13.44.&nbsp;What's new in Pustefix 0.19.25</h2></div></div></div><p>Added new <code class="literal">Context</code> method <code class="literal">invalidateSessionAfterCompletion</code> for guaranteed invalidation of 
          session after current request has been processed.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_19_27"></a>13.45.&nbsp;What's new in Pustefix 0.19.27</h2></div></div></div><p>Added new tool for analyzing XSL transformation performance.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_19_28"></a>13.46.&nbsp;What's new in Pustefix 0.19.28</h2></div></div></div><p>Improved rendering performance for pages with lots of runtime includes (by include extension function caching).</p><p>Added servlet filter for performance logging.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_19_29"></a>13.47.&nbsp;What's new in Pustefix 0.19.29</h2></div></div></div><p>Improved rendering performance for pages with lots of internal links (by caching callbacks).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="news.0_19_30"></a>13.48.&nbsp;What's new in Pustefix 0.19.30</h2></div></div></div><p><span class="emphasis"><em>We officially discontinue support for Java 1.7!</em></span> This is the first version which makes use of Java 1.8 features. 
          Almost a year after the EOL of Java 1.7 it's really about time to say goodbye.</p><p>Added support for generating request IDs which let you correlate log entries with specific web requests (see <a class="xref" href="#advanced.requestid" title="7.13.&nbsp;Request IDs for log correlation">Section&nbsp;7.13, &#8220;Request IDs for log correlation&#8221;</a>).</p><p>Added Eclipse m2e lifecycle mappings for Pustefix plugins to improve Eclipse IDE integration of Pustefix projects.</p></div></div></div></body></html>